var Ll=Object.defineProperty;var kl=(A,y,C)=>y in A?Ll(A,y,{enumerable:!0,configurable:!0,writable:!0,value:C}):A[y]=C;var $o=(A,y,C)=>(kl(A,typeof y!="symbol"?y+"":y,C),C);import{E as Rl,aM as Nl,aq as Ol,J as Gl,h as nt,c as He,n as ee,t as Pl,L as vc,x as bl,V as ni,o as qi,y as Ul,d as Ac,O as Fs,g as Xs,aN as Ks,i as Ae,K as ei,j as oo,u as ai,q as Ic,M as An,v as wl,w as xs,U as Fl,m as yc,P as Oi,N as Mc,aO as Vi,F as Nn,r as vt,H as On,aa as xl,aP as ql,k as ic,aQ as Cc,a9 as Vl,aI as ac,aR as Bl,aS as Ws,aT as sc,a0 as Hl,aU as eo,I as Kl,A as io,_ as si,z as Zs,B as Ys,aV as qs,aW as rc,aX as Gi,aY as Wl}from"./_plugin-vue_export-helper.5ebd159e.js";import{Z as Qs,c as de,r as ke,J as $s,d as st,h as J,t as no,q as rn,i as Wi,o as ao,l as Yi,Q as zs,p as zi,F as xt,W as cn,X as Bi,a0 as Yl,a1 as zl,Y as jl,R as Jl,y as Xl,a2 as cc,S as uc,b as re,e as he,f as ft,w as Kt,g as ue,k as In,j as At,u as ce,m as ji,n as Ji,C as js,s as gt,B as oi,a3 as Tc,D as to,a4 as Pi}from"./index.c5f202e6.js";import{l as Zl,n as Ql,b as $l,k as Dc}from"./use-message.903a1cae.js";import{c as ed,u as td,b as nd,N as ii}from"./Image.4d668f1c.js";function od(A){if(typeof A=="number")return{"":A.toString()};const y={};return A.split(/ +/).forEach(C=>{if(C==="")return;const[l,G]=C.split(":");G===void 0?y[""]=l:y[l]=G}),y}function $n(A,y){var C;if(A==null)return;const l=od(A);if(y===void 0)return l[""];if(typeof y=="string")return(C=l[y])!==null&&C!==void 0?C:l[""];if(Array.isArray(y)){for(let G=y.length-1;G>=0;--G){const S=y[G];if(S in l)return l[S]}return l[""]}else{let G,S=-1;return Object.keys(l).forEach(B=>{const E=Number(B);!Number.isNaN(E)&&y>=E&&E>=S&&(S=E,G=l[B])}),G}}function id(A,y="default",C=[]){const G=A.$slots[y];return G===void 0?C:G()}function ad(A){var y;const C=(y=A.dirs)===null||y===void 0?void 0:y.find(({dir:l})=>l===Qs);return!!(C&&C.value===!1)}const sd={xs:0,s:640,m:1024,l:1280,xl:1536,"2xl":1920};function rd(A){return`(min-width: ${A}px)`}const ti={};function cd(A=sd){if(!Rl)return de(()=>[]);if(typeof window.matchMedia!="function")return de(()=>[]);const y=ke({}),C=Object.keys(A),l=(G,S)=>{G.matches?y.value[S]=!0:y.value[S]=!1};return C.forEach(G=>{const S=A[G];let B,E;ti[S]===void 0?(B=window.matchMedia(rd(S)),B.addEventListener?B.addEventListener("change",W=>{E.forEach(F=>{F(W,G)})}):B.addListener&&B.addListener(W=>{E.forEach(F=>{F(W,G)})}),E=new Set,ti[S]={mql:B,cbs:E}):(B=ti[S].mql,E=ti[S].cbs),E.add(l),B.matches&&E.forEach(W=>{W(B,G)})}),$s(()=>{C.forEach(G=>{const{cbs:S}=ti[A[G]];S.has(l)&&S.delete(l)})}),de(()=>{const{value:G}=y;return C.filter(S=>G[S])})}function ud(A){return Nl(Ol(A).toLowerCase())}var ld=ed(function(A,y,C){return y=y.toLowerCase(),A+(C?ud(y):y)});const lc=ld,dd=st({name:"Eye",render(){return J("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},J("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),J("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),pd=st({name:"EyeOff",render(){return J("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},J("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"}),J("path",{d:"M255.66 384c-41.49 0-81.5-12.28-118.92-36.5c-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 0 0 .14-2.94L93.5 161.38a2 2 0 0 0-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0 0 75.8-12.58a2 2 0 0 0 .77-3.31l-21.58-21.58a4 4 0 0 0-3.83-1a204.8 204.8 0 0 1-51.16 6.47z",fill:"currentColor"}),J("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 0 0-74.89 12.83a2 2 0 0 0-.75 3.31l21.55 21.55a4 4 0 0 0 3.88 1a192.82 192.82 0 0 1 50.21-6.69c40.69 0 80.58 12.43 118.55 37c34.71 22.4 65.74 53.88 89.76 91a.13.13 0 0 1 0 .16a310.72 310.72 0 0 1-64.12 72.73a2 2 0 0 0-.15 2.95l19.9 19.89a2 2 0 0 0 2.7.13a343.49 343.49 0 0 0 68.64-78.48a32.2 32.2 0 0 0-.1-34.78z",fill:"currentColor"}),J("path",{d:"M256 160a95.88 95.88 0 0 0-21.37 2.4a2 2 0 0 0-1 3.38l112.59 112.56a2 2 0 0 0 3.38-1A96 96 0 0 0 256 160z",fill:"currentColor"}),J("path",{d:"M165.78 233.66a2 2 0 0 0-3.38 1a96 96 0 0 0 115 115a2 2 0 0 0 1-3.38z",fill:"currentColor"}))}}),gd=st({name:"ChevronDown",render(){return J("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},J("path",{d:"M3.14645 5.64645C3.34171 5.45118 3.65829 5.45118 3.85355 5.64645L8 9.79289L12.1464 5.64645C12.3417 5.45118 12.6583 5.45118 12.8536 5.64645C13.0488 5.84171 13.0488 6.15829 12.8536 6.35355L8.35355 10.8536C8.15829 11.0488 7.84171 11.0488 7.64645 10.8536L3.14645 6.35355C2.95118 6.15829 2.95118 5.84171 3.14645 5.64645Z",fill:"currentColor"}))}}),hd=Gl("clear",J("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},J("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},J("g",{fill:"currentColor","fill-rule":"nonzero"},J("path",{d:"M8,2 C11.3137085,2 14,4.6862915 14,8 C14,11.3137085 11.3137085,14 8,14 C4.6862915,14 2,11.3137085 2,8 C2,4.6862915 4.6862915,2 8,2 Z M6.5343055,5.83859116 C6.33943736,5.70359511 6.07001296,5.72288026 5.89644661,5.89644661 L5.89644661,5.89644661 L5.83859116,5.9656945 C5.70359511,6.16056264 5.72288026,6.42998704 5.89644661,6.60355339 L5.89644661,6.60355339 L7.293,8 L5.89644661,9.39644661 L5.83859116,9.4656945 C5.70359511,9.66056264 5.72288026,9.92998704 5.89644661,10.1035534 L5.89644661,10.1035534 L5.9656945,10.1614088 C6.16056264,10.2964049 6.42998704,10.2771197 6.60355339,10.1035534 L6.60355339,10.1035534 L8,8.707 L9.39644661,10.1035534 L9.4656945,10.1614088 C9.66056264,10.2964049 9.92998704,10.2771197 10.1035534,10.1035534 L10.1035534,10.1035534 L10.1614088,10.0343055 C10.2964049,9.83943736 10.2771197,9.57001296 10.1035534,9.39644661 L10.1035534,9.39644661 L8.707,8 L10.1035534,6.60355339 L10.1614088,6.5343055 C10.2964049,6.33943736 10.2771197,6.07001296 10.1035534,5.89644661 L10.1035534,5.89644661 L10.0343055,5.83859116 C9.83943736,5.70359511 9.57001296,5.72288026 9.39644661,5.89644661 L9.39644661,5.89644661 L8,7.293 L6.60355339,5.89644661 Z"}))))),_d=nt("base-clear",`
 flex-shrink: 0;
 height: 1em;
 width: 1em;
 position: relative;
`,[He(">",[ee("clear",`
 font-size: var(--n-clear-size);
 height: 1em;
 width: 1em;
 cursor: pointer;
 color: var(--n-clear-color);
 transition: color .3s var(--n-bezier);
 display: flex;
 `,[He("&:hover",`
 color: var(--n-clear-color-hover)!important;
 `),He("&:active",`
 color: var(--n-clear-color-pressed)!important;
 `)]),ee("placeholder",`
 display: flex;
 `),ee("clear, placeholder",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[Pl({originalTransform:"translateX(-50%) translateY(-50%)",left:"50%",top:"50%"})])])]),Js=st({name:"BaseClear",props:{clsPrefix:{type:String,required:!0},show:Boolean,onClear:Function},setup(A){return vc("-base-clear",_d,no(A,"clsPrefix")),{handleMouseDown(y){y.preventDefault()}}},render(){const{clsPrefix:A}=this;return J("div",{class:`${A}-base-clear`},J(bl,null,{default:()=>{var y,C;return this.show?J("div",{key:"dismiss",class:`${A}-base-clear__clear`,onClick:this.onClear,onMousedown:this.handleMouseDown,"data-clear":!0},ni(this.$slots.icon,()=>[J(qi,{clsPrefix:A},{default:()=>J(hd,null)})])):J("div",{key:"icon",class:`${A}-base-clear__placeholder`},(C=(y=this.$slots).placeholder)===null||C===void 0?void 0:C.call(y))}}))}}),fd=st({name:"InternalSelectionSuffix",props:{clsPrefix:{type:String,required:!0},showArrow:{type:Boolean,default:void 0},showClear:{type:Boolean,default:void 0},loading:{type:Boolean,default:!1},onClear:Function},setup(A,{slots:y}){return()=>{const{clsPrefix:C}=A;return J(Ul,{clsPrefix:C,class:`${C}-base-suffix`,strokeWidth:24,scale:.85,show:A.loading},{default:()=>A.showArrow?J(Js,{clsPrefix:C,show:A.showClear,onClear:A.onClear},{placeholder:()=>J(qi,{clsPrefix:C,class:`${C}-base-suffix__arrow`},{default:()=>ni(y.default,()=>[J(gd,null)])})}):null})}}}),md={paddingTiny:"0 8px",paddingSmall:"0 10px",paddingMedium:"0 12px",paddingLarge:"0 14px",clearSize:"16px"},vd=A=>{const{textColor2:y,textColor3:C,textColorDisabled:l,primaryColor:G,primaryColorHover:S,inputColor:B,inputColorDisabled:E,borderColor:W,warningColor:F,warningColorHover:j,errorColor:oe,errorColorHover:pe,borderRadius:Ge,lineHeight:Q,fontSizeTiny:ae,fontSizeSmall:X,fontSizeMedium:te,fontSizeLarge:z,heightTiny:b,heightSmall:ie,heightMedium:De,heightLarge:Ve,actionColor:Ue,clearColor:ut,clearColorHover:Re,clearColorPressed:K,placeholderColor:g,placeholderColorDisabled:Me,iconColor:Vt,iconColorDisabled:Pe,iconColorHover:Nt,iconColorPressed:ze}=A;return Object.assign(Object.assign({},md),{countTextColorDisabled:l,countTextColor:C,heightTiny:b,heightSmall:ie,heightMedium:De,heightLarge:Ve,fontSizeTiny:ae,fontSizeSmall:X,fontSizeMedium:te,fontSizeLarge:z,lineHeight:Q,lineHeightTextarea:Q,borderRadius:Ge,iconSize:"16px",groupLabelColor:Ue,groupLabelTextColor:y,textColor:y,textColorDisabled:l,textDecorationColor:y,caretColor:G,placeholderColor:g,placeholderColorDisabled:Me,color:B,colorDisabled:E,colorFocus:B,groupLabelBorder:`1px solid ${W}`,border:`1px solid ${W}`,borderHover:`1px solid ${S}`,borderDisabled:`1px solid ${W}`,borderFocus:`1px solid ${S}`,boxShadowFocus:`0 0 0 2px ${Fs(G,{alpha:.2})}`,loadingColor:G,loadingColorWarning:F,borderWarning:`1px solid ${F}`,borderHoverWarning:`1px solid ${j}`,colorFocusWarning:B,borderFocusWarning:`1px solid ${j}`,boxShadowFocusWarning:`0 0 0 2px ${Fs(F,{alpha:.2})}`,caretColorWarning:F,loadingColorError:oe,borderError:`1px solid ${oe}`,borderHoverError:`1px solid ${pe}`,colorFocusError:B,borderFocusError:`1px solid ${pe}`,boxShadowFocusError:`0 0 0 2px ${Fs(oe,{alpha:.2})}`,caretColorError:oe,clearColor:ut,clearColorHover:Re,clearColorPressed:K,iconColor:Vt,iconColorDisabled:Pe,iconColorHover:Nt,iconColorPressed:ze,suffixTextColor:y})},Ad={name:"Input",common:Ac,self:vd},Id=Ad,Sc=Xs("n-input");function yd(A){let y=0;for(const C of A)y++;return y}function bi(A){return A===""||A==null}function Md(A){const y=ke(null);function C(){const{value:S}=A;if(!(S!=null&&S.focus)){G();return}const{selectionStart:B,selectionEnd:E,value:W}=S;if(B==null||E==null){G();return}y.value={start:B,end:E,beforeText:W.slice(0,B),afterText:W.slice(E)}}function l(){var S;const{value:B}=y,{value:E}=A;if(!B||!E)return;const{value:W}=E,{start:F,beforeText:j,afterText:oe}=B;let pe=W.length;if(W.endsWith(oe))pe=W.length-oe.length;else if(W.startsWith(j))pe=j.length;else{const Ge=j[F-1],Q=W.indexOf(Ge,F-1);Q!==-1&&(pe=Q+1)}(S=E.setSelectionRange)===null||S===void 0||S.call(E,pe,pe)}function G(){y.value=null}return rn(A,G),{recordCursor:C,restoreCursor:l}}const dc=st({name:"InputWordCount",setup(A,{slots:y}){const{mergedValueRef:C,maxlengthRef:l,mergedClsPrefixRef:G,countGraphemesRef:S}=Wi(Sc),B=de(()=>{const{value:E}=C;return E===null||Array.isArray(E)?0:(S.value||yd)(E)});return()=>{const{value:E}=l,{value:W}=C;return J("span",{class:`${G.value}-input-word-count`},Ks(y.default,{value:W===null||Array.isArray(W)?"":W},()=>[E===void 0?B.value:`${B.value} / ${E}`]))}}}),Cd=nt("input",`
 max-width: 100%;
 cursor: text;
 line-height: 1.5;
 z-index: auto;
 outline: none;
 box-sizing: border-box;
 position: relative;
 display: inline-flex;
 border-radius: var(--n-border-radius);
 background-color: var(--n-color);
 transition: background-color .3s var(--n-bezier);
 font-size: var(--n-font-size);
 --n-padding-vertical: calc((var(--n-height) - 1.5 * var(--n-font-size)) / 2);
`,[ee("input, textarea",`
 overflow: hidden;
 flex-grow: 1;
 position: relative;
 `),ee("input-el, textarea-el, input-mirror, textarea-mirror, separator, placeholder",`
 box-sizing: border-box;
 font-size: inherit;
 line-height: 1.5;
 font-family: inherit;
 border: none;
 outline: none;
 background-color: #0000;
 text-align: inherit;
 transition:
 -webkit-text-fill-color .3s var(--n-bezier),
 caret-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier);
 `),ee("input-el, textarea-el",`
 -webkit-appearance: none;
 scrollbar-width: none;
 width: 100%;
 min-width: 0;
 text-decoration-color: var(--n-text-decoration-color);
 color: var(--n-text-color);
 caret-color: var(--n-caret-color);
 background-color: transparent;
 `,[He("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",`
 width: 0;
 height: 0;
 display: none;
 `),He("&::placeholder",`
 color: #0000;
 -webkit-text-fill-color: transparent !important;
 `),He("&:-webkit-autofill ~",[ee("placeholder","display: none;")])]),Ae("round",[ei("textarea","border-radius: calc(var(--n-height) / 2);")]),ee("placeholder",`
 pointer-events: none;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 overflow: hidden;
 color: var(--n-placeholder-color);
 `,[He("span",`
 width: 100%;
 display: inline-block;
 `)]),Ae("textarea",[ee("placeholder","overflow: visible;")]),ei("autosize","width: 100%;"),Ae("autosize",[ee("textarea-el, input-el",`
 position: absolute;
 top: 0;
 left: 0;
 height: 100%;
 `)]),nt("input-wrapper",`
 overflow: hidden;
 display: inline-flex;
 flex-grow: 1;
 position: relative;
 padding-left: var(--n-padding-left);
 padding-right: var(--n-padding-right);
 `),ee("input-mirror",`
 padding: 0;
 height: var(--n-height);
 line-height: var(--n-height);
 overflow: hidden;
 visibility: hidden;
 position: static;
 white-space: pre;
 pointer-events: none;
 `),ee("input-el",`
 padding: 0;
 height: var(--n-height);
 line-height: var(--n-height);
 `,[He("&[type=password]::-ms-reveal","display: none;"),He("+",[ee("placeholder",`
 display: flex;
 align-items: center; 
 `)])]),ei("textarea",[ee("placeholder","white-space: nowrap;")]),ee("eye",`
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `),Ae("textarea","width: 100%;",[nt("input-word-count",`
 position: absolute;
 right: var(--n-padding-right);
 bottom: var(--n-padding-vertical);
 `),Ae("resizable",[nt("input-wrapper",`
 resize: vertical;
 min-height: var(--n-height);
 `)]),ee("textarea-el, textarea-mirror, placeholder",`
 height: 100%;
 padding-left: 0;
 padding-right: 0;
 padding-top: var(--n-padding-vertical);
 padding-bottom: var(--n-padding-vertical);
 word-break: break-word;
 display: inline-block;
 vertical-align: bottom;
 box-sizing: border-box;
 line-height: var(--n-line-height-textarea);
 margin: 0;
 resize: none;
 white-space: pre-wrap;
 scroll-padding-block-end: var(--n-padding-vertical);
 `),ee("textarea-mirror",`
 width: 100%;
 pointer-events: none;
 overflow: hidden;
 visibility: hidden;
 position: static;
 white-space: pre-wrap;
 overflow-wrap: break-word;
 `)]),Ae("pair",[ee("input-el, placeholder","text-align: center;"),ee("separator",`
 display: flex;
 align-items: center;
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 white-space: nowrap;
 `,[nt("icon",`
 color: var(--n-icon-color);
 `),nt("base-icon",`
 color: var(--n-icon-color);
 `)])]),Ae("disabled",`
 cursor: not-allowed;
 background-color: var(--n-color-disabled);
 `,[ee("border","border: var(--n-border-disabled);"),ee("input-el, textarea-el",`
 cursor: not-allowed;
 color: var(--n-text-color-disabled);
 text-decoration-color: var(--n-text-color-disabled);
 `),ee("placeholder","color: var(--n-placeholder-color-disabled);"),ee("separator","color: var(--n-text-color-disabled);",[nt("icon",`
 color: var(--n-icon-color-disabled);
 `),nt("base-icon",`
 color: var(--n-icon-color-disabled);
 `)]),nt("input-word-count",`
 color: var(--n-count-text-color-disabled);
 `),ee("suffix, prefix","color: var(--n-text-color-disabled);",[nt("icon",`
 color: var(--n-icon-color-disabled);
 `),nt("internal-icon",`
 color: var(--n-icon-color-disabled);
 `)])]),ei("disabled",[ee("eye",`
 color: var(--n-icon-color);
 cursor: pointer;
 `,[He("&:hover",`
 color: var(--n-icon-color-hover);
 `),He("&:active",`
 color: var(--n-icon-color-pressed);
 `)]),He("&:hover",[ee("state-border","border: var(--n-border-hover);")]),Ae("focus","background-color: var(--n-color-focus);",[ee("state-border",`
 border: var(--n-border-focus);
 box-shadow: var(--n-box-shadow-focus);
 `)])]),ee("border, state-border",`
 box-sizing: border-box;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 pointer-events: none;
 border-radius: inherit;
 border: var(--n-border);
 transition:
 box-shadow .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),ee("state-border",`
 border-color: #0000;
 z-index: 1;
 `),ee("prefix","margin-right: 4px;"),ee("suffix",`
 margin-left: 4px;
 `),ee("suffix, prefix",`
 transition: color .3s var(--n-bezier);
 flex-wrap: nowrap;
 flex-shrink: 0;
 line-height: var(--n-height);
 white-space: nowrap;
 display: inline-flex;
 align-items: center;
 justify-content: center;
 color: var(--n-suffix-text-color);
 `,[nt("base-loading",`
 font-size: var(--n-icon-size);
 margin: 0 2px;
 color: var(--n-loading-color);
 `),nt("base-clear",`
 font-size: var(--n-icon-size);
 `,[ee("placeholder",[nt("base-icon",`
 transition: color .3s var(--n-bezier);
 color: var(--n-icon-color);
 font-size: var(--n-icon-size);
 `)])]),He(">",[nt("icon",`
 transition: color .3s var(--n-bezier);
 color: var(--n-icon-color);
 font-size: var(--n-icon-size);
 `)]),nt("base-icon",`
 font-size: var(--n-icon-size);
 `)]),nt("input-word-count",`
 pointer-events: none;
 line-height: 1.5;
 font-size: .85em;
 color: var(--n-count-text-color);
 transition: color .3s var(--n-bezier);
 margin-left: 4px;
 font-variant: tabular-nums;
 `),["warning","error"].map(A=>Ae(`${A}-status`,[ei("disabled",[nt("base-loading",`
 color: var(--n-loading-color-${A})
 `),ee("input-el, textarea-el",`
 caret-color: var(--n-caret-color-${A});
 `),ee("state-border",`
 border: var(--n-border-${A});
 `),He("&:hover",[ee("state-border",`
 border: var(--n-border-hover-${A});
 `)]),He("&:focus",`
 background-color: var(--n-color-focus-${A});
 `,[ee("state-border",`
 box-shadow: var(--n-box-shadow-focus-${A});
 border: var(--n-border-focus-${A});
 `)]),Ae("focus",`
 background-color: var(--n-color-focus-${A});
 `,[ee("state-border",`
 box-shadow: var(--n-box-shadow-focus-${A});
 border: var(--n-border-focus-${A});
 `)])])]))]),Td=nt("input",[Ae("disabled",[ee("input-el, textarea-el",`
 -webkit-text-fill-color: var(--n-text-color-disabled);
 `)])]),Dd=Object.assign(Object.assign({},ai.props),{bordered:{type:Boolean,default:void 0},type:{type:String,default:"text"},placeholder:[Array,String],defaultValue:{type:[String,Array],default:null},value:[String,Array],disabled:{type:Boolean,default:void 0},size:String,rows:{type:[Number,String],default:3},round:Boolean,minlength:[String,Number],maxlength:[String,Number],clearable:Boolean,autosize:{type:[Boolean,Object],default:!1},pair:Boolean,separator:String,readonly:{type:[String,Boolean],default:!1},passivelyActivated:Boolean,showPasswordOn:String,stateful:{type:Boolean,default:!0},autofocus:Boolean,inputProps:Object,resizable:{type:Boolean,default:!0},showCount:Boolean,loading:{type:Boolean,default:void 0},allowInput:Function,renderCount:Function,onMousedown:Function,onKeydown:Function,onKeyup:[Function,Array],onInput:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClick:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],countGraphemes:Function,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],textDecoration:[String,Array],attrSize:{type:Number,default:20},onInputBlur:[Function,Array],onInputFocus:[Function,Array],onDeactivate:[Function,Array],onActivate:[Function,Array],onWrapperFocus:[Function,Array],onWrapperBlur:[Function,Array],internalDeactivateOnEnter:Boolean,internalForceFocus:Boolean,internalLoadingBeforeSuffix:{type:Boolean,default:!0},showPasswordToggle:Boolean}),Sd=st({name:"Input",props:Dd,setup(A){const{mergedClsPrefixRef:y,mergedBorderedRef:C,inlineThemeDisabled:l,mergedRtlRef:G}=oo(A),S=ai("Input","-input",Cd,Id,A,y);Zl&&vc("-input-safari",Td,y);const B=ke(null),E=ke(null),W=ke(null),F=ke(null),j=ke(null),oe=ke(null),pe=ke(null),Ge=Md(pe),Q=ke(null),{localeRef:ae}=td("Input"),X=ke(A.defaultValue),te=no(A,"value"),z=Ic(te,X),b=Ql(A),{mergedSizeRef:ie,mergedDisabledRef:De,mergedStatusRef:Ve}=b,Ue=ke(!1),ut=ke(!1),Re=ke(!1),K=ke(!1);let g=null;const Me=de(()=>{const{placeholder:T,pair:x}=A;return x?Array.isArray(T)?T:T===void 0?["",""]:[T,T]:T===void 0?[ae.value.placeholder]:[T]}),Vt=de(()=>{const{value:T}=Re,{value:x}=z,{value:L}=Me;return!T&&(bi(x)||Array.isArray(x)&&bi(x[0]))&&L[0]}),Pe=de(()=>{const{value:T}=Re,{value:x}=z,{value:L}=Me;return!T&&L[1]&&(bi(x)||Array.isArray(x)&&bi(x[1]))}),Nt=An(()=>A.internalForceFocus||Ue.value),ze=An(()=>{if(De.value||A.readonly||!A.clearable||!Nt.value&&!ut.value)return!1;const{value:T}=z,{value:x}=Nt;return A.pair?!!(Array.isArray(T)&&(T[0]||T[1]))&&(ut.value||x):!!T&&(ut.value||x)}),Xt=de(()=>{const{showPasswordOn:T}=A;if(T)return T;if(A.showPasswordToggle)return"click"}),qt=ke(!1),un=de(()=>{const{textDecoration:T}=A;return T?Array.isArray(T)?T.map(x=>({textDecoration:x})):[{textDecoration:T}]:["",""]}),O=ke(void 0),Ce=()=>{var T,x;if(A.type==="textarea"){const{autosize:L}=A;if(L&&(O.value=(x=(T=Q.value)===null||T===void 0?void 0:T.$el)===null||x===void 0?void 0:x.offsetWidth),!E.value||typeof L=="boolean")return;const{paddingTop:Fe,paddingBottom:Ye,lineHeight:Le}=window.getComputedStyle(E.value),ge=Number(Fe.slice(0,-2)),dt=Number(Ye.slice(0,-2)),Ie=Number(Le.slice(0,-2)),{value:q}=W;if(!q)return;if(L.minRows){const qe=Math.max(L.minRows,1),qn=`${ge+dt+Ie*qe}px`;q.style.minHeight=qn}if(L.maxRows){const qe=`${ge+dt+Ie*L.maxRows}px`;q.style.maxHeight=qe}}},ln=de(()=>{const{maxlength:T}=A;return T===void 0?void 0:Number(T)});ao(()=>{const{value:T}=z;Array.isArray(T)||hn(T)});const Zt=Yi().proxy;function Ot(T,x){const{onUpdateValue:L,"onUpdate:value":Fe,onInput:Ye}=A,{nTriggerFormInput:Le}=b;L&&vt(L,T,x),Fe&&vt(Fe,T,x),Ye&&vt(Ye,T,x),X.value=T,Le()}function ht(T,x){const{onChange:L}=A,{nTriggerFormChange:Fe}=b;L&&vt(L,T,x),X.value=T,Fe()}function Gn(T){const{onBlur:x}=A,{nTriggerFormBlur:L}=b;x&&vt(x,T),L()}function Qe(T){const{onFocus:x}=A,{nTriggerFormFocus:L}=b;x&&vt(x,T),L()}function It(T){const{onClear:x}=A;x&&vt(x,T)}function Wt(T){const{onInputBlur:x}=A;x&&vt(x,T)}function lt(T){const{onInputFocus:x}=A;x&&vt(x,T)}function $e(){const{onDeactivate:T}=A;T&&vt(T)}function dn(){const{onActivate:T}=A;T&&vt(T)}function me(T){const{onClick:x}=A;x&&vt(x,T)}function Ke(T){const{onWrapperFocus:x}=A;x&&vt(x,T)}function fe(T){const{onWrapperBlur:x}=A;x&&vt(x,T)}function Be(){Re.value=!0}function so(T){Re.value=!1,T.target===oe.value?yt(T,1):yt(T,0)}function yt(T,x=0,L="input"){const Fe=T.target.value;if(hn(Fe),T instanceof InputEvent&&!T.isComposing&&(Re.value=!1),A.type==="textarea"){const{value:Le}=Q;Le&&Le.syncUnifiedContainer()}if(g=Fe,Re.value)return;Ge.recordCursor();const Ye=ro(Fe);if(Ye)if(!A.pair)L==="input"?Ot(Fe,{source:x}):ht(Fe,{source:x});else{let{value:Le}=z;Array.isArray(Le)?Le=[Le[0],Le[1]]:Le=["",""],Le[x]=Fe,L==="input"?Ot(Le,{source:x}):ht(Le,{source:x})}Zt.$forceUpdate(),Ye||cn(Ge.restoreCursor)}function ro(T){const{countGraphemes:x,maxlength:L,minlength:Fe}=A;if(x){let Le;if(L!==void 0&&(Le===void 0&&(Le=x(T)),Le>Number(L))||Fe!==void 0&&(Le===void 0&&(Le=x(T)),Le<Number(L)))return!1}const{allowInput:Ye}=A;return typeof Ye=="function"?Ye(T):!0}function yn(T){Wt(T),T.relatedTarget===B.value&&$e(),T.relatedTarget!==null&&(T.relatedTarget===j.value||T.relatedTarget===oe.value||T.relatedTarget===E.value)||(K.value=!1),jt(T,"blur"),pe.value=null}function pn(T,x){lt(T),Ue.value=!0,K.value=!0,dn(),jt(T,"focus"),x===0?pe.value=j.value:x===1?pe.value=oe.value:x===2&&(pe.value=E.value)}function Yt(T){A.passivelyActivated&&(fe(T),jt(T,"blur"))}function zt(T){A.passivelyActivated&&(Ue.value=!0,Ke(T),jt(T,"focus"))}function jt(T,x){T.relatedTarget!==null&&(T.relatedTarget===j.value||T.relatedTarget===oe.value||T.relatedTarget===E.value||T.relatedTarget===B.value)||(x==="focus"?(Qe(T),Ue.value=!0):x==="blur"&&(Gn(T),Ue.value=!1))}function Qt(T,x){yt(T,x,"change")}function Gt(T){me(T)}function Mn(T){It(T),St()}function St(){A.pair?(Ot(["",""],{source:"clear"}),ht(["",""],{source:"clear"})):(Ot("",{source:"clear"}),ht("",{source:"clear"}))}function $t(T){const{onMousedown:x}=A;x&&x(T);const{tagName:L}=T.target;if(L!=="INPUT"&&L!=="TEXTAREA"){if(A.resizable){const{value:Fe}=B;if(Fe){const{left:Ye,top:Le,width:ge,height:dt}=Fe.getBoundingClientRect(),Ie=14;if(Ye+ge-Ie<T.clientX&&T.clientX<Ye+ge&&Le+dt-Ie<T.clientY&&T.clientY<Le+dt)return}}T.preventDefault(),Ue.value||tn()}}function Cn(){var T;ut.value=!0,A.type==="textarea"&&((T=Q.value)===null||T===void 0||T.handleMouseEnterWrapper())}function en(){var T;ut.value=!1,A.type==="textarea"&&((T=Q.value)===null||T===void 0||T.handleMouseLeaveWrapper())}function Bt(){De.value||Xt.value==="click"&&(qt.value=!qt.value)}function Pn(T){if(De.value)return;T.preventDefault();const x=Fe=>{Fe.preventDefault(),On("mouseup",document,x)};if(Nn("mouseup",document,x),Xt.value!=="mousedown")return;qt.value=!0;const L=()=>{qt.value=!1,On("mouseup",document,L)};Nn("mouseup",document,L)}function bn(T){A.onKeyup&&vt(A.onKeyup,T)}function Un(T){switch(A.onKeydown&&vt(A.onKeydown,T),T.key){case"Escape":gn();break;case"Enter":wn(T);break}}function wn(T){var x,L;if(A.passivelyActivated){const{value:Fe}=K;if(Fe){A.internalDeactivateOnEnter&&gn();return}T.preventDefault(),A.type==="textarea"?(x=E.value)===null||x===void 0||x.focus():(L=j.value)===null||L===void 0||L.focus()}}function gn(){A.passivelyActivated&&(K.value=!1,cn(()=>{var T;(T=B.value)===null||T===void 0||T.focus()}))}function tn(){var T,x,L;De.value||(A.passivelyActivated?(T=B.value)===null||T===void 0||T.focus():((x=E.value)===null||x===void 0||x.focus(),(L=j.value)===null||L===void 0||L.focus()))}function Fn(){var T;!((T=B.value)===null||T===void 0)&&T.contains(document.activeElement)&&document.activeElement.blur()}function nn(){var T,x;(T=E.value)===null||T===void 0||T.select(),(x=j.value)===null||x===void 0||x.select()}function Et(){De.value||(E.value?E.value.focus():j.value&&j.value.focus())}function Pt(){const{value:T}=B;(T==null?void 0:T.contains(document.activeElement))&&T!==document.activeElement&&gn()}function xn(T){if(A.type==="textarea"){const{value:x}=E;x==null||x.scrollTo(T)}else{const{value:x}=j;x==null||x.scrollTo(T)}}function hn(T){const{type:x,pair:L,autosize:Fe}=A;if(!L&&Fe)if(x==="textarea"){const{value:Ye}=W;Ye&&(Ye.textContent=(T!=null?T:"")+`\r
`)}else{const{value:Ye}=F;Ye&&(T?Ye.textContent=T:Ye.innerHTML="&nbsp;")}}function u(){Ce()}const Lt=ke({top:"0"});function k(T){var x;const{scrollTop:L}=T.target;Lt.value.top=`${-L}px`,(x=Q.value)===null||x===void 0||x.syncUnifiedContainer()}let Y=null;zs(()=>{const{autosize:T,type:x}=A;T&&x==="textarea"?Y=rn(z,L=>{!Array.isArray(L)&&L!==g&&hn(L)}):Y==null||Y()});let se=null;zs(()=>{A.type==="textarea"?se=rn(z,T=>{var x;!Array.isArray(T)&&T!==g&&((x=Q.value)===null||x===void 0||x.syncUnifiedContainer())}):se==null||se()}),zi(Sc,{mergedValueRef:z,maxlengthRef:ln,mergedClsPrefixRef:y,countGraphemesRef:no(A,"countGraphemes")});const Te={wrapperElRef:B,inputElRef:j,textareaElRef:E,isCompositing:Re,clear:St,focus:tn,blur:Fn,select:nn,deactivate:Pt,activate:Et,scrollTo:xn},Se=wl("Input",G,y),_e=de(()=>{const{value:T}=ie,{common:{cubicBezierEaseInOut:x},self:{color:L,borderRadius:Fe,textColor:Ye,caretColor:Le,caretColorError:ge,caretColorWarning:dt,textDecorationColor:Ie,border:q,borderDisabled:qe,borderHover:qn,borderFocus:ri,placeholderColor:bt,placeholderColorDisabled:Vn,lineHeightTextarea:Mt,colorDisabled:ci,colorFocus:_n,textColorDisabled:Bn,boxShadowFocus:co,iconSize:Xi,colorFocusWarning:ne,boxShadowFocusWarning:D,borderWarning:Tn,borderFocusWarning:Zi,borderHoverWarning:fn,colorFocusError:ui,boxShadowFocusError:li,borderError:Qi,borderFocusError:Hn,borderHoverError:Dn,clearSize:uo,clearColor:lo,clearColorHover:et,clearColorPressed:rt,iconColor:We,iconColorDisabled:ct,suffixTextColor:ot,countTextColor:Kn,countTextColorDisabled:di,iconColorHover:Sn,iconColorPressed:pi,loadingColor:gi,loadingColorError:hi,loadingColorWarning:po,[xs("padding",T)]:_i,[xs("fontSize",T)]:go,[xs("height",T)]:Ut}}=S.value,{left:fi,right:mi}=Fl(_i);return{"--n-bezier":x,"--n-count-text-color":Kn,"--n-count-text-color-disabled":di,"--n-color":L,"--n-font-size":go,"--n-border-radius":Fe,"--n-height":Ut,"--n-padding-left":fi,"--n-padding-right":mi,"--n-text-color":Ye,"--n-caret-color":Le,"--n-text-decoration-color":Ie,"--n-border":q,"--n-border-disabled":qe,"--n-border-hover":qn,"--n-border-focus":ri,"--n-placeholder-color":bt,"--n-placeholder-color-disabled":Vn,"--n-icon-size":Xi,"--n-line-height-textarea":Mt,"--n-color-disabled":ci,"--n-color-focus":_n,"--n-text-color-disabled":Bn,"--n-box-shadow-focus":co,"--n-loading-color":gi,"--n-caret-color-warning":dt,"--n-color-focus-warning":ne,"--n-box-shadow-focus-warning":D,"--n-border-warning":Tn,"--n-border-focus-warning":Zi,"--n-border-hover-warning":fn,"--n-loading-color-warning":po,"--n-caret-color-error":ge,"--n-color-focus-error":ui,"--n-box-shadow-focus-error":li,"--n-border-error":Qi,"--n-border-focus-error":Hn,"--n-border-hover-error":Dn,"--n-loading-color-error":hi,"--n-clear-color":lo,"--n-clear-size":uo,"--n-clear-color-hover":et,"--n-clear-color-pressed":rt,"--n-icon-color":We,"--n-icon-color-hover":Sn,"--n-icon-color-pressed":pi,"--n-icon-color-disabled":ct,"--n-suffix-text-color":ot}}),Ne=l?yc("input",de(()=>{const{value:T}=ie;return T[0]}),_e,A):void 0;return Object.assign(Object.assign({},Te),{wrapperElRef:B,inputElRef:j,inputMirrorElRef:F,inputEl2Ref:oe,textareaElRef:E,textareaMirrorElRef:W,textareaScrollbarInstRef:Q,rtlEnabled:Se,uncontrolledValue:X,mergedValue:z,passwordVisible:qt,mergedPlaceholder:Me,showPlaceholder1:Vt,showPlaceholder2:Pe,mergedFocus:Nt,isComposing:Re,activated:K,showClearButton:ze,mergedSize:ie,mergedDisabled:De,textDecorationStyle:un,mergedClsPrefix:y,mergedBordered:C,mergedShowPasswordOn:Xt,placeholderStyle:Lt,mergedStatus:Ve,textAreaScrollContainerWidth:O,handleTextAreaScroll:k,handleCompositionStart:Be,handleCompositionEnd:so,handleInput:yt,handleInputBlur:yn,handleInputFocus:pn,handleWrapperBlur:Yt,handleWrapperFocus:zt,handleMouseEnter:Cn,handleMouseLeave:en,handleMouseDown:$t,handleChange:Qt,handleClick:Gt,handleClear:Mn,handlePasswordToggleClick:Bt,handlePasswordToggleMousedown:Pn,handleWrapperKeydown:Un,handleWrapperKeyup:bn,handleTextAreaMirrorResize:u,getTextareaScrollContainer:()=>E.value,mergedTheme:S,cssVars:l?void 0:_e,themeClass:Ne==null?void 0:Ne.themeClass,onRender:Ne==null?void 0:Ne.onRender})},render(){var A,y;const{mergedClsPrefix:C,mergedStatus:l,themeClass:G,type:S,countGraphemes:B,onRender:E}=this,W=this.$slots;return E==null||E(),J("div",{ref:"wrapperElRef",class:[`${C}-input`,G,l&&`${C}-input--${l}-status`,{[`${C}-input--rtl`]:this.rtlEnabled,[`${C}-input--disabled`]:this.mergedDisabled,[`${C}-input--textarea`]:S==="textarea",[`${C}-input--resizable`]:this.resizable&&!this.autosize,[`${C}-input--autosize`]:this.autosize,[`${C}-input--round`]:this.round&&S!=="textarea",[`${C}-input--pair`]:this.pair,[`${C}-input--focus`]:this.mergedFocus,[`${C}-input--stateful`]:this.stateful}],style:this.cssVars,tabindex:!this.mergedDisabled&&this.passivelyActivated&&!this.activated?0:void 0,onFocus:this.handleWrapperFocus,onBlur:this.handleWrapperBlur,onClick:this.handleClick,onMousedown:this.handleMouseDown,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd,onKeyup:this.handleWrapperKeyup,onKeydown:this.handleWrapperKeydown},J("div",{class:`${C}-input-wrapper`},Oi(W.prefix,F=>F&&J("div",{class:`${C}-input__prefix`},F)),S==="textarea"?J(Mc,{ref:"textareaScrollbarInstRef",class:`${C}-input__textarea`,container:this.getTextareaScrollContainer,triggerDisplayManually:!0,useUnifiedContainer:!0,internalHoistYRail:!0},{default:()=>{var F,j;const{textAreaScrollContainerWidth:oe}=this,pe={width:this.autosize&&oe&&`${oe}px`};return J(xt,null,J("textarea",Object.assign({},this.inputProps,{ref:"textareaElRef",class:[`${C}-input__textarea-el`,(F=this.inputProps)===null||F===void 0?void 0:F.class],autofocus:this.autofocus,rows:Number(this.rows),placeholder:this.placeholder,value:this.mergedValue,disabled:this.mergedDisabled,maxlength:B?void 0:this.maxlength,minlength:B?void 0:this.minlength,readonly:this.readonly,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,style:[this.textDecorationStyle[0],(j=this.inputProps)===null||j===void 0?void 0:j.style,pe],onBlur:this.handleInputBlur,onFocus:Ge=>{this.handleInputFocus(Ge,2)},onInput:this.handleInput,onChange:this.handleChange,onScroll:this.handleTextAreaScroll})),this.showPlaceholder1?J("div",{class:`${C}-input__placeholder`,style:[this.placeholderStyle,pe],key:"placeholder"},this.mergedPlaceholder[0]):null,this.autosize?J(Vi,{onResize:this.handleTextAreaMirrorResize},{default:()=>J("div",{ref:"textareaMirrorElRef",class:`${C}-input__textarea-mirror`,key:"mirror"})}):null)}}):J("div",{class:`${C}-input__input`},J("input",Object.assign({type:S==="password"&&this.mergedShowPasswordOn&&this.passwordVisible?"text":S},this.inputProps,{ref:"inputElRef",class:[`${C}-input__input-el`,(A=this.inputProps)===null||A===void 0?void 0:A.class],style:[this.textDecorationStyle[0],(y=this.inputProps)===null||y===void 0?void 0:y.style],tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[0],disabled:this.mergedDisabled,maxlength:B?void 0:this.maxlength,minlength:B?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[0]:this.mergedValue,readonly:this.readonly,autofocus:this.autofocus,size:this.attrSize,onBlur:this.handleInputBlur,onFocus:F=>{this.handleInputFocus(F,0)},onInput:F=>{this.handleInput(F,0)},onChange:F=>{this.handleChange(F,0)}})),this.showPlaceholder1?J("div",{class:`${C}-input__placeholder`},J("span",null,this.mergedPlaceholder[0])):null,this.autosize?J("div",{class:`${C}-input__input-mirror`,key:"mirror",ref:"inputMirrorElRef"},"\xA0"):null),!this.pair&&Oi(W.suffix,F=>F||this.clearable||this.showCount||this.mergedShowPasswordOn||this.loading!==void 0?J("div",{class:`${C}-input__suffix`},[Oi(W["clear-icon-placeholder"],j=>(this.clearable||j)&&J(Js,{clsPrefix:C,show:this.showClearButton,onClear:this.handleClear},{placeholder:()=>j,icon:()=>{var oe,pe;return(pe=(oe=this.$slots)["clear-icon"])===null||pe===void 0?void 0:pe.call(oe)}})),this.internalLoadingBeforeSuffix?null:F,this.loading!==void 0?J(fd,{clsPrefix:C,loading:this.loading,showArrow:!1,showClear:!1,style:this.cssVars}):null,this.internalLoadingBeforeSuffix?F:null,this.showCount&&this.type!=="textarea"?J(dc,null,{default:j=>{var oe;return(oe=W.count)===null||oe===void 0?void 0:oe.call(W,j)}}):null,this.mergedShowPasswordOn&&this.type==="password"?J("div",{class:`${C}-input__eye`,onMousedown:this.handlePasswordToggleMousedown,onClick:this.handlePasswordToggleClick},this.passwordVisible?ni(W["password-visible-icon"],()=>[J(qi,{clsPrefix:C},{default:()=>J(dd,null)})]):ni(W["password-invisible-icon"],()=>[J(qi,{clsPrefix:C},{default:()=>J(pd,null)})])):null]):null)),this.pair?J("span",{class:`${C}-input__separator`},ni(W.separator,()=>[this.separator])):null,this.pair?J("div",{class:`${C}-input-wrapper`},J("div",{class:`${C}-input__input`},J("input",{ref:"inputEl2Ref",type:this.type,class:`${C}-input__input-el`,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[1],disabled:this.mergedDisabled,maxlength:B?void 0:this.maxlength,minlength:B?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[1]:void 0,readonly:this.readonly,style:this.textDecorationStyle[1],onBlur:this.handleInputBlur,onFocus:F=>{this.handleInputFocus(F,1)},onInput:F=>{this.handleInput(F,1)},onChange:F=>{this.handleChange(F,1)}}),this.showPlaceholder2?J("div",{class:`${C}-input__placeholder`},J("span",null,this.mergedPlaceholder[1])):null),Oi(W.suffix,F=>(this.clearable||F)&&J("div",{class:`${C}-input__suffix`},[this.clearable&&J(Js,{clsPrefix:C,show:this.showClearButton,onClear:this.handleClear},{icon:()=>{var j;return(j=W["clear-icon"])===null||j===void 0?void 0:j.call(W)},placeholder:()=>{var j;return(j=W["clear-icon-placeholder"])===null||j===void 0?void 0:j.call(W)}}),F]))):null,this.mergedBordered?J("div",{class:`${C}-input__border`}):null,this.mergedBordered?J("div",{class:`${C}-input__state-border`}):null,this.showCount&&S==="textarea"?J(dc,null,{default:F=>{var j;const{renderCount:oe}=this;return oe?oe(F):(j=W.count)===null||j===void 0?void 0:j.call(W,F)}}):null)}}),Ed=A=>({dotSize:"8px",dotColor:"rgba(255, 255, 255, .3)",dotColorActive:"rgba(255, 255, 255, 1)",dotColorFocus:"rgba(255, 255, 255, .5)",dotLineWidth:"16px",dotLineWidthActive:"24px",arrowColor:"#eee"}),Ld={name:"Carousel",common:Ac,self:Ed},kd=Ld;function Rd(A){const{length:y}=A;return y>1&&(A.push(pc(A[0],0,"append")),A.unshift(pc(A[y-1],y-1,"prepend"))),A}function pc(A,y,C){return Bi(A,{key:`carousel-item-duplicate-${y}-${C}`})}function gc(A,y,C){return y===1?0:C?A===0?y-3:A===y-1?0:A-1:A}function Vs(A,y){return y?A+1:A}function Nd(A,y,C){return A<0?null:A===0?C?y-1:null:A-1}function Od(A,y,C){return A>y-1?null:A===y-1?C?0:null:A+1}function Gd(A,y){return y&&A>3?A-2:A}function hc(A){return window.TouchEvent&&A instanceof window.TouchEvent}function _c(A,y){let{offsetWidth:C,offsetHeight:l}=A;if(y){const G=getComputedStyle(A);C=C-parseFloat(G.getPropertyValue("padding-left"))-parseFloat(G.getPropertyValue("padding-right")),l=l-parseFloat(G.getPropertyValue("padding-top"))-parseFloat(G.getPropertyValue("padding-bottom"))}return{width:C,height:l}}function Ui(A,y,C){return A<y?y:A>C?C:A}function Pd(A){if(A===void 0)return 0;if(typeof A=="number")return A;const y=/^((\d+)?\.?\d+?)(ms|s)?$/,C=A.match(y);if(C){const[,l,,G="ms"]=C;return Number(l)*(G==="ms"?1:1e3)}return 0}const Ec=Xs("n-carousel-methods"),bd=A=>{zi(Ec,A)},er=(A="unknown",y="component")=>{const C=Wi(Ec);return C||xl(A,`\`${y}\` must be placed inside \`n-carousel\`.`),C},Ud={total:{type:Number,default:0},currentIndex:{type:Number,default:0},dotType:{type:String,default:"dot"},trigger:{type:String,default:"click"},keyboard:Boolean},wd=st({name:"CarouselDots",props:Ud,setup(A){const{mergedClsPrefixRef:y}=oo(A),C=ke([]),l=er();function G(F,j){switch(F.key){case"Enter":case" ":F.preventDefault(),l.to(j);return}A.keyboard&&E(F)}function S(F){A.trigger==="hover"&&l.to(F)}function B(F){A.trigger==="click"&&l.to(F)}function E(F){var j;if(F.shiftKey||F.altKey||F.ctrlKey||F.metaKey)return;const oe=(j=document.activeElement)===null||j===void 0?void 0:j.nodeName.toLowerCase();if(oe==="input"||oe==="textarea")return;const{code:pe}=F,Ge=pe==="PageUp"||pe==="ArrowUp",Q=pe==="PageDown"||pe==="ArrowDown",ae=pe==="PageUp"||pe==="ArrowRight",X=pe==="PageDown"||pe==="ArrowLeft",te=l.isVertical(),z=te?Ge:ae,b=te?Q:X;!z&&!b||(F.preventDefault(),z&&!l.isNextDisabled()?(l.next(),W(l.currentIndexRef.value)):b&&!l.isPrevDisabled()&&(l.prev(),W(l.currentIndexRef.value)))}function W(F){var j;(j=C.value[F])===null||j===void 0||j.focus()}return Yl(()=>C.value.length=0),{mergedClsPrefix:y,dotEls:C,handleKeydown:G,handleMouseenter:S,handleClick:B}},render(){const{mergedClsPrefix:A,dotEls:y}=this;return J("div",{class:[`${A}-carousel__dots`,`${A}-carousel__dots--${this.dotType}`],role:"tablist"},ql(this.total,C=>{const l=C===this.currentIndex;return J("div",{"aria-selected":l,ref:G=>y.push(G),role:"button",tabindex:"0",class:[`${A}-carousel__dot`,l&&`${A}-carousel__dot--active`],key:C,onClick:()=>{this.handleClick(C)},onMouseenter:()=>{this.handleMouseenter(C)},onKeydown:G=>{this.handleKeydown(G,C)}})}))}}),Fd=J("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},J("g",{fill:"none"},J("path",{d:"M10.26 3.2a.75.75 0 0 1 .04 1.06L6.773 8l3.527 3.74a.75.75 0 1 1-1.1 1.02l-4-4.25a.75.75 0 0 1 0-1.02l4-4.25a.75.75 0 0 1 1.06-.04z",fill:"currentColor"}))),xd=J("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},J("g",{fill:"none"},J("path",{d:"M5.74 3.2a.75.75 0 0 0-.04 1.06L9.227 8L5.7 11.74a.75.75 0 1 0 1.1 1.02l4-4.25a.75.75 0 0 0 0-1.02l-4-4.25a.75.75 0 0 0-1.06-.04z",fill:"currentColor"}))),qd=st({name:"CarouselArrow",setup(A){const{mergedClsPrefixRef:y}=oo(A),{isVertical:C,isPrevDisabled:l,isNextDisabled:G,prev:S,next:B}=er();return{mergedClsPrefix:y,isVertical:C,isPrevDisabled:l,isNextDisabled:G,prev:S,next:B}},render(){const{mergedClsPrefix:A}=this;return J("div",{class:`${A}-carousel__arrow-group`},J("div",{class:[`${A}-carousel__arrow`,this.isPrevDisabled()&&`${A}-carousel__arrow--disabled`],role:"button",onClick:this.prev},Fd),J("div",{class:[`${A}-carousel__arrow`,this.isNextDisabled()&&`${A}-carousel__arrow--disabled`],role:"button",onClick:this.next},xd))}}),xi="CarouselItem",Vd=A=>{var y;return((y=A.type)===null||y===void 0?void 0:y.name)===xi},Bd=st({name:xi,setup(A){const{mergedClsPrefixRef:y}=oo(A),C=er(lc(xi),`n-${lc(xi)}`),l=ke(),G=de(()=>{const{value:j}=l;return j?C.getSlideIndex(j):-1}),S=de(()=>C.isPrev(G.value)),B=de(()=>C.isNext(G.value)),E=de(()=>C.isActive(G.value)),W=de(()=>C.getSlideStyle(G.value));ao(()=>{C.addSlide(l.value)}),$s(()=>{C.removeSlide(l.value)});function F(j){const{value:oe}=G;oe!==void 0&&(C==null||C.onCarouselItemClick(oe,j))}return{mergedClsPrefix:y,selfElRef:l,isPrev:S,isNext:B,isActive:E,index:G,style:W,handleClick:F}},render(){var A;const{$slots:y,mergedClsPrefix:C,isPrev:l,isNext:G,isActive:S,index:B,style:E}=this,W=[`${C}-carousel__slide`,{[`${C}-carousel__slide--current`]:S,[`${C}-carousel__slide--prev`]:l,[`${C}-carousel__slide--next`]:G}];return J("div",{ref:"selfElRef",class:W,role:"option",tabindex:"-1","data-index":B,"aria-hidden":!S,style:E,onClickCapture:this.handleClick},(A=y.default)===null||A===void 0?void 0:A.call(y,{isPrev:l,isNext:G,isActive:S,index:B}))}}),Hd=nt("carousel",`
 position: relative;
 width: 100%;
 height: 100%;
 touch-action: pan-y;
 overflow: hidden;
`,[ee("slides",`
 display: flex;
 width: 100%;
 height: 100%;
 transition-timing-function: var(--n-bezier);
 transition-property: transform;
 `,[ee("slide",`
 flex-shrink: 0;
 position: relative;
 width: 100%;
 height: 100%;
 outline: none;
 overflow: hidden;
 `,[He("> img",`
 display: block;
 `)])]),ee("dots",`
 position: absolute;
 display: flex;
 flex-wrap: nowrap;
 `,[Ae("dot",[ee("dot",`
 height: var(--n-dot-size);
 width: var(--n-dot-size);
 background-color: var(--n-dot-color);
 border-radius: 50%;
 cursor: pointer;
 transition:
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[He("&:focus",`
 background-color: var(--n-dot-color-focus);
 `),Ae("active",`
 background-color: var(--n-dot-color-active);
 `)])]),Ae("line",[ee("dot",`
 border-radius: 9999px;
 width: var(--n-dot-line-width);
 height: 4px;
 background-color: var(--n-dot-color);
 cursor: pointer;
 transition:
 width .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[He("&:focus",`
 background-color: var(--n-dot-color-focus);
 `),Ae("active",`
 width: var(--n-dot-line-width-active);
 background-color: var(--n-dot-color-active);
 `)])])]),ee("arrow",`
 transition: background-color .3s var(--n-bezier);
 cursor: pointer;
 height: 28px;
 width: 28px;
 display: flex;
 align-items: center;
 justify-content: center;
 background-color: rgba(255, 255, 255, .2);
 color: var(--n-arrow-color);
 border-radius: 8px;
 user-select: none;
 -webkit-user-select: none;
 font-size: 18px;
 `,[He("svg",`
 height: 1em;
 width: 1em;
 `),He("&:hover",`
 background-color: rgba(255, 255, 255, .3);
 `)]),Ae("vertical",`
 touch-action: pan-x;
 `,[ee("slides",`
 flex-direction: column;
 `),Ae("fade",[ee("slide",`
 top: 50%;
 left: unset;
 transform: translateY(-50%);
 `)]),Ae("card",[ee("slide",`
 top: 50%;
 left: unset;
 transform: translateY(-50%) translateZ(-400px);
 `,[Ae("current",`
 transform: translateY(-50%) translateZ(0);
 `),Ae("prev",`
 transform: translateY(-100%) translateZ(-200px);
 `),Ae("next",`
 transform: translateY(0%) translateZ(-200px);
 `)])])]),Ae("usercontrol",[ee("slides",[He(">",[He("div",`
 position: absolute;
 top: 50%;
 left: 50%;
 width: 100%;
 height: 100%;
 transform: translate(-50%, -50%);
 `)])])]),Ae("left",[ee("dots",`
 transform: translateY(-50%);
 top: 50%;
 left: 12px;
 flex-direction: column;
 `,[Ae("line",[ee("dot",`
 width: 4px;
 height: var(--n-dot-line-width);
 margin: 4px 0;
 transition:
 height .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[Ae("active",`
 height: var(--n-dot-line-width-active);
 `)])])]),ee("dot",`
 margin: 4px 0;
 `)]),ee("arrow-group",`
 position: absolute;
 display: flex;
 flex-wrap: nowrap;
 `),Ae("vertical",[ee("arrow",`
 transform: rotate(90deg);
 `)]),Ae("show-arrow",[Ae("bottom",[ee("dots",`
 transform: translateX(0);
 bottom: 18px;
 left: 18px;
 `)]),Ae("top",[ee("dots",`
 transform: translateX(0);
 top: 18px;
 left: 18px;
 `)]),Ae("left",[ee("dots",`
 transform: translateX(0);
 top: 18px;
 left: 18px;
 `)]),Ae("right",[ee("dots",`
 transform: translateX(0);
 top: 18px;
 right: 18px;
 `)])]),Ae("left",[ee("arrow-group",`
 bottom: 12px;
 left: 12px;
 flex-direction: column;
 `,[He("> *:first-child",`
 margin-bottom: 12px;
 `)])]),Ae("right",[ee("dots",`
 transform: translateY(-50%);
 top: 50%;
 right: 12px;
 flex-direction: column;
 `,[Ae("line",[ee("dot",`
 width: 4px;
 height: var(--n-dot-line-width);
 margin: 4px 0;
 transition:
 height .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[Ae("active",`
 height: var(--n-dot-line-width-active);
 `)])])]),ee("dot",`
 margin: 4px 0;
 `),ee("arrow-group",`
 bottom: 12px;
 right: 12px;
 flex-direction: column;
 `,[He("> *:first-child",`
 margin-bottom: 12px;
 `)])]),Ae("top",[ee("dots",`
 transform: translateX(-50%);
 top: 12px;
 left: 50%;
 `,[Ae("line",[ee("dot",`
 margin: 0 4px;
 `)])]),ee("dot",`
 margin: 0 4px;
 `),ee("arrow-group",`
 top: 12px;
 right: 12px;
 `,[He("> *:first-child",`
 margin-right: 12px;
 `)])]),Ae("bottom",[ee("dots",`
 transform: translateX(-50%);
 bottom: 12px;
 left: 50%;
 `,[Ae("line",[ee("dot",`
 margin: 0 4px;
 `)])]),ee("dot",`
 margin: 0 4px;
 `),ee("arrow-group",`
 bottom: 12px;
 right: 12px;
 `,[He("> *:first-child",`
 margin-right: 12px;
 `)])]),Ae("fade",[ee("slide",`
 position: absolute;
 opacity: 0;
 transition-property: opacity;
 pointer-events: none;
 `,[Ae("current",`
 opacity: 1;
 pointer-events: auto;
 `)])]),Ae("card",[ee("slides",`
 perspective: 1000px;
 `),ee("slide",`
 position: absolute;
 left: 50%;
 opacity: 0;
 transform: translateX(-50%) translateZ(-400px);
 transition-property: opacity, transform;
 `,[Ae("current",`
 opacity: 1;
 transform: translateX(-50%) translateZ(0);
 z-index: 1;
 `),Ae("prev",`
 opacity: 0.4;
 transform: translateX(-100%) translateZ(-200px);
 `),Ae("next",`
 opacity: 0.4;
 transform: translateX(0%) translateZ(-200px);
 `)])])]),Kd=["transitionDuration","transitionTimingFunction"],Wd=Object.assign(Object.assign({},ai.props),{defaultIndex:{type:Number,default:0},currentIndex:Number,showArrow:Boolean,dotType:{type:String,default:"dot"},dotPlacement:{type:String,default:"bottom"},slidesPerView:{type:[Number,String],default:1},spaceBetween:{type:Number,default:0},centeredSlides:Boolean,direction:{type:String,default:"horizontal"},autoplay:Boolean,interval:{type:Number,default:5e3},loop:{type:Boolean,default:!0},effect:{type:String,default:"slide"},showDots:{type:Boolean,default:!0},trigger:{type:String,default:"click"},transitionStyle:{type:Object,default:()=>({transitionDuration:"300ms"})},transitionProps:Object,draggable:Boolean,prevSlideStyle:[Object,String],nextSlideStyle:[Object,String],touchable:{type:Boolean,default:!0},mousewheel:Boolean,keyboard:Boolean,"onUpdate:currentIndex":Function,onUpdateCurrentIndex:Function});let Bs=!1;const Yd=st({name:"Carousel",props:Wd,setup(A){const{mergedClsPrefixRef:y,inlineThemeDisabled:C}=oo(A),l=ke(null),G=ke(null),S=ke([]),B={value:[]},E=de(()=>A.direction==="vertical"),W=de(()=>E.value?"height":"width"),F=de(()=>E.value?"bottom":"right"),j=de(()=>A.effect==="slide"),oe=de(()=>A.loop&&A.slidesPerView===1&&j.value),pe=de(()=>A.effect==="custom"),Ge=de(()=>!j.value||A.centeredSlides?1:A.slidesPerView),Q=de(()=>pe.value?1:A.slidesPerView),ae=de(()=>Ge.value==="auto"||A.slidesPerView==="auto"&&A.centeredSlides),X=ke({width:0,height:0}),te=de(()=>{const{value:k}=S;if(!k.length)return[];const{value:Y}=ae;if(Y)return k.map(T=>_c(T));const{value:se}=Q,{value:Te}=X,{value:Se}=W;let _e=Te[Se];if(se!=="auto"){const{spaceBetween:T}=A,x=_e-(se-1)*T,L=1/Math.max(1,se);_e=x*L}const Ne=Object.assign(Object.assign({},Te),{[Se]:_e});return k.map(()=>Ne)}),z=de(()=>{const{value:k}=te;if(!k.length)return[];const{centeredSlides:Y,spaceBetween:se}=A,{value:Te}=W,{[Te]:Se}=X.value;let _e=0;return k.map(({[Te]:Ne})=>{let T=_e;return Y&&(T+=(Ne-Se)/2),_e+=Ne+se,T})}),b=ke(!1),ie=de(()=>{const{transitionStyle:k}=A;return k?ic(k,Kd):{}}),De=de(()=>pe.value?0:Pd(ie.value.transitionDuration)),Ve=de(()=>{const{value:k}=S;if(!k.length)return[];const Y=!(ae.value||Q.value===1),se=Ne=>{if(Y){const{value:T}=W;return{[T]:`${te.value[Ne][T]}px`}}};if(pe.value)return k.map((Ne,T)=>se(T));const{effect:Te,spaceBetween:Se}=A,{value:_e}=F;return k.reduce((Ne,T,x)=>{const L=Object.assign(Object.assign({},se(x)),{[`margin-${_e}`]:`${Se}px`});return Ne.push(L),b.value&&(Te==="fade"||Te==="card")&&Object.assign(L,ie.value),Ne},[])}),Ue=de(()=>{const{value:k}=Ge,{length:Y}=S.value;if(k!=="auto")return Math.max(Y-k,0)+1;{const{value:se}=te,{length:Te}=se;if(!Te)return Y;const{value:Se}=z,{value:_e}=W,Ne=X.value[_e];let T=se[se.length-1][_e],x=Te;for(;x>1&&T<Ne;)x--,T+=Se[x]-Se[x-1];return Ui(x+1,1,Te)}}),ut=de(()=>Gd(Ue.value,oe.value)),Re=Vs(A.defaultIndex,oe.value),K=ke(gc(Re,Ue.value,oe.value)),g=Ic(no(A,"currentIndex"),K),Me=de(()=>Vs(g.value,oe.value));function Vt(k){var Y,se;k=Ui(k,0,Ue.value-1);const Te=gc(k,Ue.value,oe.value),{value:Se}=g;Te!==g.value&&(K.value=Te,(Y=A["onUpdate:currentIndex"])===null||Y===void 0||Y.call(A,Te,Se),(se=A.onUpdateCurrentIndex)===null||se===void 0||se.call(A,Te,Se))}function Pe(k=Me.value){return Nd(k,Ue.value,A.loop)}function Nt(k=Me.value){return Od(k,Ue.value,A.loop)}function ze(k){const Y=yt(k);return Y!==null&&Pe()===Y}function Xt(k){const Y=yt(k);return Y!==null&&Nt()===Y}function qt(k){return Me.value===yt(k)}function un(k){return g.value===k}function O(){return Pe()===null}function Ce(){return Nt()===null}function ln(k){const Y=Ui(Vs(k,oe.value),0,Ue.value);(k!==g.value||Y!==Me.value)&&Vt(Y)}function Zt(){const k=Pe();k!==null&&Vt(k)}function Ot(){const k=Nt();k!==null&&Vt(k)}function ht(){(!Qe||!oe.value)&&Zt()}function Gn(){(!Qe||!oe.value)&&Ot()}let Qe=!1,It=0;const Wt=ke({});function lt(k,Y=0){Wt.value=Object.assign({},ie.value,{transform:E.value?`translateY(${-k}px)`:`translateX(${-k}px)`,transitionDuration:`${Y}ms`})}function $e(k=0){j.value?dn(Me.value,k):It!==0&&(!Qe&&k>0&&(Qe=!0),lt(It=0,k))}function dn(k,Y){const se=me(k);se!==It&&Y>0&&(Qe=!0),It=me(Me.value),lt(se,Y)}function me(k){let Y;return k>=Ue.value-1?Y=Ke():Y=z.value[k]||0,Y}function Ke(){if(Ge.value==="auto"){const{value:k}=W,{[k]:Y}=X.value,{value:se}=z,Te=se[se.length-1];let Se;if(Te===void 0)Se=Y;else{const{value:_e}=te;Se=Te+_e[_e.length-1][k]}return Se-Y}else{const{value:k}=z;return k[Ue.value-1]||0}}const fe={currentIndexRef:g,to:ln,prev:ht,next:Gn,isVertical:()=>E.value,isHorizontal:()=>!E.value,isPrev:ze,isNext:Xt,isActive:qt,isPrevDisabled:O,isNextDisabled:Ce,getSlideIndex:yt,getSlideStyle:ro,addSlide:Be,removeSlide:so,onCarouselItemClick:yn};bd(fe);function Be(k){!k||S.value.push(k)}function so(k){if(!k)return;const Y=yt(k);Y!==-1&&S.value.splice(Y,1)}function yt(k){return typeof k=="number"?k:k?S.value.indexOf(k):-1}function ro(k){const Y=yt(k);if(Y!==-1){const se=[Ve.value[Y]],Te=fe.isPrev(Y),Se=fe.isNext(Y);return Te&&se.push(A.prevSlideStyle||""),Se&&se.push(A.nextSlideStyle||""),Xl(se)}}function yn(k,Y){let se=!Qe&&!St&&!$t;A.effect==="card"&&se&&!qt(k)&&(ln(k),se=!1),se||(Y.preventDefault(),Y.stopPropagation())}let pn=null;function Yt(){pn&&(clearInterval(pn),pn=null)}function zt(){Yt(),!A.autoplay||ut.value<2||(pn=window.setInterval(Ot,A.interval))}let jt=0,Qt=0,Gt=0,Mn=0,St=!1,$t=!1;function Cn(k){var Y;if(Bs||!(!((Y=G.value)===null||Y===void 0)&&Y.contains(Vl(k))))return;Bs=!0,St=!0,$t=!1,Mn=Date.now(),Yt(),k.type!=="touchstart"&&!k.target.isContentEditable&&k.preventDefault();const se=hc(k)?k.touches[0]:k;E.value?Qt=se.clientY:jt=se.clientX,A.touchable&&(Nn("touchmove",document,en),Nn("touchend",document,Bt),Nn("touchcancel",document,Bt)),A.draggable&&(Nn("mousemove",document,en),Nn("mouseup",document,Bt))}function en(k){const{value:Y}=E,{value:se}=W,Te=hc(k)?k.touches[0]:k,Se=Y?Te.clientY-Qt:Te.clientX-jt,_e=X.value[se];Gt=Ui(Se,-_e,_e),k.cancelable&&k.preventDefault(),j.value&&lt(It-Gt,0)}function Bt(){const{value:k}=Me;let Y=k;if(!Qe&&Gt!==0&&j.value){const se=It-Gt,Te=[...z.value.slice(0,Ue.value-1),Ke()];let Se=null;for(let _e=0;_e<Te.length;_e++){const Ne=Math.abs(Te[_e]-se);if(Se!==null&&Se<Ne)break;Se=Ne,Y=_e}}if(Y===k){const se=Date.now()-Mn,{value:Te}=W,Se=X.value[Te];Gt>Se/2||Gt/se>.4?Y=Pe(k):(Gt<-Se/2||Gt/se<-.4)&&(Y=Nt(k))}Y!==null&&Y!==k?($t=!0,Vt(Y),cn(()=>{(!oe.value||K.value!==g.value)&&$e(De.value)})):$e(De.value),Pn(),zt()}function Pn(){St&&(Bs=!1),St=!1,jt=0,Qt=0,Gt=0,Mn=0,On("touchmove",document,en),On("touchend",document,Bt),On("touchcancel",document,Bt),On("mousemove",document,en),On("mouseup",document,Bt)}function bn(){if(j.value&&Qe){const{value:k}=Me;dn(k,0)}else zt();j.value&&(Wt.value.transitionDuration="0ms"),Qe=!1}function Un(k){if(k.preventDefault(),Qe)return;let{deltaX:Y,deltaY:se}=k;k.shiftKey&&!Y&&(Y=se);const Te=-1,Se=1,_e=(Y||se)>0?Se:Te;let Ne=0,T=0;E.value?T=_e:Ne=_e;const x=10;(T*se>=x||Ne*Y>=x)&&(_e===Se&&!Ce()?Ot():_e===Te&&!O()&&Zt())}function wn(){X.value=_c(l.value,!0),zt()}function gn(){var k,Y;ae.value&&((Y=(k=te.effect).scheduler)===null||Y===void 0||Y.call(k),te.effect.run())}function tn(){A.autoplay&&Yt()}function Fn(){A.autoplay&&zt()}ao(()=>{zs(zt),requestAnimationFrame(()=>b.value=!0)}),$s(()=>{Pn(),Yt()}),zl(()=>{const{value:k}=S,{value:Y}=B,se=new Map,Te=_e=>se.has(_e)?se.get(_e):-1;let Se=!1;for(let _e=0;_e<k.length;_e++){const Ne=Y.findIndex(T=>T.el===k[_e]);Ne!==_e&&(Se=!0),se.set(k[_e],Ne)}Se&&k.sort((_e,Ne)=>Te(_e)-Te(Ne))}),rn(Me,(k,Y)=>{if(k!==Y)if(zt(),j.value){if(oe.value){const{value:se}=Ue;ut.value>2&&k===se-2&&Y===1?k=0:k===1&&Y===se-2&&(k=se-1)}dn(k,De.value)}else $e()},{immediate:!0}),rn([oe,Ge],()=>void cn(()=>{Vt(Me.value)})),rn(z,()=>{j.value&&$e()},{deep:!0}),rn(j,k=>{k?$e():(Qe=!1,lt(It=0))});const nn=de(()=>({onTouchstartPassive:A.touchable?Cn:void 0,onMousedown:A.draggable?Cn:void 0,onWheel:A.mousewheel?Un:void 0})),Et=de(()=>Object.assign(Object.assign({},ic(fe,["to","prev","next","isPrevDisabled","isNextDisabled"])),{total:ut.value,currentIndex:g.value})),Pt=de(()=>({total:ut.value,currentIndex:g.value,to:fe.to})),xn={getCurrentIndex:()=>g.value,to:ln,prev:Zt,next:Ot},hn=ai("Carousel","-carousel",Hd,kd,A,y),u=de(()=>{const{common:{cubicBezierEaseInOut:k},self:{dotSize:Y,dotColor:se,dotColorActive:Te,dotColorFocus:Se,dotLineWidth:_e,dotLineWidthActive:Ne,arrowColor:T}}=hn.value;return{"--n-bezier":k,"--n-dot-color":se,"--n-dot-color-focus":Se,"--n-dot-color-active":Te,"--n-dot-size":Y,"--n-dot-line-width":_e,"--n-dot-line-width-active":Ne,"--n-arrow-color":T}}),Lt=C?yc("carousel",void 0,u,A):void 0;return Object.assign(Object.assign({mergedClsPrefix:y,selfElRef:l,slidesElRef:G,slideVNodes:B,duplicatedable:oe,userWantsControl:pe,autoSlideSize:ae,realIndex:Me,slideStyles:Ve,translateStyle:Wt,slidesControlListeners:nn,handleTransitionEnd:bn,handleResize:wn,handleSlideResize:gn,handleMouseenter:tn,handleMouseleave:Fn,isActive:un,arrowSlotProps:Et,dotSlotProps:Pt},xn),{cssVars:C?void 0:u,themeClass:Lt==null?void 0:Lt.themeClass,onRender:Lt==null?void 0:Lt.onRender})},render(){var A;const{mergedClsPrefix:y,showArrow:C,userWantsControl:l,slideStyles:G,dotType:S,dotPlacement:B,slidesControlListeners:E,transitionProps:W={},arrowSlotProps:F,dotSlotProps:j,$slots:{default:oe,dots:pe,arrow:Ge}}=this,Q=oe&&Cc(oe())||[];let ae=zd(Q);return ae.length||(ae=Q.map(X=>J(Bd,null,{default:()=>Bi(X)}))),this.duplicatedable&&(ae=Rd(ae)),this.slideVNodes.value=ae,this.autoSlideSize&&(ae=ae.map(X=>J(Vi,{onResize:this.handleSlideResize},{default:()=>X}))),(A=this.onRender)===null||A===void 0||A.call(this),J("div",Object.assign({ref:"selfElRef",class:[this.themeClass,`${y}-carousel`,this.direction==="vertical"&&`${y}-carousel--vertical`,this.showArrow&&`${y}-carousel--show-arrow`,`${y}-carousel--${B}`,`${y}-carousel--${this.direction}`,`${y}-carousel--${this.effect}`,l&&`${y}-carousel--usercontrol`],style:this.cssVars},E,{onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave}),J(Vi,{onResize:this.handleResize},{default:()=>J("div",{ref:"slidesElRef",class:`${y}-carousel__slides`,role:"listbox",style:this.translateStyle,onTransitionend:this.handleTransitionEnd},l?ae.map((X,te)=>J("div",{style:G[te],key:te},jl(J(Jl,Object.assign({},W),{default:()=>X}),[[Qs,this.isActive(te)]]))):ae)}),this.showDots&&j.total>1&&Ks(pe,j,()=>[J(wd,{key:S+B,total:j.total,currentIndex:j.currentIndex,dotType:S,trigger:this.trigger,keyboard:this.keyboard})]),C&&Ks(Ge,F,()=>[J(qd,null)]))}});function zd(A){return A.reduce((y,C)=>(Vd(C)&&y.push(C),y),[])}const Jd={abstract:Boolean,bordered:{type:Boolean,default:void 0},clsPrefix:{type:String,default:Ws},locale:Object,dateLocale:Object,namespace:String,rtl:Array,tag:{type:String,default:"div"},hljs:Object,katex:Object,theme:Object,themeOverrides:Object,componentOptions:Object,icons:Object,breakpoints:Object,preflightStyleDisabled:Boolean,inlineThemeDisabled:{type:Boolean,default:void 0},as:{type:String,validator:()=>(Hl("config-provider","`as` is deprecated, please use `tag` instead."),!0),default:void 0}},Xd=st({name:"ConfigProvider",alias:["App"],props:Jd,setup(A){const y=Wi(ac,null),C=de(()=>{const{theme:Q}=A;if(Q===null)return;const ae=y==null?void 0:y.mergedThemeRef.value;return Q===void 0?ae:ae===void 0?Q:Object.assign({},ae,Q)}),l=de(()=>{const{themeOverrides:Q}=A;if(Q!==null){if(Q===void 0)return y==null?void 0:y.mergedThemeOverridesRef.value;{const ae=y==null?void 0:y.mergedThemeOverridesRef.value;return ae===void 0?Q:Bl({},ae,Q)}}}),G=An(()=>{const{namespace:Q}=A;return Q===void 0?y==null?void 0:y.mergedNamespaceRef.value:Q}),S=An(()=>{const{bordered:Q}=A;return Q===void 0?y==null?void 0:y.mergedBorderedRef.value:Q}),B=de(()=>{const{icons:Q}=A;return Q===void 0?y==null?void 0:y.mergedIconsRef.value:Q}),E=de(()=>{const{componentOptions:Q}=A;return Q!==void 0?Q:y==null?void 0:y.mergedComponentPropsRef.value}),W=de(()=>{const{clsPrefix:Q}=A;return Q!==void 0?Q:y?y.mergedClsPrefixRef.value:Ws}),F=de(()=>{var Q;const{rtl:ae}=A;if(ae===void 0)return y==null?void 0:y.mergedRtlRef.value;const X={};for(const te of ae)X[te.name]=cc(te),(Q=te.peers)===null||Q===void 0||Q.forEach(z=>{z.name in X||(X[z.name]=cc(z))});return X}),j=de(()=>A.breakpoints||(y==null?void 0:y.mergedBreakpointsRef.value)),oe=A.inlineThemeDisabled||(y==null?void 0:y.inlineThemeDisabled),pe=A.preflightStyleDisabled||(y==null?void 0:y.preflightStyleDisabled),Ge=de(()=>{const{value:Q}=C,{value:ae}=l,X=ae&&Object.keys(ae).length!==0,te=Q==null?void 0:Q.name;return te?X?`${te}-${sc(JSON.stringify(l.value))}`:te:X?sc(JSON.stringify(l.value)):""});return zi(ac,{mergedThemeHashRef:Ge,mergedBreakpointsRef:j,mergedRtlRef:F,mergedIconsRef:B,mergedComponentPropsRef:E,mergedBorderedRef:S,mergedNamespaceRef:G,mergedClsPrefixRef:W,mergedLocaleRef:de(()=>{const{locale:Q}=A;if(Q!==null)return Q===void 0?y==null?void 0:y.mergedLocaleRef.value:Q}),mergedDateLocaleRef:de(()=>{const{dateLocale:Q}=A;if(Q!==null)return Q===void 0?y==null?void 0:y.mergedDateLocaleRef.value:Q}),mergedHljsRef:de(()=>{const{hljs:Q}=A;return Q===void 0?y==null?void 0:y.mergedHljsRef.value:Q}),mergedKatexRef:de(()=>{const{katex:Q}=A;return Q===void 0?y==null?void 0:y.mergedKatexRef.value:Q}),mergedThemeRef:C,mergedThemeOverridesRef:l,inlineThemeDisabled:oe||!1,preflightStyleDisabled:pe||!1}),{mergedClsPrefix:W,mergedBordered:S,mergedNamespace:G,mergedTheme:C,mergedThemeOverrides:l}},render(){var A,y,C,l;return this.abstract?(l=(C=this.$slots).default)===null||l===void 0?void 0:l.call(C):J(this.as||this.tag,{class:`${this.mergedClsPrefix||Ws}-config-provider`},(y=(A=this.$slots).default)===null||y===void 0?void 0:y.call(A))}}),fc=1,Lc=Xs("n-grid"),kc=1,Zd={span:{type:[Number,String],default:kc},offset:{type:[Number,String],default:0},suffix:Boolean,privateOffset:Number,privateSpan:Number,privateColStart:Number,privateShow:{type:Boolean,default:!0}},wi=st({__GRID_ITEM__:!0,name:"GridItem",alias:["Gi"],props:Zd,setup(){const{isSsrRef:A,xGapRef:y,itemStyleRef:C,overflowRef:l,layoutShiftDisabledRef:G}=Wi(Lc),S=Yi();return{overflow:l,itemStyle:C,layoutShiftDisabled:G,mergedXGap:de(()=>eo(y.value||0)),deriveStyle:()=>{A.value;const{privateSpan:B=kc,privateShow:E=!0,privateColStart:W=void 0,privateOffset:F=0}=S.vnode.props,{value:j}=y,oe=eo(j||0);return{display:E?"":"none",gridColumn:`${W!=null?W:`span ${B}`} / span ${B}`,marginLeft:F?`calc((100% - (${B} - 1) * ${oe}) / ${B} * ${F} + ${oe} * ${F})`:""}}}},render(){var A,y;if(this.layoutShiftDisabled){const{span:C,offset:l,mergedXGap:G}=this;return J("div",{style:{gridColumn:`span ${C} / span ${C}`,marginLeft:l?`calc((100% - (${C} - 1) * ${G}) / ${C} * ${l} + ${G} * ${l})`:""}},this.$slots)}return J("div",{style:[this.itemStyle,this.deriveStyle()]},(y=(A=this.$slots).default)===null||y===void 0?void 0:y.call(A,{overflow:this.overflow}))}}),Qd={xs:0,s:640,m:1024,l:1280,xl:1536,xxl:1920},Rc=24,Hs="__ssr__",$d={layoutShiftDisabled:Boolean,responsive:{type:[String,Boolean],default:"self"},cols:{type:[Number,String],default:Rc},itemResponsive:Boolean,collapsed:Boolean,collapsedRows:{type:Number,default:1},itemStyle:[Object,String],xGap:{type:[Number,String],default:0},yGap:{type:[Number,String],default:0}},ep=st({name:"Grid",inheritAttrs:!1,props:$d,setup(A){const{mergedClsPrefixRef:y,mergedBreakpointsRef:C}=oo(A),l=/^\d+$/,G=ke(void 0),S=cd((C==null?void 0:C.value)||Qd),B=An(()=>!!(A.itemResponsive||!l.test(A.cols.toString())||!l.test(A.xGap.toString())||!l.test(A.yGap.toString()))),E=de(()=>{if(!!B.value)return A.responsive==="self"?G.value:S.value}),W=An(()=>{var te;return(te=Number($n(A.cols.toString(),E.value)))!==null&&te!==void 0?te:Rc}),F=An(()=>$n(A.xGap.toString(),E.value)),j=An(()=>$n(A.yGap.toString(),E.value)),oe=te=>{G.value=te.contentRect.width},pe=te=>{nd(oe,te)},Ge=ke(!1),Q=de(()=>{if(A.responsive==="self")return pe}),ae=ke(!1),X=ke();return ao(()=>{const{value:te}=X;te&&te.hasAttribute(Hs)&&(te.removeAttribute(Hs),ae.value=!0)}),zi(Lc,{layoutShiftDisabledRef:no(A,"layoutShiftDisabled"),isSsrRef:ae,itemStyleRef:no(A,"itemStyle"),xGapRef:F,overflowRef:Ge}),{isSsr:!Kl,contentEl:X,mergedClsPrefix:y,style:de(()=>A.layoutShiftDisabled?{width:"100%",display:"grid",gridTemplateColumns:`repeat(${A.cols}, minmax(0, 1fr))`,columnGap:eo(A.xGap),rowGap:eo(A.yGap)}:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${W.value}, minmax(0, 1fr))`,columnGap:eo(F.value),rowGap:eo(j.value)}),isResponsive:B,responsiveQuery:E,responsiveCols:W,handleResize:Q,overflow:Ge}},render(){if(this.layoutShiftDisabled)return J("div",uc({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style},this.$attrs),this.$slots);const A=()=>{var y,C,l,G,S,B,E;this.overflow=!1;const W=Cc(id(this)),F=[],{collapsed:j,collapsedRows:oe,responsiveCols:pe,responsiveQuery:Ge}=this;W.forEach(z=>{var b,ie,De,Ve,Ue;if(((b=z==null?void 0:z.type)===null||b===void 0?void 0:b.__GRID_ITEM__)!==!0)return;if(ad(z)){const K=Bi(z);K.props?K.props.privateShow=!1:K.props={privateShow:!1},F.push({child:K,rawChildSpan:0});return}z.dirs=((ie=z.dirs)===null||ie===void 0?void 0:ie.filter(({dir:K})=>K!==Qs))||null,((De=z.dirs)===null||De===void 0?void 0:De.length)===0&&(z.dirs=null);const ut=Bi(z),Re=Number((Ue=$n((Ve=ut.props)===null||Ve===void 0?void 0:Ve.span,Ge))!==null&&Ue!==void 0?Ue:fc);Re!==0&&F.push({child:ut,rawChildSpan:Re})});let Q=0;const ae=(y=F[F.length-1])===null||y===void 0?void 0:y.child;if(ae!=null&&ae.props){const z=(C=ae.props)===null||C===void 0?void 0:C.suffix;z!==void 0&&z!==!1&&(Q=Number((G=$n((l=ae.props)===null||l===void 0?void 0:l.span,Ge))!==null&&G!==void 0?G:fc),ae.props.privateSpan=Q,ae.props.privateColStart=pe+1-Q,ae.props.privateShow=(S=ae.props.privateShow)!==null&&S!==void 0?S:!0)}let X=0,te=!1;for(const{child:z,rawChildSpan:b}of F){if(te&&(this.overflow=!0),!te){const ie=Number((E=$n((B=z.props)===null||B===void 0?void 0:B.offset,Ge))!==null&&E!==void 0?E:0),De=Math.min(b+ie,pe);if(z.props?(z.props.privateSpan=De,z.props.privateOffset=ie):z.props={privateSpan:De,privateOffset:ie},j){const Ve=X%pe;De+Ve>pe&&(X+=pe-Ve),De+X+Q>oe*pe?te=!0:X+=De}}te&&(z.props?z.props.privateShow!==!0&&(z.props.privateShow=!1):z.props={privateShow:!1})}return J("div",uc({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style,[Hs]:this.isSsr||void 0},this.$attrs),F.map(({child:z})=>z))};return this.isResponsive&&this.responsive==="self"?J(Vi,{onResize:this.handleResize},{default:A}):A()}}),tp=Object.assign(Object.assign({},ai.props),{trigger:String,xScrollable:Boolean,onScroll:Function,size:Number}),np=st({name:"Scrollbar",props:tp,setup(){const A=ke(null);return Object.assign(Object.assign({},{scrollTo:(...C)=>{var l;(l=A.value)===null||l===void 0||l.scrollTo(C[0],C[1])},scrollBy:(...C)=>{var l;(l=A.value)===null||l===void 0||l.scrollBy(C[0],C[1])}}),{scrollbarInstRef:A})},render(){return J(Mc,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),op=np,ip="data:image/webp;base64,UklGRmYDAABXRUJQVlA4WAoAAAAwAAAAIwAAIwAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwoAQAALyPACBCfoKBtG8b8Sbc7IOZ//g2yjZz6A+gEvge4HACGABBg8MIDAixJsts2wwgJYFru/Q/LCFBy+I3oPwO3jRR1+XCofQQAAAAAAAAAAAAAAAAAAAAAAAAAAABQv1IK9cPdbNv2WD8Zsq31eK68V7JTBXWyVZXiZccbC96lkJerCbOV/V6IMcYY7SXGswmTnU4GhGuIbNu2bdu2bds+h7a99PGIoSRJkiRJkmSvGm8v2SVxsfdrvxxNqk8BnponWJyOLyVPzzAcXxq2RP/HeG/WnKzY0lOKE3EuVVqfaJVFb/f5Mul2WzJUXD3nMW0+XUh5pcDOxdyI9ljC6amvbszo56wAnMpRGZYdGtGUCMiY2a1jVaghXQghhBBCCH2xhgAAwE8VTAA=",tr=A=>(ji("data-v-57ae5cf3"),A=A(),Ji(),A),ap={"w-388":"","p-b-40":"","bg-313255":"","border-radius-20":"","overflow-hidden":""},sp={"color-ffffff":"","fs-22":"","len-35":"","w-300":"","text-center":"","m-a":"","p-t-40":""},rp=tr(()=>ue("br",null,null,-1)),cp=tr(()=>ue("br",null,null,-1)),up=tr(()=>ue("br",null,null,-1)),lp=st({__name:"delAi",setup(A){const y=io(),C=()=>{y.isPopupAi=!1},l=()=>{y.chatIm.deleteConversation(y.delAiInfo.conversationID,y.delAiInfo.index),setTimeout(()=>{C()},300)};return(G,S)=>(re(),he("div",null,[ft(ce($l),{show:ce(y).isPopupAi,"onUpdate:show":S[0]||(S[0]=B=>ce(y).isPopupAi=B),"on-after-leave":C},{default:Kt(()=>[ue("div",ap,[ue("p",sp,[In(" Are you sure you want to "),rp,In(" delete the conversation with "),cp,In(" "+At(ce(y).delAiInfo.userProfile.nick)+" ? All messages ",1),up,In(" will be lost ")]),ue("div",{class:"btn",center:""},[ue("p",{onClick:C},"Cancel"),ue("p",{onClick:l},"Continue")])])]),_:1},8,["show"])]))}});const dp=si(lp,[["__scopeId","data-v-57ae5cf3"]]),nr=A=>(ji("data-v-2d6b02b9"),A=A(),Ji(),A),pp={"p-x-12":"","min-w-250":"","p-t-33":"","h-100p":"","overflow-auto":"","flex-column":""},gp=nr(()=>ue("div",{"color-fff":"","fs-20":"","font-weight-bold":""}," Chat",-1)),hp={key:0,"color-B5B1FF":"",op30:"","fs-15":""},_p={key:1,"m-t-13":""},fp={"w-100p":"","m-r-8":""},mp={"line-height-18":"","flex-between-center":""},vp={"color-FFF":"","fs-14":""},Ap={"fs-10":""},Ip=nr(()=>ue("p",{"line-height-18":"","flex-between-center":""},null,-1)),yp=["onClick"],Mp={"w-100p":"","m-r-8":""},Cp={"line-height-18":"","flex-between-center":""},Tp={"color-FFF":"","fs-14":""},Dp={"fs-10":""},Sp={"line-height-18":"","flex-between-center":""},Ep={class:"overflow","fs-12":""},Lp=["onClick"],kp=nr(()=>ue("img",{"square-12":"","border-radius-50p":"",src:ip},null,-1)),Rp=[kp],Np=st({__name:"people",setup(A){const y=io(),C=Dc(),l=async S=>{y.chatList=[],y.isSend=0,y.isScroll=!0,y.isLoadAi=!0;const B=await y.getCoreInfo(S.userProfile.userID);y.isLoadAi=!1,B.code==200?y.chatIm.getMessageRead():C.error(B.msg)},G=(S,B)=>{y.delAiInfo=S,y.delAiInfo.index=B,y.isPopupAi=!0};return ao(async()=>{cn(()=>{!y.aiInfo.ai_uid&&y.aiList!=""&&l(y.aiList[0])})}),(S,B)=>(re(),he(xt,null,[ue("div",pp,[gp,ce(y).aiList==""&&ce(y).isAI?(re(),he("p",hp," It's empty ")):(re(),he("div",_p,[ce(y).isAI?gt("",!0):(re(),he("div",{key:0,"h-54":"","m-b-10":"","flex-flex-start-center":"","c-p":"",class:js(ce(y).isAI?"border":"border current")},[ft(ce(ii),{width:"37",height:"37","m-x-8":"","border-radius-50p":"","preview-disabled":"","object-fit":"cover",src:ce(y).aiInfo.avatar},null,8,["src"]),ue("div",fp,[ue("p",mp,[ue("span",vp,At(ce(y).aiInfo.name),1),ue("span",Ap,At(),1)]),Ip])],2)),(re(!0),he(xt,null,oi(ce(y).aiList,(E,W)=>(re(),he("div",{key:W,class:js(E.userProfile.userID===ce(y).aiInfo.ai_uid?"border current":"border"),"h-54":"","m-b-10":"","flex-flex-start-center":"","c-p":"",onClick:F=>l(E)},[ft(ce(ii),{width:"37",height:"37","m-x-8":"","border-radius-50p":"","preview-disabled":"","object-fit":"cover",src:E.userProfile.avatar},null,8,["src"]),ue("div",Mp,[ue("p",Cp,[ue("span",Tp,At(E.userProfile.nick),1),ue("span",Dp,At(E.lastMessage.lastTime),1)]),ue("p",Sp,[ue("span",Ep,At(E.lastMessage.content),1),E.userProfile.userID!=ce(y).aiInfo.ai_uid?(re(),he("span",{key:0,onClick:Tc(F=>G(E,W),["stop"])},Rp,8,Lp)):gt("",!0)])])],10,yp))),128))]))]),ft(dp)],64))}});const Op=si(Np,[["__scopeId","data-v-2d6b02b9"]]),Gp="data:image/webp;base64,UklGRkIMAABXRUJQVlA4WAoAAAAwAAAARQAARQAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwECgAAL0VAERANdSGi/wHa1raZtqP3r43Ytm1bbVtHvgBfgLuvwbZtd2zb3DaSrKrUWJn6a/boc9qSJCmSJI2IzKrdY2ZmZvrz+wam12Vmbu6uLmq2bZvWq57v7Pt9sW3btm3bLMPzK4AL4F+2bduO+Sl27l60s21f3zZ3K4z8/8txxXA1XOZ/B9AA8gBZQBnAPde/5/UA0gDJAMoAXkDnVZjNKIhFuRxKtlI3Tg1GCZ6p4OsT4CsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHhq8D3UoA4hBBACAPswhk/wDJ4J4/+kzRNCCyKIoJZB4hnAEPZgmHeTJ4IOfAdhNgvUoA1g7IlhIAxzLHm2oQM1LRCE0IaeZwB9YZCXBsTpJcXn0PUMIBaGeYwkxBBFZGEF6Hli6An7oWieFnQhzONfgjb0PVFgpWcHHsb/7BwqPR2hH+JVsAPt/AYeOp4dYVefoQff5emD8NDzH/wrjNU5X1eGFnSVONC9nHP+eWIh1sB4OtDKCs5ceiwa08RJEGf7oVGy+VGzbP9nqydKY8VOM508LJ+93Tm/88Lw2+1To9TX/634bcXHH496njg3VwFB7AmzDMCjsGjbf21gvVWTlFNoPTZJ/XJ6/vdKf4VOVl2gg7ZrlChkiYuCzaRlbpr689Ksb1e9+eE7XX8ZVdAJHL7RLx883Hx97C0XBRcFW8ne1eDSn7dmNla9+NFHnU66hFpgmvTSnydrrk1p7L03uGorcVEoVMnm5bjqyW33jeHj0akGCaKiSJPBvrTk1c8/fnl11f2Tm+6bNhOXBZvJpw/W3VUaTJtAAmT9plW2YtEx6DJcXgx/6uhV1ME1r7zz5p2r239s0DJtK3FZqI9W6bWbyYXFJ744DRMBfn7qQbf8v1emPbCZuCisvjm1sfSlzz4CALrk5dWJXY+Nt+7v/MFFwVZSqJJfpvl1ZegkfTTAyqFH/QqFKnFRsJnsXAyv/nl3ZmPVcx99BACMGI5M319sub1zGl6wldhKqnu79J/HWYVV+eGpKnISvgp/B4xDWb+5KlSJrcRmYjPZsh5b3bUetjXt5K/nAICrH3t3/6XNbb/YlhRaicvCyDw80a0BibAPmZrnvPD9/kfXN/7Ucmyaspm4LBSq5NfNvGbVsX2mf1bPAeif1fNXjvtvb86xhUtVgYHjJ3oGFdExM3A+PVe9hqfOdWVVu2+T+fTuuu8aomXaZcFWUp+t0r/s5tcihmn164UbC1JBMkiFvePg4IrNB6cq5XhLkJP26XXz6qld5vWHe3682CvZTAqtZGuOLlTOHTID4swcgEXzlxcd27X1hV6VkAxSYd3jk4oqNvgu1gB1BU/drnX21KLbZvWhXa7XeHbWazj7efTJg1cxhH5VM/99N6fy6zSvaSuxldhMfq4F5fuPT74HAIyqg5MD48BNGiayqpPtbyijOPpUMSluuDm+eXA1oOKi4KJgK7GR/PlwVmPVUx9+jEFcObx/+PR076912Tpd6CU2k+3DyJsRwbA4PmVAMkiFC2NVormaJbtNF1eaBN8D1eP4qmf+wHpgxWbismAzcVGwmWzZj6lu3I4rzh+/PYlhDB5OjrfUmIKtxLak7kTrdEs0TXSdL60B6HusXUgPkkEqmMzOneiUGb/8Z6p+ZC98exZDKoUqsZlczEot2VRJlvlqwGVh+zSyGMeYFr9eXBirXKoKkoHO4aFvbub2pzEAvee6JR2pYDKTDG3VOKEzGqlma1YcOwQXeyWbSdWxvaZsrrzf0L1f4LJwsnpsxDE6xdW1GwomMxoms5beJAkA6HK8spYhSAYTmcmsbWicUCXl+lvWby3qtcraSjiBGwt+aOBir+SyIC3WcQwC6UEq0KBDEAFICyYyySAVCPJbDLqfPD87dOj/ja2kfLih91jvUlW42CvZSkbHwcs4RtXQPs2IVJAIUmHU/vAMAFB9sl1aWjCRSQYTWd9t7UIFCkGkB+NMmCUnvvj0/m7Ld43ZIm0rsZnYTGxLTOX1ncfn38cxtj4xeouOtCAZpELXw6U1AKC9N0qYyiSDkUmFztOVtSrBJKaXCdMva+ZVc/vMZ/Pa2yeqR1BoJbYlXeLy4tH1w8/iQdbYWiSPPtk7kB6kgmQYtTk06XE4vwIANI3NU9KCZDCRmciGLo9fZ6aYfuyRTdM/quegIjpmTmT3XJ+on489/DdLQHz80obahaEqIRmkgmSYsfj5IiI48NyAvLRgZCazLtPlJdAn+KThGTifni+YvjlPEvz04sLi6hemlk1mkkEqdJyvrVfe+ugUANA4tEiefbJzYCIzmZnIptz9/VyX4FmkB/tBI7z6uak3P3h98y2pIBmkgons6pvv7vfYn18BAFa/ObVgKjORSQapMPnWH5fZcCn6MArJhx7vl3vrnZ23pQepIBlMZCOWRya3X3zxMGLY/eLQLVOZiUwylE83vox8eHiWTZeiL+x7BgGTyfevLSlfHCoTkkFakAw99+cWj5x65E2EsP2lkfmKpztuSASpYGR9t7Wfe2zOr1RwiW0z7AVs3LrMl9fSg4lMMvTYnV8++f/9z4YsT8wjhM++XHtbKpjIjKxkLrvizAf7ypaEpYCXG66+cfTyZwdun36ya9D9cGH51H/3jWL520+WVdtONk4ZmZGZyPqvq6czr/x0mQkXt5uwBGP9TnTI6sT82T/vHp16olt22OLYdQzgyHN9cqvfn1ozkZnISuYyE9mqUx/uK9sTK5gw9sQhu4N4Pv101+xbP+2871rxtZGVKDOZTbjx99nMyz9dAl1LEgAG0AsO6Xd+2n63/WSjVMlcZmQlyjrvryxv/e/l90omeJwEEIaeXugO/dNv1zXqnmx9o2QuM5kZWWnc+nLf70+97LE+v1JK4VkKAvRDxc43hxdKosxkVjKXmcjmnv/uYPStg9N0pjTkIkKK8AwCNyv9VtXXFc90Co3MZDbx2l8nN/3z2j5QSmGYvqULFHf89eK7T39Zd/vCUJUce/2/i7t+e+5DKlI6cBEiVXjisE3c0HvHrx//9cH/9UTwJOs4A7vwGGrBB0mlj6ZYSfiqJ0rvIcdTSHSyyqjydAI3clqLmuOZ0C/q5J91pyohLvp8zhmeao9m8A90oZVvTjnDZBq4fETMszXkkCjshhnL8kjhSRqUxtjl43c+/gk7wrMsruxOPTV4lNZjQKRAP+yGIraGAE8N+imV2sCH3VhtDgXPNrQhCilBP78bDmEAPBFsFy9adGs4PIW9zFuS0D4A8ETQggi+y/oeniVr8q7whPAdhPAdhBBCABMAYxjDPoxgP4/bI7X7/9/uvAA=",Hi="data:image/webp;base64,UklGRlIFAABXRUJQVlA4WAoAAAAwAAAARQAARQAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwUAwAAL0VAERB3oSiSpKb9a+WV0wE2FLZtpHj/aZ8Z5l9x27ZxrnJP+d3A+D8IgmACBOBALGwA8BGIYOEABAsBAAsTpKC5shQdg7Xr2hxT19K1GIcf4vJsjcu4eo/GIyDItp22eeEyhOnFDTgqav/bcyzrfalaQET/GThgEqfB3DqyQEGfAAAAAAAAAAAAAPTvn16n8/Vuv9+t59PXp/s+AAAAAAAAAABIGRk/vW9IkiRJkiQ3709jw0jS/ofpjiRJPbCbPmTbPnhekCRpHVg8D3K0eo9BK7Hx2Esud+8kmd54v0ssL1syj2xfUlrDN5LM1XgbmstoRuaU2chYJksyrywntrIic8tqYpkN2tmbI31aZEfmDfIw8aGs31H2Sf6XvMQ9xWTk2cz+Luazyt2qi3OXY6jB1TnnnHPOOeecc9ejdsKILz+q8uu9974mP0INvPfee+99oM+nlMcuBSn2+O6oWfFWTHKWzNIhqGehzaGr5anyRnzL6jlkVFW3Oofdo7fKQVYB6z4oZY4JiPwcWT20mCpdTgpZFk/bKCMDxDkDfnUoGQNPUpc6CrN8SFWfAE3w1xy4aItHXwdNF4f5UB1m+/faI7/isB8qdb1vZ5TLxGE/VE+8SjTuFke2Q1+nGn9x2A/VljrX8InoMoTSdb6WpdLIwyfr3T/hS3rNXuKYCX9K2X0DSQJxpMhRoelIEsiFq+qsNQkoJDifWjLXiPl6g6SF6qCpoZPO92FkUtZ+8zwZv7p+cWgIIcX1DsrzJAu0wS8sFVl9SZ3ruq7ruq6PmgVujGRoHI/Hj47VflsNQjNSw46pCcDFxooGdkR6Snw0saJm6lvUMKQj2uYsnqKjRhvBkqVJEzSFGCJYG03T8amho2kQ2Q3QxKB5Xkd2U5ZhsjgdRnWWEWY86ZVkM53xdLOv9IXKaXX21c0Ek/ETlp9QKZ0JRrJSafGGANvxaKOl96IZcqr3BRRQWTPkeLae7DbfXydztl7IzaGUW0whN6pCbneF3DQLufUWcgMv4zWgkJeJQl5JynixKeP1qOSXrEJe1QA=",Ki="data:image/webp;base64,UklGRlgFAABXRUJQVlA4WAoAAAAwAAAARQAARQAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwZAwAAL0VAERCXoSiSpKb9a+WV0wE2FLZtpHj/aZ8Z5l9x27ZxrnJP+d3A+D8IgmACAADAhljYAOAjEAAsHIAATAQALEyQgubKUnQM1q5rc0xdS9diHH6Iy7M1LuPqPRqPgCDbdtrmhZmZ89OQo1C1/82lkT+oWkBE/x1Ikho3W6iEb5TAAnoCAAAAAAAAAAAAUGx1B5PZerff79azyaDbKgIAAAAAAAAAAMuZane8ISIiIiIiIiLajLpVxRnT8+3JjoiISD6xm7SjPV7qzYmIiLQn5r1SDK3QCTSj0imYR3NERGRXRg3j6G+J4si2b9HKQyKiWMqwrPeqKVFMmVaUo74kiiuLum6siGLLSiOVQI+uVuS3MU9EfkB8mfChqN+R/NNqZPZ0J61FvL82ttbhvff3g9LtG1zMmsPt4b/y/lEGIRPLHfOv/vKBvJRGdfIUZGePtw/lqmSWHEH17B7gPwhPKa3qhYxqn398Xk7KKWDdtn0+M9B+qv3FxI4bg4vSrsmXh3bmcfjloE0lVaD7N5t9ncFRa1kXGEW4zuGgpn8UN2adHc+cbYo0W2xpjDmeTqdclJ0+js7ipl9iq6vQ3qFnH4kOd+95PLIsy7Isy07yhYHCE/IBcqCn99577733nltHQCySsQPZS6+Mhee/WJGF8zXJU2eGfzE7yTD8wbN1GljLEXOxQHATKWr2snMboeaDvYxTJPweJOxkN7WAjx6RB9ayn1rBcLZ0y0ym5Uj4pCHpRQpu/DWBIX6ZHweKRKOGRAdi5Mks8AnaKFCwQMsEy1tlRlKwo1ODZ0kFO36YWg5gE/K5WWbqv6wRD2zykLPGN4OJNMBBf0WRwb7ZVKSBCHByNg0yu0gDenA5Vc7sYZUh0YAWfDaUq4yw4pFogFnqUf1WueLJV19Sxca49Fv7Vrn6yleCUpn0zht5+tUlL7kS5KpS6dTVuewYLOTqnHPOOeecc845dzsrqlKup4vUjmkrZL5a/z/0E+kcUuliEumoEunuEuk0E+l6E+nA09gNSGRnIpFdkjR2bJLYPYq7n1WLvZOVyK4aAAA=",Pp="data:image/webp;base64,UklGRgYNAABXRUJQVlA4WAoAAAAwAAAANQAANgAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEzICgAALzWADRANdSGi/wFKtratbaRXDKZgMTMzc02rmmkLmfUasoae9bgXwN3TPj3CwjAzo1VmW9J/kv/7BDuQpG3bYTnPVz5G24htc+pkA5lmljXkyhoy6y3EHtq27bT7nOpy1U+L2rYzenV/mW/CsY263ba9j+x9aNu2bdu2baO27Y7VTJM/crBtO/bm/JIjh52MyfaPtdvRWN3Gtr3Vtu3Und2Odv9u1mg3/B04ktQ4yJcXKKL8BkAAAAAAAAAAAAAAAAAAAAAAAADwx65DYg/92meO66WHAzEFSgxTlcxSMzVWUb4AQIgbCbVhbyjOZ4j3Ani3q/n14YXe3y6/uPJlLwAAAAAAAAAAAAAAAAAAAECSN6/W7ByTdU9YaMSJpWpmTFMzLZYZFCUDLTXjjCSUDQAAEGp2b6gNbrbMTafLxXfP33r8f3/Kuz93npJ28Pcu9VoabNATKyveomZarJ5E5jr+mFO+0fsc6J0diz3/7Xx+7aXvKe4EImp0wQN1VphepmZGekKQnlhZVphZcezbwW9GFjzYcPb9ZbsUvKGkR9+y24a7XvG4EYdGp2iImhnpjl/ZPjnnpYfV/MrCKy9vCCcDDS5+oMr18lvUTI1P12lGHBqda469N7j4gaqLby7blwAjEMHY/Cd22UGmJlbiGx1qplIzTYxDzdT4rFvdOzr/yd1nPpxXp+BF4mgCET0+7+mTVphcEoUINVvDrikXl6k5awT6kG90AAAAGHGAmmmsMCE7W+b4OVFZ7SBTMz7v6Z7TH8/OV/AGY9L4vKePRx213Bqb9ckadk2gDzFC0+oB8CoLAAC4Xlb3+J6sMI6TrDC5ZHze08fPfDwrL/oYWfDUVitM5nJBy+xabf9ZNb9GbE3V/Fqz/R/IN8brnNyJEQcwgxUmc0cWPLX13PtzmqNAfcvuzXX8VCMXbLZMsdEyBYAQRYK+9ioLTQ29rWtiR50TO2IEx0819i27N/fKyyt7uOb16ltCWbe0F4iACVY7/rFdnU2IImEp663TtE9vZe//3VAAEEHWLe19vfqW0M0nN71ilqxb2q+lajLr/dn+r9WduuSlbtXmmB78xKHfB6FRWqomZ93SfibpW/Zwrh2EpzLAzMA36k4dgKI8QgSApO9ruYb53h+d+HoEirOD8NS+ZQ/nXnl5cQ9ZJ66XWMuOlc7/1J06IACPEAXwJH9fdxpWOv+z798uKM/1Emtfrdk5Rq4hxz+pxIjNHKpYb5tusz6XEEXKFbVZn2uzZa7OiYlIBUZs5jizJ5XIfGYUaWO1rrbPIPN1TG3t3r3bEESptM5620IjCx4kS3p0+0H5RhVRzA78C2Bm8E2V/HIAAADLnf87++FoNMZMIm0AAABvV947w4ysEE2rHTOReyOOoAjHj9FSjeuVVQorAQC4XlK+UcUjhAgENd/7txNfD0YQZmSF3q68c8b1Z9deB3C9zAI2/bZqS5GSQs1FFXqimu+bzPUrhAgAADm3audrxE/GlYsbVArrZWbTCCLr5hYAAKipbx7lLHVPAQTgkedQGwHALlm3AAjAA4S9/3cTdVDVSucsJz8fhCig/PMA/ll9xyQzNjIIINCHvPJqcV1uhYbMbIma6QLdBpBvVEWeSL5yYaNAH9JSlSzJjI2Mf1bfMSnvpyZTTbm40Q6HPvATQM4dZ7s6i+slFWbKIg4hCiEC4xVm8khJeT812YyMEZRRrK4RkfiHrFskRMg3KyKvQgTGO/p9F6QkMzJGhJo7gTJquSYhAhAAAIAHCLQHmlafGZkAABw/pjAzmhCFnE11p8MOgtgFeIirXNiIKkLNnaAomU0rqOTbhCgi+61ht8kPWqpx/KTCTAUAAEDL7Ik71Z0BWpKiZLaWykRSUqBvwacjEGRc3WkDAACwwhCAPWM7KsyUAQD4xlDDHmCcXRcFaqmfzKelMlHNZDRBNOy+mDFqWgOBbtNSDYAZmeb7Jtszui05USNy8kTyqZmMVpRAEUIToAABOVOTV1kDAADADkJcLwIAAKCab+LZuKth9+WaCZKhKEGIh/ys0CQQKIttIMXqCgAAAHYQZMQWOR56omEe7tJSP5JPiCfUnEEt9UcThNAUUIAAAAAKELAuWGufDwAAwPFj9EQFAOAbQ02rz4ws7IG7rNBEGKHmDPqG+8cK9RSShAhQAAAg7+ipZfYZsQlAT1TkS6WwDstGXfzkG+4fIc6nHQ55lIMEEXaz0aGSF/LFq6zDxxQiEJfrhVCFEOeTouR9WkG+EbfWthrtZSECbdJuItPsQ3kt3xjiM5mGuF4YZShK3m9a9nNaQftUhtCEmKFda19gN5/8slVfxg5C4orqmEyjJTUt+3mx2rjDTkIEAAAgAE/EbNmqr9Iy+4zYRL54lXX2jI7HdwPgIa58I44yitXGnUe3L707NvetL1akZcgK9ETKNxK8Sh0tiOYToljtWEiWVMt1bdWXKxcb4tZa50SKnkikpIZtf310+9K7AIHhXnI9s5wIjvwYrW/5ZLQHWJP+3vSqnw9cTy68pjUgRMGXBa3gxJfxqCLQ3UsAAF6ldmH/3+I1IijMRBVmorxKA98NyGQuF+sS7Y57/2dZoYFW4FVqFwAA7t2/6Pro/Dde2oERIoQzH7by3/o/RDxUCnXF6npxe4dXWafu9BSr69F+oJa6M3h17/5F1wEAAMrFzZu6xqP7iMEOdCe+jDc5ZwEAAICVzoV+OHS+uGZNzvlHpOPYtyo70O1WIGNl3Ku1/x55fnX/11ao5RDEoV8FB3+XLPSuknz3pq6j36toBQ3b/vhq7b9HZL6ekWf6S6VWd9d46hRlnPo0xv/rJisXe1IdWddy6tMYDFAqtbp7Rp7pJyXdfHJ2z/DCV2+6XmAqdVx+uZX+ZbOVSn0pjlzTdP3pdhigmu/euvnk7B4G2K7VKvf+zz/WE5lMY24/3Mn4vCXm+1ZLfBz+mXf64ygM4BvOr+1arZJTHty95NV/657O3TOaOqkoAio4/XGU6aEVpoZXSHic+FJy/GsJAwghstlSr35w95JXEZg7D8/ueb/8la1t08EmJjj+teTh7Z1NDa+01L1Rgrv2qZCLr8ewAx0neJXO9jsPz+6J9Fx9cVJz/9LXTuUbVu6OgEZdeDNWqdQzumC57VoLf0PmeK5pOfm5oH0qJALxodztufripOaYZgwv+qzwwpvDTuaagSWckGtabj2axDccW/WO9baaUqmvZbrqzmaSbsQ+7VMhe0Zjck2TnkhRulKpe2Z40eeFcY3/5sS7g1AE71e8uqttOlAT1aw9o1EXX48BAADgGw7fcNmBJramYrW75+rzE+sgRGIlECJXX5xY++/656u6xsNb9MQXHyPREylW5hvuv+1as+XW4zP2QYgkGZ+7D07f99f2Z4fvGQ0edz1tdKrZVc3bT9baO4VPb5wZTuh5euPMcO/Rm6M+uliua5u2lhmxTE981zKdb8Vqb9lve5fv6j1281BiUu+xm4cAfjx4S9rxr9V6x9ca7MCflQhUd7Z8ruXsHdNDS3d+fvam76ma//nZm74DfH/4rJjrT3dbmHWNpWYkpxmxLzbG0jLd3qbl3CwXB6ffrvrnfM/IM/2p/qWTNQQA8N2RC2OvPdt+Tte4OVxRI1OAGKYnSpaWylgtJQAIdCKB7vT6xshn4L0QotwuVtvhV2tnXf72+KO9CXQA",bp="/assets/loading.52d42914.gif",Up="/assets/fig_icon_1.708199b2.webp",wp="/assets/fig_icon_2.9ab17cc1.webp",Fp="/assets/fig_icon_3.06a3bec4.webp",xp="/assets/fig_icon_4.2740b193.webp",qp="/assets/send.cc8c67bb.webp",or=A=>(ji("data-v-c721e6b9"),A=A(),Ji(),A),Vp={"h-100p":"","position-absolute":"","w-100p":""},Bp={class:"top","h-80":"","font-weight-bold":"","fs-20":"","color-ffffff":"","flex-flex-start-center":"","position-absolute":"","z-10":"","bg-13102b":"","w-100p":"","left-0":"","top-0":""},Hp=["src"],Kp={class:"main","p-x-15":""},Wp=or(()=>ue("div",{class:"tips"}," All chats and related services are Al-generated, and some may incur charges. Please ensure sufficient balance.",-1)),Yp={"m-t-24":"","color-ffffff":"",op50:"","text-center":"","w-100p":""},zp={key:0,class:"dialogue"},jp={key:1},Jp={key:2},Xp={key:0,class:"icon"},Zp={key:0,"c-p":"",src:Hi},Qp={key:1,"c-p":"",src:Ki},$p={key:1,class:"icon"},eg=["onClick"],tg=["onClick"],ng={key:1,class:"imgPrice flex"},og={key:0,class:"coin"},ig={key:1},ag=["onClick"],sg={center:""},rg={center:""},cg=or(()=>ue("img",{"square-18":"","m-l-3":"",src:Pp},null,-1)),ug={key:3,class:"icon"},lg={key:0,"c-p":"",src:Hi},dg={key:1,"c-p":"",src:Ki},pg={key:4,class:"icon"},gg=["onClick"],hg=["onClick"],_g={key:1,class:"reply"},fg={key:0,class:"dialogue flex dialogue_login"},mg=or(()=>ue("div",{class:"content"},[ue("div",{class:"text"},[ue("img",{width:"30",src:bp})])],-1)),vg=[mg],Ag={class:"send","position-absolute":"","left-0":"","bottom-0":"","w-100p":"","p-b-25":"","bg-13102b":"","p-10":"","z-10":""},Ig={"d-flex":"","m-b-10":""},yg={"position-relative":""},Mg={key:0,"position-absolute":"","top-50p":"","left-50p":""},Cg=st({__name:"dialogue",setup(A){const y=Yi(),C=y==null?void 0:y.appContext.config.globalProperties.$sensors,l=Zs(),G=io(),S=ke(""),B=Dc(),E=ke(!1),W=z=>{z!=""?(C.track("h5_AI_function_click",{node_name:z,ai_name:G.aiInfo.name,ai_id:G.aiInfo.ai_uid}),C.track("h5_download_pop",{entrance_source:z})):(C.track("h5_AI_chat_msg_voice",{ai_name:G.aiInfo.name,ai_id:G.aiInfo.ai_uid}),C.track("h5_download_pop",{entrance_source:"chat"})),z!="Selfie"&&(G.isPopupDl=!0)};rn(()=>G.chatList,()=>{if(!G.isScroll)return!1;cn(()=>{X()})},{deep:!0});const F=ke(!1),j=ke(!1),oe=async()=>{var z,b,ie,De;if(S.value!=""&&G.isSend==0){j.value=!0;const Ve={targetId:(z=G.aiInfo)==null?void 0:z.ai_uid,content:{content:S.value,extra:{messageId:qs(10),dataType:"text",data:{context:S.value}}}};G.isSend=1;const Ue=await G.getChatV3(Ve);j.value=!1,Ue.code==200&&(G.chatList.push({content:{data:{targetId:(b=G.aiInfo)==null?void 0:b.ai_uid,content:{content:S.value},extra:{messageId:qs(10),dataType:"text",data:{context:S.value}}},description:"",extension:""},to:(ie=G.aiInfo)==null?void 0:ie.ai_uid}),G.chatIm.sendToAiText({targetId:(De=G.aiInfo)==null?void 0:De.ai_uid,content:{content:S.value},extra:{messageId:qs(10),dataType:"text",data:{context:S.value}}}),S.value="",G.isSend=2)}},pe=async(z,b)=>{F.value=!0,G.isScroll=!1;const ie=await G.getUnlockImage(z,b);F.value=!1,ie.code!=200&&(ie.code==1011?G.isPopupCoin=!0:B.error(ie.msg)),cn(()=>{G.isScroll=!1})},Ge=async(z,b,ie)=>{F.value=!0;const De=await G.getChatLike(z,b,ie);F.value=!1,De.code!=200&&B.error(De.msg),cn(()=>{G.isScroll=!1})},Q=async()=>{F.value=!0;const z=await G.getSendSelfie();F.value=!1,z.code!=200&&(z.code==1011?G.isPopupCoin=!0:B.error(z.msg)),cn(()=>{G.isScroll=!1})},ae=ke(),X=()=>{var z;(z=ae.value)==null||z.scrollBy({top:1e4})};document.addEventListener("keydown",function(z){z.keyCode===13&&E.value&&oe()});const te={common:{primaryColor:"#8650D0",primaryColorHover:"#8650D0"}};return(z,b)=>(re(),he(xt,null,[ue("div",Vp,[ue("div",Bp,[ue("img",{"square-45":"","border-radius-50p":"","m-l-15":"","m-r-12":"",src:ce(G).aiInfo.avatar},null,8,Hp),In(" "+At(ce(G).aiInfo.ai_name),1)]),ft(ce(op),{ref_key:"NScrollbarRef",ref:ae,"h-100p":""},{default:Kt(()=>[ue("div",Kp,[Wp,(re(!0),he(xt,null,oi(ce(G).chatList,(ie,De)=>(re(),he(xt,{key:De},[ue("div",Yp,At(ie.time),1),ie.to==ce(l).userInfo.uid?(re(),he(xt,{key:0},[ie.content.data.extra.dataType=="text"||ie.content.data.extra.dataType=="audio"?(re(),he("div",zp,[ue("div",null,[ie.content.data.extra.dataType=="audio"?(re(),he("img",{key:0,class:"video","square-20":"",onClick:b[0]||(b[0]=Ve=>W("")),src:Gp})):gt("",!0),ie.content.data.extra.dataType=="text"?(re(),he("span",jp,At(ie.content.data.extra.data.context),1)):(re(),he("span",Jp,At(ie.content.data.extra.data.audioContext),1))]),ie.content.data.extra.data.is_like?(re(),he("p",Xp,[ie.content.data.extra.data.is_like=="dislike"?(re(),he("img",Zp)):(re(),he("img",Qp))])):(re(),he("div",$p,[De==ce(G).chatList.length-1?(re(),he("img",{key:0,onClick:Ve=>Ge(ie,De,"dislike"),src:Hi},null,8,eg)):gt("",!0),De==ce(G).chatList.length-1?(re(),he("img",{key:1,onClick:Ve=>Ge(ie,De,"like"),src:Ki},null,8,tg)):gt("",!0)]))])):ie.content.data.extra.dataType=="image"?(re(),he("div",ng,[ie.content.data.extra.data.price==0?(re(),he("div",og,[ft(ce(ii),{class:"nimage",width:"150",height:"230",src:ie.content.data.extra.data.url},null,8,["src"])])):(re(),he("div",ig,[ie.content.data.extra.data.pay_url?(re(),to(ce(ii),{key:0,class:"nimage",width:"150",height:"230",src:ie.content.data.extra.data.pay_url},null,8,["src"])):(re(),to(ce(ii),{key:1,class:"nimage",width:"150",height:"230","preview-disabled":"",src:ie.content.data.extra.data.url},null,8,["src"])),ie.content.data.extra.data.is_unlock?gt("",!0):(re(),he("div",{key:2,class:"buy",onClick:Tc(Ve=>pe(ie,De),["stop"])},[ue("div",sg,[ue("p",rg,[In(At(ie.content.data.extra.data.price),1),cg])]),In(" Tap to see what's inside ")],8,ag)),ie.content.data.extra.data.is_like?(re(),he("p",ug,[ie.content.data.extra.data.is_like=="dislike"?(re(),he("img",lg)):(re(),he("img",dg))])):(re(),he("div",pg,[De==ce(G).chatList.length-1?(re(),he("img",{key:0,onClick:Ve=>Ge(ie,De,"dislike"),src:Hi},null,8,gg)):gt("",!0),De==ce(G).chatList.length-1?(re(),he("img",{key:1,onClick:Ve=>Ge(ie,De,"like"),src:Ki},null,8,hg)):gt("",!0)]))]))])):gt("",!0)],64)):(re(),he("div",_g,[ue("span",null,At(ie.content.data.extra.data.context),1)]))],64))),128)),ce(G).isSend==2?(re(),he("div",fg,vg)):gt("",!0)])]),_:1},512)]),ue("div",Ag,[ue("div",Ig,[ue("img",{onClick:b[1]||(b[1]=ie=>(Q(),W("Selfie"))),"h-26":"","m-r-5":"","c-p":"",src:Up}),ce(G).aiInfo.generate_photo_btn?(re(),he("img",{key:0,"h-26":"","m-r-5":"","c-p":"",src:wp,onClick:b[2]||(b[2]=ie=>W("Generate Photo"))})):gt("",!0),ce(G).aiInfo.role_play_btn?(re(),he("img",{key:1,"h-26":"","m-r-5":"","c-p":"",src:Fp,onClick:b[3]||(b[3]=ie=>W("Role Play"))})):gt("",!0),ce(G).aiInfo.private_date_btn?(re(),he("img",{key:2,"h-26":"","m-r-5":"","c-p":"",src:xp,onClick:b[4]||(b[4]=ie=>W("Date"))})):gt("",!0)]),ue("div",yg,[ft(ce(Xd),{"preflight-style-disabled":""},{default:Kt(()=>[ft(ce(Sd),{placeholder:"Say something\u2026",type:"textarea",class:"textarea",value:S.value,"onUpdate:value":b[5]||(b[5]=ie=>S.value=ie),autosize:{minRows:1,maxRows:3},"theme-overrides":te,onBlur:b[6]||(b[6]=ie=>E.value=!1),onFocus:b[7]||(b[7]=ie=>E.value=!0),onkeydown:"if(event.keyCode==13)return false;"},null,8,["value"])]),_:1}),j.value?(re(),to(ce(Ys),{key:0,class:"send_message","square-26":"","position-absolute":"","r-10":"","top-50p":"",size:"small"})):(re(),he("img",{key:1,class:"send_message","square-26":"",onClick:b[8]||(b[8]=ie=>oe()),"c-p":"","position-absolute":"","r-10":"","top-50p":"",src:qp}))])]),F.value?(re(),he("div",Mg,[ft(ce(Ys),{size:"large"})])):gt("",!0)],64))}});const Tg=si(Cg,[["__scopeId","data-v-c721e6b9"]]),mc="data:image/webp;base64,UklGRggFAABXRUJQVlA4WAoAAAAwAAAAYgAAYgAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEzJAgAAL2KAGBCvMf/zP/8M27aNHK5stHn63AQXGDcAEIAgFIwJwVgQAACFgmA0ADAWAkAAEwAkBEEAwAAgEPgRCAQCHwKBB0iOJCmSYpiZmSlmlnf//7eBhsjKPUf0n4Hbto2K+JDbO856AQAAAAAAAAAAAAAAAAAAyFVa/clssz2eeT5uN7NJv1XJAQAAAAAAAAAAAAAAAJCty9cH8wNJkiRJkiTJw3xQzwexpNCc7kmSJBOt2k+bBWutOn5Zkm7BuGq4JNtckCQpWLBoZm20THtFkjJl1c4YoLYkSamyrKm10uhMyuU8KknR2ZKkgbLt6LTikCSNlGFRhPKaNJR1WYLGjjSVXUOA7ok0llM3NXoX0lwuvZTok2QASj+dTgYivTR7vKwNYWU3+Ykij2Z/sEbS/zD2rNYnLSezJYn+dNt/P5F9SWytLG1YEotLBiedeNZIadOt7H0sp4zIAGUUx60S5rPgxlq0fyBjbz3HR/oRbTJQaUd5USvt0PpDET5XkwxWmq9jYTF0vuOrN2txyW+f71fRBb74wGO9dvv9+/v7vWkucfzs8+9t8Pf3db9GhS9feNraAk/jR7nx1ADP41t0mdNH7LXX42W8UzSbB+pm+JBdaR0YmEF3qQNgbgXhtc6RO4SFZPF0rmIE7UuttGwg/jJbfRPIPeuJBeRWaDIzgN5YzzZ6GBDOZiuHiR93lFzcNQomjHs8a7g1AjZunMg1/IiiDRtxMTlqrs56sYvdXPyPLqyKC9vowsK74CkXbOvCZ/Dg+bjw31x4oaa+9JvMl/YQERjGNY/wTBXXuIjOPMSYCSNljZ/y/vUmi5Q9xPsushYuci8eMkgu8mAesnkecpIuMqse8sMestwucvUeKg4e6iYeqj8ealgeKnEe6okeqqIearseKtQe6uwOugU89Dw46Nzw0H/ioIsm/F4gBx1N/0JflofuMgAA",Dg="data:image/webp;base64,UklGRkIIAABXRUJQVlA4WAoAAAAwAAAANQAANQAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwDBgAALzVADRB/B7e2bdXKvefsK0/+/7i7SwM/pAAnggaI3DNSdyjAIneNXDK3zLUCBjlNOGzbyJGoufvQf7WXD85t26aevc4593v6YltVOqvNr2aZ9Kps25UIsm1xDb7XQRDxqggSoVkEiSAlhoU0y9jyqv7LIoiQsyRCrkAuQTMhZ4klIbkEucPzqgiVCEm6Sv1nk0tiVTSJUHFJhBJd/0EAsQJIhJwRQHI0q13XgUCwxApWAIEAAiIEX6g+RppfjiQqbC6nAjI151iai1eanF3EhXWIVRlbthBnmdJzIEeSqKCEOBlfxpO0LBu+54uWOEzPsZgvEAGzNefi5IZnR4ISGM2kqKs7x9ubS8WazXUoTQPFXc4Dhwu/3dNMrFKs3Gx7zuaWK4mUczmP695n/tuPpTmVrcF2ZwJqAmrOlhtd1+Te+0SMYcDszrlsTYisdwoQo+QKAIaoJ++vHxc9ilfoOxb66ZvmPMnVPGFwOSPsd0WB4gwTVHPeHQIFBJ5Ec8fdMAwYAgkERFyu7ZzIcrc901yczGOvrnrC8NQ7zYH56Zthpo6lAK99AjAIADAwwwAQcNYtBmYkYQAwwwCGgUGS0+4AAMwAiJGEASCAgeG8WwIIJGFg5t8DnHYHwACGQBIwBAAwDHc9YxAAIJCEGQAo/P+/1kqX9sXuxG5swe4Au7uxG7C7Abu7C7Gb2NET5NL7j+kuvc37/+s5elbefAy87s62OyL678BtJEUqXS2DD+feAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD73bXBmug5c+desgZ68Zw5c64uvxfNmz9v/t2l9+xGo9FovFh2t6/X6/V6vT663I5+pVar1Wq12oXl5rZqtVqtVqvVr0vtkb/+1jk9q8y8XKlUKpVKpVKpfLV+eT1BURRFURRFURTl2vLyUldX1+8Z2/ctq/tYlmVZlmVZlmVZ1ndbl5RbTdM0TdM0TdM0TdN8qKS8YRiGYRiGYRiGYRiGcWYp3VvXdV3XdV3XdV3XdV3XtysjZ2iapmmapmmapmmapmna6+uNQLnV8ekb3Kuqqqqqqqqqqqqqqqqq6mXFe9K3i49LAR5bvKjIdNui3WvZwmW3pASvLVtYZPpowW756tIFS79JERYsLTbds1hu7l7SvaR7mLTFakGx6SOFurnjOI7jPJxFcBzHcRzHcRwnbRpTJJf++UdqejowZrWg4PSaInnXtm3btu3vt8Eetm3btm3btm3btm3bnaQC3Y1zzjnnnPMbTuScc84555xzzrNEu+fnaMYYY4wxxhhjjDHGGGOMMcYYY4wxxhg7LT/XU0oppZRSSimllFJKKaWUUkoppZRSSuk9+XmSEEIIIYQQQgghhBBCCCGEEEIIIYQQQt7JzxNSSimllFJKKaWUUkoppZRSSimllFJKKfPzthBCCCGEEEIIIYQQQgghhBBCCCGEEEKIzXLT09PzV4HtD+Rbds2N7/u+7/u+7/u+7/u+7/v+VXgrV3JEbt70PM/zPM/zPM/zPM/zvI+Bo3Ipu+TmWdd1Xdd1Xdd1Xdd1XdedBGBSHmXd3Ny/atXKVXnbDwew7kc5lvzTrlu+In+6zrDnsGzJc/k5NI7jOI7jOI7jOI7jOP4xDbozk3JTftb5IYqiKIqiKIqi6MPh7WnQzpmcQwp82R4PwzAMwzAMw/C+g8Mw/KAD9EyaMywp8r0+KAiCIAiCIAiCidjp6fcndoBuzODcUein56l2u91ut9vtdntCtmdCp+a9TQvlwH//65yOz/aM79RcWfAn9fZWq9VqtVqt1rnZnCs6MF8W/fVe+4Vms9lsNpvN6dmc6WnLL5sUHik2+Xnon6Gh4e3jsjDjOizHjmBU2vGLvwdT05kbd1I2npmWXFBo6MuwzRgYGOgfGBiY0fEY+3nK8dPYEY6Ya03p6+vr6+vr65tyzAE7nPpg2vDZRiMfaff/9P/e3t7s7bPPL+fPwCnTkiRJkiRJkiRJpl0+qrR/OaNOnjz1+VmzPpk6+bwNC7kAAA==",Sg=A=>(ji("data-v-6238d6c5"),A=A(),Ji(),A),Eg={key:0,class:"banner"},Lg=["src"],kg={key:0,class:"custom-arrow","flex-between-center":""},Rg=["onClick"],Ng=["onClick"],Og={class:"custom-dots",center:""},Gg=["onClick"],Pg={class:"details","w-100p":"","h-280":"","position-absolute":"","bottom-0":"","left-0":""},bg={"p-y-20":"","p-x-15":""},Ug={"color-fff":"","fs-22":"","font-weight-bold":"","flex-between-center":"","m-b-10":""},wg={"flex-end-center":""},Fg=Sg(()=>ue("img",{"square-18":"",src:Dg},null,-1)),xg={"color-fff":"","fs-16":"","m-l-4":""},qg={class:"tag","flex-flex-start-center":"","flex-wrap":""},Vg={class:"introduce","m-t-10":"","fs-14":"","line-height-24":"","m-b-80":""},Bg=st({__name:"detalis",setup(A){const y=Yi(),C=y==null?void 0:y.appContext.config.globalProperties.$sensors,l=io();return rn(()=>l.aiInfo,()=>{l.aiInfo&&l.aiInfo.name&&C.track("h5_chat_page_view",{entrance_source:"AI\u8BE6\u60C5\u9875",ai_name:l.aiInfo.name,ai_id:l.aiInfo.ai_uid})},{immediate:!0}),(G,S)=>(re(),he(xt,null,[ce(l).aiInfo?(re(),he("div",Eg,[ce(l).aiInfo.posters?(re(),to(ce(Yd),{key:0,"show-arrow":""},{arrow:Kt(({prev:B,next:E})=>[ce(l).aiInfo.posters.length>1?(re(),he("div",kg,[ue("img",{"square-34":"","m-l-12":"","c-p":"",class:"prev",onClick:B,src:mc},null,8,Rg),ue("img",{"square-34":"","m-r-12":"","c-p":"",class:"next",onClick:E,src:mc},null,8,Ng)])):gt("",!0)]),dots:Kt(({total:B,currentIndex:E,to:W})=>[ue("ul",Og,[(re(!0),he(xt,null,oi(B,F=>(re(),he("li",{key:F,class:js({["is-active"]:E===F-1}),onClick:j=>W(F-1)},null,10,Gg))),128))])]),default:Kt(()=>[(re(!0),he(xt,null,oi(ce(l).aiInfo.posters,B=>(re(),he("img",{key:B,class:"carousel-img",src:B},null,8,Lg))),128))]),_:1})):gt("",!0)])):gt("",!0),ue("div",Pg,[ue("div",bg,[ue("div",Ug,[In(At(ce(l).aiInfo.ai_name)+" ",1),ue("p",wg,[Fg,ue("span",xg,At(ce(l).aiInfo.heat),1)])]),ue("div",qg,[(re(!0),he(xt,null,oi(ce(l).aiInfo.tags,B=>(re(),he("span",{key:B,"fs-12":"","p-x-12":"","p-y-6":""},At(B),1))),128))]),ue("div",Vg,At(ce(l).aiInfo.ai_desc),1)])])],64))}});const Hg=si(Bg,[["__scopeId","data-v-6238d6c5"]]),Kg="/assets/null.49a2f2b0.webp",Wg={},Yg={"h-100p":"",center:""},zg=ue("div",null,[ue("img",{"w-300":"",src:Kg}),ue("p",{"color-B5B1FF":"",op30:"","m-t-10":"","text-center":"","fs-15":""}," It's empty ")],-1),jg=[zg];function Jg(A,y){return re(),he("div",Yg,jg)}const Xg=si(Wg,[["render",Jg]]);var Nc={exports:{}};(function(A,y){(function(C,l){A.exports=l()})(Pi,function(){function C(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),o.push.apply(o,n)),o}function l(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(o){W(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function G(e){return(G=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function E(e,t,n){return t&&B(e.prototype,t),n&&B(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function oe(e,t){return(oe=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(e,t)}function pe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ge(e,t,n){return(Ge=pe()?Reflect.construct:function(o,r,a){var s=[null],r=(s.push.apply(s,r),new(Function.bind.apply(o,s)));return a&&oe(r,a.prototype),r}).apply(null,arguments)}function Q(e){var t=typeof Map=="function"?new Map:void 0;return function(n){if(n===null||Function.toString.call(n).indexOf("[native code]")===-1)return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,o)}function o(){return Ge(n,arguments,j(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),oe(o,n)}(e)}function ae(e,t){if(e==null)return{};var n,o=function(s,r){if(s==null)return{};for(var c,d={},p=Object.keys(s),_=0;_<p.length;_++)c=p[_],0<=r.indexOf(c)||(d[c]=s[c]);return d}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),a=0;a<i.length;a++)n=i[a],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function X(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e){var t=pe();return function(){var n,o=j(e),o=(n=t?(n=j(this).constructor,Reflect.construct(o,arguments,n)):o.apply(this,arguments),this);if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return X(o)}}function z(e,t){return ie(e)||function(n,o){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var a,s,r=[],c=!0,d=!1;try{for(i=i.call(n);!(c=(a=i.next()).done)&&(r.push(a.value),!o||r.length!==o);c=!0);}catch(p){d=!0,s=p}finally{try{c||i.return==null||i.return()}finally{if(d)throw s}}return r}}(e,t)||Ve(e,t)||ut()}function b(e){return function(t){if(Array.isArray(t))return Ue(t)}(e)||De(e)||Ve(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ie(e){if(Array.isArray(e))return e}function De(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ve(e,t){if(e){if(typeof e=="string")return Ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return(n=n==="Object"&&e.constructor?e.constructor.name:n)==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(e,t):void 0}}function Ue(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ut(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Re(e,t){var n,o=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=Ve(e))||t&&e&&typeof e.length=="number")return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(r){throw r},f:t};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i,a=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var r=o.next();return a=r.done,r},e:function(r){s=!0,i=r},f:function(){try{a||o.return==null||o.return()}finally{if(s)throw i}}}}var K={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange"},g={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3},Me={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},Vt=(E(Ot,[{key:"use",value:function(e){if(typeof e!="function")throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map(function(t){return t}),this.options=e,this.next()}}]),Ot),Pe=(E(Zt,[{key:"equal",value:function(e){return e!==null&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),Zt),Nt={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.18.188"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT:"wss://wssidn.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},ze={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},Xt="1.7.3",qt=537048168,un="CHINA",O={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=Nt.PRODUCTION[0<arguments.length&&arguments[0]!==void 0?arguments[0]:un]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report"}},Ce={SEARCH_MSG:new Pe(0,Math.pow(2,0)).toString(),SEARCH_GRP_SNS:new Pe(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new Pe(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new Pe(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new Pe(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new Pe(0,Math.pow(2,6)).toString(),USER_STATUS:new Pe(0,Math.pow(2,7)).toString(),CONV_MARK:new Pe(0,Math.pow(2,9)).toString(),CONV_GROUP:new Pe(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new Pe(0,Math.pow(2,11)).toString(),MSG_EXT:new Pe(0,Math.pow(2,13)).toString(),GRP_COUNTER:new Pe(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new Pe(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new Pe(Math.pow(2,7)).toString(),PLUGIN_CS:new Pe(Math.pow(2,8)).toString(),PLUGIN_PUSH:new Pe(Math.pow(2,9)).toString(),PLUGIN_BOT:new Pe(Math.pow(2,10)).toString(),MSG_REACTION:new Pe(Math.pow(2,16)).toString(),FOLLOW:new Pe(Math.pow(2,20)).toString()},ln="group_profile";function Zt(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;S(this,Zt),this.high=e,this.low=t}function Ot(){S(this,Ot),this.cache=[],this.options=null}O.HOST.setCurrent(un);var ht=typeof wx<"u"&&typeof wx.getSystemInfoSync=="function"&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Gn=ht&&typeof wx.createGamePortal=="function",Qe=typeof qq<"u"&&typeof qq.getSystemInfoSync=="function"&&Boolean(qq.getSystemInfoSync().fontSizeSetting),It=typeof tt<"u"&&typeof tt.getSystemInfoSync=="function"&&Boolean(tt.getSystemInfoSync().fontSizeSetting),Wt=typeof swan<"u"&&typeof swan.getSystemInfoSync=="function"&&Boolean(swan.getSystemInfoSync().fontSizeSetting),lt=typeof my<"u"&&typeof my.getSystemInfoSync=="function"&&Boolean(my.getSystemInfoSync().fontSizeSetting),ye=typeof jd<"u"&&typeof jd.getSystemInfoSync=="function",$e=typeof uni<"u"&&typeof window>"u"&&typeof uni.requireNativePlugin=="function",dn=typeof uni<"u",me=ht||Qe||It||Wt||lt||$e||ye,Ke=(typeof uni<"u"||typeof window<"u")&&!me,fe=Qe?qq:It?tt:Wt?swan:lt?my:ht?wx:$e?uni:ye?jd:{},Be=Ke&&window&&window.navigator&&window.navigator.userAgent||"",ye=/(micromessenger|webbrowser)/i.test(Be),w=/AppleWebKit\/([\d.]+)/i.exec(Be);w&&parseFloat(w.pop()),w="WEB",ye?w="WEB":Qe?w="QQ_MP":It?w="TT_MP":Wt?w="BAIDU_MP":lt?w="ALI_MP":ht?w="WX_MP":$e&&(w="UNI_NATIVE_APP");var so=ze[w],ye=/iPad/i.test(Be),w=/iPhone/i.test(Be)&&!ye,ve=/iPod/i.test(Be),yt=w||ye||ve,ro=(w=Be.match(/OS (\d+)_/i))&&w[1]?w[1]:null,yn=/Android/i.test(Be),pn=function(){var e=Be.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),ye=/Edge/i.test(Be),ve=!ye&&/Chrome/i.test(Be),Yt=((w=Be.match(/Chrome\/(\d+)/))&&w[1]&&parseFloat(w[1]),/MSIE/.test(Be)||-1<Be.indexOf("Trident")&&-1<Be.indexOf("rv:11.0")),zt=w=!(w=(w=/MSIE\s(\d+)\.\d/.exec(Be))&&parseFloat(w[1]))&&/Trident\/7.0/i.test(Be)&&/rv:11.0/.test(Be)?11:w,jt=/Safari/i.test(Be)&&!ve&&!yn&&!ye;(w=Be.match(/TBS\/(\d+)/i))&&w[1]&&w[1];for(var Qt,Gt=/Windows/i.test(Be),Mn=/MAC OS X/i.test(Be),St=Ke&&typeof Worker<"u"&&!Yt,$t=yn||yt,Cn=Ke&&window.tencent_cloud_im_csig_flutter_for_web_25F_cy!==void 0,en=function(){if(typeof window>"u"||window.navigator===void 0)return!1;var e=window.navigator.standalone;return!(!yt||e||jt)}(),Bt=typeof console<"u"?console:typeof Pi<"u"&&Pi.console?Pi.console:typeof window<"u"&&window.console?window.console:{},Pn=function(){},bn=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Un=bn.length;Un--;)Qt=bn[Un],console[Qt]||(Bt[Qt]=Pn);function wn(){var e=new Date;return e.setTime(Et()),e}function gn(){nn=0}function tn(){return Math.floor(Et()/1e3)}var Fn=Bt,nn=0,Et=function(){return new Date().getTime()+nn},Pt=0;function xn(){return $i()?"%c Chat %c":"Chat"}function hn(){var e=wn();return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(t){var n;switch(t.toString().length){case 1:n="00"+t;break;case 2:n="0"+t;break;default:n=t}return n}(e.getMilliseconds())}var u={arguments2String:function(e){var t="";if(e.length===1)t=e[0];else for(var n=0,o=e.length;n<o;n++)Tn(e[n])?Zi(e[n])?t+=ui(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){$i()?Fn[e](xn(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",hn(),t):Fn[e]("".concat(xn()," ").concat(hn()," ").concat(t))},d:function(){var e;Pt<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;Pt<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;Pt<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;Pt<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;Pt<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;Pt<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+Pt+" to "+e),Pt=e},getLevel:function(){return Pt}},Lt={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},ve="Tag_Profile_IM_",k={NICK:"".concat(ve,"Nick"),GENDER:"".concat(ve,"Gender"),BIRTHDAY:"".concat(ve,"BirthDay"),LOCATION:"".concat(ve,"Location"),SELFSIGNATURE:"".concat(ve,"SelfSignature"),ALLOWTYPE:"".concat(ve,"AllowType"),LANGUAGE:"".concat(ve,"Language"),AVATAR:"".concat(ve,"Image"),MESSAGESETTINGS:"".concat(ve,"MsgSettings"),ADMINFORBIDTYPE:"".concat(ve,"AdminForbidType"),LEVEL:"".concat(ve,"Level"),ROLE:"".concat(ve,"Role")},Y={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},ye="Gender_Type_",se={UNKNOWN:"".concat(ye,"Unknown"),FEMALE:"".concat(ye,"Female"),MALE:"".concat(ye,"Male")},Te={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},Se={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},_e="JoinedSuccess",Ne="WaitAdminApproval",T="@TOPIC#_",x=Object.prototype.hasOwnProperty;function L(e){if(e==null)return!0;if(typeof e=="boolean")return!1;if(typeof e=="number")return e===0;if(typeof e=="string"||typeof e=="function"||Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(Ie(e)){for(var t in e)if(x.call(e,t))return!1;return!0}return!!(Fe(e)||Ye(e)||Le(e))&&e.size===0}function Fe(e){return fn(e)==="map"}function Ye(e){return fn(e)==="set"}function Le(e){return fn(e)==="file"}function ge(e){return e!==null&&(typeof e=="number"&&!isNaN(+e)||G(e)==="object"&&e.constructor===Number)}function dt(e){return e!==null&&G(e)==="object"}function Ie(e){if(G(e)==="object"&&e!==null){if((e=Object.getPrototypeOf(e))===null)return 1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return e===t}}function q(e){return typeof Array.isArray=="function"?Array.isArray(e):fn(e)==="array"}function qe(e){return typeof e=="function"}function qn(e){return fn(e)==="filelist"}function ri(e){return typeof e=="string"&&(e=e[0],!/[^a-zA-Z0-9]/.test(e))}function bt(e,t,n,o){if(!Tn(e)||!Tn(t))return 0;for(var i,a=0,s=Object.keys(t),r=0,c=s.length;r<c;r++)if(i=s[r],!(D(t[i])||n&&n.includes(i)))if(Tn(e[i])&&Tn(t[i]))a+=bt(e[i],t[i],n,o);else{if(o&&o.includes(t[i]))continue;e[i]!==t[i]&&(e[i]=t[i],a+=1)}return a}function Vn(e){if(e.length===0)return 0;for(var t=0,n=0,o=typeof document<"u"&&document.characterSet!==void 0?document.characterSet:"UTF-8";e[t]!==void 0;)n+=e[t++].charCodeAt[t]<=255?1:o===!1?3:2;return n}function Mt(e){return e=e||99999999,Math.round(Math.random()*e)}function ci(){for(var e="",t=32;0<t;--t)e+=li[Math.floor(Math.random()*Qi)];return e}function _n(e,t){for(var n in e)if(e[n]===t)return 1}function Bn(e){return e.indexOf("http://")===-1||e.indexOf("https://")===-1?"https://"+e:e.replace(/https|http/,"https")}function co(e){if(Object.getOwnPropertyNames(e).length===0)return Object.create(null);var t,n,o=Array.isArray(e)?[]:Object.create(null);for(n in e)e[n]!==null?e[n]!==void 0?(t=G(e[n]),0<=["string","number","function","boolean"].indexOf(t)?o[n]=e[n]:o[n]=co(e[n])):o[n]=void 0:o[n]=null;return o}var Xi=["url"],ne=function(e){return typeof e=="string"},D=function(e){return e===void 0},Tn=function(e){return q(e)||dt(e)},Zi=function(e){return e instanceof Error},fn=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},ui=(Date.now||(Date.now=function(){return new Date().getTime()}),function(e){return JSON.stringify(e,["message","code"])}),li="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",Qi=li.length,Hn={};function Dn(e,t){if(!q(e)||!q(t))return!1;var n=!1;return t.forEach(function(a){var i=a.key,a=a.value,s=e.find(function(r){return r.key===i});s?s.value!==a&&(s.value=a,n=!0):(e.push({key:i,value:a}),n=!0)}),n}function uo(e){return L(e)?[]:e.filter(function(t){return t.isModified===!0})}function lo(e){return L(e)?[]:e.filter(function(t){return t.isModified===!1})}function et(e){return e===g.GRP_AVCHATROOM}function rt(n){var t=n.type,n=n.groupID;return t===g.GRP_COMMUNITY||"".concat(n).startsWith("@TGS#_")&&!"".concat(n).includes(T)}function We(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(T)}function ct(e){return ne(e)&&e.slice(0,3)===g.CONV_C2C}function ot(e){return ne(e)&&e.slice(0,5)===g.CONV_GROUP}function Kn(e){return ne(e)&&e===g.CONV_SYSTEM}function di(e,t){var n={};return Object.keys(e).forEach(function(o){n[o]=t(e[o],o)}),n}function Sn(e){return me?new Promise(function(t,n){fe.getImageInfo({src:e,success:function(o){t({width:o.width,height:o.height})},fail:function(){t({width:0,height:0})}})}):Yt&&zt===9?Promise.resolve({width:0,height:0}):new Promise(function(t,n){var o=new Image;o.onload=function(){t({width:this.width,height:this.height}),o=null},o.onerror=function(){t({width:0,height:0}),o=null},o.src=e})}function pi(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function gi(){var e=yn?"android":yt?"ios":Gt?"windows":Mn?"mac":"unknown";if(me)try{var t=fe.getSystemInfoSync().platform;t!==void 0&&(e=t)}catch{}return e}function hi(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var i=parseInt(e[o]),a=parseInt(t[o]);if(a<i)return 1;if(i<a)return-1}return 0}function po(n){var t=n.originUrl,t=t===void 0?void 0:t,o=n.originWidth,i=n.originHeight,n=n.min,n=n===void 0?198:n,o=parseInt(o),i=parseInt(i),a={url:void 0,width:0,height:0};return(o<=i?o:i)<=n?(a.url=t,a.width=o,a.height=i):(i<=o?(a.width=Math.ceil(o*n/i),a.height=n):(a.width=n,a.height=Math.ceil(i*n/o)),i=t&&-1<t.indexOf("?")?"".concat(t,"&"):"".concat(t,"?"),a.url="".concat(i,n===198?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),D(t)?(a.url,ae(a,Xi)):a}function _i(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function go(e){return e=e.servcmd,e.slice(e.indexOf(".")+1)}function Ut(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function fi(e,t){return e.includes(t)}function mi(e,t){return e.includes(t)}function je(e){return e.split(T)[0]}var ho=function(e,t,n){if(D(t))return"";switch(e){case g.MSG_TEXT:return t.text;case g.MSG_IMAGE:return n?"[Image]":"[\u56FE\u7247]";case g.MSG_LOCATION:return n?"[Location]":"[\u4F4D\u7F6E]";case g.MSG_AUDIO:return n?"[Voice]":"[\u8BED\u97F3]";case g.MSG_VIDEO:return n?"[Video]":"[\u89C6\u9891]";case g.MSG_FILE:return n?"[File]":"[\u6587\u4EF6]";case g.MSG_CUSTOM:return n?"[Custom Messages]":"[\u81EA\u5B9A\u4E49\u6D88\u606F]";case g.MSG_GRP_TIP:return n?"[Group Notification]":"[\u7FA4\u63D0\u793A\u6D88\u606F]";case g.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[\u7FA4\u7CFB\u7EDF\u901A\u77E5]";case g.MSG_FACE:return n?"[Animated Sticker]":"[\u52A8\u753B\u8868\u60C5]";case g.MSG_MERGER:return n?"[Chat Record]":"[\u804A\u5929\u8BB0\u5F55]";default:return""}};function ir(e){return e===g.MSG_TEXT||e===g.MSG_CUSTOM||e===g.MSG_LOCATION||e===g.MSG_FACE}function vi(e){var t=[];if(!ne(e))return t;var n=e.length;if(n===0)return t;for(var o=n-1;0<=o;o--)e[o]==="1"&&t.push(Math.pow(2,n-o-1));return t}function $i(){return!Yt&&!me}function En(e){return"the length of userIDList cannot exceed ".concat(e)}function Ct(e,t){var n;if(e)return n=e,t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}function ar(e){var t;if(q(e)&&e.length!==0)return t=0,e.forEach(function(n){t+=n}),t.toFixed(0)}function sr(e){var t;if(q(e)&&e.length!==0)return t=0,e.forEach(function(n){t+=n}),(t/e.length).toFixed(0)}function Je(e,o,i){var o=!(1<arguments.length&&o!==void 0)||o,i=!(2<arguments.length&&i!==void 0)||i,a=Date.now();return o?i?"".concat(a-e," ms"):"".concat(Math.round((a-e)/1e3)," s"):i?a-e:Math.round((a-e)/1e3)}function rr(e){return!!(e&&1<e)}function cr(e,t,n,o){if(t===void 0)return 1;var i,a,s=!0;return t.required&&L(e)&&(u.e("[".concat(n,'] Missing required params: "').concat(o,'".')),s=!1),L(e)||(i=fn(e))!==(a=t.type.toLowerCase())&&(i==="asyncfunction"&&a==="function"||(u.e("[".concat(n,'] Invalid params: type check failed for "').concat(o,'". Expected ').concat(t.type,".")),s=!1)),t.validator&&!t.validator(e,n,o)&&(u.e("[".concat(n,'] Invalid params: custom validator check failed for "').concat(o,'".')),s=!1),s}function mn(e){return!!e&&(!!(ct(e)||ot(e)||Kn(e))||((e=Ee("InvalidConversationID",e))&&u.w(e),!1))}function U(e){e.desc!==""&&Ee("API_REFER")!==""&&u.w("[".concat(e.api,"] | ").concat(e.paramName," | ").concat(e.desc,", ").concat(Ee("API_REFER")).concat(e.api))}function wt(){return Ee("StringRequiredLog")}function Wn(e){return Ee("NonEmptyStringRequiredLog",e)}function _o(){return Ee("NumberRequiredLog")}function ea(){return Ee("UndefinedNotAllowedLog")}function ta(){return Ee("FileRequiredLog")}function on(){return Ee("FunctionRequiredLog")}function _t(){return Ee("ArrayRequiredLog")}function Jt(){return Ee("NonEmptyArrayLog")}function Ai(){return Ee("CallbackMissingLog")}function ur(){return Ee("PositiveIntegerRequiredLog")}function Ln(e,t){return Ee("StringNotLongerThanLog",e,t)}function na(e,t){return Ee("NumberGreaterOrEqualLog",e,t)}function Ii(e){return Ee("KeyValueStringRequiredLog",e)}function Ht(){return Ee("PlainObjectRequiredLog")}function lr(){return Ee("NonEmptyContentRequiredLog")}function Yn(){return Ee("FileNotSelectedLog")}function yi(){return Ee("MessageInstanceRequiredLog")}function fo(){return Ee("NonAnonymousFunctionLog")}function oa(){return Ee("MessageExtensionNotAvailableLog")}function ia(){return Ee("MessageReactionRequiredLog")}function dr(e,t){return Ee("MaximumArrayLengthLog",e,t)}function V(e){return{code:0,data:e||{}}}function $(e){return Promise.resolve(V(e))}function v(e){var t=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(e instanceof Oe)return t&&kn!==null&&kn.emit(K.ERROR,e),Promise.reject(e);if(e instanceof Error)return n=new Oe({code:M.UNCAUGHT_ERROR}),t&&kn!==null&&kn.emit(K.ERROR,n),Promise.reject(n);if(D(e)||D(e.code))return Promise.reject(new Oe({code:M.UNCAUGHT_ERROR}));var n=new Oe(e);return t&&kn!==null&&kn.emit(K.ERROR,n),Promise.reject(n)}var pr,gr,Mi="unSend",Ft="success",aa="fail",an="notStart",hr="pending",mo="resolved",zn="rejected",w={type:"String",required:!0},ve={type:"Array",required:!0},ye={type:"Object",required:!0},kt={type:"Boolean",required:!0},xe={type:"number",required:!0},Ee=null,_r={hookGetAPITips:function(e){Ee=e},login:{userID:w,userSig:w},addToBlacklist:{userIDList:ve},removeFromBlacklist:{userIDList:ve},on:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(U({api:t,paramName:n,desc:Wn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(U({api:t,paramName:n,desc:on()}),!1):(e.name===""&&U({api:t,paramName:n,desc:fo()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(U({api:t,paramName:n,desc:Wn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(U({api:t,paramName:n,desc:on()}),!1):(e.name===""&&U({api:t,paramName:n,desc:fo()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(U({api:t,paramName:n,desc:Wn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(U({api:t,paramName:n,desc:on()}),!1):(e.name===""&&U({api:t,paramName:n,desc:fo()}),!0)}}],sendMessage:[l({name:"message"},ye)],setMessageExtensions:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return e.status===Ft&&e.isSupportExtension===!0||(U({api:t,paramName:n,desc:oa()}),!1)}}),l({name:"extensions"},ve)],getMessageExtensions:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return e.status===Ft&&e.isSupportExtension===!0||(U({api:t,paramName:n,desc:oa()}),!1)}})],deleteMessageExtensions:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return e.status===Ft&&e.isSupportExtension===!0||(U({api:t,paramName:n,desc:oa()}),!1)}})],addMessageReaction:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return e.status===Ft||(U({api:t,paramName:n,desc:ia()}),!1)}}),l({name:"reactionID"},w)],removeMessageReaction:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return e.status===Ft||(U({api:t,paramName:n,desc:ia()}),!1)}}),l({name:"reactionID"},w)],getMessageReactions:{messageList:l({},ve)},getAllUserListOfMessageReaction:{message:l(l({},ye),{},{validator:function(e,t,n){return e.status===Ft||(U({api:t,paramName:n,desc:ia()}),!1)}}),reactionID:l({},w),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:l(l({},w),{},{validator:mn}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e,t,n){return!(!D(e)&&!/^[1-9][0-9]*$/.test(e)&&(U({api:t,paramName:n,desc:ur()}),1))}}},getMessageListHopping:{conversationID:l(l({},w),{},{validator:mn}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e,t,n){return!(!D(e)&&e!==0&&e!==1&&(U({api:t,paramName:n,desc:Ee("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e,t,n){return!(!D(e)&&!/^[1-9][0-9]*$/.test(e)&&(U({api:t,paramName:n,desc:ur}),1))}}},setMessageRead:{conversationID:l(l({},w),{},{validator:mn})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e,t,n){return!e||[g.READ_ALL_C2C_MSG,g.READ_ALL_GROUP_MSG,g.READ_ALL_MSG].indexOf(e)!==-1||(U({api:t,paramName:n,desc:Ee("ValidScopeRequired")}),!1)}}},getConversationProfile:[l(l({name:"conversationID"},w),{},{validator:mn})],clearHistoryMessage:[l(l({name:"conversationID"},w),{},{validator:mn})],pinConversation:{conversationID:l(l({},w),{},{validator:mn}),isPinned:l({},kt)},setConversationDraft:{conversationID:l(l({},w),{},{validator:mn}),draftText:{type:"String",validator:function(e,t,n){return!!ne(e)||(U({api:t,paramName:n,desc:wt()}),!1)}}},setConversationCustomData:{conversationIDList:l({},ve),customData:{type:"String",validator:function(e,t,n){return ne(e)?!(256<e.length&&(U({api:t,paramName:n,desc:Ln(n,256)}),1)):(U({api:t,paramName:n,desc:wt()}),!1)}}},markConversation:{conversationIDList:l({},ve),markType:{type:"number",validator:function(e,t,n){return ge(e)?e<=0?(U({api:t,paramName:n,desc:Ee("NumberGreaterThanLog",n,0)}),!1):!(e>=Math.pow(2,64)&&(U({api:t,paramName:n,desc:Ee("NumberLessThanLog",n,"Math.pow(2,64)")}),1)):(U({api:t,paramName:n,desc:_o()}),!1)}},enableMark:l({},kt)},createConversationGroup:{conversationIDList:l({},ve),groupName:l(l({},w),{},{validator:function(e,t,n){return!(!e||32<e.length&&(U({api:t,paramName:n,desc:Ln(n,32)}),1))}})},deleteConversationGroup:[l({name:"groupName"},w)],renameConversationGroup:{oldName:l({},w),newName:l(l({},w),{},{validator:function(e,t,n){return!(!e||32<e.length&&(U({api:t,paramName:n,desc:Ln(n,32)}),1))}})},addConversationsToGroup:{conversationIDList:l({},ve),groupName:l({},w)},deleteConversationsFromGroup:{conversationIDList:l({},ve),groupName:l({},w)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:w,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:ve},createGroup:{name:w},joinGroup:{groupID:w,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[l({name:"groupID"},w)],handleApplication:{message:ye,handleAction:w,handleMessage:{type:"String"}},changeGroupOwner:{groupID:w,newOwnerID:w},updateGroupProfile:{groupID:w,muteAllMembers:{type:"Boolean"}},dismissGroup:[l({name:"groupID"},w)],searchGroupByID:[l({name:"groupID"},w)],getGroupOnlineMemberCount:[l({name:"groupID"},w)],initGroupAttributes:{groupID:w,groupAttributes:l(l({},ye),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach(function(i){if(!ne(e[i]))return U({api:t,paramName:n,desc:Ii("value")}),o=!1}),o}})},setGroupAttributes:{groupID:w,groupAttributes:l(l({},ye),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach(function(i){if(!ne(e[i]))return U({api:t,paramName:n,desc:Ii("value")}),o=!1}),o}})},deleteGroupAttributes:{groupID:w,keyList:{type:"Array",validator:function(e,t,n){return D(e)||!q(e)?(U({api:t,paramName:n,desc:_t()}),!1):!!L(e)||(o=!0,e.forEach(function(i){if(!ne(i))return U({api:t,paramName:n,desc:Ee("StringArrayRequiredLog")}),o=!1}),o);var o}}},getGroupAttributes:{groupID:w,keyList:{type:"Array",validator:function(e,t,n){return D(e)||!q(e)?(U({api:t,paramName:n,desc:_t()}),!1):!!L(e)||(o=!0,e.forEach(function(i){if(!ne(i))return U({api:t,paramName:n,desc:Ii("key")}),o=!1}),o);var o}}},setGroupCounters:{groupID:w,counters:ye},increaseGroupCounter:{groupID:w,key:w,value:xe},decreaseGroupCounter:{groupID:w,key:w,value:xe},getGroupCounters:{groupID:w},getGroupMemberList:{groupID:w,count:{type:"Number"}},getGroupMemberProfile:{groupID:w,userIDList:ve,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:w,userIDList:ve},setGroupMemberRole:{groupID:w,userID:w,role:w},setGroupMemberMuteTime:{groupID:w,userID:w,muteTime:{type:"Number",validator:function(e){return 0<=e}}},setGroupMemberNameCard:{groupID:w,userID:{type:"String"},nameCard:{type:"String",validator:function(e,t,n){return ne(e)?(e.length,!0):(U({api:t,paramName:n,desc:wt()}),!1)}}},setGroupMemberCustomField:{groupID:w,userID:{type:"String"},memberCustomField:ve},deleteGroupMember:{groupID:w},markGroupMemberList:{groupID:w,markType:{type:"number",validator:function(e,t,n){return ge(e)?!(e<1e3&&(U({api:t,paramName:n,desc:na(n,1e3)}),1)):(U({api:t,paramName:n,desc:_o()}),!1)}},userIDList:l({},ve),enableMark:l({},kt)},createTextMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?ne(e.text)?e.text.length!==0||(U({api:t,paramName:"payload.text",desc:lr()}),!1):(U({api:t,paramName:"payload.text",desc:wt()}),!1):(U({api:t,paramName:n,desc:Ht()}),!1)}})},createTextAtMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?ne(e.text)?e.text.length===0?(U({api:t,paramName:"payload.text",desc:lr()}),!1):!(e.atUserList&&!q(e.atUserList)&&(U({api:t,paramName:"payload.atUserList",desc:_t()}),1)):(U({api:t,paramName:"payload.text",desc:wt()}),!1):(U({api:t,paramName:n,desc:Ht()}),!1)}})},createCustomMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?e.data&&!ne(e.data)?(U({api:t,paramName:"payload.data",desc:wt()}),!1):e.description&&!ne(e.description)?(U({api:t,paramName:"payload.description",desc:wt()}),!1):!(e.extension&&!ne(e.extension)&&(U({api:t,paramName:"payload.extension",desc:wt()}),1)):(U({api:t,paramName:"payload",desc:Ht()}),!1)}})},createImageMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){if(!Ie(e))return U({api:t,paramName:n,desc:Ht()}),!1;if(D(e.file))return U({api:t,paramName:"payload.file",desc:ea()}),!1;if(Ke){if(!(e.file instanceof HTMLInputElement||Le(e.file)))return Ie(e.file)&&typeof uni<"u"?e.file.tempFilePaths.length!==0&&e.file.tempFiles.length!==0||(U({api:t,paramName:"payload.file",desc:Yn()}),!1):(U({api:t,paramName:"payload.file",desc:ta()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return U({api:t,paramName:"payload.file",desc:Yn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:Ai()}),!0}}})},createAudioMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){return!!Ie(e)||(U({api:t,paramName:n,desc:Ht()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:Ai()}),!0}}},createVideoMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){if(!Ie(e))return U({api:t,paramName:n,desc:Ht()}),!1;if(D(e.file))return U({api:t,paramName:"payload.file",desc:ea()}),!1;if(Ke){if(!(e.file instanceof HTMLInputElement||Le(e.file)))return Ie(e.file)&&typeof uni<"u"?!!Le(e.file.tempFile)||(U({api:t,paramName:"payload.file",desc:Yn()}),!1):(U({api:t,paramName:"payload.file",desc:ta()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return U({api:t,paramName:"payload.file",desc:Yn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:Ai()}),!0}}},createFaceMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?ge(e.index)?!!ne(e.data)||(U({api:t,paramName:"payload.data",desc:wt()}),!1):(U({api:t,paramName:"payload.index",desc:_o()}),!1):(U({api:t,paramName:n,desc:Ht()}),!1)}})},createFileMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){if(!Ie(e))return U({api:t,paramName:n,desc:Ht()}),!1;if(D(e.file))return U({api:t,paramName:"payload.file",desc:ea()}),!1;if(Ke){if(!(e.file instanceof HTMLInputElement||Le(e.file)))return Ie(e.file)&&typeof uni<"u"?e.file.tempFilePaths.length!==0&&e.file.tempFiles.length!==0||(U({api:t,paramName:"payload.file",desc:Yn()}),!1):(U({api:t,paramName:"payload.file",desc:ta()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return U({api:t,paramName:"payload.file",desc:Yn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:Ai()}),!0}}},createLocationMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?ne(e.description)?ge(e.longitude)?!!ge(e.latitude)||(U({api:t,paramName:"payload.latitude",desc:_o()}),!1):(U({api:t,paramName:"payload.longitude",desc:_o()}),!1):(U({api:t,paramName:"payload.description",desc:wt()}),!1):(U({api:t,paramName:n,desc:Ht()}),!1)}})},createMergerMessage:{to:w,conversationType:w,payload:l(l({},ye),{},{validator:function(e,t,n){if(L(e.messageList))return U({api:t,paramName:"payload.messageList",desc:Jt()}),!1;if(L(e.compatibleText))return U({api:t,paramName:"payload.compatibleText",desc:Wn("compatibleText")}),!1;var o=!1;return e.messageList.forEach(function(i){i.status===aa&&(o=!0)}),!o||(U({api:t,paramName:"payload.messageList",desc:Ee("MergeFailedMessageLog")}),!1)}})},revokeMessage:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return L(e)?(U({api:t,paramName:n,desc:yi()}),!1):e.conversationType===g.CONV_SYSTEM?(U({api:t,paramName:n,desc:Ee("MessageCanBeRevokedDesc")}),!1):e.isRevoked!==!0||(U({api:t,paramName:n,desc:Ee("MessageRevokedLog")}),!1)}})],deleteMessage:[l(l({name:"messageList"},ve),{},{validator:function(e,t,n){return!L(e)||(U({api:t,paramName:n,desc:Jt()}),!1)}})],translateText:{sourceTextList:ve,sourceLanguage:w,targetLanguage:w},convertVoiceToText:{message:l(l({},ye),{},{validator:function(e,t,n){return L(e)?(U({api:t,paramName:n,desc:yi()}),!1):e.type===g.MSG_AUDIO&&e.status===Ft||(U({api:t,paramName:n,desc:Ee("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return L(e)?(U({api:t,paramName:n,desc:yi()}),!1):e.conversationType===g.CONV_SYSTEM?(U({api:t,paramName:n,desc:Ee("MessageCanBeModifiedLog")}),!1):e._onlineOnlyFlag!==!0||(U({api:t,paramName:n,desc:Ee("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(q(e)?e.length===0?(U({api:t,paramName:n,desc:Jt()}),1):5<e.length&&(U({api:t,paramName:n,desc:dr(n,5)}),1):(U({api:t,paramName:n,desc:_t()}),1)))}},keywordListMatchType:{type:"String",required:!1,validator:function(e,t,n){return!e||e==="or"||e==="and"||U({api:t,paramName:n,desc:"".concat(e," is invalid match type")})}},senderUserIDList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(q(e)?(e.length===0&&U({api:t,paramName:n,desc:Jt()}),5<e.length&&(U({api:t,paramName:n,desc:dr(n,5)}),1)):(U({api:t,paramName:n,desc:_t()}),1)))}},messageTypeList:{type:"Array",required:!1,validator:function(e,t,n){if(!e)return!0;if(!q(e))return U({api:t,paramName:n,desc:_t()}),!1;e.length===0&&U({api:t,paramName:n,desc:Jt()});var o=[g.MSG_TEXT,g.MSG_IMAGE,g.MSG_AUDIO,g.MSG_FILE,g.MSG_VIDEO,g.MSG_LOCATION,g.MSG_CUSTOM,g.MSG_MERGER];return!(0<e.filter(function(i){return o.indexOf(i)===-1}).length&&(U({api:t,paramName:n,desc:Ee("ContainsUnsupportedMessageTypeLog",n)}),1))}},conversationID:{type:"String",required:!1,validator:function(e){return!e||mn(e)}},timePosition:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(U({api:t,paramName:n,desc:na(n,0)}),1))}},timePeriod:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(U({api:t,paramName:n,desc:na(n,0)}),1))}},cursor:{type:"String",required:!1}},getUserProfile:{userIDList:{type:"Array",validator:function(e,t,n){return q(e)?(e.length===0&&U({api:t,paramName:n,desc:Jt()}),!0):(U({api:t,paramName:n,desc:_t()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e,t,n){return!!D(e)||!!q(e)||(U({api:t,paramName:n,desc:_t()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e,t,n){return!!ne(e)||(U({api:t,paramName:n,desc:wt()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return q(e)?e.length!==0||(U({api:t,paramName:n,desc:Jt()}),!1):(U({api:t,paramName:n,desc:_t()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return q(e)?e.length!==0||(U({api:t,paramName:n,desc:Jt()}),!1):(U({api:t,paramName:n,desc:_t()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return!e||!!q(e)||(U({api:t,paramName:n,desc:_t()}),!1)}}},addFriend:{to:w,source:{type:"String",required:!0,validator:function(e,t,n){return!(!e||(e.startsWith("AddSource_Type_")?8<e.replace("AddSource_Type_","").length&&(U({api:t,paramName:n,desc:Ln("keyword",8)}),1):(U({api:t,paramName:n,desc:Ee("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e,t,n){return!(ne(e)&&96<e.length&&(U({api:t,paramName:n,desc:Ln(n,96)}),1))}}},deleteFriend:{userIDList:ve},checkFriend:{userIDList:ve},getFriendProfile:{userIDList:ve},updateFriend:{userID:w,remark:{type:"String",required:!1,validator:function(e,t,n){return!(ne(e)&&96<e.length&&(U({api:t,paramName:n,desc:Ln(n,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e,t,n){if(e){if(!q(e))return U({api:t,paramName:n,desc:_t()}),!1;var o=!0;return e.forEach(function(i){return ne(i.key)&&i.key.indexOf("Tag_SNS_Custom")!==-1?ne(i.value)?8<i.key.replace("Tag_SNS_Custom_","").length?(U({api:t,paramName:n,desc:Ln("keyword",8)}),o=!1):void 0:(U({api:t,paramName:n,desc:Ii("value")}),o=!1):(U({api:t,paramName:n,desc:Ee("FriendCustomFieldPrefixLog")}),o=!1)}),o}return!0}}},acceptFriendApplication:{userID:w},refuseFriendApplication:{userID:w},deleteFriendApplication:{userID:w},createFriendGroup:{name:w},deleteFriendGroup:{name:w},addToFriendGroup:{name:w,userIDList:ve},removeFromFriendGroup:{name:w,userIDList:ve},renameFriendGroup:{oldName:w,newName:w},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e,t,n){return q(e)?e.length!==0||(U({api:t,paramName:n,desc:Jt()}),!1):(U({api:t,paramName:n,desc:_t()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e,t,n){return q(e)?e.length!==0||(U({api:t,paramName:n,desc:Jt()}),!1):(U({api:t,paramName:n,desc:_t()}),!1)}}],createTopicInCommunity:{groupID:w,topicName:w},deleteTopicFromCommunity:{groupID:w,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!q(e)||(U({api:t,paramName:n,desc:_t()}),!1)}}},updateTopicProfile:{groupID:w,topicID:w},getTopicList:{groupID:w,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!q(e)||(U({api:t,paramName:n,desc:_t()}),!1)}}},followUser:[l({name:"userIDList"},ve)],unfollowUser:[l({name:"userIDList"},ve)],getMyFollowingList:[l(l({name:"startIndex"},w),{},{required:!1})],getMyFollowersList:[l(l({name:"startIndex"},w),{},{required:!1})],getMutualFollowersList:[l(l({name:"startIndex"},w),{},{required:!1})],getUserFollowInfo:[l(l({name:"userIDList"},ve),{},{required:!1})],checkFollowType:[l({name:"userIDList"},ve)],addSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(U({api:t,paramName:n,desc:Wn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(U({api:t,paramName:n,desc:on()}),!1):(e.name===""&&U({api:t,paramName:n,desc:fo()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(U({api:t,paramName:n,desc:Wn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(U({api:t,paramName:n,desc:on()}),!1):(e.name===""&&U({api:t,paramName:n,desc:fo()}),!0)}}],invite:{userID:w},inviteSync:[l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?!!ne(e.userID)||(U({api:t,paramName:"options.userID",desc:wt()}),!1):(U({api:t,paramName:"options",desc:Ht()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:on()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:on()}),!0}}],inviteInGroup:{groupID:w,inviteeList:ve},inviteInGroupSync:[l(l({},ye),{},{validator:function(e,t,n){return Ie(e)?ne(e.groupID)?!!q(e.inviteeList)||(U({api:t,paramName:"options.inviteeList",desc:_t()}),!1):(U({api:t,paramName:"options.groupID",desc:wt()}),!1):(U({api:t,paramName:"options",desc:Ht()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:on()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return D(e)&&U({api:t,paramName:n,desc:on()}),!0}}],accept:{inviteID:w},reject:{inviteID:w},getSignalingInfo:[l(l({name:"message"},ye),{},{validator:function(e,t,n){return!L(e)||(U({api:t,paramName:n,desc:yi()}),!1)}})],modifyInvitation:{inviteID:w,data:w}},Oc={login:1,logout:1,getLoginUser:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,searchCloudMessages:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,setMessageRemindType:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},Oe=(F(Ti,Q(Error)),gr=te(Ti),E(Ti)),M={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_FUNCTION_ERROR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AVCHATROOM:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020,MSG_SEARCH_CURSOR_INVALID:27002,MSG_SEARCH_CURSOR_EXPIRED:27003},kn=null,xe=(E(Na,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.get(12).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"getPlatform",value:function(){return so}},{key:"getCloudConfig",value:function(e){return this._m.get(23).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.get(12).getTinyID()+"-"+e.random}},{key:"req",value:function(e){return this._m.get(20).req(e)}},{key:"canIUse",value:function(e){return this._m.get(27).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){e=this.getErrorMessage(e,t,n),e&&u.w(e)}},{key:"cannotUseCommercialAbility",value:function(e){var t=M.CANNOT_USE_COMMERCIAL_ABILITY;return v({code:t,message:this.getErrorMessage(t,e)})}}]),Na),h={LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",MSG_CLOUD_SEARCH:"query",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check"},sa="networkRTT",ra="messageE2EDelay",jn="sendMessageC2C",Jn="sendMessageGroup",Xn="sendMessageGroupAV",Rn="sendMessageRichMedia",Tt="cosUpload",Zn="messageReceivedGroup",vo="messageReceivedGroupAVPush",Ao="messageReceivedGroupAVPull",Gc=(W(kt={},sa,2),W(kt,ra,3),W(kt,jn,4),W(kt,Jn,5),W(kt,Xn,6),W(kt,Rn,7),W(kt,Zn,8),W(kt,vo,9),W(kt,Ao,10),W(kt,Tt,11),kt),Pc={info:4,warning:5,error:6},fr={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},bc={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16},R=(E(yo,[{key:"updateTimeStamp",value:function(){this.timestamp=Et()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e,t=this,n=0<arguments.length&&arguments[0]!==void 0&&arguments[0];this._sentFlag||(this._netMonitorModule&&(e=this._netMonitorModule.getNetworkType(),this.setNetworkType(e)),e=Et(),this.costTime===0&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),n?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(function(){t._sentFlag=!0,t._eventStatModule&&t._eventStatModule.pushIn(t)},0))}},{key:"setError",value:function(e){if(!(e instanceof Error))return u.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;var t=!0;return(t=this._netMonitorModule?this._netMonitorModule.isOnline():t)?(e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message)):this.setCode(M.NO_NETWORK),this.setLevel("error"),this}},{key:"setCode",value:function(e){return D(e)||this._sentFlag||(e==="ECONNABORTED"&&(this.code=103),ge(e)?this.code=e:u.w("".concat(this._n,".setCode value not a number, please check!"),e,G(e))),this}},{key:"setMessage",value:function(e){return D(e)||this._sentFlag||(ge(e)&&(this.message=e.toString()),ne(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return D(e)||this._sentFlag||(this.level=Pc[e]),this}},{key:"setMoreMessage",value:function(e){return L(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){return D(e)?u.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(e=fr[e.toLowerCase()],D(e)||(this.networkType=e)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){return this.uiPlatform=e,this}},{key:"setExtension",value:function(e){return this.extension=e,this}},{key:"setEventType",value:function(e){return this.eventType=e,this}}],[{key:"bindEventStatModule",value:function(e){yo.prototype._eventStatModule=e}},{key:"bindNetMonitorModule",value:function(e){yo.prototype._netMonitorModule=e}}]),yo),ca=(E(Ra,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return this.content.text.length!==0}}]),Ra),ua=(E(ka,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=Mt(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.imageUrl||t.url||"",this.url=Ct(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(t){this.sizeType=t},setType:function(t){this.type=t},setImageUrl:function(t){t&&(this.imageUrl=t)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t,n=0,o=null;n<=2;)t=D(e)||D(e[n])?{type:0,size:0,width:0,height:0,url:""}:e[n],(o=new this._ImageInfoModel(t)).setSizeType(n+1),o.setType(n),this.addImageInfo(o),n++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e[o].size&&(t.size=e[o].size),e[o].url&&t.setImageUrl(e[o].url),e[o].width&&(t.width=e[o].width),e[o].height&&(t.height=e[o].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",o=["http","https"],i=null,a=0;a<e;a++)this.content.imageInfoArray[a].url&&(i=this.content.imageInfoArray[a]).imageUrl!==""&&(n=i.imageUrl.slice(0,i.imageUrl.indexOf("://")+1),t=i.imageUrl.slice(i.imageUrl.indexOf("://")+1),o.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[a].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=Lt[e.toUpperCase()]||Lt.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){e!==void 0&&0<e.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,n=e[0],t=n.width,t=t===void 0?0:t,n=n.height,n=n===void 0?0:n;t!==0&&n!==0&&(_i(e),Object.assign(e[2],po({originWidth:t,originHeight:n,min:720})))}},{key:"sendable",value:function(){return this.content.imageInfoArray.length!==0&&this.content.imageInfoArray[0].imageUrl!==""&&this.content.imageInfoArray[0].size!==0}}]),ka),la=(E(La,[{key:"sendable",value:function(){return this.content!==null}}]),La),da=(E(Ea,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return this.content.remoteAudioUrl!==""}}]),Ea),Uc={from:!0,groupID:!0,groupName:!0,to:!0},mr=(E(Sa,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"remarkInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberExtraInfo":case"onlineMemberInfo":break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];Uc[o]&&(this.content.groupProfile[o]=e[o])}}},{key:"_updateMemberList",value:function(e){L(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach(function(t){e.forEach(function(n){t.userID===n.userID&&Object.assign(t,n)})})}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.newGroupProfile[o]=o!=="muteAllMembers"?e[o]:e[o]===1}}}]),Sa),wc={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},vr=(E(Da,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}})}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];wc[o]&&(o==="groupName"?this.content.groupProfile.name=e[o]:this.content.groupProfile[o]=e[o])}}}]),Da),pa=(E(Ta,[{key:"_getFileInfo",value:function(n){if(!D(n.fileName)&&!D(n.fileSize))return{size:n.fileSize,name:n.fileName};var t,n=n.file.files[0];return $e&&(n.path&&n.path.indexOf(".")!==-1&&(t=n.path.slice(n.path.lastIndexOf(".")+1).toLowerCase(),n.type=t,n.name||(n.name="".concat(Mt(999999),".").concat(t))),n.name||(n.type="",n.name=n.path.slice(n.path.lastIndexOf("/")+1).toLowerCase()),n.suffix&&(n.type=n.suffix),n.url||(n.url=n.path)),{size:n.size,name:n.name}}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return this.content.fileUrl!==""&&this.content.fileName!==""&&this.content.fileSize!==0}}]),Ta),ga=(E(Ca,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return this.content.data.length!==0||this.content.description.length!==0||this.content.extension.length!==0}}]),Ca),ha=(E(Ma,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(o){var t=o.snapshotUrl,n=o.snapshotWidth,o=o.snapshotHeight;L(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),L(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),L(o)||(this.content.thumbHeight=this.content.snapshotHeight=Number(o))}},{key:"sendable",value:function(){return this.content.remoteVideoUrl!==""}}]),Ma),_a=(E(ya,[{key:"sendable",value:function(){return!0}}]),ya),Ar=(E(Ia,[{key:"_patchRichMediaPayload",value:function(e,t){e===g.MSG_IMAGE?t.imageInfoArray.forEach(function(n){!n.imageUrl&&n.url&&(n.imageUrl=n.url,n.sizeType=n.type,n.type===1?n.type=0:n.type===3&&(n.type=1))}):e===g.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===g.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===g.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===g.MSG_IMAGE?t.imageInfoArray.forEach(function(o){o.url=Ct(o.url,n)}):e===g.MSG_VIDEO?(t.videoUrl=Ct(t.videoUrl,n),t.snapshotUrl=Ct(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===g.MSG_AUDIO?t.url=Ct(t.url,n):e===g.MSG_FILE&&(t.fileUrl=Ct(t.fileUrl,n)))}}]),Ia),Ci=(E(Aa,[{key:"sendable",value:function(){return!L(this.content.messageList)||!L(this.content.downloadKey)}}]),Aa),fa={1:g.MSG_PRIORITY_HIGH,2:g.MSG_PRIORITY_NORMAL,3:g.MSG_PRIORITY_LOW,4:g.MSG_PRIORITY_LOWEST},Xe=(E(va,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){e!==null&&(ne(e.nick)&&(this.nick=e.nick),ne(e.avatar)&&(this.avatar=e.avatar),e=e.messageFromAccountExtraInformation,Ie(e)&&ne(e.nameCard)&&(this.nameCard=e.nameCard))}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach(function(n){n!==g.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:n}),t.atUserList.push(n)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(g.MSG_AT_ALL))}),q(e.groupAtInfo)&&e.groupAtInfo.forEach(function(n){n.groupAtAllFlag===0?t.atUserList.push(n.groupAtUserID):n.groupAtAllFlag===1&&t.atUserList.push(g.MSG_AT_ALL)})}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Ft:Mi,this.from||(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return this._elements.length!==0&&(this._relayFlag===!0||typeof this._elements[0].sendable=="function"&&this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===g.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){var t,n,o;this.clientSequence===0&&e&&(this.clientSequence=!!(e=e)&&(Hn[e]===void 0&&(o=new Date,t="3".concat(o.getHours()).slice(-2),n="0".concat(o.getMinutes()).slice(-2),o="0".concat(o.getSeconds()).slice(-2),Hn[e]=parseInt([t,n,o,"0001"].join("")),o=n=t=null,u.l("autoIncrementIndex start index:".concat(Hn[e]))),Hn[e]++)),this.sequence===0&&this.conversationType===g.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===g.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){e!==""&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n=this.conversationType;n!==g.CONV_SYSTEM?(e=n===g.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=e?"".concat(n).concat(e):null):this.conversationID=g.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof ca||e instanceof ua||e instanceof la||e instanceof da||e instanceof pa||e instanceof ha||e instanceof mr||e instanceof vr||e instanceof ga||e instanceof _a||e instanceof Ci}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();function o(a){if(a.type&&a.content)switch(a.type){case g.MSG_TEXT:n.setTextElement(a.content);break;case g.MSG_IMAGE:n.setImageElement(a.content,t);break;case g.MSG_AUDIO:n.setAudioElement(a.content,t);break;case g.MSG_FILE:n.setFileElement(a.content,t);break;case g.MSG_VIDEO:n.setVideoElement(a.content,t);break;case g.MSG_CUSTOM:n.setCustomElement(a.content);break;case g.MSG_LOCATION:n.setLocationElement(a.content);break;case g.MSG_GRP_TIP:n.setGroupTipElement(a.content);break;case g.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(a.content);break;case g.MSG_FACE:n.setFaceElement(a.content);break;case g.MSG_MERGER:n.setMergerElement(a.content,t)}}if(q(e))for(var i=0;i<e.length;i++)o(e[i]);else o(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){e=typeof e=="string"?e:e.text,e=new ca({text:e}),this._elements.push(e)}},{key:"setImageElement",value:function(e,t){e=new ua(e,t),this._elements.push(e)}},{key:"setAudioElement",value:function(e,t){e=new da(e,t),this._elements.push(e)}},{key:"setFileElement",value:function(e,t){e=new pa(e,t),this._elements.push(e)}},{key:"setVideoElement",value:function(e,t){e=new ha(e,t),this._elements.push(e)}},{key:"setLocationElement",value:function(e){e=new _a(e),this._elements.push(e)}},{key:"setCustomElement",value:function(e){e=new ga(e),this._elements.push(e)}},{key:"setGroupTipElement",value:function(e){var t,n={},o=e.operationType;L(e.memberInfoList)?e.operatorInfo&&(n=e.operatorInfo):o!==g.GRP_TIP_MBR_JOIN&&o!==g.GRP_TIP_MBR_KICKED_OUT&&o!==g.GRP_TIP_MBR_SET_ADMIN&&o!==g.GRP_TIP_MBR_CANCELED_ADMIN||(n=e.memberInfoList[0]),L(e.memberExtraInfo)||(t=e.memberExtraInfo.reason,e.msgMemberInfo.forEach(function(i){i.reason=t})),o=n.nick,n=n.avatar,ne(o)&&(this.nick=o),ne(n)&&(this.avatar=n),o=new mr(e),this._elements.push(o)}},{key:"setGroupSystemNoticeElement",value:function(e){e=new vr(e),this._elements.push(e)}},{key:"setFaceElement",value:function(e){e=new la(e),this._elements.push(e)}},{key:"setMergerElement",value:function(e,t){e=new Ci(e,t),this._elements.push(e)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"_computePriority",value:function(e){return D(e)?g.MSG_PRIORITY_NORMAL:ne(e)&&Object.values(fa).indexOf(e)!==-1?e:ge(e)&&(e=""+e,Object.keys(fa).indexOf(e)!==-1)?fa[e]:g.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(n){var t=n.nick,n=n.avatar;ne(t)&&(this.nick=t),ne(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){ne(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===g.CONV_C2C&&this.needReadReceipt===!0&&(this.readReceiptInfo.isPeerRead=e===1)}}]),va),Fc=(F(Io,xe),pr=te(Io),E(Io,[{key:"onNewC2CMessage",value:function(n){var a=n.dataList,t=n.isInstantMessage,o=n.C2CRemainingUnreadList,i=n.C2CPairUnreadList,n=n.isSyncingEnded,a=(u.d("".concat(this._n,".onNewC2CMessage count:").concat(a.length," isInstantMessage:").concat(t)),this._newC2CMessageStoredAndSummary({dataList:a,C2CRemainingUnreadList:o,C2CPairUnreadList:i,isInstantMessage:t})),o=a.conversationOptionsList,i=a.messageList,a=a.isUnreadC2CMessage,s=uo(i),s=(0<s.length&&this.emitOuterEvent(K.MESSAGE_MODIFIED,s),this.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:t,isUnreadC2CMessage:a,isSyncingEnded:n}),lo(i));t&&0<s.length&&this.emitOuterEvent(K.MESSAGE_RECEIVED,s),i.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList,i=e.isInstantMessage,a=null,s=[],r=[],c={},d=this.get(26),p=!1,_=this.get(11),m=this.get(4),f=this.getFileDownloadProxy(),I=0,N=t.length;I<N;I++)if(this._isC2CNotice(t[I]))this._noticeFromUnreadDBList.push(t[I].eventArray[0].c2CNotifyMsgArray[0]);else{var P=t[I],H=(P.currentUser=this.getMyUserID(),P.conversationType=g.CONV_C2C,P.isSystemMessage=!!P.isSystemMessage,(D(P.nick)||D(P.avatar))&&(p=!0,u.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),(a=new Xe(P)).setElement(P.elements,f),a.setNickAndAvatar({nick:P.nick,avatar:P.avatar}),a.conversationID);if(i){if(this._messageFromUnreadDBMap.get(a.ID)===1)continue;var Z,le,be=!1,it=(a.from!==this.getMyUserID()?(le=_.getLatestMessageSentByPeer(H))&&(Z=le.nick,le=le.avatar,p?a.setNickAndAvatar({nick:Z,avatar:le}):Z===a.nick&&le===a.avatar||(be=!0)):(Z=_.getLatestMessageSentByMe(H))&&(le=Z.nick,it=Z.avatar,le===a.nick&&it===a.avatar||(_.modifyMessageSentByMe({conversationID:H,latestNick:a.nick,latestAvatar:a.avatar}),m.mockOnNickAvatarModified(a.nick,a.avatar))),t[I].isModified===1);if(_.isMessageSentByCurrentInstance(a)?a.isModified=it:it=!1,P.msgLifeTime===0)a._onlineOnlyFlag=!0,_.isMessageSentByCurrentInstance(a)||r.push(a);else{if(!_.pushIntoMessageList(r,a,it))continue;be&&(_.modifyMessageSentByPeer({conversationID:H,latestNick:a.nick,latestAvatar:a.avatar}),_.updateUserProfileSpecifiedKey({conversationID:H,nick:a.nick,avatar:a.avatar}))}i&&0<a.clientTime&&d.addMessageDelay(a.clientTime)}else this._messageFromUnreadDBMap.set(a.ID,1);if(P.msgLifeTime!==0){if(a._onlineOnlyFlag===!1){if(be=_.getLastMessageTime(H),ge(be)&&a.time<be)continue;D(c[H])?(P=0,a.flow==="in"&&(a._isExcludedFromUnreadCount||(P=1)),c[H]=s.push({conversationID:H,unreadCount:P,type:a.conversationType,subType:a.conversationSubType,lastMessage:a._isExcludedFromLastMessage?"":a})-1):(P=c[H],s[P].type=a.conversationType,s[P].subType=a.conversationSubType,s[P].lastMessage=a._isExcludedFromLastMessage?"":a,a.flow==="in"&&(a._isExcludedFromUnreadCount||s[P].unreadCount++))}}else a._onlineOnlyFlag=!0}this._handleRevokedNoticeFromUnreadDB();var at=!1;if(q(o))for(var pt=0,Zo=o.length;pt<Zo;pt++)(function(sn){var Ni;0<o[sn].unreadCount&&(at=!0,(Ni=s.find(function(El){return El.conversationID==="C2C".concat(o[sn].from)}))?Ni.unreadCount=o[sn].unreadCount:s.push({conversationID:"C2C".concat(o[sn].from),unreadCount:o[sn].unreadCount,type:g.CONV_C2C}))})(pt);if(q(n))for(var Qo=0,Qn=n.length;Qo<Qn;Qo++)(function(sn){s.find(function(Ni){return Ni.conversationID==="C2C".concat(n[sn].from)})||s.push({conversationID:"C2C".concat(n[sn].from),type:g.CONV_C2C,lastMsgTime:n[sn].lastMsgTime})})(Qo);return{conversationOptionsList:s,messageList:r,isUnreadC2CMessage:at}}},{key:"_isC2CNotice",value:function(e){return e=e.eventArray,!(!q(e)||e[0].event!==10)}},{key:"_handleRevokedNoticeFromUnreadDB",value:function(){var e,t=this._noticeFromUnreadDBList.length;t!==0&&(u.l("".concat(this._n,"._handleRevokedNoticeFromUnreadDB count:").concat(t)),e=[],this._noticeFromUnreadDBList.forEach(function(n){n.hasOwnProperty("c2cMessageRevokedNotify")&&e.push(n)}),this.onC2CMessageRevoked({dataList:e}),this._noticeFromUnreadDBList.length=0,e.length=0)}},{key:"onC2CMessageRevoked",value:function(e){var t,n=this,o=this.get(11),i=[];e.dataList.forEach(function(a){a.c2cMessageRevokedNotify&&(a=a.c2cMessageRevokedNotify.revokedInfos,D(a)||a.forEach(function(s){var r=n.getMyUserID()===s.from?"".concat(g.CONV_C2C).concat(s.to):"".concat(g.CONV_C2C).concat(s.from);t=o.revoke(r,s.sequence,s.random);var c,d=s.revokerInfo&&s.revokerInfo.revoker,p=s.revokerInfo&&s.revokerInfo.reason||"";t?c=t:(c={conversationID:r,sequence:s.sequence},s.tinyID&&s.clientTime&&s.random&&(c.ID="".concat(s.tinyID,"-").concat(s.clientTime,"-").concat(s.random)),s.time&&(c.time=s.time)),c&&(c.revoker=d,c.revokeReason=p,c.revokerInfo={userID:d,nick:"",avatar:""},i.push(c))}))}),i.length!==0&&(o.onMessageRevoked(i),u.l("".concat(this._n,".onC2CMessageRevoked count:").concat(i.length)),o.updateRevokerInfo(i).then(function(a){n.emitOuterEvent(K.MESSAGE_REVOKED,a)}))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach(function(n){var o;L(n.c2cMessageReadReceipt)||(o=n.c2cMessageReadReceipt.to,n.c2cMessageReadReceipt.uinPairReadArray.forEach(function(a){var a=a.peerReadTime,s=(u.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(o," peerReadTime:").concat(a)),"".concat(g.CONV_C2C).concat(o)),r=t.get(11);r.recordPeerReadTime(s,a),r.updateMessageIsPeerReadProperty(s,a)}))})}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach(function(n){var o;L(n.c2cMessageReadNotice)||(o=t.get(11),n.c2cMessageReadNotice.uinPairReadArray.forEach(function(a){var s=a.from,a=a.peerReadTime,s=(u.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(s," lastReadTime:").concat(a)),"".concat(g.CONV_C2C).concat(s));o.updateIsReadAfterReadReport({conversationID:s,lastMessageTime:a}),o.updateUnreadCount(s)}))})}},{key:"onC2CMessageModified",value:function(e){u.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var t=this.get(11);e.dataList.forEach(function(n){t.onMessageModified(l(l({},n),{},{conversationType:g.CONV_C2C}))})}},{key:"onReadReceiptList",value:function(n){u.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(n));var n=n.dataList,t=n.userID,n=n.readReceiptList;this.get(11).updateReadReceiptInfo({userID:t,readReceiptList:n})}},{key:"sendMessage",value:function(e,t){return e=this._createC2CMessagePack(e,t),this.req(e)}},{key:"_createC2CMessagePack",value:function(e,t){var n,o,i=null,a=(t&&(t.offlinePushInfo&&(i=t.offlinePushInfo),t.onlineUserOnly===!0&&(i?i.disablePush=!0:i={disablePush:!0})),""),s=(ne(e.cloudCustomData)&&0<e.cloudCustomData.length&&(a=e.cloudCustomData),[]),r=(Ie(t)&&Ie(t.messageControlInfo)&&(r=(o=t.messageControlInfo).excludedFromUnreadCount,n=o.excludedFromLastMessage,o=o.excludedFromContentModeration,r===!0&&s.push("NoUnread"),n===!0&&s.push("NoLastMsg"),o===!0&&s.push("NoMsgCheck")),this.isOnlineMessage(e,t)?0:void 0);return{proto:h.SEND_C2C_MSG,tjgID:this.generateTjgID(e),data:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:a,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:r,nick:e.nick,avatar:e.avatar,offlinePushInfo:i?{pushFlag:i.disablePush===!0?1:0,title:i.title||"",desc:i.description||"",ext:i.extension||"",apnsInfo:{badgeMode:i.ignoreIOSBadge===!0?1:0,isVoipPush:this._isVoipPush(i)},androidInfo:{OPPOChannelID:i.androidOPPOChannelID||""}}:void 0,messageControlInfo:r!==0?s:void 0,clientTime:e.clientTime,needReadReceipt:e.needReadReceipt===!0?1:0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}},{key:"_isVoipPush",value:function(e){var t=void 0;return t=D(e.disableVoipPush)?t:e.disableVoipPush===!1?1:0}},{key:"isOnlineMessage",value:function(e,t){return!(!t||t.onlineUserOnly!==!0)}},{key:"revokeMessage",value:function(e){return this.req({proto:h.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(n){var t=n.to,n=n.keyList;return u.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.req({proto:h.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(d){var t=d.from,n=d.to,o=d.version,o=o===void 0?0:o,i=d.sequence,a=d.random,s=d.time,r=d.payload,c=d.type,d=d.cloudCustomData,p=void 0;return ir(c)&&(p=[]).push({type:c,content:r}),this.req({proto:h.MODIFY_C2C_MSG,data:{from:t,to:n,version:o,sequence:i,random:a,time:s,elements:p,cloudCustomData:d}})}},{key:"setMessageRead",value:function(a){var t=this,n=a.conversationID,o=a.lastMessageTime,i="".concat(this._n,".").concat("setMessageRead"),a="conversationID:".concat(n," lastMessageTime:").concat(o),s=(u.l("".concat(i," ").concat(a)),ge(o)||this.outputWarning("DoNotModifyLastTime"),new R("setMessageRead"));return s.setMessage(a),this.req({proto:h.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:o,receipt:1}]}}}).then(function(){s.end(),u.l("".concat(i," ok"));var r=t.get(11);return r.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:o}),r.updateUnreadCount(n),V()}).catch(function(r){return s.setError(r).end(),u.l("".concat(i," failed. error:"),r),v(r)})}},{key:"getRoamingMessage",value:function(r){var t=this,n="".concat(this._n,".getRoamingMessage"),o=r.peerAccount,i=r.conversationID,a=r.count,s=r.lastMessageTime,r=r.messageKey,c="peerAccount:".concat(o," count:").concat(a||15," lastMessageTime:").concat(s||0," messageKey:").concat(r),d=(u.l("".concat(n," ").concat(c)),new R("getC2CRoamingMessages"));return this.req({proto:h.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:a||15,lastMessageTime:s||0,messageKey:r}}).then(function(N){var N=N.data,f=N.complete,I=N.messageList,_=N.messageKey,N=N.lastMessageTime,m=(D(I)?u.l("".concat(n," ok. complete:").concat(f," but messageList is undefined!")):u.l("".concat(n," ok. complete:").concat(f," count:").concat(I.length)),d.setMessage("".concat(c," complete:").concat(f," length:").concat(I.length)).end(),t.get(11)),f=(f===1&&m.setCompleted(i),m.onRoamingMessage(I,i)),I=(m.modifyMessageList(i),m.updateIsRead(i),m.updateRoamingMessageKeyAndTime(i,_,N),m.getPeerReadTime(i)),N=(u.l("".concat(n," update isPeerRead property. conversationID:").concat(i," peerReadTime:").concat(I)),I?m.updateMessageIsPeerReadProperty(i,I):(_=i.replace(g.CONV_C2C,""),t.getRemotePeerReadTime([_]).then(function(){m.updateMessageIsPeerReadProperty(i,m.getPeerReadTime(i))})),"");return 0<f.length?N=f[0].ID:(I=m.getLocalOldestMessage(i))&&(N=I.ID),u.l("".concat(n," nextReqID:").concat(N," stored message count:").concat(f.length)),{nextReqID:N,storedMessageList:f}}).catch(function(p){return d.setMessage(c).setError(p).end(),u.w("".concat(n," failed. error:"),p),v(p)})}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),o=e.peerAccount,i=e.time,i=i===void 0?0:i,a=e.count,s=e.direction,r="".concat(g.CONV_C2C).concat(o),c="peerAccount:".concat(o," count:").concat(a," time:").concat(i," direction:").concat(s),d=(u.l("".concat(n," ").concat(c)),new R("getC2CRoamingMessagesHopping"));return this.req({proto:h.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:a+1,lastMessageTime:i,direction:s}}).then(function(_){var _=_.data,f=_.complete,m=_.messageList,m=m===void 0?[]:m,_=_.lastMessageTime,m=(u.l("".concat(n," ok. complete:").concat(f," count:").concat(m.length)),d.setMessage("".concat(c," complete:").concat(f," length:").concat(m.length)).end(),f!==1&&(s===1?m.pop():m.shift()),t.get(11).onRoamingMessage(m,r,!1)),f=(t._modifyMessageList(r,m),t._computeResult({complete:f,lastMessageTime:_,resultList:m}));return V(f)}).catch(function(p){return d.setMessage(c).setError(p).end(),u.w("".concat(n," failed. error:"),p),v(p)})}},{key:"_computeResult",value:function(o){var t=o.complete,t=t===void 0?0:t,n=o.lastMessageTime,o=o.resultList,o={messageList:b(o===void 0?[]:o),isCompleted:!1,nextMessageTime:""};return t===1?o.isCompleted=!0:o.nextMessageTime=n,o}},{key:"_modifyMessageList",value:function(e,t){if(e=this.get(11).getLocalConversation(e),e)for(var n=e.userProfile.nick,o=e.userProfile.avatar,e=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),i=e.nick,a=e.avatar,s=t.length-1;0<=s;s--){var r=t[s];r.flow==="in"&&(r.nick!==n&&r.setNickAndAvatar({nick:n}),r.avatar!==o&&r.setNickAndAvatar({avatar:o})),r.flow==="out"&&(r.nick!==i&&r.setNickAndAvatar({nick:i}),r.avatar!==a&&r.setNickAndAvatar({avatar:a}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if(L(e))return u.w("".concat(n," userIDList is empty!")),Promise.resolve();var o=new R("getPeerReadTime");return u.l("".concat(n," userIDList:").concat(e)),this.req({proto:h.GET_C2C_PEER_READ_TIME,data:{userIDList:e}}).then(function(i){var a=i.data.peerReadTimeList;u.l("".concat(n," ok. peerReadTimeList:").concat(a));for(var s="",r=t.get(11),c=0;c<e.length;c++)s+="".concat(e[c],"-").concat(a[c]," "),0<a[c]&&r.recordPeerReadTime("C2C".concat(e[c]),a[c]);o.setMessage(s).end()}).catch(function(i){o.setError(i).end(),u.w("".concat(n," failed. error:"),i)})}},{key:"sendReadReceipt",value:function(i){var t=i[0].conversationID.replace(g.CONV_C2C,""),n=new R("sendC2CReadReceipt"),o=(n.setMessage("peerAccount:".concat(t)),this.getMyUserID()),i=i.filter(function(s){return s.from!==o&&s.needReadReceipt===!0}).map(function(s){return{fromAccount:s.from,toAccount:s.to,sequence:s.sequence,random:s.random,time:s.time,clientTime:s.clientTime}});if(i.length===0)return v({code:M.READ_RECEIPT_MSG_LIST_EMPTY});var a="".concat(this._n,".sendReadReceipt");return u.l("".concat(a,". peerAccount:").concat(t," messageInfoList length:").concat(i.length)),this.req({proto:h.SEND_C2C_READ_RECEIPT,data:{peerAccount:t,messageInfoList:i}}).then(function(s){return n.end(),u.l("".concat(a," ok")),V()}).catch(function(s){return n.setError(s).end(),u.w("".concat(a," failed. error:"),s),v(s)})}},{key:"getReadReceiptList",value:function(o){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),o=o.filter(function(i){return i.from===n&&i.needReadReceipt===!0});return u.l("".concat(t," userID:").concat(n," messageList length:").concat(o.length)),$({messageList:o})}},{key:"getMessageExtensions",value:function(e,t){return u.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({proto:h.GET_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return u.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.req({proto:h.MODIFY_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),extensionList:t,operateType:n}})}},{key:"getMessageKey",value:function(o){var t=o.clientSequence,n=o.random,o=o.time;return"".concat(t,"_").concat(n,"_").concat(o)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]),Io),xc=(E(ma,[{key:"getLocalOldestMessageByConversationID",value:function(e){return!e||!this.list.has(e)?null:(e=this.list.get(e).values(),e?e.next().value:null)}},{key:"pushIn",value:function(e){var t=1<arguments.length&&arguments[1]!==void 0&&arguments[1],n=e.conversationID,o=!0,i=(this.list.has(n)||this.list.set(n,new Map),this._getUniqueIDOfMessage(e));if(this.list.get(n).has(i)){var a=this.list.get(n).get(i);if(!t||a.isModified===!0)return!1}return this.list.get(n).set(i,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),o}},{key:"unshift",value:function(e,t){var n;if(q(e)?0<e.length&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n){var o=Array.from(this.list.get(n).values()),e=o.length;if(e!==0){for(var i=e-1;0<=i;i--)if(o[i].flow==="out"){this._setLatestMessageSentByMe(n,o[i]);break}if(n.startsWith(g.CONV_C2C)){for(var a=e-1;0<=a;a--)if(o[a].flow==="in"){this._setLatestMessageSentByPeer(n,o[a]);break}}}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,o=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(o,e),void t.push(e);var i=this.list.get(n),a=Array.from(i);i.has(o)||(a.unshift([o,e]),this.list.set(n,new Map(a)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,o=[],i=e[0].conversationID,a=this.list.get(i),s=this.list.has(i)?Array.from(a):[],r=0;r<n;r++){var c=this._getUniqueIDOfMessage(e[r]);a&&a.has(c)||(o.push([c,e[r]]),t.push(e[r]))}this.list.set(i,new Map(o.concat(s)))}},{key:"remove",value:function(n){var t=n.conversationID,n=this._getUniqueIDOfMessage(n);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){if(u.d("revoke message",e,t,n),this.list.has(e)){var o,i=Re(this.list.get(e));try{for(i.s();!(o=i.n()).done;){var a=z(o.value,2)[1];if(a.sequence===t&&(D(n)||a.random===n))return a.isRevoked||(a.isRevoked=!0),a}}catch(s){i.e(s)}finally{i.f()}}return null}},{key:"removeByConversationID",value:function(e){var t=this.list.has(e);u.l("".concat(this._n,".removeByConversationID conversationID:").concat(e," has:").concat(t)),t&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t,n=null,o=Re(this.list);try{for(o.s();!(t=o.n()).done;)for(var i=b(z(t.value,2)[1].values()),a=i.length,s=0;s<a;s++)if(i[s].ID===e){n=i[s];break}}catch(r){o.e(r)}finally{o.f()}return n}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n=[];if(this.list.has(e)){var o,i=Re(this.list.get(e));try{for(i.s();!(o=i.n()).done;){var a=z(o.value,2)[1];a.time<=t&&!a.isPeerRead&&a.flow==="out"&&(a.isPeerRead=!0,n.push(a))}}catch(s){i.e(s)}finally{i.f()}u.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(n.length))}return n}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;this.list.has(t)&&(e=this._getUniqueIDOfMessage(e),(t=this.list.get(t).get(e))&&(t.isModified=!0))}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?b(this.list.get(e).values()):[]}},{key:"getLocalMaxSequence",value:function(e){return this.hasLocalMessageList(e)?(e=b(this.list.get(e).values()).map(function(t){return t.sequence}),Math.max.apply(Math,b(e))):0}},{key:"getLocalMaxTime",value:function(e){return this.hasLocalMessageList(e)?(e=b(this.list.get(e).values()).map(function(t){return t.time}),Math.max.apply(Math,b(e))):0}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,o=this.getLocalMessageList(e),i=o.length,a=0;a<i;a++)o[a].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,o=this.getLocalMessageList(e),i=o.length,a=0;a<i;a++)if(o[a].ID===t){n=o[a];break}return n}},{key:"getLocalLastMessage",value:function(e){return e=this.getLocalMessageList(e),e[e.length-1]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(g.CONV_C2C)&&t.flow==="in"&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){t.flow==="out"&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(i){var t=i.conversationID,n=i.latestNick,o=i.latestAvatar,i=this.list.get(t);if(!L(i)){var a=Array.from(i.values()),i=a.length;if(i!==0){for(var s=null,r=0,c=!1,d=i-1;0<=d;d--)a[d].flow==="in"&&((s=a[d]).nick!==n&&(s.setNickAndAvatar({nick:n}),c=!0),s.avatar!==o&&(s.setNickAndAvatar({avatar:o}),c=!0),c&&(r+=1));u.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(r))}}}},{key:"modifyMessageSentByMe",value:function(i){var t=i.conversationID,n=i.latestNick,o=i.latestAvatar,i=this.list.get(t);if(!L(i)){var a=Array.from(i.values()),i=a.length;if(i!==0){for(var s=null,r=0,c=!1,d=i-1;0<=d;d--)a[d].flow==="out"&&((s=a[d]).nick!==n&&(s.setNickAndAvatar({nick:n}),c=!0),s.avatar!==o&&(s.setNickAndAvatar({avatar:o}),c=!0),c&&(r+=1));u.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(r))}}}},{key:"getTopicConversationIDList",value:function(e){return b(this.list.keys()).filter(function(t){return t.startsWith("".concat(g.CONV_GROUP).concat(e))})}},{key:"traversal",value:function(){if(this.list.size!==0&&u.getLevel()===-1){console.group("conversationID-messageCount");var e,t=Re(this.list);try{for(t.s();!(e=t.n()).done;){var n=z(e.value,2),o=n[0],i=n[1];"".concat(o,"-").concat(i.size)}}catch(a){t.e(a)}finally{t.f()}console.groupEnd()}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e))return{isUpdated:!1,message:null};var n,o="".concat(this._n,".onMessageModified"),i=this._getUniqueIDOfMessage(t),a=this.list.get(e).has(i);return u.l("".concat(o," conversationID:").concat(e," uniqueID:").concat(i," has:").concat(a)),a?(a=this.list.get(e).get(i),e=t.messageVersion,i=t.elements,n=t.cloudCustomData,t=t.checkResult,u.l("".concat(o," localVersion:").concat(a.version," remoteVersion:").concat(e)),a.version<e?(a.version=e,a._elements=JSON.parse(JSON.stringify(i)),a.payload=JSON.parse(JSON.stringify(i[0].content)),a.type=i[0].type,a.cloudCustomData=n,a.isModified=!0,a.hasRiskContent=rr(t),{isUpdated:!0,message:a}):{isUpdated:!1,message:a}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(a){var t=a.from,n=a.to,o=a.random,i=a.sequence,a=a.time;return"".concat(t,"-").concat(n,"-").concat(o,"-").concat(i,"-").concat(a)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear()}}]),ma),we={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG_UPDATED:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)};function ma(){S(this,ma),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map}function Io(e){return S(this,Io),(e=pr.call(this,e))._n="C2CModule",e._messageFromUnreadDBMap=new Map,e._noticeFromUnreadDBList=[],e}function va(e){S(this,va),this.ID="",this.conversationID=e.conversationID||null,this.conversationType=e.conversationType||g.CONV_C2C,this.conversationSubType=e.conversationSubType,this.time=e.time||Math.ceil(Date.now()/1e3),this.sequence=e.sequence||0,this.clientSequence=e.clientSequence||e.sequence||0,this.random=e.random||e.random===0?e.random:Mt(),this.priority=this._computePriority(e.priority),this.nick=e.nick||"",this.avatar=e.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=rr(e.checkResult),this._elements=[],this.isPlaceMessage=e.isPlaceMessage||0,this.isRevoked=e.isPlaceMessage===2||e.msgFlagBits===8,this.from=e.from||null,this.to=e.to||null,this.flow="",this.isSystemMessage=e.isSystemMessage||!1,this.protocol=e.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=e.status||Ft,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=e.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!e.messageControlInfo||e.messageControlInfo.excludedFromUnreadCount!==1),this._isExcludedFromLastMessage=!(!e.messageControlInfo||e.messageControlInfo.excludedFromLastMessage!==1),this.clientTime=e.clientTime||tn()||0,this.senderTinyID=e.senderTinyID||e.tinyID||"",this.readReceiptInfo=e.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=e.needReadReceipt===!0||e.needReadReceipt===1,this.version=e.messageVersion||0,this.isBroadcastMessage=e.isBroadcastMessage||!1,this._receiverList=e.receiverList||void 0,this.isSupportExtension=e.isSupportExtension===!0||e.isSupportExtension===1,this.revoker=e.revokerInfo&&e.revokerInfo.revoker||"",this.revokerInfo=e.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=e.revokeReason||"",this.reInitialize(e.currentUser),this.extractGroupInfo(e.groupProfile||null),this.handleGroupAtInfo(e),this.initC2CReadReceiptInfo(e.readReceiptSentByPeer)}function Aa(e,t){var n,o,i,a,s,r,c;S(this,Aa),this.type=g.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},e.downloadKey?(o=e.downloadKey,i=e.pbDownloadKey,a=e.title,s=e.abstractList,r=e.compatibleText,n=e.version,this.content.downloadKey=o,this.content.pbDownloadKey=i,this.content.title=a,this.content.abstractList=s,this.content.compatibleText=r,this.content.version=n||0):L(e.messageList)?e.layersOverLimit===1&&(this.content.layersOverLimit=!0):(o=e.messageList,i=e.title,a=e.abstractList,s=e.compatibleText,r=e.version,c=[],o.forEach(function(d){L(d)||(d=new Ar(d,t),c.push(d))}),this.content.messageList=c,this.content.title=i,this.content.abstractList=a,this.content.compatibleText=s,this.content.version=r||0)}function Ia(e,t){var n,o;S(this,Ia),this.from=e.from,this.messageSender=e.from,this.time=e.time,this.messageSequence=e.sequence,this.clientSequence=e.clientSequence||e.sequence,this.messageRandom=e.random,this.cloudCustomData=e.cloudCustomData||"",this.clientTime=e.clientTime||void 0,e.ID?(this.ID=e.ID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",e.messageBody?this.messageBody=JSON.parse(JSON.stringify(e.messageBody)):this.messageBody=[{type:e.type,payload:e.payload}],e.conversationType?e.conversationType.startsWith(g.CONV_C2C)?this.receiverUserID=e.to:e.conversationType.startsWith(g.CONV_GROUP)&&(this.receiverGroupID=e.to):e.receiverGroupID?this.receiverGroupID=e.receiverGroupID:e.receiverUserID&&(this.receiverUserID=e.receiverUserID),this.messageReceiver=e.to||e.messageReceiver):(this.nick=e.nick||"",this.avatar=e.avatar||"",this.messageBody=[],n=e.elements[0].type,o=e.elements[0].content,this._patchRichMediaPayload(n,o),this._updateRichMediaDownloadUrl(n,o,t),n===g.MSG_MERGER?this.messageBody.push({type:n,payload:new Ci(o).content}):this.messageBody.push({type:n,payload:o}),e.groupID&&(this.receiverGroupID=e.groupID,this.messageReceiver=e.groupID),e.to&&(this.receiverUserID=e.to,this.messageReceiver=e.to),this.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random))}function ya(o){S(this,ya),this.type=g.MSG_LOCATION;var t=o.description,n=o.longitude,o=o.latitude;this.content={description:t,longitude:n,latitude:o}}function Ma(e,t){S(this,Ma),this.type=g.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:e.remoteVideoUrl||e.videoUrl||"",videoFormat:e.videoFormat,videoSecond:parseInt(e.videoSecond,10),videoSize:e.videoSize,videoUrl:Ct(e.videoUrl,t),videoDownloadFlag:2,videoUUID:e.videoUUID,thumbUUID:e.thumbUUID,thumbFormat:e.thumbFormat,thumbWidth:e.thumbWidth,snapshotWidth:e.thumbWidth,thumbHeight:e.thumbHeight,snapshotHeight:e.thumbHeight,thumbSize:e.thumbSize,snapshotSize:e.thumbSize,thumbDownloadFlag:2,thumbUrl:Ct(e.thumbUrl,t),snapshotUrl:Ct(e.thumbUrl,t)}}function Ca(e){S(this,Ca),this.type=g.MSG_CUSTOM,this.content={data:e.data||"",description:e.description||"",extension:e.extension||""}}function Ta(e,t){S(this,Ta),this.type=g.MSG_FILE,this._percent=0;var n=this._getFileInfo(e);this.content={downloadFlag:2,fileUrl:Ct(e.url||e.fileUrl,t)||"",uuid:e.uuid,fileName:n.name||"",fileSize:n.size||0}}function Da(e){S(this,Da),this.type=g.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(e)}function Sa(e){S(this,Sa),this.type=g.MSG_GRP_TIP,this.content={},this._initContent(e)}function Ea(e,t){S(this,Ea),this.type=g.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:e.second,size:e.size,url:Ct(e.url,t),remoteAudioUrl:e.url||"",uuid:e.uuid}}function La(e){S(this,La),this.type=g.MSG_FACE,this.content=e||null}function ka(e,t){S(this,ka),this._imageMemoryURL="",this._fileDownloadProxy=t,me?this.createImageDataASURLInWXMiniApp(e.file):this.createImageDataASURLInWeb(e.file),this._initImageInfoModel(),this.type=g.MSG_IMAGE,this._percent=0,this.content={imageFormat:e.imageFormat||Lt.UNKNOWN,uuid:e.uuid,imageInfoArray:[]},this.initImageInfoArray(e.imageInfoArray),this._autoFixUrl()}function Ra(e){S(this,Ra),this.type=g.MSG_TEXT,this.content={text:e.text||""}}function yo(e){S(this,yo),this._n="SSOLogData",this.eventType=bc[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Et()}function Na(e){S(this,Na),this._m=e,this._n=""}function Ti(i){S(this,Ti),t=gr.call(this);var t,n=i.code,o=i.message,i=i.data;return t.code=n,o?t.message=o:t._getErrorMessage&&(t.message=t._getErrorMessage(t.code)),t.data=i||{},t}function Oa(e){this.mixin(e)}Oa.mixin=function(e){e=e.prototype||e,e._isReady=!1,e.ready=function(t){if(t)return this._isReady?void(1<arguments.length&&arguments[1]!==void 0&&arguments[1]?t.call(this):setTimeout(t,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(t))},e.triggerReady=function(){var t=this;this._isReady=!0,setTimeout(function(){var n=t._readyQueue;t._readyQueue=[],n&&0<n.length&&n.forEach(function(o){o.call(this)},t)},1)},e.resetReady=function(){this._isReady=!1,this._readyQueue=[]},e.isReady=function(){return this._isReady}};function Ir(e,t,n){return D(e)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:n&&e.ID||e instanceof Xe?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:ho(e.type,e.payload,t),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:l(l({},e),{},{messageForShow:ho(e.type,e.payload,t)})}function yr(e,t){return L(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:ho(e.type,e.payload,t),nick:e.nick||"",avatar:e.avatar||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}}function Ga(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var o,i,a=0,s=0;i=t.charAt(s++);~i&&(o=a%4?64*o+i:i,a++%4)&&(n+=String.fromCharCode(255&o>>(-2*a&6))))i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);try{return decodeURIComponent(escape(n))}catch{return""}}var Mr,Cr,Tr,Dr,Sr,qc=["jpg","jpeg","gif","png","bmp","image","webp"],Vc=["mp4","quicktime","mov"],Mo=(E(es,[{key:"validate",value:function(e){var t,n=!0,o="";if(L(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,a=null,s=0;s<i;s++){if(a=e.profileCustomField[s],!ne(a.key)||a.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ne(a.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if(t==="profileCustomField")continue;if(L(e[t])&&!ne(e[t])&&!ge(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":ne(e[t])||(n=!(o="nick must be a string")),500<Vn(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(Vn(e[t])," bytes"),n=!1);break;case"gender":_n(se,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":ge(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":ne(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":ne(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":_n(Se,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":ge(e.language)||(n=!(o="language must be a number"));break;case"avatar":ne(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":e.messageSettings!==0&&e.messageSettings!==1&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":_n(Te,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":ge(e.level)||(n=!(o="level must be a number"));break;case"role":ge(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}}]),es),Bc=E(function e(t){S(this,e),this.value=t,this.next=null}),Pa=(E($a,[{key:"set",value:function(e){var t,n=new Bc(e);this.map.size<this.MAX_LENGTH?this.pTail===null?(this.pTail=n,this.pNodeToDel=n):(this.pTail.next=n,this.pTail=n):(t=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,this.map.delete(t.value),t.next=null,t=null,this.pTail.next=n,this.pTail=n),this.map.set(e,1)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;this.pNodeToDel!==null;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),$a),Hc=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],vn=(E(Qa,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)Hc.indexOf(t)<0||(t!=="selfInfo"?(t==="memberNum"&&(this.memberCount=e[t]),t==="maxMemberNum"&&(this.maxMemberCount=e[t]),t!=="isSupportTopic"?this[t]=e[t]:this.isSupportTopic=e[t]===1):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(n){var t=this,n=(n.appid=void 0,n.grossTopicNextMsgSeq=void 0,n.selfInfo&&(n.selfInfo.grossTopicReadSeq=void 0),JSON.parse(JSON.stringify(n)));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),D(n.muteAllMembers)||(n.muteAllMembers==="On"?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&Dn(this.groupCustomField,n.groupCustomField),D(n.memberNum)||(this.memberCount=n.memberNum),D(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),D(n.isSupportTopic)||(this.isSupportTopic=ge(n.isSupportTopic)?n.isSupportTopic===1:n.isSupportTopic),bt(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),q(n.members)&&0<n.members.length&&n.members.forEach(function(o){o.userID===t.selfInfo.userID&&bt(t.selfInfo,o,["sequence"])})}},{key:"updateSelfInfo",value:function(e){e={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList},bt(this.selfInfo,l({},e),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),Qa),Di=(E(Za,[{key:"toAccount",get:function(){return this.conversationID.startsWith(g.CONV_C2C)?this.conversationID.replace(g.CONV_C2C,""):this.conversationID.startsWith(g.CONV_GROUP)?this.conversationID.replace(g.CONV_GROUP,""):""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}}),D(this.userProfile)&&this.type===g.CONV_C2C?this.userProfile=new Mo({userID:e.conversationID.replace("C2C","")}):D(this.groupProfile)&&this.type===g.CONV_GROUP&&(this.groupProfile=new vn({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(o){var t=o.nextUnreadCount,n=o.isFromGetConversations,o=o.isUnreadC2CMessage;D(t)||(et(this.subType)?this.unreadCount=0:n&&this.type===g.CONV_GROUP||n&&this.type===g.CONV_TOPIC||o&&this.type===g.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=Ir(e)}},{key:"updateGroupAtInfoList",value:function(e){var t;this._isNeedMergeGroupAtInfo(e)||((t=(ie(t=e.groupAtType)||De(t)||Ve(t)||ut()).slice(0)).indexOf(g.CONV_AT_ME)!==-1&&t.indexOf(g.CONV_AT_ALL)!==-1&&(t=[g.CONV_AT_ALL_AT_ME]),t={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:t,__random:e.__random,__sequence:e.__sequence},this.groupAtInfoList.push(t))}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!rt({groupID:t}))return!1;var o=!1;return this.groupAtInfoList.forEach(function(i){i.messageSequence===n&&(-1<i.atTypeArray.indexOf(g.CONV_AT_ME)&&-1<e.groupAtType.indexOf(g.CONV_AT_ALL)&&(i.atTypeArray=[g.CONV_AT_ALL_AT_ME]),-1<i.atTypeArray.indexOf(g.CONV_AT_ALL)&&-1<e.groupAtType.indexOf(g.CONV_AT_ME)&&(i.atTypeArray=[g.CONV_AT_ALL_AT_ME],i.__random=e.__random,i.__sequence=e.__sequence),o=!0)}),o}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(n){var t=n.sequence,n=n.time;return this.type===g.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===g.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}},{key:"setDraftText",value:function(e){this.draftText=e}}]),Za),Kc=(E(Xa,[{key:"getC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,".getC2CMessageRemindType");return this._convM.req({proto:h.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:e}}).then(function(o){u.l("".concat(n," ok. userIDList:").concat(e)),o=o.data.muteFlagList,t._convM.onC2CMessageRemindTypeFetched(o)}).catch(function(o){u.e("".concat(n," failed. error:"),o)})}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):q(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),o=e.groupID,i=e.messageRemindType,a="groupID:".concat(o," messageRemindType:").concat(i),s=new R("setMessageRemindType"),r=(s.setMessage(a),this._get(7));return r?r.modifyGroupMemberInfo({groupID:o,messageRemindType:i,userID:this._convM.getMyUserID()}).then(function(){s.end(),u.l("".concat(n," ok. ").concat(a));var c=t.onGroupMessageRemindTypeUpdated(e);return t._convM.emitTotalUnreadMessageCountUpdate(),V(c)}).catch(function(c){return s.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)}):v({code:M.CANNOT_FIND_MODULE})}},{key:"onGroupMessageRemindTypeUpdated",value:function(i){var t,n,o=i.groupID,i=i.messageRemindType,a=(u.l("".concat(this._n,".onGroupMessageRemindTypeUpdated groupID:").concat(o," messageRemindType:").concat(i)),this._get(7).getLocalGroupProfile(o));return a&&(a.selfInfo.messageRemindType=i),We(o)?(t=je(n=o),(n=this._get(10).getLocalTopic(t,n))&&(n.updateSelfInfo({messageRemindType:i}),this._convM.emitOuterEvent(K.TOPIC_UPDATED,{groupID:t,topic:n})),{topic:n}):(this._convM.patchMessageRemindType({ID:o,isC2CConversation:!1,messageRemindType:i})&&this._emitConversationUpdate(),{group:a})}},{key:"_setC2CMessageRemindType",value:function(s){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),o=s.userIDList,i=s.messageRemindType,a=o.slice(0,30),s=0,r=(i===g.MSG_REMIND_DISCARD?s=1:i===g.MSG_REMIND_ACPT_NOT_NOTE&&(s=2),"userIDList:".concat(a," messageRemindType:").concat(i)),c=new R("setMessageRemindType");return c.setMessage(r),this._convM.req({proto:h.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:a,muteFlag:s}}).then(function(m){c.end();var m=m.data.errorList,p=[],_=[],m=(q(m)&&m.forEach(function(I){p.push(I.userID),_.push({userID:I.userID,code:I.errorCode})}),a.filter(function(I){return p.indexOf(I)===-1})),f=(u.l("".concat(n," ok. ").concat(r," successUserIDList:").concat(m," failureUserIDList:").concat(JSON.stringify(_))),0);return m.forEach(function(I){t._convM.patchMessageRemindType({ID:I,isC2CConversation:!0,messageRemindType:i})&&(f+=1)}),1<=f&&t._emitConversationUpdate(),a.length=p.length=0,t._convM.emitTotalUnreadMessageCountUpdate(),$({successUserIDList:m.map(function(I){return{userID:I}}),failureUserIDList:_})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"_get",value:function(e){return this._convM.get(e)}},{key:"_emitConversationUpdate",value:function(){this._convM.emitConversationUpdate(!0,!1)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),Xa),Wc=(E(Ja,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),o=e.conversationIDList,i=e.customData,a=(u.l("".concat(n," options:"),e),new R("setConvCustomData")),s=(a.setMessage(JSON.stringify(e)),{fromAccount:this._getMyUserID(),itemList:[]}),r=[],c=[];return o.forEach(function(d){if(!t._hasLocalConversation(d))return t._onConversationNotFound(c,d),!0;if(!ct(d)&&!ot(d))return t._onConversationIDInvalid(c,d),!0;var p={operationType:2,contactItem:void 0,customMark:i};ct(d)?p.contactItem={type:1,toAccount:d.replace(g.CONV_C2C,"")}:ot(d)&&(p.contactItem={type:2,groupID:d.replace(g.CONV_GROUP,"")}),s.itemList.push(p)}),c.length===o.length?$({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:h.SET_CONV_CUSTOM_DATA,data:s}).then(function(f){a.end(),u.l("".concat(n," ok"));var p,_,m,f=f.data.resultItem;return q(f)&&(m=!1,f.forEach(function(I){p=t._concatConversationID(I.contactItem),I.resultCode===0?(r.push(p),(_=t._getLocalConversation(p))&&_.customData!==i&&(_.customData=i,m=!0)):c.push({conversationID:p,code:I.resultCode,message:I.resultInfo})}),m===!0&&t._emitConversationUpdate()),V({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return a.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"markConversation",value:function(d){var t=this;if(!this._convM.canIUse(Ce.CONV_MARK))return this._convM.cannotUseCommercialAbility("markConversation");var n="".concat(this._n,".").concat("markConversation"),o=d.conversationIDList,i=d.markType,a=d.enableMark,s=(u.l("".concat(n," options:"),d),new R("markConversation")),r=(s.setMessage(JSON.stringify(d)),void 0),c=void 0,d=this._getFlagBit(i),p=(a===!0?c=[d]:r=[d],{fromAccount:this._getMyUserID(),itemList:[]}),_=[],m=[];return o.forEach(function(f){if(!t._hasLocalConversation(f))return t._onConversationNotFound(m,f),!0;if(!ct(f)&&!ot(f))return t._onConversationIDInvalid(m,f),!0;var I={operationType:1,contactItem:void 0,clearMark:r,setMark:c};ct(f)?I.contactItem={type:1,toAccount:f.replace(g.CONV_C2C,"")}:ot(f)&&(I.contactItem={type:2,groupID:f.replace(g.CONV_GROUP,"")}),p.itemList.push(I)}),m.length===o.length?$({successConversationIDList:_,failureConversationIDList:m}):this._convM.req({proto:h.MARK_CONV,data:p}).then(function(H){s.end(),u.l("".concat(n," ok"));var I,N,P,H=H.data.resultItem;return q(H)&&(P=!1,H.forEach(function(Z){var le;I=t._concatConversationID(Z.contactItem),Z.resultCode===0?(_.push(I),(N=t._getLocalConversation(I))&&(le=N.markList.indexOf(i),a===!0?le===-1&&(N.markList.push(i),P=!0):le!==-1&&(N.markList.splice(le,1),P=!0))):m.push({conversationID:I,code:Z.resultCode,message:Z.resultInfo})}),P===!0&&t._emitConversationUpdate()),V({successConversationIDList:_,failureConversationIDList:m})}).catch(function(f){return s.setError(f).end(),u.e("".concat(n," failed. error:"),f),v(f)})}},{key:"getLocalConvGroupList",value:function(){var e=this;return u.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===zn?this.getRemoteConvGroupList().then(function(){return V(b(e._convGroupMap.values()))}):$(b(this._convGroupMap.values()))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=hr,this._convM.req({proto:h.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex,startTime:tn()}}).then(function(r){var o,r=r.data,i=r.completeFlag,a=r.contactItem,s=r.nextStartIndex,s=s===void 0?0:s,r=r.groupItem;if(e._startIndex=s,u.l("".concat(t," completeFlag:").concat(i," nextStartIndex:").concat(s)),q(r)&&r.forEach(function(p){var d=p.convGroupID,p=p.groupName;e._convGroupMap.set(d,p)}),q(a)&&a.forEach(function(c){var d,p=c.standardMark,_=c.customData,m=c.convGroupIDList;o=e._concatConversationID(c),(o=e._getLocalConversation(o))&&(o.markList=vi(p),o.customData=_||"",q(m))&&(d=[],m.forEach(function(f){e._convGroupMap.has(f)&&d.push(e._convGroupMap.get(f))}),o.conversationGroupList=[].concat(d),d.length=0)}),i===0)return e.getRemoteConvGroupList();i===1&&(e._pagingStatus=mo,e._emitConversationUpdate(),e._emitConvGroupListUpdate())}).catch(function(n){e._pagingStatus=zn,u.w("".concat(t," failed. error:"),n)})}},{key:"createConvGroup",value:function(e){var t=this,a="createConversationGroup";if(!this._convM.canIUse(Ce.CONV_GROUP))return this._convM.cannotUseCommercialAbility(a);var n="".concat(this._n,".").concat(a),o=(u.l("".concat(n," options:"),e),new R(a)),i=(o.setMessage(JSON.stringify(e)),e.groupName),a=e.conversationIDList,s={fromAccount:this._getMyUserID(),itemList:[{groupName:i,contactItem:[]}]},r=[],c=[];return a.forEach(function(d){return t._hasLocalConversation(d)?ct(d)||ot(d)?void(ct(d)?s.itemList[0].contactItem.push({type:1,toAccount:d.replace(g.CONV_C2C,"")}):ot(d)&&s.itemList[0].contactItem.push({type:2,groupID:d.replace(g.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,d),!0):(t._onConversationNotFound(c,d),!0)}),c.length===a.length?$({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:h.CREATE_CONV_GRP,data:s}).then(function(I){o.end(),u.l("".concat(n," ok"));var p,_,m,I=I.data.groupResultItem[0],f=I.groupItem,I=I.resultItem;return Ie(f)&&(t._convGroupMap.set(f.convGroupID,f.groupName),t._emitConvGroupListUpdate()),q(I)&&(m=!1,I.forEach(function(N){p=t._concatConversationID(N.contactItem),N.resultCode===0?(r.push(p),(_=t._getLocalConversation(p))&&_.conversationGroupList.indexOf(i)===-1&&(_.conversationGroupList.push(i),m=!0)):c.push({conversationID:p,code:N.resultCode,message:N.resultInfo})}),m===!0&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())),V({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return o.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"deleteConvGroup",value:function(e){var t=this,n="deleteConversationGroup";if(!this._convM.canIUse(Ce.CONV_GROUP))return this._convM.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),i=(u.l("".concat(o," groupName:").concat(e)),new R(n));return i.setMessage(e),this._convM.req({proto:h.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[e]}}).then(function(r){i.end(),u.l("".concat(o," ok"));var s,r=r.data.groupItem;q(r)&&(s=!1,r.forEach(function(c){t._convGroupMap.has(c.convGroupID)&&(t._convGroupMap.delete(c.convGroupID),s=!0)}),s===!0&&t._emitConvGroupListUpdate()),t._eraseFromConversationGroupList([e])}).catch(function(a){return i.setError(a).end(),u.e("".concat(o," failed. error:"),a),v(a)})}},{key:"renameConvGroup",value:function(e){var t=this,n="renameConversationGroup";if(!this._convM.canIUse(Ce.CONV_GROUP))return this._convM.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),i=(u.l("".concat(o," options:"),e),new R(n)),a=(i.setMessage(JSON.stringify(e)),e.oldName),s=e.newName;return this._convM.req({proto:h.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:a,newName:s}}}).then(function(p){i.end(),u.l("".concat(o," ok")),p=p.data.updateGroupResult.convGroupID,t._convGroupMap.set(p,s),t._emitConvGroupListUpdate();var c,d,p=t._convM.getLocalConversationList(),_=!1;p.forEach(function(m){c=m.conversationGroupList,(d=c.indexOf(a))!==-1&&(c.splice(d,1,s),_=!0)}),_===!0&&t._emitConversationUpdate()}).catch(function(r){return i.setError(r).end(),u.e("".concat(o," failed. error:"),r),v(r)})}},{key:"addConvsToGroup",value:function(e){var t=this,i="addConversationsToGroup";if(!this._convM.canIUse(Ce.CONV_GROUP))return this._convM.cannotUseCommercialAbility(i);var n="".concat(this._n,".").concat(i),o=(u.l("".concat(n," options:"),e),new R(i)),i=(o.setMessage(JSON.stringify(e)),e.conversationIDList),a=e.groupName,s={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:a,updateItem:[]}},r=[],c=[];return i.forEach(function(d){return t._hasLocalConversation(d)?ct(d)||ot(d)?void(ct(d)?s.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:d.replace(g.CONV_C2C,"")}}):ot(d)&&s.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:d.replace(g.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,d),!0):(t._onConversationNotFound(c,d),!0)}),c.length===i.length?$({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:h.ADD_CONV_TO_GRP,data:s}).then(function(f){o.end(),u.l("".concat(n," ok"));var p,_,m,f=f.data.updateGroupResult.contactResultItem;return q(f)&&(m=!1,f.forEach(function(I){p=t._concatConversationID(I.contactItem),I.resultCode===0?(_=t._getLocalConversation(p))&&_.conversationGroupList.indexOf(a)===-1&&(_.conversationGroupList.push(a),r.push(p),m=!0):c.push({conversationID:p,code:I.resultCode,message:I.resultInfo})}),m===!0&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(a))),V({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return o.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"deleteConvsFromGroup",value:function(e){var t=this,i="deleteConversationsFromGroup";if(!this._convM.canIUse(Ce.CONV_GROUP))return this._convM.cannotUseCommercialAbility(i);var n="".concat(this._n,".").concat(i),o=(u.l("".concat(n," options:"),e),new R(i)),i=(o.setMessage(JSON.stringify(e)),e.conversationIDList),a=e.groupName,s={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:a,updateItem:[]}},r=[],c=[];return i.forEach(function(d){return t._hasLocalConversation(d)?ct(d)||ot(d)?void(ct(d)?s.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:d.replace(g.CONV_C2C,"")}}):ot(d)&&s.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:d.replace(g.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,d),!0):(t._onConversationNotFound(c,d),!0)}),c.length===i.length?$({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:h.DEL_CONV_FROM_GRP,data:s}).then(function(f){o.end(),u.l("".concat(n," ok"));var p,_,m,f=f.data.updateGroupResult.contactResultItem;return q(f)&&(m=!1,f.forEach(function(I){var N;p=t._concatConversationID(I.contactItem),I.resultCode===0?!(_=t._getLocalConversation(p))||(N=_.conversationGroupList.indexOf(a))!==-1&&(_.conversationGroupList.splice(N,1),r.push(p),m=!0):c.push({conversationID:p,code:I.resultCode,message:I.resultInfo})}),m===!0&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(a))),V({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return o.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"onConvMarkUpdated",value:function(e){var t,n,o=this;L(e)||(u.d("".concat(this._n,".onConvMarkUpdated markItemList:"),e),n=!1,e.forEach(function(c){var a=c.recentContactItem,s=c.optType,r=c.standardMark,c=c.customMark;t=o._concatConversationID(a),(t=o._getLocalConversation(t))&&(s===1?n=o._diffStandardMark(t,r):s===2?n=o._diffCustomMark(t,c):s===3&&(n=o._diffStandardMark(t,r)||o._diffCustomMark(t,c)))}),n===!0&&this._emitConversationUpdate())}},{key:"_diffStandardMark",value:function(e,n){var n=vi(n),o=!1;return function(i,a){if(i===a)return!0;if(!i||!a||i.length!==a.length)return!1;for(var s=0,r=i.length;s<r;s++)if(i[s]!==a[s])return!1;return!0}(e.markList,n)!==!0&&(e.markList=n,o=!0),o}},{key:"_diffCustomMark",value:function(e,t){var n=!1;return e.customData!==t&&t!==void 0&&(e.customData=t,n=!0),n}},{key:"onConvGroupCreated",value:function(e){var t=this,n=(u.d("".concat(this._n,".onConvGroupCreated resultList:"),e),!1),o=!1;q(e)&&(e.forEach(function(i){var c=i.msgGroupItem,a=c.groupID,s=c.groupName;t._convGroupMap.get(a)!==s&&(t._convGroupMap.set(a,s),o=!0);var r,c=i.msgRecentContactItem;q(c)&&c.forEach(function(d){r=t._concatConversationID(d),(r=t._getLocalConversation(r))&&r.conversationGroupList.indexOf(s)===-1&&(r.conversationGroupList.push(s),n=!0)})}),n===!0&&this._emitConversationUpdate(),o===!0&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t,n=this,o=(u.d("".concat(this._n,".onConvGroupDeleted groupItemList:"),e),[]);q(e)&&(t=!1,e.forEach(function(s){var a=s.groupID,s=s.groupName;n._convGroupMap.has(a)&&(n._convGroupMap.delete(a),t=!0,o.push(s))}),t===!0&&this._emitConvGroupListUpdate()),this._eraseFromConversationGroupList(o)}},{key:"_eraseFromConversationGroupList",value:function(e){L(e)||(this._convM.getLocalConversationList().forEach(function(t){t.conversationGroupList=t.conversationGroupList.filter(function(n){return!e.includes(n)})}),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){u.d("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t,n,o,i=e.groupID,a=e.groupName,s=e.oldGroupName;this._convGroupMap.get(i)!==a&&(this._convGroupMap.set(i,a),this._emitConvGroupListUpdate(),e=this._convM.getLocalConversationList(),o=!1,e.forEach(function(r){t=r.conversationGroupList,(n=t.indexOf(s))!==-1&&(t.splice(n,1,a),o=!0)}),o===!0&&this._emitConversationUpdate())}},{key:"onConvInGroupUpdated",value:function(s){var t,n,o,i=this,a=(u.d("".concat(this._n,".onConvInGroupUpdated options:"),s),s.oldGroupName),s=s.recentContactUpdateGroupItem;q(s)&&(o=!1,s.forEach(function(d){var c=d.contactOptType,d=d.recentContactItem;t=i._concatConversationID(d),(t=i._getLocalConversation(t))&&(n=t.conversationGroupList.indexOf(a),c===1?n===-1&&(t.conversationGroupList.push(a),o=!0):c===2&&n!==-1&&(t.conversationGroupList.splice(n,1),o=!0))}),o===!0&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(a)))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(i){var t,n,o=this,a=(u.d("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),i),i.msgRecentContactItem),i=i.msgRecentContactUpdateContactItem,a=this._concatConversationID(a),s=this._getLocalConversation(a);s&&q(i)&&(n=!1,i.forEach(function(d){var c=d.groupOptType,d=d.recentContactGroupItem.groupName;t=s.conversationGroupList.indexOf(d),c===1?t===-1&&(s.conversationGroupList.push(d),n=!0):c===2&&t!==-1&&(s.conversationGroupList.splice(t,1),n=!0),n===!0&&o._emitConvInGroupUpdate(d)}),n===!0&&this._emitConversationUpdate())}},{key:"onConvGroupListSynced",value:function(e){var t=this;q(e)&&e.length!==0&&(u.l("".concat(this._n,".onConvGroupListSynced groupItemList:"),e),e.forEach(function(n){t._convGroupMap.set(n.convGroupID,n.groupName)}))}},{key:"getConvGroupListByID",value:function(e){var t,n=this;if(!L(e))return t=[],e.forEach(function(o){n._convGroupMap.has(o)&&t.push(n._convGroupMap.get(o))}),t}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:M.CONV_NOT_FOUND,message:this._convM.getErrorMessage(M.CONV_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:M.INVALID_CONV_ID,message:this._convM.getErrorMessage(M.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,o=n-1;0<=o;o--)if(t[o]==="1")return n-o-1}},{key:"_concatConversationID",value:function(a){var t,n=a.type,o=a.to,i=a.groupID,a=a.userID;return n===1?D(a)?D(o)||(t="".concat(g.CONV_C2C).concat(o)):t="".concat(g.CONV_C2C).concat(a):n===2&&(t="".concat(g.CONV_GROUP).concat(i)),t}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_insertConversationGroup",value:function(n,t){var n=this._getLocalConversation(n);!n||(n=n.conversationGroupList).indexOf(t)===-1&&n.push(t)}},{key:"_getLocalConversation",value:function(e){return this._convM.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._convM.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._convM.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOuterEvent(K.CONVERSATION_GROUP_LIST_UPDATED,b(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._convM.getLocalConversationList();t.conversationList=n.filter(function(o){return o.conversationGroupList.includes(e)}),this._convM.emitOuterEvent(K.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=an}}]),Ja),Yc=(F(Eo,xe),Sr=te(Eo),E(Eo,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(we.A2KEY_AND_TINYID_UPDATED,this._init,this),e.on(we.PROFILE_UPDATED,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_init",value:function(){var e=this,t=(u.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),n=this.isIntl(),o=this.isUsingChatCore();if(t){for(var i=t.length,a=0;a<i;a++){var s=t[a];if(s){if(this._isNonExistentAccount(s.conversationID))continue;if(s.groupProfile){var r=s.groupProfile.type;if(et(r))continue}}this._conversationMap.set(s.conversationID,new Di(t[a],n,o))}this.emitConversationUpdate(!0,!1)}this.ready(function(){0<e._tmpGroupList.length&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)}),this.syncConversationList()}},{key:"_isNonExistentAccount",value:function(e){var t;return(t=e.startsWith(g.CONV_C2C)?e.replace(g.CONV_C2C,""):t)==="@TLS#ERROR"||t==="@TLS#NOT_FOUND"}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,o=e.isInstantMessage,o=o===void 0||o,i=e.isUnreadC2CMessage,i=i!==void 0&&i,a=e.updateUnreadCount,a=a===void 0||a,s=e.isSyncingEnded,s=s!==void 0&&s;this._isReady?n.length!==0?(o===!0&&this._checkNewConversation(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:o,isUnreadC2CMessage:i,isFromGetConversations:!1,updateUnreadCount:a}),o||(this._convIDFromUnreadDBMap=new Map([].concat(b(this._convIDFromUnreadDBMap),b(n.map(function(r){return[r.conversationID,1]})))),this._diffAndDeleteConversation(),s&&this.emitInnerEvent(we.C2C_UNREAD_HANDLE_COMPLETED)),0<n.filter(function(r){return!t._isConvNeedShow(r.conversationID)}).length||this.emitConversationUpdate()):s&&this.emitInnerEvent(we.C2C_UNREAD_HANDLE_COMPLETED):this.ready(function(){t._onSendOrReceiveMessage(e)})}},{key:"updateConversationGroupProfile",value:function(e){var t,n=this;q(e)&&e.length===0||(this._conversationMap.size!==0?(t=!1,e.forEach(function(o){var i="GROUP".concat(o.groupID);n._conversationMap.has(i)&&(t=!0,(i=n._conversationMap.get(i)).groupProfile=JSON.parse(JSON.stringify(o)),i.lastMessage.lastSequence<o.nextMessageSeq&&(i.lastMessage.lastSequence=o.nextMessageSeq-1),i.subType||(i.subType=o.type))}),t&&this.emitConversationUpdate(!0,!1)):this._tmpGroupList=e)}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach(function(n){var o="C2C".concat(n.userID);t._conversationMap.has(o)&&(t._conversationMap.get(o).userProfile=n)}),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t,n,o,i=this;e.length!==0&&(t=null,n=!1,o=[],e.forEach(function(a){(t=i._conversationMap.get(a.conversationID))&&(t.reduceUnreadCount()&&(n=t.type!==g.CONV_TOPIC),t.type===g.CONV_TOPIC?o.push(a):t.isLastMessageRevoked({sequence:a.sequence,time:a.time})&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(a.revoker),n=!0))}),this.get(10).onMessageRevoked(o),n&&this.emitConversationUpdate(!0,!1))}},{key:"updateRevokerInfo",value:function(e){for(var t=new Set,n=0;n<e.length;n++){var o=e[n].revoker;t.add(o)}var i=b(t),a=this.get(4);return new Promise(function(s){a.getUserProfile({userIDList:i}).then(function(r){if(r=r.data,!q(r)||r.length===0)return s(e);var c,d={},p=Re(r);try{for(p.s();!(c=p.n()).done;){var _=c.value,m=_.userID,f=_.nick,I=_.avatar;d[m]={nick:f,avatar:I}}}catch(N){p.e(N)}finally{p.f()}e.forEach(function(N){var P=N.revoker;d[P]&&(N.revokerInfo.nick=d[P].nick||"",N.revokerInfo.avatar=d[P].avatar||"")}),s(e)}).catch(function(){s(e)})})}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,o=e.sequence,i=e.time,a=this._conversationMap.get(n);return a&&(t=a.type===g.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:n.replace(g.CONV_GROUP,""),sequence:o}):a.isLastMessageRevoked({sequence:o,time:i})),u.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(e.length!==0){var n=null;e.forEach(function(c){(n=t._messageListHandler.getLocalMessage(c.conversationID,c.ID))&&(n.isDeleted=!0),c!==n&&(c.isDeleted=!0)});for(var e=e[0].conversationID,o=this._messageListHandler.getLocalMessageList(e),i={},a=o.length-1;0<=a;a--)if(!o[a].isDeleted){i=o[a];break}var s,r=this._conversationMap.get(e);r&&(s=!1,r.lastMessage.lastSequence===i.sequence&&r.lastMessage.lastTime===i.time||(L(i)&&(i=void 0),r.updateLastMessage(i),r.type!==g.CONV_TOPIC&&(s=!0),u.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(e," with lastMessage:"),r.lastMessage)),e.startsWith(g.CONV_C2C)&&this.updateUnreadCount(e),s&&this.emitConversationUpdate(!0,!1))}}},{key:"onMessageModified",value:function(e){var t="".concat(this._n,".onMessageModified"),p=e.conversationType,n=e.from,o=e.to,i=e.time,a=e.sequence,s=e.elements,r=e.cloudCustomData,c=e.messageVersion,_=this.getMyUserID(),d="".concat(p).concat(o),_=(o===_&&p===g.CONV_C2C&&(d="".concat(p).concat(n)),this._messageListHandler.onMessageModified(d,e)),p=_.isUpdated,_=_.message,m=(p===!0&&this.emitOuterEvent(K.MESSAGE_MODIFIED,[_]),this._isTopicConversation(d));return _===null?u.l("".concat(t," message is null! options:").concat(JSON.stringify(e),"}")):u.l("".concat(t," isUpdated:").concat(p," isTopicMessage:").concat(m," from:").concat(n," to:").concat(o," sequence:").concat(_.sequence," time:").concat(_.time)),m?this.get(10).onMessageModified(e):!(p=this._conversationMap.get(d))||(n=p.lastMessage)&&n.lastTime===i&&n.lastSequence===a&&n.version!==c&&(u.l("".concat(t," conversationID:").concat(d," lastMessage updated")),n.type=s[0].type,n.payload=s[0].content,n.messageForShow=ho(n.type,n.payload,this.isIntl()),n.cloudCustomData=r,n.version=c,this.emitConversationUpdate(!0,!1)),_}},{key:"onNewGroupAtTips",value:function(n){var t=this,n=n.dataList,o=null;n.forEach(function(i){i.groupAtTips?o=i.groupAtTips:i.elements?o=l(l({},i.elements),{},{sync:!0}):i.groupAtType&&(o=l(l({},i),{},{sync:!0})),o.__random=i.random,o.__sequence=i.clientSequence,t._tmpGroupAtTipsList.push(o)}),u.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e,t=this;this._tmpGroupAtTipsList.length!==0&&(e=!1,this._tmpGroupAtTipsList.forEach(function(n){var o,i=n.groupID,a=n.from,s=n.topicID,s=s===void 0?void 0:s,r=n.sync,r=r!==void 0&&r;a!==t.getMyUserID()&&(D(s)?(a=t._conversationMap.get("".concat(g.CONV_GROUP).concat(i)))&&(a.updateGroupAtInfoList(n),e=!0):((i=t._conversationMap.get("".concat(g.CONV_GROUP).concat(s)))&&(i.updateGroupAtInfoList(n),a=t.get(10),o=i.groupAtInfoList,a.onConversationProxy({topicID:s,groupAtInfoList:o})),L(i)&&r&&(t.updateTopicConversation([{conversationID:"".concat(g.CONV_GROUP).concat(s),type:g.CONV_TOPIC}]),t._conversationMap.get("".concat(g.CONV_GROUP).concat(s)).updateGroupAtInfoList(n))))}),e&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConversation",value:function(e){var t=this,n=[],o=[];e.forEach(function(i){t._conversationMap.has(i.conversationID)||(i.type===g.CONV_C2C?n.push(i.conversationID.replace(g.CONV_C2C,"")):i.type===g.CONV_GROUP&&o.push(i.conversationID.replace(g.CONV_GROUP,"")))}),0<n.length&&(this._onNewC2CConversation(n),n=null),0<o.length&&(this._onNewGroupConversation(o),o=null)}},{key:"_onNewC2CConversation",value:function(e){this.get(6).getRemotePeerReadTime(e),this._messageRemindHandler.getC2CMessageRemindType(e)}},{key:"_onNewGroupConversation",value:function(e){var t=this.get(7);t&&t.getMessageRemindType(e)}},{key:"_setStorageConversationList",value:function(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],t=this.getLocalConversationList().filter(function(n){return n.type===g.CONV_C2C||n.type===g.CONV_GROUP&&n.lastMessage.type!==g.MSG_GRP_TIP}).slice(0,20).map(function(n){return{conversationID:n.conversationID,type:n.type,subType:n.subType,lastMessage:n.lastMessage,groupProfile:n.groupProfile,userProfile:n.userProfile}});this.get(13).setItem("conversationMap",t,e)}},{key:"emitConversationUpdate",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n=this.getLocalConversationList();!t||(t=this.get(7))&&t.updateGroupLastMessage(n),e&&(this.emitOuterEvent(K.CONVERSATION_LIST_UPDATED),this.emitTotalUnreadMessageCountUpdate())}},{key:"getLocalConversationList",value:function(){var e=this;return b(this._conversationMap.values()).filter(function(t){return e._isConvNeedShow(t.conversationID)})}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n="syncConversationList",o=new R(n);return this._pagingStatus===an&&this._conversationMap.clear(),this._pagingGetConversationList(t).then(function(i){var a=sr(e._pagingGetCostList),s=ar(e._pagingGetCostList),s=(e._pagingGetCostList.length=0,e._pagingStatus=mo,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e.emitInnerEvent(we.CONV_SYNC_COMPLETED),"count:".concat(e._conversationMap.size," sum:").concat(s," avg:").concat(a));return u.l("".concat(e._n,".").concat(n,". ").concat(s)),o.setMessage(s).end(),i}).catch(function(i){return e._pagingStatus=zn,o.setMessage(e._pagingTimeStamp).setError(i).end(),v(i)})}},{key:"_diffAndDeleteConversation",value:function(){var e,t=this;this._isSyncCompleted()&&(e=[],this._conversationMap.forEach(function(n,o){!t._pagingConvIDMap.has(o)&&t._convIDFromUnreadDBMap.has(o)&&(t._conversationMap.delete(o),e.push(o))}),u.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(e)),e=null)}},{key:"_pagingGetConversationList",value:function(){var e=this,t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n="".concat(this._n,"._pagingGetConversationList"),o=(u.l("".concat(n," incrementalPullFlag:").concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex)),Date.now());return this._pagingStatus=hr,this.req({proto:h.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:t?this._pagingTimeStamp:0,startIndex:t?this._pagingStartIndex:0,pinnedTimeStamp:t?this._pagingPinnedTimeStamp:0,pinnedStartIndex:t?this._pagingPinnedStartIndex:0,orderType:1}}).then(function(_){var _=_.data,a=_.completeFlag,s=_.conversations,s=s===void 0?[]:s,r=_.timeStamp,c=_.startIndex,d=_.pinnedTimeStamp,p=_.pinnedStartIndex,_=_.groupItem;if(e._pagingGetCostList.push(Je(o,!1)),u.l("".concat(n," ok. completeFlag:").concat(a," count:").concat(s.length," cost:").concat(Je(o))),e._convGroupHandler.onConvGroupListSynced(_),0<s.length&&(_=e._getConversationOptions(s),e._pagingConvIDMap=new Map([].concat(b(e._pagingConvIDMap),b(_.map(function(m){return[m.conversationID,1]})))),e._updateLocalConversationList({conversationOptionsList:_,isFromGetConversations:!0,updateUnreadCount:!0}),e.isLoggedIn()&&e.emitConversationUpdate()),!e._isReady){if(!e.isLoggedIn())return $();e.triggerReady()}return e._pagingTimeStamp=r,e._pagingStartIndex=c,e._pagingPinnedTimeStamp=d,e._pagingPinnedStartIndex=p,a!==1?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),$())}).catch(function(i){throw e.isLoggedIn()&&(e._isReady||(u.w("".concat(n," failed. error:"),i),e.triggerReady())),i})}},{key:"_updateLocalConversationList",value:function(o){var t=o.isFromGetConversations,n=Date.now(),o=this._getTmpConversationListMapping(o);this._conversationMap=new Map(this._sortConversationList([].concat(b(o.toBeUpdatedConversationList),b(this._conversationMap)))),t||this._updateUserOrGroupProfile(o.newConversationList),u.l("".concat(this._n,"._updateLocalConversationList cost:").concat(Je(n)))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,o=e.isInstantMessage,i=e.isUnreadC2CMessage,a=i!==void 0&&i,s=e.updateUnreadCount,r=[],c=[],d=this.get(7),p=this.get(8),_=this.isIntl(),m=this.isUsingChatCore(),f=0,I=t.length;f<I;f++){var N,P,H,Z,le=new Di(t[f],_,m),be=le.conversationID;this._isNonExistentAccount(be)||(this._conversationMap.has(be)?(N=this._conversationMap.get(be),!(P=["unreadCount","allowType","adminForbidType","payload"])===o?P.push("lastMessage"):P.push("isPinned"),Z=t[f].lastMessage,(H=!D(Z))||t[f].type===g.CONV_TOPIC||this._onLastMessageNotExist(t[f]),D(o)&&H&&N.lastMessage.payload===null&&(N.lastMessage.payload=Z.payload),L(N.lastMessage.revoker)||(N.lastMessage.revoker=null),bt(N,le,P,[null,void 0,"",0,NaN]),s===!0&&N.updateUnreadCount({nextUnreadCount:le.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:a}),o&&H&&(Z.payload&&(N.lastMessage.payload=Z.payload),N.type===g.CONV_GROUP&&(N.lastMessage.nameCard=Z.nameCard,N.lastMessage.nick=Z.nick)),H&&N.lastMessage.cloudCustomData!==Z.cloudCustomData&&(N.lastMessage.cloudCustomData=Z.cloudCustomData||""),this._conversationMap.delete(be),r.push([be,N])):(le.type===g.CONV_GROUP&&d?(P=le.groupProfile.groupID,(H=d.getLocalGroupProfile(P))&&(le.groupProfile=H,s===!0&&le.updateUnreadCount({nextUnreadCount:0}))):le.type===g.CONV_C2C&&(Z=be.replace(g.CONV_C2C,""),p&&p.isMyFriend(Z)&&(le.remark=p.getFriendRemark(Z))),c.push(le),r.push([be,le])))}for(var it,at,pt,Zo=this.get(10),Qo=r.length,Qn=0;Qn<Qo;Qn++)r[Qn][1].type===g.CONV_TOPIC&&(it=(pt=r[Qn][1]).conversationID,at=pt.unreadCount,pt=pt.groupAtInfoList,Zo.onConversationProxy({topicID:it.replace(g.CONV_GROUP,""),unreadCount:at,groupAtInfoList:L(pt)?void 0:pt}));return{toBeUpdatedConversationList:r,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new R("lastMessageNotExist").setMessage(JSON.stringify(e)).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],o=[],i=[];return e.forEach(function(a){(a[1].isPinned===!0?L(a[1].lastMessage.lastTime)?n:t:L(a[1].lastMessage.lastTime)?i:o).push(a)}),t.sort(function(a,s){return s[1].lastMessage.lastTime-a[1].lastMessage.lastTime}).concat(n).concat(o.sort(function(a,s){return s[1].lastMessage.lastTime-a[1].lastMessage.lastTime})).concat(i)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(b(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t,n,o,i,a=this;e.length!==0&&(t=[],n=[],o=this.get(4),i=this.get(7),e.forEach(function(s){var r;s.type===g.CONV_C2C?t.push(s.toAccount):s.type===g.CONV_GROUP&&(r=s.toAccount,i.hasLocalGroup(r)?s.groupProfile=i.getLocalGroupProfile(r):n.push(r))}),u.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(t," groupIDList:").concat(n)),0<t.length&&o.getUserProfile({userIDList:t}).then(function(s){s=s.data,q(s)?s.forEach(function(r){a._doUpdateUserProfile("C2C".concat(r.userID),r)}):a._doUpdateUserProfile("C2C".concat(s.userID),s)}),0<n.length&&i.getGroupProfileAdvance({groupIDList:n,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then(function(s){s.data.successGroupList.forEach(function(r){var c="GROUP".concat(r.groupID);a._conversationMap.has(c)&&(c=a._conversationMap.get(c),bt(c.groupProfile,r,[],[null,void 0,"",0,NaN]),!c.subType&&r.type&&(c.subType=r.type))})}))}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t)}},{key:"_getConversationOptions",value:function(i){var t=this,n=[],i=i.filter(function(r){var s=r.type,r=r.userID;return s===1&&!t._isNonExistentAccount(r)||s===2}),o=this.getMyUserID(),i=i.map(function(a){var s;return D(a.lastMsg)&&(a.lastMsg={elements:[]}),a.type===1?(s={userID:a.userID,nick:a.peerNick,avatar:a.peerAvatar},n.push(s),{conversationID:"C2C".concat(a.userID),type:"C2C",lastMessage:{lastTime:a.time,lastSequence:a.sequence,fromAccount:a.lastC2CMsgFromAccount,type:a.lastMsg.elements[0]?a.lastMsg.elements[0].type:null,payload:a.lastMsg.elements[0]?t._amendLayersOverLimitProperty(a.lastMsg.elements[0].content):null,cloudCustomData:a.lastMsg.cloudCustomData||"",isRevoked:a.lastMessageFlag===8,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:a.lastC2CMsgFromAccount===o&&a.time<=a.c2cPeerReadTime,revoker:a.lastMsg.revokerInfo?a.lastMsg.revokerInfo.revoker:null},userProfile:new Mo(s),peerReadTime:a.c2cPeerReadTime,isPinned:a.isPinned===1,customData:a.customMark||"",markList:vi(a.standardMark),conversationGroupList:t._convGroupHandler.getConvGroupListByID(a.contactGroupId),remark:a.friendRemark||"",messageRemindType:t._transMessageRemindType(a.messageRemindType)}):{conversationID:"GROUP".concat(a.groupID),type:"GROUP",lastMessage:l(l({lastTime:a.time,lastSequence:a.sequence,fromAccount:a.msgGroupFromAccount},t._patchTypeAndPayload(a)),{},{cloudCustomData:a.lastMsg.cloudCustomData||"",isRevoked:a.lastMessageFlag===2,onlineOnlyFlag:!1,nick:a.senderNick||"",nameCard:a.senderNameCard||"",revoker:a.lastMsg.revokerInfo?a.lastMsg.revokerInfo.revoker:null}),groupProfile:new vn({groupID:a.groupID,name:a.groupNick,avatar:a.groupImage,type:a.groupType,nextMessageSeq:a.nextMessageSeq}),unreadCount:t._computeGroupUnreadCount(a),peerReadTime:0,isPinned:a.isPinned===1,version:0,customData:a.customMark||"",markList:vi(a.standardMark),conversationGroupList:t._convGroupHandler.getConvGroupListByID(a.contactGroupId),messageRemindType:t._transMessageRemindType(a.messageRemindType)}});return 0<n.length&&this.get(4).onConversationsProfileUpdated(n),i}},{key:"_transMessageRemindType",value:function(e){var t="";return e===0?t=g.MSG_REMIND_ACPT_AND_NOTE:e===1?t=g.MSG_REMIND_DISCARD:e===2&&(t=g.MSG_REMIND_ACPT_NOT_NOTE),t}},{key:"_computeGroupUnreadCount",value:function(t){var n=t.unreadCount,t=t.noUnreadCount,n=(n===void 0?0:n)-(t===void 0?0:t);return 0<n?n:0}},{key:"_patchTypeAndPayload",value:function(o){var o=o.lastMsg,t=o.event,n=o.elements,n=n===void 0?[]:n,o=o.groupTips,o=o===void 0?{}:o;return D(t===void 0?void 0:t)||L(o)?{type:n[0]?n[0].type:null,payload:n[0]?this._amendLayersOverLimitProperty(n[0].content):null}:((t=new Xe(o)).setElement({type:g.MSG_GRP_TIP,content:l(l({},o.elements),{},{groupProfile:o.groupProfile})}),n=JSON.parse(JSON.stringify(t.payload)),t=null,{type:g.MSG_GRP_TIP,payload:n})}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return t===0?e.layersOverLimit=!1:t===1&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof Xe&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){q(e)&&(e=e.map(function(i){var n=i.type,o=i.userID,i=i.groupID;return n===1?"".concat(g.CONV_C2C).concat(o):n===2?"".concat(g.CONV_GROUP).concat(i):void 0}),u.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(e)),this.deleteLocalConversationList(e))}},{key:"onConversationPinned",value:function(e){var t,n=this;q(e)&&(t=!1,e.forEach(function(r){var i,a=r.type,s=r.userID,r=r.groupID;a===1?i=n.getLocalConversation("".concat(g.CONV_C2C).concat(s)):a===2&&(i=n.getLocalConversation("".concat(g.CONV_GROUP).concat(r))),i&&(u.l("".concat(n._n,".onConversationPinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned||(i.isPinned=!0,t=!0))}),t&&this._sortConversationListAndEmitEvent())}},{key:"onConversationUnpinned",value:function(e){var t,n=this;q(e)&&(t=!1,e.forEach(function(r){var i,a=r.type,s=r.userID,r=r.groupID;a===1?i=n.getLocalConversation("".concat(g.CONV_C2C).concat(s)):a===2&&(i=n.getLocalConversation("".concat(g.CONV_GROUP).concat(r))),i&&(u.l("".concat(n._n,".onConversationUnpinned conversationID:").concat(i.conversationID," isPinned:").concat(i.isPinned)),i.isPinned&&(i.isPinned=!1,t=!0))}),t&&this._sortConversationListAndEmitEvent())}},{key:"getMessageList",value:function(i){var t=this,n=i.conversationID,o=i.nextReqMessageID,i=i.count,a="".concat(this._n,".getMessageList"),c=this.getLocalConversation(n),s="";if(c&&c.groupProfile&&(s=c.groupProfile.type),et(s))return u.l("".concat(a," not available in avchatroom. conversationID:").concat(n)),$({messageList:[],nextReqMessageID:"",isCompleted:!0});(D(i)||15<i)&&(i=15),!o&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var r=this._computeRemainingCount({conversationID:n,nextReqMessageID:o}),c=this._completedMap.has(n);return u.l("".concat(a," conversationID:").concat(n," nextReqMessageID:").concat(o)+" remainingCount:".concat(r," count:").concat(i," isCompleted:").concat(c)),this._needGetHistory({conversationID:n,remainingCount:r,count:i})?this.getHistoryMessages({conversationID:n,nextReqMessageID:o,count:20}).then(function(I){var f=I.nextReqID,I=I.storedMessageList,p=t._completedMap.has(n),_=I,m={nextReqMessageID:p?"":f,messageList:_=0<r?t._messageListHandler.getLocalMessageList(n).slice(0,I.length+r):_,isCompleted:p},f=m.messageList.filter(function(N){return N.isRevoked})||[],I=_.map(function(N){return N.sequence});return u.l("".concat(a," ret.nextReqMessageID:").concat(m.nextReqMessageID," ret.isCompleted:").concat(m.isCompleted," ret.length:").concat(_.length," sequenceList:").concat(I)),q(f)&&f.length!==0?t.updateRevokerInfo(f).then(function(N){return N.forEach(function(P){var H=P.revokerInfo;m.messageList=m.messageList.map(function(Z){return Z.ID===P.ID&&H&&(Z.revokeReason=H.reason||"",Z.revokerInfo={userID:H.revoker||Z.revoker,nick:H.nick,avatar:H.avatar}),Z})}),V(m)}):V(m)}):(this.modifyMessageList(n),s=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:o,count:i}),$(s))}},{key:"_getMessageListFromMemory",value:function(o){var t=o.conversationID,n=o.nextReqMessageID,o=o.count,i="".concat(this._n,"._getMessageListFromMemory"),a=this._messageListHandler.getLocalMessageList(t),s=a.length,r=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(r=a.findIndex(function(d){return d.ID===n}))>o?(c.messageList=a.slice(r-o,r),c.nextReqMessageID=a[r-o].ID):(c.messageList=a.slice(0,r),c.isCompleted=!0):o<s?(c.messageList=a.slice(r=s-o,s),c.nextReqMessageID=a[r].ID):(c.messageList=a.slice(0,s),c.isCompleted=!0),u.l("".concat(i," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(r){var t,n,o=r.conversationID,i=r.sequence,a=r.time,s=r.count,r=r.direction,r=r===void 0?0:r;return(D(s)||15<s)&&(s=15),o.startsWith(g.CONV_C2C)?(t=this.get(6),n=o.replace(g.CONV_C2C,""),t.getRoamingMessagesHopping({peerAccount:n,time:a,count:s,direction:r})):o.startsWith(g.CONV_GROUP)?(t=this.get(7),n=o.replace(g.CONV_GROUP,""),t.getRoamingMessagesHopping({groupID:n,sequence:i,count:s,direction:r})):void 0}},{key:"_computeRemainingCount",value:function(o){var t=o.conversationID,n=o.nextReqMessageID,o=this._messageListHandler.getLocalMessageList(t),i=o.length;return n?(i=0,ct(t)?i=o.findIndex(function(a){return a.ID===n}):ot(t)&&(i=n.indexOf("-")!==-1?o.findIndex(function(a){return a.ID===n}):o.findIndex(function(a){return a.sequence===n})),i=i===-1?0:i):i}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(o){var t=o.conversationID,n=o.remainingCount,o=o.count,i=this.getLocalConversation(t),a="";if(i&&i.groupProfile&&(a=i.groupProfile.type),Kn(t)||et(a))return!1;if(i=!1,a="".concat(this._n,"._needGetHistory conversationID:").concat(t),ot(t)){var s=this._isPagingGetGroupListCompleted(),r=this._getLocalGroupCount(),c=this._hasLocalGroup(t),d=this._isTopicConversation(t);if(u.l("".concat(a," isGroupListCompleted:").concat(s," localGroupCount:").concat(r)+" isGroupInList:".concat(c," isTopic:").concat(d)),s&&r<=500&&!c&&!d)return i}return i=n<=o&&!this._completedMap.has(t),u.l("".concat(a," ret:").concat(i)),i}},{key:"_isTopicConversation",value:function(e){return e=e.replace(g.CONV_GROUP,""),We(e)}},{key:"getHistoryMessages",value:function(o){var t=o.conversationID,o=o.count;if(t===g.CONV_SYSTEM)return $();var n=15,o=(20<o&&(n=20),null);if(ct(t))return i=this._roamingMessageKeyAndTimeMap.has(t),(o=this.get(6))?o.getRoamingMessage({conversationID:t,peerAccount:t.replace(g.CONV_C2C,""),count:n,lastMessageTime:i?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:i?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):v({code:M.CANNOT_FIND_MODULE});if(ot(t)){if(!(o=this.get(7)))return v({code:M.CANNOT_FIND_MODULE});var i=t.replace(g.CONV_GROUP,""),s=null,a=0,s=((s=this._conversationMap.has(t)&&!We(i)?this._conversationMap.get(t).lastMessage:s)&&(a=s.lastSequence),this._roamingMessageSequenceMap.get(t));return o.getRoamingMessage({conversationID:t,groupID:i,count:n,sequence:s||a})}return $()}},{key:"patchConversationLastMessage",value:function(e){var t,n,o=this.getLocalConversation(e);o&&(t=(n=o.lastMessage).messageForShow,n=n.payload,!L(t)&&!L(n)||(t=this._messageListHandler.getLocalMessageList(e)).length!==0&&(n=t[t.length-1],u.l("".concat(this._n,".patchConversationLastMessage conversationID:").concat(e," payload:"),n.payload),o.updateLastMessage(n)))}},{key:"onRoamingMessage",value:function(){for(var e,t,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],o=1<arguments.length?arguments[1]:void 0,i=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],a=o.startsWith(g.CONV_C2C)?g.CONV_C2C:g.CONV_GROUP,s=null,r=[],c=[],f=0,I=n.length,d=a===g.CONV_GROUP,p=this.getFileDownloadProxy(),_=function(){d?--f:++f},m=function(){return d?I<=f:f<I},f=d?n.length-1:0,I=d?0:n.length;m();_())d&&n[f].sequence===1&&i&&this.setCompleted(o),n[f].isPlaceMessage!==1&&((s=new Xe(n[f])).to=n[f].to,a!==g.CONV_GROUP||D(n[f].topicID)||(s.to=n[f].topicID),s.isSystemMessage=!!n[f].isSystemMessage,s.conversationType=a,e=n[f].event===4?{type:g.MSG_GRP_TIP,content:l(l({},n[f].elements),{},{groupProfile:n[f].groupProfile})}:n[f].elements,d||s.setNickAndAvatar({nick:n[f].nick,avatar:n[f].avatar}),L(e)?((t=new R("emptyMessageBody")).setMessage("from:".concat(s.from," to:").concat(s.to," sequence:").concat(s.sequence," event:").concat(n[f].event)),t.setLevel("warning").end()):(s.setElement(e,p),s.reInitialize(this.getMyUserID()),r.push(s)));return _=m=null,i?(this._messageListHandler.unshift(r,c),r=null,c):(c=null,r)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;return e.startsWith(g.CONV_GROUP)&&this._isTopicConversation(e)&&(e=je(e.replace(g.CONV_GROUP,"")),this.get(7).hasLocalGroup(e)||(t=!0)),t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;rt({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach(function(n){t._completedMap.delete(n),t._roamingMessageSequenceMap.delete(n)})}},{key:"deleteGroupRoamingMessageInfo",value:function(e){e="".concat(g.CONV_GROUP).concat(e),this._completedMap.delete(e),this._roamingMessageSequenceMap.delete(e)}},{key:"setMessageRead",value:function(o){var t=o.conversationID,n=this.getLocalConversation(t),o="".concat(this._n,".setMessageRead");if(u.l("".concat(o," conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n||(n.type!==g.CONV_GROUP&&n.type!==g.CONV_TOPIC||L(n.groupAtInfoList)||this.deleteGroupAtTips(t),n.unreadCount===0))return $();if(n.type===g.CONV_GROUP&&!this._hasLocalGroup(t))return n.unreadCount!==0&&(n.unreadCount=0,this.emitConversationUpdate(!0,!1)),$();var i=this._messageListHandler.getLocalLastMessage(t),a=n.lastMessage.lastTime,s=this._messageListHandler.getLocalMaxTime(t),s=(a<s&&(u.l("".concat(o," update lastMessageTime from ").concat(a," to ").concat(s)),a=s),this._messageListHandler.getLocalMaxSequence(t)),r=n.lastMessage.lastSequence,c=(r<s&&(u.l("".concat(o," update lastMessageSeq from ").concat(r," to ").concat(s)),r=s),n.type===g.CONV_TOPIC&&D(i)&&(o=this.get(10),i=je(s=t.replace(g.CONV_GROUP,"")),(o=o.getLocalTopic(i,s))&&(r=o.nextMessageSeq-1)),null);switch(n.type){case g.CONV_C2C:return(c=this.get(6))?c.setMessageRead({conversationID:t,lastMessageTime:a}):v({code:M.CANNOT_FIND_MODULE});case g.CONV_GROUP:case g.CONV_TOPIC:return(c=this.get(7))?c.setMessageRead({conversationID:t,lastMessageSeq:r}):v({code:M.CANNOT_FIND_MODULE});case g.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),$();default:return $()}}},{key:"setAllMessageRead",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},n="setAllMessageRead",o="".concat(this._n,".").concat(n),i=(t.scope||(t.scope=g.READ_ALL_MSG),u.l("".concat(o," options:"),t),this._createSetAllMessageReadPack(t));if(i.readAllC2CMessage===0&&i.groupMessageReadInfoList.length===0)return $();var a=new R(n);return this.req({proto:h.SET_ALL_MSG_READ,data:i}).then(function(s){return s=s.data,s=e._handleAllMessageRead(s),a.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(s))).end(),$()}).catch(function(s){return a.setError(s).end(),u.w("".concat(o," failed. error:"),s),v({code:s&&s.code?s.code:M.MSG_UNREAD_ALL_FAIL,message:s&&s.message?s.message:void 0})})}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(n){var t=this._messageListHandler.getLocalLastMessage(n.conversationID),n=n.lastMessage.lastSequence;return n=t&&n<t.sequence?t.sequence:n}},{key:"_getConversationLastMessageTime",value:function(n){var t=this._messageListHandler.getLocalLastMessage(n.conversationID),n=n.lastMessage.lastTime;return n=t&&n<t.time?t.time:n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},o=e.scope,i=Re(this._conversationMap);try{for(i.s();!(t=i.n()).done;){var a,s=z(t.value,2)[1];if(0<s.unreadCount)if(s.type===g.CONV_C2C&&n.readAllC2CMessage===0){if(o===g.READ_ALL_MSG)n.readAllC2CMessage=1;else if(o===g.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else s.type!==g.CONV_GROUP||o!==g.READ_ALL_GROUP_MSG&&o!==g.READ_ALL_MSG||(a=this._getConversationLastMessageSequence(s),n.groupMessageReadInfoList.push({groupID:s.groupProfile.groupID,messageSequence:a}))}}catch(r){i.e(r)}finally{i.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(t){var n=t.groupMessageReadInfoList,t=t.readAllC2CMessage,n=this._parseGroupReadInfo(n);return 1<=this._updateAllConversationUnreadCount({readAllC2CMessage:t})&&this.emitConversationUpdate(!0,!1),n}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,o=e.length;n<o;n++){var r=e[n],i=r.groupID,a=r.sequence,s=r.retCode,r=r.lastMessageSeq;D(s)?this._remoteGroupReadSequenceMap.set(i,r):(this._remoteGroupReadSequenceMap.set(i,a),s!==0&&t.push("".concat(i,"-").concat(a,"-").concat(s)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,o=0,i=Re(this._conversationMap);try{for(i.s();!(t=i.n()).done;){var a,s,r,c,d=z(t.value,2),p=d[0],_=d[1];1<=_.unreadCount&&(n===1&&_.type===g.CONV_C2C?(a=this._getConversationLastMessageTime(_),this.updateIsReadAfterReadReport({conversationID:p,lastMessageTime:a})):_.type===g.CONV_GROUP&&(s=p.replace(g.CONV_GROUP,""),this._remoteGroupReadSequenceMap.has(s)&&(r=this._remoteGroupReadSequenceMap.get(s),c=this._getConversationLastMessageSequence(_),this.updateIsReadAfterReadReport({conversationID:p,remoteReadSequence:r}),r<=c&&this._remoteGroupReadSequenceMap.delete(s))),this.updateUnreadCount(p,!1)&&(o+=1))}}catch(m){i.e(m)}finally{i.f()}return o}},{key:"isRemoteRead",value:function(o){var t,n=o.conversationID,o=o.sequence,i=n.replace(g.CONV_GROUP,""),a=!1;return this._remoteGroupReadSequenceMap.has(i)&&(o<=(t=this._remoteGroupReadSequenceMap.get(i))&&(a=!0,u.l("".concat(this._n,".isRemoteRead conversationID:").concat(n," messageSequence:").concat(o," remoteReadSequence:").concat(t))),t+10<=o&&this._remoteGroupReadSequenceMap.delete(i)),a}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,i=this._messageListHandler.getLocalMessageList(t);if(i.length!==0){for(var a,s=i.length-1;0<=s;s--)if(a=i[s],!(o&&a.time>o||n&&a.sequence>n)){if(a.flow==="in"&&a.isRead)break;a.setIsRead(!0)}}}},{key:"updateUnreadCount",value:function(e){var t,n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],o=!1,i=this.getLocalConversation(e),a=this._messageListHandler.getLocalMessageList(e);if(i)return(t=i.unreadCount)!==(a=a.filter(function(s){return!s.isRead&&!s._onlineOnlyFlag&&!s.isDeleted}).length)&&(i.unreadCount=a,o=!0,u.l("".concat(this._n,".updateUnreadCount from ").concat(t," to ").concat(a,", conversationID:").concat(e)),n===!0&&this.emitConversationUpdate(!0,!1)),o&&i.type===g.CONV_TOPIC&&(t=i.unreadCount,a=this.get(10),n=e.replace(g.CONV_GROUP,""),a.onConversationProxy({topicID:n,unreadCount:t})),o}},{key:"clearGroupAtInfoList",value:function(e){var t,n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],o=this.getLocalConversation(e);o&&0<o.groupAtInfoList.length&&(o.clearGroupAtInfoList(),u.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),o.type===g.CONV_TOPIC&&(o=o.groupAtInfoList,t=this.get(10),e=e.replace(g.CONV_GROUP,""),t.onConversationProxy({topicID:e,groupAtInfoList:o})),n===!0&&this.emitConversationUpdate(!0,!1))}},{key:"updateReadReceiptInfo",value:function(e){var t,n,o,i=this,r=e.userID,a=r===void 0?void 0:r,r=e.groupID,s=r===void 0?void 0:r,r=e.readReceiptList;L(r)||(t=[],D(a)?D(s)||(n="".concat(g.CONV_GROUP).concat(s),r.forEach(function(p){var _=p.tinyID,m=p.clientTime,f=p.random,d=p.readCount,p=p.unreadCount,_="".concat(_,"-").concat(m,"-").concat(f),m=i._messageListHandler.getLocalMessage(n,_),f={groupID:s,messageID:_,readCount:0,unreadCount:0};m&&(ge(d)&&(m.readReceiptInfo.readCount=d,f.readCount=d),ge(p)&&(m.readReceiptInfo.unreadCount=p,f.unreadCount=p),t.push(f))})):(o="".concat(g.CONV_C2C).concat(a),r.forEach(function(d){var p=d.tinyID,_=d.clientTime,d=d.random,p="".concat(p,"-").concat(_,"-").concat(d),_=i._messageListHandler.getLocalMessage(o,p);_&&(_.readReceiptInfo.isPeerRead=!0,t.push({userID:a,messageID:p,isPeerRead:!0}))})),0<t.length&&this.emitOuterEvent(K.MESSAGE_READ_RECEIPT_RECEIVED,t))}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&n.length!==0&&!Kn(t.type)){for(var o=[],i=0,a=n.length;i<a;i++)n[i].flow!=="in"?n[i].flow!=="out"||n[i].isRead||n[i].setIsRead(!0):o.push(n[i]);var s=0;s=t.type===g.CONV_C2C?(e=o.slice(-t.unreadCount).filter(function(c){return c.isRevoked}).length,o.length-t.unreadCount-e):o.length-t.unreadCount;for(var r=0;r<s&&!o[r].isRead;r++)o[r].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips"),i=(u.l("".concat(n)),this._conversationMap.get(e));if(!i)return Promise.resolve();var o=i.groupAtInfoList;if(o.length===0)return Promise.resolve();var i=void 0,a=(e.startsWith(g.CONV_GROUP)&&(i=e.replace(g.CONV_GROUP,"")),b(o));if((rt({groupID:i})||We(i))&&(a=o.filter(function(r){return!r.atTypeArray.includes(g.CONV_AT_ALL)})).length===0)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var s=this.getMyUserID();return this.req({proto:h.DEL_GROUP_AT_TIPS,data:{messageListToDelete:a.map(function(r){return{from:r.from,to:s,messageSeq:r.__sequence,messageRandom:r.__random,groupID:D(r.topicID)?r.groupID:r.topicID}})}}).then(function(){return u.l("".concat(n," ok. count:").concat(o.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()}).catch(function(r){return u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"appendToMessageList",value:function(e){return this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n||(e.push(t),0))}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){(!this._peerReadTimeMap.has(e)||this._peerReadTimeMap.get(e)<t)&&this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n;e.startsWith(g.CONV_C2C)&&0<t&&(0<(n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t)).length&&this.emitOuterEvent(K.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)&&(L(n=this._conversationMap.get(e).lastMessage)||n.fromAccount===this.getMyUserID()&&n.lastTime<=t&&!n.isPeerRead&&(n.isPeerRead=!0,this.emitConversationUpdate(!0,!1))))}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){u.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getConversationList"),i="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(e);return u.l("".concat(o,". ").concat(i)),this._pagingStatus===zn?((t=new R("getConversationList")).setMessage(i),this.syncConversationList().then(function(){t.end();var a=n._getConversationList(e);return V({conversationList:a,isSyncCompleted:n._isSyncCompleted()})}).catch(function(a){return t.setError(a).end(),u.e("".concat(o," failed. error:"),a),v(a)})):(i=this._getConversationList(e),u.l("".concat(o,". returned conversation count:").concat(i.length)),$({conversationList:i,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConversationList",value:function(e){return D(e)?this.getLocalConversationList():q(e)?e.length===0?[]:this.getLocalConversationList().filter(function(i){return e.includes(i.conversationID)}):Ie(e)?(t=e.type,n=e.markType,o=e.groupName,this.getLocalConversationList().filter(function(i){return(t!==g.CONV_C2C&&t!==g.CONV_GROUP||i.type===t)&&(!ne(o)||i.conversationGroupList.includes(o))&&(!ge(n)||i.markList.includes(n))})):[];var t,n,o}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=Re(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=z(e.value,2),o=n[0],i=n[1];i.type===g.CONV_C2C&&(u.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(o," peerReadTime:").concat(i.peerReadTime)),this.recordPeerReadTime(o,i.peerReadTime))}}catch(a){t.e(a)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var e=this.get(7);return!e||e.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var e=this.get(7);return e?e.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(e){var t=this.get(7);return!!t&&t.hasLocalGroup(e.replace(g.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new Di({conversationID:e,type:e.slice(0,3)===g.CONV_C2C?g.CONV_C2C:g.CONV_GROUP},this.isIntl(),this.isUsingChatCore()))._isInfoCompleted||t.type===g.CONV_SYSTEM)return $({conversation:t});if(ot(e)&&!this._hasLocalGroup(e))return $({conversation:t});var o="".concat(this._n,".").concat("getConversationProfile"),i=new R("getConversationProfile");return u.l("".concat(o,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then(function(a){i.setMessage("conversationID:".concat(e," unreadCount:").concat(a.data.conversation.unreadCount)).end();var s,r=n.get(8);return r&&t.type===g.CONV_C2C&&(s=e.replace(g.CONV_C2C,""),r.isMyFriend(s)&&(r=r.getFriendRemark(s),t.remark!==r&&(t.remark=r,u.l("".concat(o,". conversationID:").concat(e," patch remark:").concat(t.remark))))),u.l("".concat(o," ok. conversationID:").concat(e)),a}).catch(function(a){return i.setError(a).setMessage("conversationID:".concat(e)).end(),u.e("".concat(o," failed. error:"),a),v(a)})}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===g.CONV_C2C?this.get(4).getUserProfile({userIDList:[e.toAccount]}).then(function(n){return n=n.data,n.length===0?v(new Oe({code:M.USER_OR_GRP_NOT_FOUND})):(e.userProfile=n[0],e._isInfoCompleted=!0,t._unshiftConversation(e),$({conversation:e}))}):this.get(7).getGroupProfile({groupID:e.toAccount}).then(function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),$({conversation:e})})}},{key:"_unshiftConversation",value:function(e){e instanceof Di&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(b(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach(function(n){var o=n.userID;o===t.getMyUserID()?t._onMyProfileModified({latestNick:n.nick,latestAvatar:n.avatar}):(o=t._conversationMap.get("".concat(g.CONV_C2C).concat(o)))&&(o.userProfile=n)})}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===mo}},{key:"_errorLog",value:function(e,t,n,o){var i=new Error("Params validate failed."),a="".concat(this.getErrorMessage("API_REFER")).concat(e);throw u.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,o),", ").concat(a)),u.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),i}},{key:"_isValidConversationID",value:function(e){return ct(e)||ot(e)||Kn(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return ne(e)||dt(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),ne(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),u.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(q(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),e.conversationIDList.length===0&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach(function(o){t._isValidConversationID(o)||t._errorLog(n,"conversationIDList","InvalidConversationID",o)}),"clearHistoryMessage"in e&&typeof e.clearHistoryMessage!="boolean"&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),100<e.conversationIDList.length&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(o){var t=o.conversationIDList,t=t===void 0?[]:t,n=o.clearHistoryMessage,n=n===void 0||n,o=o.flag,i=o===void 0?0:o,a="".concat(this._n,".").concat("deleteConversationList"),s=(u.l("".concat(a," conversationIDList.length:").concat(t.length," clearHistoryMessage:").concat(n)),new R("deleteConversationList"));return s.setMessage("conversationIDList:".concat(t)),Promise.all([this.rmLocalOnlyConversationList(t),this.rmLocalAndRemoteConversationList(t,n)]).then(function(r){return s.end(),r=[].concat(b(r[0]),b(r[1])),r.length===0?v(new Oe({code:M.CONV_NOT_FOUND})):(u.l("".concat(a," ok")),$(i===1?{conversationID:r[0]}:{conversationIDList:r}))}).catch(function(r){return s.setError(r).end(),u.e("".concat(a," failed. error:"),r),v(r)})}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter(function(n){if(!t._conversationMap.has(n))return!1;var o=t.getLocalConversation(n).type;return o!==g.CONV_GROUP||t._hasLocalGroup(n)?o===g.CONV_SYSTEM&&(t.get(7).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(n)}),t.deleteLocalConversation(n),!0):(t.deleteLocalConversation(n),!0)})}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,o={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach(function(i){var a;n._conversationMap.has(i)&&((a=n.getLocalConversation(i).type)===g.CONV_C2C?o.conversationList.push({toAccount:i.replace(a,""),type:1}):a===g.CONV_GROUP&&n._hasLocalGroup(i)&&o.conversationList.push({toGroupID:i.replace(a,""),type:2}))}),o.conversationList.length===0?[]:this.req({proto:h.DEL_CONV,data:o}).then(function(i){var a=[];return 0<i.data.resultList.length&&i.data.resultList.map(function(s){s.code===0&&(s=s.type===1?"".concat(g.CONV_C2C).concat(s.to):"".concat(g.CONV_GROUP).concat(s.groupID),a.push(s))}),n.deleteLocalConversationList(a),a})}},{key:"setConversationDraft",value:function(n){var t=n.conversationID,n=n.draftText,o="".concat(this._n,".").concat("setConversationDraft");return u.l("".concat(o," conversationID:").concat(t," draftText:").concat(n)),this._conversationMap.has(t)?(o=this._conversationMap.get(t),o.setDraftText(n),$({code:0,conversation:o})):v({code:M.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return v({code:M.CONV_NOT_FOUND});var o=this._conversationMap.get(e).type;if(o===g.CONV_C2C)n.type=1,n.toAccount=e.replace(g.CONV_C2C,"");else{if(o!==g.CONV_GROUP)return o===g.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),$({conversationID:e})):v({code:M.CONV_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(g.CONV_GROUP,"")}var i="".concat(this._n,".").concat("clearHistoryMessage"),a=new R("clearHistoryMessage");return a.setMessage("conversationID:".concat(e)),u.l("".concat(i,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then(function(){return t.req({proto:h.CLEAR_HISTORY_MSG,data:n})}).then(function(){a.end(),u.l("".concat(i," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var s=t.getLocalConversation(e);return s&&(s.updateLastMessage(),t._sortConversationListAndEmitEvent()),$({conversationID:e})}).catch(function(s){return a.setError(s).end(),u.e("".concat(i," failed. error:"),s),v(s)})}},{key:"pinConversation",value:function(r){var t=this,n=r.conversationID,o=r.isPinned;if(!this._conversationMap.has(n))return v({code:M.CONV_NOT_FOUND});var i=this.getLocalConversation(n);if(i.isPinned===o)return $({conversationID:n});var a="".concat(this._n,".").concat("pinConversation"),s=new R("pinConversation"),r=(s.setMessage("conversationID:".concat(n," isPinned:").concat(o)),u.l("".concat(a,". conversationID:").concat(n," isPinned:").concat(o)),null);return ct(n)?r={type:1,toAccount:n.replace(g.CONV_C2C,"")}:ot(n)&&(r={type:2,groupID:n.replace(g.CONV_GROUP,"")}),this.req({proto:h.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:o===!0?1:2,itemList:[r]}}).then(function(){return s.end(),u.l("".concat(a," ok")),i.isPinned!==o&&(i.isPinned=o,t._sortConversationListAndEmitEvent()),V({conversationID:n})}).catch(function(c){return s.setError(c).end(),u.e("".concat(a," failed. error:"),c),v(c)})}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,i=e.isC2CConversation,n=e.messageRemindType,o=!1,i=this.getLocalConversation("".concat(i?g.CONV_C2C:g.CONV_GROUP).concat(t));return i&&i.messageRemindType!==n&&(i.messageRemindType=n,o=!0),u.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(o)),o}},{key:"onC2CMessageRemindTypeFetched",value:function(e){var t,n=this;q(e)&&0<e.length&&(t=0,e.forEach(function(a){var i=a.userID,a=a.muteFlag,a=n._transMessageRemindType(a);n.patchMessageRemindType({ID:i,isC2CConversation:!0,messageRemindType:a})===!0&&(t+=1)}),u.l("".concat(this._n,".onC2CMessageRemindTypeFetched updateCount:").concat(t)),1<=t&&this.emitConversationUpdate(!0,!1))}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");u.d(n,e),e.dataList.forEach(function(o){var i;L(o.muteNotificationsSync)||(i=(o=o.muteNotificationsSync).to,o=o.muteFlag,o=t._transMessageRemindType(o),t.patchMessageRemindType({ID:i,isC2CConversation:!(i=0),messageRemindType:o})&&(i+=1),u.l("".concat(n," updateCount:").concat(i)),1<=i&&t.emitConversationUpdate(!0,!1))})}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){u.d("".concat(this._n,".onGroupMessageRemindTypeUpdated options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n=this._conversationMap.has(e);u.d("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)&&(n=!this._isTopicConversation(e),this.emitConversationUpdate(n,!1))}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=!1;e.forEach(function(o){t._conversationMap.has(o)&&(t.deleteLocalConversation(o,!1),n=!0)}),u.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(n)),n&&this.emitConversationUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){var t,n;e.startsWith(g.CONV_C2C)&&this._conversationMap.has(e)&&(n=this._conversationMap.get(e),t=Date.now(),this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:n.userProfile.nick,latestAvatar:n.userProfile.avatar}),n=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:n.nick,latestAvatar:n.avatar}),u.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost:").concat(Je(t))))}},{key:"updateUserProfileSpecifiedKey",value:function(o){u.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),o);var t=o.conversationID,n=o.nick,o=o.avatar;this._conversationMap.has(t)&&(t=this._conversationMap.get(t).userProfile,ne(n)&&t.nick!==n&&(t.nick=n),ne(o)&&t.avatar!==o&&(t.avatar=o),this.emitConversationUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(e){var t=this,n=this.getLocalConversationList(),o=Date.now();n.forEach(function(i){t.modifyMessageSentByMe(l({conversationID:i.conversationID},e))}),u.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(Je(o)))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e,t,n=this.get(8);this._conversationMap.size===0||!n||(e=b(this._conversationMap.values()).filter(function(o){return o.type===g.CONV_C2C})).length!==0&&(t=0,e.forEach(function(o){var i=o.conversationID.replace(g.CONV_C2C,"");n.isMyFriend(i)&&(i=n.getFriendRemark(i),o.remark!==i&&(o.remark=i,t+=1))}),u.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(e.length,", patched count:").concat(t)))}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===g.CONV_C2C?n=this._m.get(6):t.conversationType===g.CONV_GROUP&&(n=this._m.get(7)),n?n.sendReadReceipt(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===g.CONV_C2C?n=this._m.get(6):t.conversationType===g.CONV_GROUP&&(n=this._m.get(7)),n?n.getReadReceiptList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){return e=this.getLocalConversation(e),e?e.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach(function(n){n.type!==g.CONV_SYSTEM&&(n.messageRemindType!==""&&n.messageRemindType!==g.MSG_REMIND_ACPT_AND_NOTE||(t+=n.unreadCount))}),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(u.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(K.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(n){if(n=this.getLocalConversation(n),D(n))return!0;var t=n.type===g.CONV_TOPIC,n=n.type===g.CONV_GROUP&&n.groupProfile.type===g.GRP_ROOM;return!(t||n)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._setStorageConversationList(!0),this._pagingStatus=an,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this.resetReady()}}]),Eo),zc=(E(ja,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupTipsMap.size&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach(function(t,n){var o=e._checkCountMap.get(n),i=e._grpM.hasLocalGroup(n);u.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(i," checkCount:").concat(o)),i?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)})}},{key:"onNewGroupTips",value:function(o){u.d("".concat(this._n,".onReceiveGroupTips count:").concat(o.dataList.length));var o=this.newGroupTipsStoredAndSummary(o),t=o.eventDataList,n=o.result,o=o.AVChatRoomMessageList;0<o.length&&this._grpM.onAVChatRoomMessage(o),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:!0})),0<n.length&&(this._grpM.emitOuterEvent(K.MESSAGE_RECEIVED,n),this.handleMessageList(n))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var t=e.event,n=e.dataList,o=null,i=[],a=[],s={},r=[],c=0,d=n.length;c<d;c++){var p=co(n[c]);if(!(t===6&&(this._grpM.isGroupAttributesUpdatedNotice(p)||this._grpM.isGroupCountersNotice(p)))){var I=p.groupProfile,_=I.groupID,m=I.communityType,m=m===void 0?0:m,f=I.topicID,f=f===void 0?void 0:f,I=I.invisible,N=void 0,P=this._grpM.isMessageFromTopic(m,f),H=(P&&(N=g.CONV_TOPIC,p.to=f),this._grpM.hasLocalGroup(_));if(H||!this._grpM.isUnjoinedAVChatRoom(_))if(H||P)if(this._grpM.isMessageFromOrToAVChatroom(_))p.event=t,r.push(p);else if(p.currentUser=this._grpM.getMyUserID(),p.conversationType=g.CONV_GROUP,(o=new Xe(p)).setElement({type:g.MSG_GRP_TIP,content:l(l({},p.elements),{},{groupProfile:p.groupProfile})}),o.isSystemMessage=!1,I!==1){var H=this._grpM.get(11),P=o,I=P.conversationID,P=P.sequence;if(t===6)o._onlineOnlyFlag=!0,a.push(o);else if(!H.pushIntoNoticeResult(a,o))continue;this._grpM.isMessageFromCommunityOfTopic(m,f)||t===6&&H.getLocalConversation(I)||(t!==6&&this._qualityStat(o),m=H.isRemoteRead({conversationID:I,sequence:P}),D(s[I])?(f=0,o.flow==="in"&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||m||(f=1)),s[I]=i.push({conversationID:I,unreadCount:f,type:D(N)?o.conversationType:N,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1):(i[H=s[I]].type=o.conversationType,i[H].subType=o.conversationSubType,i[H].lastMessage=o._isExcludedFromLastMessage?"":o,o.flow==="in"&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||m||i[H].unreadCount++)))}else this._qualityStat(o);else this._cacheGroupTipsAndProbe({groupID:_,event:t,item:p})}}return{eventDataList:i,result:a,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e){this._grpM.get(26).addMessageSequence({key:Zn,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach(function(n){switch(n.payload.operationType){case 1:t._onNewMemberComeIn(n);break;case 2:t._onMemberQuit(n);break;case 3:t._onMemberKickedOut(n);break;case 4:t._onMemberSetAdmin(n);break;case 5:t._onMemberCancelledAdmin(n);break;case 6:t._onGroupProfileModified(n);break;case 7:t._onMemberInfoModified(n);break;case 8:t._onTopicProfileUpdated(n);break;default:u.w("".concat(t._n,".handleMessageList unknown operationType:").concat(n.payload.operationType))}})}},{key:"_onNewMemberComeIn",value:function(n){var n=n.payload,t=n.memberNum,n=n.groupProfile.groupID,n=this._grpM.getLocalGroupProfile(n);n&&ge(t)&&n.memberCount!==t&&(n.memberCount=t,this._updateConversationGroupProfile(n))}},{key:"_onMemberQuit",value:function(e){var n=e.payload,t=n.memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&ge(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConversationGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var n=e.payload,t=n.memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&ge(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConversationGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._grpM.get(11).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(n){var t=n.payload.groupProfile.groupID,n=n.payload.userIDList,o=this._grpM.getGroupMemberHandler();n.forEach(function(i){i=o.getLocalGroupMemberInfo(t,i),i&&i.updateRole(g.GRP_MBR_ROLE_ADMIN)})}},{key:"_onMemberCancelledAdmin",value:function(n){var t=n.payload.groupProfile.groupID,n=n.payload.userIDList,o=this._grpM.getGroupMemberHandler();n.forEach(function(i){i=o.getLocalGroupMemberInfo(t,i),i&&i.updateRole(g.GRP_MBR_ROLE_MEMBER)})}},{key:"_onGroupProfileModified",value:function(i){var t=this,i=i.payload,n=i.newGroupProfile,i=i.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(i),i=(Object.keys(n).forEach(function(a){switch(a){case"ownerID":t._ownerChanged(o,n);break;case"groupName":o.name=n[a];break;default:o[a]=n[a]}}),!o.isSupportTopic);this._grpM.emitGroupListUpdate(!0,i)}},{key:"_ownerChanged",value:function(n,t){var n=n.groupID,o=this._grpM.getLocalGroupProfile(n),i=this._grpM.getMyUserID();i===t.ownerID&&(o.updateGroup({selfInfo:{role:g.GRP_MBR_ROLE_OWNER}}),o=(t=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(n,i),i=this._grpM.getLocalGroupProfile(n).ownerID,t=t.getLocalGroupMemberInfo(n,i),o&&o.updateRole(g.GRP_MBR_ROLE_OWNER),t&&t.updateRole(g.GRP_MBR_ROLE_MEMBER))}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,o=e.payload,n=o.groupProfile,o=o.memberList,i=n.groupID,a=(We(t)&&this._updateTopicMuteTime(e),this._grpM.getGroupMemberHandler());o.forEach(function(s){var r=a.getLocalGroupMemberInfo(i,s.userID);r&&ge(s.muteTime)&&r.updateMuteUntil(s.muteTime)})}},{key:"_updateTopicMuteTime",value:function(o){var t=o.to,o=o.payload,i=o.groupProfile,o=o.memberList,n=o===void 0?[]:o,o=this._grpM.get(10),i=i.groupID,a=o.getLocalTopic(i,t);if(a){for(var s=!1,r=0;r<n.length;r++){var c=n[r];if(c.userID===this._grpM.getMyUserID()&&0<=c.muteTime){a.updateSelfInfo({muteTime:c.muteTime}),s=!0;break}}s&&this._grpM.emitOuterEvent(K.TOPIC_UPDATED,{groupID:i,topic:a})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=e.payload,t=n.groupProfile.groupID,n=n.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(l({groupID:t,topicID:e.to},n))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach(function(o){t.onNewGroupTips(o)}),this._deleteCachedGroupTips(e),u.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(i){var t=this,n=i.groupID,o=i.event,i=i.item;this._cacheGroupTips(n,{event:o,dataList:[i]}),this._grpM.getGroupSimplifiedInfo(n).then(function(a){a.type===g.GRP_AVCHATROOM?t._grpM.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._grpM.setUnjoinedAVChatRoom(n):(t._grpM.updateGroupMap([a]),t._notifyCachedGroupTips(n))}),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),u.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),ja),jc=(E(za,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupMessageMap.size&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach(function(t,n){var o=e._checkCountMap.get(n),i=e._grpM.hasLocalGroup(n);u.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(i," checkCount:").concat(o)),i?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)})}},{key:"handleUpdateGroupLastMessage",value:function(e){var t="".concat(this._n,".handleUpdateGroupLastMessage");if(this._grpM.getGroupMap().size!==0){for(var n,o,i,a,s=!1,r=0,c=e.length;r<c;r++)(n=e[r]).type===g.CONV_GROUP&&n.lastMessage.lastSequence!==0&&n.lastMessage.payload!==null&&(o=n.conversationID.split(/^GROUP/)[1],(o=this._grpM.getLocalGroupProfile(o))&&(i=o.lastMessage,a=n.lastMessage,JSON.stringify(i)!==JSON.stringify(a)&&(o.lastMessage=l({},n.lastMessage),s=!0)));u.l("".concat(t," conversation count:").concat(e.length,", local group count:").concat(this._grpM.getLocalGroupList().length," isGroupListUpdated:").concat(s)),s&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){u.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var o=this._newGroupMessageStoredAndSummary(e),t=o.conversationOptionsList,n=o.messageList,o=o.AVChatRoomMessageList,o=(0<o.length&&this._grpM.onAVChatRoomMessage(o),uo(n)),o=(0<o.length&&this._grpM.emitOuterEvent(K.MESSAGE_MODIFIED,o),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0})),lo(n));0<o.length&&this._grpM.emitOuterEvent(K.MESSAGE_RECEIVED,o),n.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=e.dataList,n=e.event,o=e.isInstantMessage,i=null,a=[],s=[],r=[],c={},d=this._grpM.getFileDownloadProxy(),p=t.length;1<p&&t.sort(function(pt,Zo){return pt.sequence-Zo.sequence});for(var _=this._grpM.get(11),m=this._grpM.get(4),f=0;f<p;f++){var I,N=co(t[f]),le=N.groupProfile,P=le.groupID,H=le.communityType,H=H===void 0?0:H,Z=le.topicID,Z=Z===void 0?void 0:Z,le=le.invisible,be=void 0,it=this._grpM.isMessageFromTopic(H,Z),at=(it&&(be=g.CONV_TOPIC,N.to=Z),this._grpM.hasLocalGroup(P));!at&&this._grpM.isUnjoinedAVChatRoom(P)||(at||it?this._grpM.isMessageFromOrToAVChatroom(P)?(N.event=n,r.push(N)):(N.currentUser=this._grpM.getMyUserID(),N.conversationType=g.CONV_GROUP,N.isSystemMessage=!!N.isSystemMessage,(i=new Xe(N)).setElement(N.elements,d),le!==1?(at=t[f].isModified===1,_.isMessageSentByCurrentInstance(i)?i.isModified=at:at=!1,N.onlineOnlyFlag===1?(i._onlineOnlyFlag=!0,_.isMessageSentByCurrentInstance(i)||s.push(i)):this._grpM.isMessageFromCommunityOfTopic(H,Z)?s.push(i):(i.from!==this._grpM.getMyUserID()||(it=_.getLatestMessageSentByMe(i.conversationID))&&(le=it.nick,H=it.avatar,le===i.nick&&H===i.avatar||(_.modifyMessageSentByMe({conversationID:I,latestNick:i.nick,latestAvatar:i.avatar}),m.mockOnNickAvatarModified(i.nick,i.avatar))),_.pushIntoMessageList(s,i,at)&&(this._qualityStat(o,i),I=(Z=i).conversationID,it=Z.sequence,le=_.isRemoteRead({conversationID:I,sequence:it}),D(c[I])?(H=0,i.flow==="in"&&(i._isExcludedFromUnreadCount||le||(H=1)),c[I]=a.push({conversationID:I,unreadCount:H,type:D(be)?i.conversationType:be,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(a[at=c[I]].type=D(be)?i.conversationType:be,a[at].subType=i.conversationSubType,a[at].lastMessage=i._isExcludedFromLastMessage?"":i,i.flow==="in"&&(i._isExcludedFromUnreadCount||le||a[at].unreadCount++))))):this._qualityStat(o,i)):this._cacheGroupMessageAndProbe({groupID:P,event:n,item:N}))}return{conversationOptionsList:a,messageList:s,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e,t){var n=this._grpM.get(26);n.addMessageSequence({key:Zn,message:t}),e&&0<t.clientTime&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this,n=this._grpM.get(11),o=[],i=[];e.dataList.forEach(function(a){var s=a.elements.revokedInfos,r=a.revokerInfo,c=a.groupProfile,d=!1;c&&(d=rt({groupID:c.groupID})||!L(c.topicID)),D(s)||s.forEach(function(p){var _,m=L(p.topicID)?"GROUP".concat(p.groupID):"GROUP".concat(p.topicID),f=n.getLocalConversation(m),I=p.revokerInfo&&p.revokerInfo.revoker||r&&r.revoker,N=r&&r.reason||"";f&&et(f.type)?_={conversationID:m,sequence:p.sequence,ID:"".concat(p.tinyID,"-").concat(p.clientTime,"-").concat(p.random)}:(f=n.revoke(m,p.sequence,p.random))?_=f:(_={conversationID:m,sequence:p.sequence},p.tinyID&&p.clientTime&&p.random&&(_.ID="".concat(p.tinyID,"-").concat(p.clientTime,"-").concat(p.random)),p.time&&(_.time=p.time)),_&&(_.revoker=I,_.revokeReason=N,_.revokerInfo={userID:I,nick:"",avatar:""},d?(_.revokerInfo.nick=c.nick,_.revokerInfo.avatar=c.avatar,o.push(_)):i.push(_))})}),i.length===0&&o.length===0||(n.onMessageRevoked([].concat(o,i)),0<o.length&&this._grpM.emitOuterEvent(K.MESSAGE_REVOKED,o),0<i.length&&n.updateRevokerInfo(i).then(function(a){t._grpM.emitOuterEvent(K.MESSAGE_REVOKED,a)}))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(b(this._grpM.getGroupMap())),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach(function(r){t.delete(r)}),this._grpM.getGroupMap().forEach(function(r,c){r.isSupportTopic&&t.delete(c)});for(var i=b(t.keys()),a=0,s=i.length;a<s;a++)this._grpM.deleteGroup(i[a])}},{key:"syncGroupList",value:function(){var e=this,i=0<arguments.length&&arguments[0]!==void 0&&arguments[0],t=(this._pagingStatus===an&&this._grpM.clearGroupMap(),["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"]),n=this.PAGING_GRP_COUNT_LIMIT,o=[];if(i===!0)return this._pagingGetGroupListWithTopic({limit:n,offset:0,groupBaseInfoFilter:t,groupList:o});var i="syncGroupList",a="".concat(this._n,".").concat(i),s=new R(i);return this._pagingGetGroupList({limit:n,offset:0,groupBaseInfoFilter:t,groupList:o}).then(function(){var r=sr(e._pagingGetCostList),c=ar(e._pagingGetCostList),d=(e._pagingGetCostList.length=0,e._pagingStatus=mo,e._groupListTreeShaking(o),e._grpM.updateGroupMap(o),e._grpM.getLocalGroupList().length),d="count:".concat(d," sum:").concat(c," avg:").concat(r);return u.l("".concat(a," ok. ").concat(d)),s.setMessage(d).end(),e.tempConversationList&&(e.handleUpdateGroupLastMessage(e.tempConversationList),e.tempConversationList=null),e._grpM.emitGroupListUpdate(!0,!0),V({groupList:e._grpM.getLocalGroupList()})}).catch(function(r){return e._pagingStatus=zn,s.setError(r).end(),u.e("".concat(a," failed. error:"),r),v(r)})}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList");if(u.l("".concat(t," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===zn||this._pagingStatus===an)return this.syncGroupList().then(function(){var o=e._grpM.getLocalGroupList();return V({groupList:o,isSyncCompleted:e.isPagingGetCompleted()})}).catch(function(o){return u.e("".concat(t," failed. error:"),o),v(o)});var n=this._grpM.getLocalGroupList();return u.l("".concat(t,". returned group count:").concat(n.length)),$({groupList:n,isSyncCompleted:this.isPagingGetCompleted()})}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===mo}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),o=e.isCommunityRelay,i=o!==void 0&&o,a=e.limit,s=e.offset,r=e.groupBaseInfoFilter,c=e.groupList,d=Date.now();return this._grpM.req({proto:h.GET_GRP_LIST,data:{type:i?g.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:a,offset:s,responseFilter:{groupBaseInfoFilter:r,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then(function(f){var f=f.data,_=f.groups,_=_===void 0?[]:_,f=f.totalCount,_=(c.push.apply(c,b(_)),t._handleGroupAtInfoWithoutTopic(i,_),s+a),m=!(_<f),f="offset:".concat(s," limit:").concat(a," totalCount:").concat(f," isCompleted:").concat(m," ")+"currentCount:".concat(c.length," isCommunityRelay:").concat(i);return t._pagingGetCostList.push(Je(d,!1)),u.l("".concat(n," ok. ").concat(f," cost:").concat(Je(d))),i||m?!i&&m?(u.l("".concat(n," start to get community list")),s=0,t._pagingGetGroupList({limit:a,offset:s,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):i&&!m?(s=_,t._pagingGetGroupList({limit:a,offset:s,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):V({groupList:c}):(s=_,t._pagingGetGroupList({limit:a,offset:s,groupBaseInfoFilter:r,groupList:c}))}).catch(function(p){return p.code===10018?(u.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(a)),a=50,t._pagingGetGroupList({limit:a,offset:s,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:i})):i?(p.code===11e3&&u.l("".concat(n," ok. community unavailable")),$({groupList:c})):v(p)})}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),o=e.limit,i=e.offset,a=e.groupBaseInfoFilter,s=e.groupList,r=Date.now();return this._grpM.req({proto:h.GET_GRP_LIST,data:{type:g.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:o,offset:i,responseFilter:{groupBaseInfoFilter:a,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then(function(d){var d=d.data,p=d.groups,d=d.totalCount,p=(s.push.apply(s,b(p===void 0?[]:p)),i+o),_=!(p<d);return u.l("".concat(n," ok. offset:").concat(i," limit:").concat(o," totalCount:").concat(d," isCompleted:").concat(_," currentCount:").concat(s.length," cost:").concat(Je(r))),_?(t._grpM.updateGroupMap(s),t._grpM.emitGroupListUpdate(!0,!1),d=t._grpM.getLocalGroupList().filter(function(m){return m.isSupportTopic===!0}),V({groupList:d})):(i=p,t._pagingGetGroupListWithTopic({limit:o,offset:i,groupBaseInfoFilter:a,groupList:s}))}).catch(function(c){return c.code===10018?(u.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(o)),o=50,t._pagingGetGroupListWithTopic({limit:o,offset:i,groupBaseInfoFilter:a,groupList:s})):v(c)})}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach(function(o){t.onNewGroupMessage(o)}),this._deleteCachedGroupMessage(e),u.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(i){var t=this,n=i.groupID,o=i.event,i=i.item;this._cacheGroupMessage(n,{event:o,dataList:[i]}),this._grpM.getGroupSimplifiedInfo(n).then(function(a){a.type===g.GRP_AVCHATROOM?t._grpM.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._grpM.setUnjoinedAVChatRoom(n):(t._grpM.updateGroupMap([a]),t._notifyCachedGroupMessage(n))}),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),u.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,t){var n=this;e&&t.length!==0&&t.forEach(function(a){var i=a.groupID,a=a.groupAtInfoList,s=[];D(a)||(a.forEach(function(r){s.push(l(l({},r),{},{groupID:i}))}),n._grpM.get(11).onNewGroupAtTips({dataList:s}))})}},{key:"setPagingGroupCount",value:function(e){D(e)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(e,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=an,this._pagingGetCostList=[]}}]),za),Jc=(E(Ya,[{key:"_onCloudConfigUpdated",value:function(){var e=this._grpM.getCloudConfig("grp_attr_cache_time");D(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach(function(e){e.localMainSequence=0})}},{key:"isGroupAttributesUpdatedNotice",value:function(n){var t=n.to,n=n.elements.newGroupProfile,o=!D(n)&&!L(n.groupAttributeOption);return o&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),o}},{key:"_onGroupAttributesUpdated",value:function(s){var t=this,n=s.groupID,s=s.groupAttributeOption,o=s.mainSequence,i=s.isWithChangedAttributeInfo,a=s.groupAttributeList,a=a===void 0?[]:a,s=s.operationType;if(u.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(i," operationType:").concat(s)),!D(s)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var r=o-this._getLocalGroupAttributes(n).localMainSequence;if(r!=0){if(i===1&&r==1)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:a,operationType:s}),void this._emitGroupAttributesUpdated(n);this._hasLocalGroupAttributes(n)&&(i=this._getLocalGroupAttributes(n).avChatRoomKey,this._getGroupAttributes({groupID:n,avChatRoomKey:i}).then(function(){t._emitGroupAttributesUpdated(n)}))}}}},{key:"initGroupAttributesCache",value:function(n){var t=n.groupID,n=n.avChatRoomKey,n=n===void 0?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:n}),u.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"initGroupAttributes",value:function(a){var t=this,n=a.groupID,o=a.groupAttributes,a=this._getLocalGroupAttributes(n),i=a.remoteMainSequence,a=a.avChatRoomKey,s=new R("initGroupAttributes");return s.setMessage("groupID:".concat(n," avChatRoomKey:").concat(a," mainSequence:").concat(i)),this._grpM.req({proto:h.SET_GRP_ATTR,data:{groupID:n,avChatRoomKey:a,mainSequence:i,groupAttributeList:this._transformGroupAttributes(o)}}).then(function(d){u.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n));var d=d.data,c=d.mainSequence,d=b(d.groupAttributeList);return d.forEach(function(p){p.value=o[p.key]}),t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:c,groupAttributeList:d,operationType:1}),t._emitGroupAttributesUpdated(n),s.end(),V({groupAttributes:o})}).catch(function(r){return s.setError(r).end(),v(r)})}},{key:"setGroupAttributes",value:function(c){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),o=c.groupID,i=c.groupAttributes,c=this._getLocalGroupAttributes(o),a=c.remoteMainSequence,s=c.avChatRoomKey,r=c.attributes,c=this._transformGroupAttributes(i),d=(c.forEach(function(p){var _=p.key;p.sequence=0,r.has(_)&&(p.sequence=r.get(_).sequence)}),new R("setGroupAttributes"));return d.setMessage("groupID:".concat(o," groupAttributes:").concat(JSON.stringify(i))),u.l("".concat(n,". groupID:").concat(o," mainSequence:").concat(a)),this._grpM.req({proto:h.MODIFY_GRP_ATTR,data:{groupID:o,avChatRoomKey:s,mainSequence:a,groupAttributeList:c}}).then(function(m){u.l("".concat(n," ok."));var m=m.data,_=m.mainSequence,m=b(m.groupAttributeList);return m.forEach(function(f){f.value=i[f.key]}),t._groupAttributesCopy=t._getCachedAttributes({groupID:o}),t._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:_,groupAttributeList:m,operationType:2}),t._emitGroupAttributesUpdated(o),d.end(),V({groupAttributes:i})}).catch(function(p){return d.setError(p).end(),v(p)})}},{key:"deleteGroupAttributes",value:function(o){var t=this,n=o.groupID,o=o.keyList,o=o===void 0?[]:o,r=this._getLocalGroupAttributes(n),i=r.remoteMainSequence,d=r.avChatRoomKey,a=r.attributes,s=b(a.keys()),r=h.CLEAR_GRP_ATTR,c=3,d={groupID:n,avChatRoomKey:d,mainSequence:i},p=[],_=(0<o.length&&(s=[],r=h.DEL_GRP_ATTR,c=4,o.forEach(function(m){var f=0;a.has(m)&&(f=a.get(m).sequence,s.push(m)),p.push({key:m,sequence:f})}),d.groupAttributeList=p),new R("deleteGroupAttributes"));return _.setMessage("groupID:".concat(n," mainSequence:").concat(i," keyList:").concat(o," proto:").concat(r)),this._grpM.req({proto:r,data:d}).then(function(m){return u.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),m=m.data.mainSequence,t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:m,groupAttributeList:p,operationType:c}),t._emitGroupAttributesUpdated(n),_.end(),V({keyList:s})}).catch(function(m){return _.setError(m).end(),v(m)})}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),o=e.groupID,r=this._getLocalGroupAttributes(o),i=r.avChatRoomKey,a=r.lastUpdateTime,s=r.localMainSequence,r=r.remoteMainSequence,c=new R("getGroupAttributes");return c.setMessage("groupID:".concat(o," localMainSequence:").concat(s," remoteMainSequence:").concat(r," keyList:").concat(e.keyList)),Date.now()-a>=this.CACHE_EXPIRE_TIME||s<r?this._getGroupAttributes({groupID:o,avChatRoomKey:i}).then(function(d){return c.setMoreMessage("get attributes from remote. count:".concat(d.length)).end(),u.l("".concat(n," from remote. groupID:").concat(o)),d=t._getCachedAttributes(e),V({groupAttributes:d})}).catch(function(d){return c.setError(d).end(),v(d)}):(c.setMoreMessage("get attributes from cache").end(),u.l("".concat(n," from cache. groupID:").concat(o)),a=this._getCachedAttributes(e),$({groupAttributes:a}))}},{key:"_getGroupAttributes",value:function(e){var t=this,n=0;return D(e.avChatRoomKey)||(n=1),this._grpM.req({proto:h.GET_GRP_ATTR,data:l(l({},e),{},{groupType:n})}).then(function(a){u.l("".concat(t._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var a=a.data,i=a.mainSequence,a=a.groupAttributeList,s=b(a);return D(i)||t._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:i,groupAttributeList:s,operationType:5}),a}).catch(function(o){return v(o)})}},{key:"_refreshCachedGroupAttributes",value:function(i){var t=i.groupID,n=i.remoteMainSequence,o=i.groupAttributeList,i=i.operationType;if(this._hasLocalGroupAttributes(t)){var a=this._getLocalGroupAttributes(t),s=a.localMainSequence;if(i===5||n-s==1)a.remoteMainSequence=n,a.localMainSequence=n,a.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:a,groupAttributeList:o,operationType:i});else{if(s===n)return;a.remoteMainSequence=n}this._groupAttributesMap.set(t,a),o="operationType:".concat(i," localMainSequence:").concat(s," remoteMainSequence:").concat(n),u.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(o))}}},{key:"_getCachedAttributes",value:function(n){var t=n.groupID,n=n.keyList,n=n===void 0?[]:n,o={};if(this._hasLocalGroupAttributes(t)){var i=this._getLocalGroupAttributes(t).attributes;if(0<n.length)n.forEach(function(c){i.has(c)&&(o[c]=i.get(c).value)});else{var a,s=Re(i.keys());try{for(s.s();!(a=s.n()).done;){var r=a.value;o[r]=i.get(r).value}}catch(c){s.e(c)}finally{s.f()}}}return o}},{key:"_updateCachedAttributes",value:function(o){var t=o.groupAttributes,n=o.groupAttributeList,o=o.operationType;o!==3?o!==4?(o===1&&t.attributes.clear(),n.forEach(function(r){var a=r.key,s=r.value,r=r.sequence;t.attributes.set(a,{value:s,sequence:r})})):n.forEach(function(i){t.attributes.delete(i.key)}):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach(function(n){t.push({key:n,value:e[n]})}),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),o=this._computeAttrChangedInfo(t),n=o.updatedKeyList,o=o.deletedKeyList;u.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(n.length,", delete:").concat(o.length)),n.length===0&&o.length===0||this._grpM.emitOuterEvent(K.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:n,deletedKeyList:o})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],o=[];return Object.keys(e).forEach(function(i){e[i]!==t._groupAttributesCopy[i]&&n.push(i)}),Object.keys(this._groupAttributesCopy).forEach(function(i){D(e[i])&&o.push(i)}),this._groupAttributesCopy={},{updatedKeyList:n,deletedKeyList:o}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),Ya),Xc=(E(Wa,[{key:"_onCloudConfigUpdated",value:function(){var e=this._grpM.getCloudConfig("grp_counter_expire_time");D(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(n){var t=n.to,n=n.elements.groupCounterInfo,o=!1;return L(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),o=!0),o}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach(function(s){var i=s.type,a=s.groupCounterSeq,s=s.counterList,s=s===void 0?[]:s;i!==0&&i!==2||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:a,counterList:s}),s.forEach(function(r){t._grpM.emitOuterEvent(K.GROUP_COUNTER_UPDATED,{groupID:n,key:r.key,value:r.value})})),i===1&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:a,counterList:s})}),u.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(n){var t=n.groupID,n=n.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),u.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(o){if(!this._grpM.canIUse(Ce.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility("setGroupCounters");var t="".concat(this._n,".").concat("setGroupCounters"),n=o.groupID,o=o.counters,o=this._convertObjectToList(o),i=this._getLocalGroupCounters(n).avChatRoomKey,a="groupID:".concat(n," count:").concat(o.length),s=new R("setGroupCounters");return s.setMessage("".concat(a)),u.l("".concat(t,". ").concat(a)),this._updateGroupCounters({groupID:n,counterList:o,avChatRoomKey:i,mode:"Set"}).then(function(r){return s.end(),u.l("".concat(t," ok.")),V({counters:r})}).catch(function(r){return s.setError(r).end(),u.e("".concat(t," failed. error:"),r),v(r)})}},{key:"increaseGroupCounter",value:function(a){var t="increaseGroupCounter";if(!this._grpM.canIUse(Ce.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility(t);var n="".concat(this._n,".").concat(t),o=a.groupID,i=a.key,a=a.value,s=this._getLocalGroupCounters(o).avChatRoomKey,r="groupID:".concat(o," key:").concat(i," value:").concat(a),c=new R(t);return c.setMessage("".concat(r)),u.l("".concat(n,". ").concat(r)),this._updateGroupCounters({groupID:o,counterList:[{key:i,value:a}],avChatRoomKey:s,mode:"Increase"}).then(function(d){return c.end(),u.l("".concat(n," ok.")),V({counters:d})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"decreaseGroupCounter",value:function(a){var t="decreaseGroupCounter";if(!this._grpM.canIUse(Ce.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility(t);var n="".concat(this._n,".").concat(t),o=a.groupID,i=a.key,a=a.value,s=this._getLocalGroupCounters(o).avChatRoomKey,r="groupID:".concat(o," key:").concat(i," value:").concat(a),c=new R(t);return c.setMessage("".concat(r)),u.l("".concat(n,". ").concat(r)),this._updateGroupCounters({groupID:o,counterList:[{key:i,value:a}],avChatRoomKey:s,mode:"Decrease"}).then(function(d){return c.end(),u.l("".concat(n," ok.")),V({counters:d})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"getGroupCounters",value:function(s){var t=this;if(!this._grpM.canIUse(Ce.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility("getGroupCounters");var n="".concat(this._n,".").concat("getGroupCounters"),o=s.groupID,s=s.keyList,i=s===void 0?[]:s,s=this._getLocalGroupCounters(o),a=s.avChatRoomKey,s=s.lastUpdateTime,r=new R("getGroupCounters");return r.setMessage("groupID:".concat(o)),Date.now()-s>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:o,avChatRoomKey:a}).then(function(c){return r.setMoreMessage("from remote. count:".concat(c.length)).end(),u.l("".concat(n," from remote. groupID:").concat(o)),c=t._getLocalCounters(o,i),V({counters:c})}).catch(function(c){return r.setError(c).end(),v(c)}):(r.setMoreMessage("from cache").end(),u.l("".concat(n," from cache. groupID:").concat(o)),s=this._getLocalCounters(o,i),$({counters:s}))}},{key:"_getRemoteGroupCounters",value:function(e){var t=this;return this._grpM.req({proto:h.GET_GRP_COUNTER,data:l({},e)}).then(function(i){var i=i.data,o=i.counterList,o=o===void 0?[]:o,i=i.groupCounterSeq;return t._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:i}),u.l("".concat(t._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o}).catch(function(n){return v(n)})}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach(function(n){t.push({key:n,value:e[n]})}),t}},{key:"_updateGroupCounters",value:function(e){var t="".concat(this._n,"._updateGroupCounters"),n=e.groupID,o=e.avChatRoomKey,i=e.mode;return u.l("".concat(t,". groupID:").concat(n," avChatRoomKey:").concat(o," mode:").concat(i)),this._grpM.req({proto:h.UPDATE_GRP_COUNTER,data:l({},e)}).then(function(s){u.l("".concat(t," ok."));var s=s.data.counterList,r={};return(s===void 0?[]:s).forEach(function(p){var d=p.key,p=p.value;r[d]=p}),r}).catch(function(a){return v(a)})}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(s){var t,n,o,i=s.groupID,a=s.counterList,a=a===void 0?[]:a,s=s.groupCounterSeq;this._hasLocalGroupCounters(i)&&(o=this._getLocalGroupCounters(i),t=o.counters,n=o.avChatRoomKey,o=o.groupCounterSeq,0<s&&s<o||(a.forEach(function(d){var c=d.key,d=d.value;t.set(c,d)}),this._groupCountersMap.set(i,{lastUpdateTime:Date.now(),groupCounterSeq:s,counters:t,avChatRoomKey:n})))}},{key:"_deleteLocalGroupCounters",value:function(a){var t,n,o=a.groupID,i=a.counterList,i=i===void 0?[]:i,a=a.groupCounterSeq;this._hasLocalGroupCounters(o)&&(n=this._getLocalGroupCounters(o),t=n.counters,n=n.avChatRoomKey,i.forEach(function(s){t.delete(s.key)}),this._groupCountersMap.set(o,{lastUpdateTime:Date.now(),groupCounterSeq:a,counters:t,avChatRoomKey:n}))}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var o=this._getLocalGroupCounters(e).counters;if(0<t.length)t.forEach(function(r){o.has(r)&&(n[r]=o.get(r))});else{var i,a=Re(o.keys());try{for(a.s();!(i=a.n()).done;){var s=i.value;n[s]=o.get(s)}}catch(r){a.e(r)}finally{a.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),Wa),Zc=(E(Ka,[{key:"start",value:function(){var e=this._grpM.isLoggedIn();e||(this._proto=h.AV_NOAUTH_POLLING),u.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._grpM.req({proto:this._proto,data:t}).then(function(n){e._onSuccess(e._groupID,n),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))}).catch(function(n){e._onFail(e._groupID,n),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))})}},{key:"stop",value:function(){u.l("".concat(this._n,".stop")),0<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),Ka),Er={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0},Qc=(E(Ha,[{key:"hasJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?b(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(e){var t=this._pollingRequestInfoMap.get(e);return e===b(this._pollingInstanceMap.keys())[0]?l(l({},t),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):l(l({},t),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n,c=t.data,o=c.key,i=c.nextSeq,a=c.rspMsgList,s=c.errorCode,r=c.nextBroadcastSeq,c=c.broadcastMessageList;s!==0?(s=this._pollingRequestInfoMap.get(e),n=new R("longPollingAVError"),s=s?"".concat(s.key,"-").concat(s.startSeq):"requestInfo is undefined",n.setMessage("".concat(e,"-").concat(s,"-").concat(t.errorInfo)).setCode(t.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(e)&&(ne(o)&&ge(i)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:i}),ge(r)&&r>this._startBroadcastSeq&&(this._startBroadcastSeq=r),q(a)&&0<a.length?(a.forEach(function(d){d.to=d.groupID}),this.onMessage(a,e)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c))}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e,t){if(q(e)&&e.length!==0){var n="".concat(this._n,".onMessage"),o=(t&&(n+=" groupID:".concat(t)),this._pollingNoMessageCount!==0&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),i=[],a=this._get(11),s=this._get(26),r=e.length,c=(1<r&&e.sort(function(I,N){return I.sequence-N.sequence}),this._get(12).isUnlimitedAVChatRoom()),d=!1;u.getLevel()<=0&&(t=e.map(function(I){return I.sequence}),u.l("".concat(n," count:").concat(t.length," sequenceList:").concat(t)),t.length=0);for(var p=0;p<r;p++){var _=this.restoreMessageFromSimplified(e[p]);if(Er[_.event]){if(_.event===6&&(this._grpM.isGroupAttributesUpdatedNotice(_)||this._grpM.isGroupCountersNotice(_)))continue;if(_.event!==20)if(_.event!==21){var o=this.packMessage(_,_.event),m=_.isModified===1,d=_.isHistoryMessage===1;if(!c){if(this.sequencesLinkedList.has(o.sequence))continue;this.sequencesLinkedList.set(o.sequence)}var f=this.messageIDLinkedList.has(o.ID);f?u.w("".concat(n," ID:").concat(o.ID," has:").concat(f)):(this.messageIDLinkedList.set(o.ID),f=!1,!d&&this._isMessageSentByCurrentInstance(o)?m&&(f=!0,o.isModified=m,a.updateMessageIsModifiedProperty(o)):f=!0,f&&(o.conversationType===g.CONV_SYSTEM&&o.payload.operationType===5&&this._onGroupDismissed(o.payload.groupProfile.groupID),d||o.conversationType===g.CONV_SYSTEM||(m=o.conversationID.replace(g.CONV_GROUP,""),this._pollingInstanceMap.has(m)?this._grpM.isLoggedIn()&&s.addMessageSequence({key:Ao,message:o}):(o.type!==g.MSG_GRP_TIP&&0<o.clientTime&&s.addMessageDelay(o.clientTime),s.addMessageSequence({key:vo,message:o}))),i.push(o)))}else this._get(34).onMessageReactionNotify({event:21,dataList:_.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(_)}else u.w("".concat(n,". unknown event:").concat(_.event))}i.length!==0&&(0<(t=uo(i)).length&&this._grpM.emitOuterEvent(K.MESSAGE_MODIFIED,t),d||0<(t=this.packConversationOption(i)).length&&a.onNewMessage({conversationOptionsList:t,isInstantMessage:!0}),this._checkMessageStacked(i),0<(t=lo(i)).length&&this._grpM.emitOuterEvent(K.MESSAGE_RECEIVED,t),i.length=0)}}},{key:"handleMessageRevokedNotice",value:function(e){var t=this,n=e.groupID,o=e.elements.revokeMsgList,i=e.revokerInfo,a=[];o.forEach(function(d){var p=d.tinyID,r=d.clientTime,c=d.random,d=d.sequence,p={conversationID:"".concat(g.CONV_GROUP).concat(n),ID:"".concat(p,"-").concat(r,"-").concat(c),revoker:i.revoker,revokeReason:i.reason||"",revokerInfo:{userID:i.revoker,nick:"",avatar:""},sequence:d};a.push(p)}),a.length!==0&&this._get(11).updateRevokerInfo(a).then(function(s){t._grpM.emitOuterEvent(K.MESSAGE_REVOKED,s)})}},{key:"isBroadcastOrNormal",value:function(e){return e===3||e===17}},{key:"isGroupTip",value:function(e){return e===4||e===6}},{key:"isGroupSystemNotice",value:function(e){return e===5}},{key:"restoreGroupTipElements",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},i=e.operatorInfo,i=i===void 0?{}:i,a=e.operatorID,t=e.userIDList,t=t===void 0?[]:t,n=e.operationType,n=(ge(e.groupJoinType)||n!==1&&n!==2||(e.groupJoinType=n===2?0:1),i.userID),o=i.avatar,i=i.nick,a=(e.operatorInfo={userID:n===void 0?a:n,avatar:o===void 0?"":o,nick:i===void 0?"":i},t.map(function(s){return{userID:s}}));return e.memberInfoList=e.memberInfoList||a,e}},{key:"restoreMessageFromSimplified",value:function(e){var t,n,o,i=e.event;return this.isBroadcastOrNormal(i)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map(function(a){var s;return a.type===g.MSG_CUSTOM&&(s=a.content,a.content=l({data:"",description:"",extension:""},s===void 0?{}:s)),a})),(this.isGroupTip(i)||this.isGroupSystemNotice(i))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(i)&&(e.elements=this.restoreGroupTipElements(e.elements),n=(o=(o=e.elements)===void 0?{}:o).operationType,t=o.operatorInfo,n===1&&(n=[{userID:(t===void 0?{}:t).userID}],o.memberInfoList=o.memberInfoList||n)),this.isGroupSystemNotice(i)&&(o=(t=e.elements).memberInfoList,n=t.operatorInfo,e.elements.memberInfoList=l({userID:e.elements.operatorID,avatar:"",nick:""},o=o||(n===void 0?{}:n)),e.elements=l({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements),i=Object.keys(e.elements).filter(function(a){return a!=="operatorInfo"}).reduce(function(a,s){return l(l({},a),{},W({},s,e.elements[s]))},{}),e.elements=i),e}},{key:"_onGroupDismissed",value:function(e){u.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(n){var t="MessageStacked",n=n.length;100<=n&&(this._grpM.outputWarning(t,n),this._reportMessageStackedCount<5&&(new R(t).setMessage("count:".concat(n," groupID:").concat(b(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._get(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(o,t){o.currentUser=this._grpM.getMyUserID(),o.conversationType=t===5?g.CONV_SYSTEM:g.CONV_GROUP,o.isSystemMessage=!!o.isSystemMessage;var n=new Xe(o),o=this.packElements(o,t);return n.setElement(o,this._grpM.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,t){return t===4||t===6?(this._updateMemberCountByGroupTips(e),{type:g.MSG_GRP_TIP,content:l(l({},e.elements),{},{groupProfile:e.groupProfile})}):t===5?{type:g.MSG_GRP_SYS_NOTICE,content:l(l({},e.elements),{},{groupProfile:l(l({},e.groupProfile),{},{groupID:e.groupID})})}:e.elements}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var o,i=e[n],a=i.conversationID;t.has(a)?((o=t.get(a)).lastMessage=i).flow==="in"&&o.unreadCount++:t.set(a,{conversationID:i.conversationID,unreadCount:i.flow==="out"?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return b(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(a){var t,n,o,i=a.groupProfile.groupID,a=a.elements.onlineMemberInfo,a=a===void 0?void 0:a;L(a)||(t=(t=a.onlineMemberNum)===void 0?0:t,a=(a=a.expireTime)===void 0?this.DEFAULT_EXPIRE_TIME:a,n=this._onlineMemberCountMap.get(i)||{},o=Date.now(),L(n)?Object.assign(n,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:o,memberCount:t,expireTime:a}):(n.latestUpdateTime=o,n.memberCount=t),this._onlineMemberCountMap.set(i,n))}},{key:"_onBroadcastMessage",value:function(e){if(!L(e)){for(var t=[],n=e.length,o=null,i=0;i<n;i++){var a=this.restoreMessageFromSimplified(e[i]);Er[a.event]?((o=this.packMessage(a,a.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(o.ID)||(t.push(o),this._broadcastMessageIDMap.set(o.ID,1))):u.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(a.event))}0<t.length&&this._grpM.emitOuterEvent(K.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){var t;this._pollingInstanceMap.has(e)?(t=this._pollingInstanceMap.get(e)).isRunning()||t.start():((t=new Zc({manager:this,groupID:e,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(e,t),u.l("".concat(this._n,".start groupID:").concat(e)))}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck().then(function(){var n=e.longPollingKey,o=e.group,i=o.groupID;return t._joinedGroupMap.set(i,o),t._grpM.updateGroupMap([o]),t._grpM.deleteUnjoinedAVChatRoom(i),t._grpM.emitGroupListUpdate(!0,!1),D(n)?$({status:_e,group:o}):Promise.resolve()})}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then(function(){var n=e.longPollingKey,o=e.group,i=e.startSeq,a=o.groupID;return t._pollingRequestInfoMap.set(a,{key:n,startSeq:i===void 0?0:i}),t.start(a),t._grpM.isLoggedIn()?$({status:_e,group:o}):$({status:_e})})}},{key:"_preCheck",value:function(){if(this._get(12).isUnlimitedAVChatRoom()||!this.hasJoinedAVChatRoom())return Promise.resolve();var t=z(this._joinedGroupMap.entries().next().value,2),e=t[0],t=t[1];if(this._grpM.isLoggedIn()){if(t.selfInfo.role!==g.GRP_MBR_ROLE_OWNER&&t.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(e);this._grpM.deleteLocalGroupAndConversation(e)}else this._grpM.deleteLocalGroupAndConversation(e);return this.reset(e),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".").concat("joinWithoutAuth"),i=new R("joinWithoutAuth");return this._grpM.req({proto:h.APPLY_JOIN_GRP_NOAUTH,data:e}).then(function(a){if(a=a.data.longPollingKey,i.setMessage("groupID:".concat(n," longPollingKey:").concat(a)).end(!0),D(a))return v({code:M.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});u.l("".concat(o," ok. groupID:").concat(n)),t._get(11).setCompleted("".concat(g.CONV_GROUP).concat(n));var s=new vn({groupID:n});return t.startRunLoop({group:s,longPollingKey:a}),V({status:_e})}).catch(function(a){return u.e("".concat(o," failed. groupID:").concat(n," error:"),a),i.setError(a).setMessage("groupID:".concat(n)).end(!0),v(a)}).finally(function(){t._grpM.get(14).reportAtOnce()})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return L(t)||n-t.lastSyncTime>1e3*t.expireTime&&1e4<n-t.latestUpdateTime&&3e3<n-t.lastReqTime?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then(function(o){return V({memberCount:o.memberCount})}).catch(function(o){return v(o)})):$({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),o=new R("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(e).then(function(r){var a=t._onlineMemberCountMap.get(e)||{},r=r.data,s=r.memberCount,s=s===void 0?0:s,r=r.expireTime,r=r===void 0?t.DEFAULT_EXPIRE_TIME:r,c=(u.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(s," expireTime:").concat(r)),Date.now());return L(a)&&(a.lastReqTime=c),t._onlineMemberCountMap.set(e,Object.assign(a,{lastSyncTime:c,latestUpdateTime:c,memberCount:s,expireTime:r})),{memberCount:s}}).catch(function(i){return u.w("".concat(n," failed. error:"),i),o.setCode(i.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(i))).end(),Promise.reject(i)})}},{key:"_get",value:function(e){return this._grpM.get(e)}},{key:"setPollingInterval",value:function(e){D(e)||(ge(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){D(e)||(ge(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){D(e)||(ge(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){D(e)||e!=="0"&&e!=="1"||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){e=e.payload.groupProfile.groupID,u.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"restartPolling",value:function(){u.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=Re(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(o){t.e(o)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var t=this._pollingInstanceMap.get(e).getPollingTimerID();return u.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t}},{key:"reset",value:function(e){if(e){u.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{u.l("".concat(this._n,".reset all"));var n,o=Re(this._pollingInstanceMap.values());try{for(o.s();!(n=o.n()).done;)n.value.stop()}catch(i){o.e(i)}finally{o.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),Ha),$c=(E(Ba,[{key:"updateMember",value:function(e){D(e.onlineStatus)||(this.isOnline=e.onlineStatus==="Online");var t=[null,void 0,"",0,NaN];e.memberCustomField&&Dn(this.memberCustomField,e.memberCustomField),bt(this,e,["memberCustomField","marks","onlineStatus"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){D(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){D(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&Dn(this.memberCustomField,e)}}]),Ba),eu=(E(Va,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,o=0;o<n.length;o++)(function(i){var a=n[i];t.groupMemberListMap.forEach(function(s){s.has(a.userID)&&s.get(a.userID).updateMember({nick:a.nick,avatar:a.avatar})})})(o)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(r){var t,n=this,o=r.groupID,i=r.role,i=i===void 0?void 0:i,_=r.offset,a=_===void 0?0:_,_=r.count,s=_===void 0?15:_,_=r.filter,r=_===void 0?void 0:_,c="".concat(this._n,".").concat("getGroupMemberList"),_=this._grpM.hasLocalGroup(o);if(u.l("".concat(c," groupID:").concat(o," role:").concat(i," offset:").concat(a," count:").concat(s," hasLocalGroup:").concat(_)),!_)return $({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(o).type===g.GRP_AVCHATROOM){if(this._grpM.canIUse(Ce.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:o,offset:a,filter:r});this._grpM.outputWarning("LiveOnlineMember")}i!==g.GRP_MBR_ROLE_ADMIN&&i!==g.GRP_MBR_ROLE_OWNER&&i!==g.GRP_MBR_ROLE_MEMBER||(t=i);var d=new R("getGroupMemberList"),p=0,_={groupID:o,limit:100<s?100:s,memberRoleFilter:t?[t]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},m=(rt({groupID:o})?_.next="".concat(a):(_.offset=a,p=a+s),[]);return this._grpM.req({proto:h.GET_GRP_MBR_LIST,data:_}).then(function(P){var P=P.data,I=P.members,N=P.memberNum,P=P.next,P=P===void 0?void 0:P;return D(P)||(p=L(P)?0:P),q(I)&&I.length!==0?(n._grpM.hasLocalGroup(o)&&(n._grpM.getLocalGroupProfile(o).memberNum=N),m=n._updateLocalGroupMemberMap(o,I),n._grpM.get(4).getUserProfile({userIDList:I.map(function(H){return H.userID}),tagList:[k.NICK,k.AVATAR]})):(p=0,Promise.resolve([]))}).then(function(f){return f=f.data,!q(f)||f.length===0?$({memberList:[],offset:p}):(f=f.map(function(I){return{userID:I.userID,nick:I.nick,avatar:I.avatar}}),n._updateLocalGroupMemberMap(o,f),m.length<s&&(p=0),d.setMessage("groupID:".concat(o," offset:").concat(a," count:").concat(s)).end(),u.l("".concat(c," ok.")),V({memberList:m,offset:p}))}).catch(function(f){return d.setError(f).end(),u.e("".concat(c," failed. error:"),f),v(f)})}},{key:"_getAVChatRoomMemberList",value:function(i){var t=this,n=i.groupID,o=i.offset,i=i.filter,a="".concat(this._n,".").concat("_getAVChatRoomMemberList"),s=new R("_getAVChatRoomMemberList");return s.setMessage("groupID:".concat(n," offset:").concat(o," filter:").concat(i)),this._grpM.req({proto:h.GET_AV_MBR_LIST,data:{groupID:n,offset:o,filter:i}}).then(function(c){var c=c.data,d=c.memberList,d=d===void 0?[]:d,c=c.offset,c=c===void 0?0:c,d=(s.end(),u.l("".concat(a," ok. member count:").concat(d.length,", next request timestamp:").concat(c)),d.map(function(p){return l(l({},p),{},{onlineStatus:"Online"})})),d=t._updateLocalGroupMemberMap(n,d);return V({memberList:d,offset:c})}).catch(function(r){return s.setError(r).end(),u.e("".concat(a," failed. error:"),r),v(r)})}},{key:"getGroupMemberProfile",value:function(e){var t=this,n="getGroupMemberProfile",s="".concat(this._n,".").concat(n),o="groupID:".concat(e.groupID),i=(5<e.userIDList.length?o+=" userIDList.length:".concat(e.userIDList.length):o+=" userIDList:".concat(e.userIDList),u.l("".concat(s," ").concat(o)),50<e.userIDList.length&&(e.userIDList=e.userIDList.slice(0,50)),e.groupID),a=e.userIDList,s=this._grpM.getLocalGroupProfile(i);if(s&&et(s.type))return v({code:s=M.OPERATION_NOT_SUPPORTED_IN_AVCHATROOM,message:this._grpM.getErrorMessage(s,n)});var r=new R(n);return r.setMessage(o),this._getGroupMemberProfileAdvance(l(l({},e),{},{userIDList:a})).then(function(c){return c=c.data.members,q(c)&&c.length!==0?(t._updateLocalGroupMemberMap(i,c),t._grpM.get(4).getUserProfile({userIDList:c.map(function(d){return d.userID}),tagList:[k.NICK,k.AVATAR]})):$([])}).then(function(c){return c=c.data.map(function(d){return{userID:d.userID,nick:d.nick,avatar:d.avatar}}),t._updateLocalGroupMemberMap(i,c),c=a.filter(function(d){return t.hasLocalGroupMember(i,d)}).map(function(d){return t.getLocalGroupMemberInfo(i,d)}),r.end(),V({memberList:c})})}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),o=e.groupID,i=this._grpM.getLocalGroupProfile(o),a=i.type,s=new R("addGroupMember");return s.setMessage("groupID:".concat(o," groupType:").concat(a)),et(a)?(a=new Oe({code:M.CANNOT_ADD_MEMBER_IN_AVCHATROOM}),s.setError(a).end(),v(a)):(e.userIDList=e.userIDList.map(function(r){return{userID:r}}),u.l("".concat(n," groupID:").concat(o)),this._grpM.req({proto:h.ADD_GRP_MBR,data:e}).then(function(_){var _=_.data.members,c=(u.l("".concat(n," ok")),_.filter(function(f){return f.result===1}).map(function(f){return f.userID})),d=_.filter(function(f){return f.result===0}).map(function(f){return f.userID}),p=_.filter(function(f){return f.result===2}).map(function(f){return f.userID}),_=_.filter(function(f){return f.result===4}).map(function(f){return f.userID}),m="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(c,", ")+"failureUserIDList:".concat(d,", ")+"existedUserIDList:".concat(p,", ")+"overLimitUserIDList:".concat(_);return s.setMoreMessage(m).end(),c.length===0?V({successUserIDList:c,failureUserIDList:d,existedUserIDList:p,overLimitUserIDList:_}):(i.memberCount+=c.length,t._updateConversationGroupProfile(i),V({successUserIDList:c,failureUserIDList:d,existedUserIDList:p,overLimitUserIDList:_,group:i}))}).catch(function(r){return s.setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),o=e.groupID,i=e.userIDList,a=this._grpM.getLocalGroupProfile(o);if(D(a))return v({code:M.CANNOT_FIND_GRP});if(et(a.type))return this._grpM.canIUse(Ce.AV_BAN_MBR)?this._banAVChatRoomMember(e):this._grpM.cannotUseCommercialAbility("deleteGroupMember");var s="groupID:".concat(o," ").concat(5<i.length?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),r=(u.l("".concat(n," groupID:").concat(o," userIDList:"),i),new R("deleteGroupMember"));return r.setMessage(s),this._grpM.req({proto:h.DEL_GRP_MBR,data:e}).then(function(){return r.end(),u.l("".concat(n," ok")),--a.memberCount,t._updateConversationGroupProfile(a),t.deleteLocalGroupMembers(o,i),V({group:a,userIDList:i})}).catch(function(c){return r.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)})}},{key:"_updateConversationGroupProfile",value:function(e){this._grpM.get(11).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("_banAVChatRoomMember"),o=e.groupID,i=e.userIDList,a="groupID:".concat(o," ").concat(5<i.length?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),s=new R("_banAVChatRoomMember"),r=(s.setMessage(a),u.l("".concat(n," groupID:").concat(o," userIDList:"),i),this._grpM.getLocalGroupProfile(o));return D(e.duration)||e.duration===0?v({code:M.BAN_DURATION_INVALID}):this._grpM.req({proto:h.BAN_AV_MBR,data:e}).then(function(){return s.end(),u.l("".concat(n," ok")),t.deleteLocalGroupMembers(o,i),V({group:r,userIDList:i})}).catch(function(c){return s.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)})}},{key:"setGroupMemberMuteTime",value:function(i){var t=this,n=i.groupID,o=i.userID,i=i.muteTime,a="".concat(this._n,".").concat("setGroupMemberMuteTime");if(o===this._grpM.getMyUserID())return v({code:M.CANNOT_MUTE_SELF});var s="groupID:".concat(n," userID:").concat(o," muteTime:").concat(i),r=(u.l("".concat(a," ").concat(s)),new R("setGroupMemberMuteTime"));return r.setMessage(s),this.modifyGroupMemberInfo({groupID:n,userID:o,muteTime:i}).then(function(c){r.end(),u.l("".concat(a," ok"));var d=t._grpM.getLocalGroupProfile(n);return V({group:d,member:c})}).catch(function(c){return r.setError(c).end(),u.e("".concat(a," failed. error:"),c),v(c)})}},{key:"setGroupMemberRole",value:function(i){var t="".concat(this._n,".").concat("setGroupMemberRole"),n=i.groupID,o=i.userID,i=i.role,a="groupID:".concat(n," userID:").concat(o," role:").concat(i),s=this._grpM.getLocalGroupProfile(n);if(!s||s.type===g.GRP_WORK||s.type===g.GRP_AVCHATROOM)return v({code:M.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});if(s&&s.selfInfo.role!==g.GRP_MBR_ROLE_OWNER)return v({code:M.NOT_OWNER});var r=[g.GRP_MBR_ROLE_ADMIN,g.GRP_MBR_ROLE_MEMBER];if(rt({groupID:n})&&r.push(g.GRP_MBR_ROLE_CUSTOM),r.indexOf(i)<0)return v({code:M.INVALID_MEMBER_ROLE});if(o===this._grpM.getMyUserID())return v({code:M.CANNOT_SET_SELF_MEMBER_ROLE});var c=new R("setGroupMemberRole");return c.setMessage(a),u.l("".concat(t," ").concat(a)),this.modifyGroupMemberInfo({groupID:n,userID:o,role:i}).then(function(d){return c.end(),u.l("".concat(t," ok")),V({group:s,member:d})}).catch(function(d){return c.setError(d).end(),u.e("".concat(t," failed. error:"),d),v(d)})}},{key:"_filterProfanity",value:function(e,t){var o=this._grpM.get(29);if(!o)return!0;var o=o.filterText(t[e],"group_member_profile"),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(c){var t=this,n="setGroupMemberNameCard",o="".concat(this._n,".").concat(n);if(c.nameCard&&this._filterProfanity("nameCard",c)===!1)return v({code:M.PROFANITY_FOUND});var i=c.groupID,r=c.userID,a=r===void 0?this._grpM.getMyUserID():r,s=c.nameCard,r="groupID:".concat(i," userID:").concat(a," nameCard:").concat(s),c=(u.l("".concat(o," ").concat(r)),this._grpM.getLocalGroupProfile(i));if(c&&et(c.type))return v({code:c=M.OPERATION_NOT_SUPPORTED_IN_AVCHATROOM,message:this._grpM.getErrorMessage(c,n)});var d=new R(n);return d.setMessage(r),this.modifyGroupMemberInfo({groupID:i,userID:a,nameCard:s}).then(function(p){u.l("".concat(o," ok")),d.end();var _=t._grpM.getLocalGroupProfile(i);return a===t._grpM.getMyUserID()&&_&&_.setSelfNameCard(s),V({group:_,member:p})}).catch(function(p){return d.setError(p).end(),u.e("".concat(o," failed. error:"),p),v(p)})}},{key:"setGroupMemberCustomField",value:function(s){var t=this,n="setGroupMemberCustomField",o="".concat(this._n,".").concat(n),i=s.groupID,a=s.userID,a=a===void 0?this._grpM.getMyUserID():a,s=s.memberCustomField,r="groupID:".concat(i," userID:").concat(a," memberCustomField:").concat(JSON.stringify(s)),c=(u.l("".concat(o," ").concat(r)),this._grpM.getLocalGroupProfile(i));if(c&&et(c.type))return v({code:c=M.OPERATION_NOT_SUPPORTED_IN_AVCHATROOM,message:this._grpM.getErrorMessage(c,n)});var d=new R(n);return d.setMessage(r),this.modifyGroupMemberInfo({groupID:i,userID:a,memberCustomField:s}).then(function(p){d.end(),u.l("".concat(o," ok"));var _=t._grpM.getLocalGroupProfile(i);return V({group:_,member:p})}).catch(function(p){return d.setError(p).end(),u.e("".concat(o," failed. error:"),p),v(p)})}},{key:"modifyGroupMemberInfo",value:function(e){var t=this,n=e.groupID,o=e.userID,i=void 0;return We(n)&&(n=je(i=n)),this._grpM.req({proto:h.MODIFY_GRP_MBR_INFO,data:l(l({},e),{},{groupID:n,topicID:i})}).then(function(){if(t.hasLocalGroupMember(n,o))return a=t.getLocalGroupMemberInfo(n,o),D(e.muteTime)||a.updateMuteUntil(e.muteTime),D(e.role)||a.updateRole(e.role),D(e.nameCard)||a.updateNameCard(e.nameCard),D(e.memberCustomField)||a.updateMemberCustomField(e.memberCustomField),a;var a=t._grpM.getLocalGroupProfile(n);return a&&!et(a.type)?t.getGroupMemberProfile({groupID:n,userIDList:[o]}).then(function(s){return z(s.data.memberList,1)[0]}):void 0})}},{key:"markGroupMemberList",value:function(a){var t="".concat(this._n,".").concat("markGroupMemberList"),n=a.groupID,o=a.markType,c=a.enableMark,a=a.userIDList,i=a===void 0?[]:a,a="groupID:".concat(n," markType:").concat(o," enableMark:").concat(c," userIDList count:").concat(i.length),s=(u.l("".concat(t," ").concat(a)),2),r=[],c=(c===!0&&(s=1),b(i)),d=(500<i.length&&(c=i.slice(0,500),u.w("".concat(t," ").concat(En(500)))),c.forEach(function(p){r.push({userID:p,markType:[o]})}),c=null,new R("markGroupMemberList"));return d.setMessage(a),this._grpM.req({proto:h.MARK_AV_MBR_INFO,data:{groupID:n,operationType:s,memberList:r}}).then(function(f){var f=f.data.memberList,f=f===void 0?[]:f,_=[],m=[],f=(f.length===i.length?_.push.apply(_,b(i)):(f.forEach(function(I){_.push(I.userID)}),i.forEach(function(I){_.includes(I)||m.push(I)})),"success count:".concat(_.length," fail count:").concat(m.length));return d.setMessage(f).end(),u.l("".concat(t," ok. ").concat(f)),V({successUserIDList:_,failureUserIDList:m})}).catch(function(p){return d.setError(p).end(),u.e("".concat(t," failed. error:"),p),v(p)})}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this._grpM.req({proto:h.GET_GRP_MBR_PROFILE,data:l(l({},e),{},{memberInfoFilter:e.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return q(t)&&t.length!==0?t.map(function(o){return n.hasLocalGroupMember(e,o.userID)?n.getLocalGroupMemberInfo(e,o.userID).updateMember(o):n.setLocalGroupMember(e,new $c(o)),n.getLocalGroupMemberInfo(e,o.userID)}):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach(function(o){n.delete(o)})}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).set(t.userID,t):(t=new Map().set(t.userID,t),this.groupMemberListMap.set(e,t))}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),Va),tu=(E(qa,[{key:"onNewGroupSystemNotice",value:function(n){var i=n.dataList,t=n.isSyncingEnded,n=n.isInstantMessage,i=(u.d("".concat(this._n,".onReceiveSystemNotice count:").concat(i.length)),this.newSystemNoticeStoredAndSummary({notifiesList:i,isInstantMessage:n})),o=i.eventDataList,i=i.result;0<o.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:n}),this._onReceivedGroupSystemNotice({result:i,isInstantMessage:n})),n?0<i.length&&this._grpM.emitOuterEvent(K.MESSAGE_RECEIVED,i):t===!0&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){for(var t=e.notifiesList,n=e.isInstantMessage,o=null,i=t.length,r=0,a=[],s={conversationID:g.CONV_SYSTEM,unreadCount:0,type:g.CONV_SYSTEM,subType:null,lastMessage:null},r=0;r<i;r++){var c=t[r],p=c.groupProfile,d=p.communityType,p=p.topicID,p=p===void 0?void 0:p,m=c.elements,_=m.topicIDList,_=_===void 0?void 0:_,m=m.operationType;if(!((d===void 0?0:d)!==2||L(p)&&L(_))){if([17,18,20].includes(m)){this._handleTopicSystemNotice(c);continue}L(p)||(c.to=p)}c.elements.operationType!==15&&(c.currentUser=this._grpM.getMyUserID(),c.conversationType=g.CONV_SYSTEM,c.conversationID=g.CONV_SYSTEM,(o=new Xe(c)).setElement({type:g.MSG_GRP_SYS_NOTICE,content:l(l({},c.elements),{},{groupProfile:l({},c.groupProfile)})}),o.isSystemMessage=!0,(o.sequence===1&&o.random===1||o.sequence===2&&o.random===2)&&(o.sequence=Mt(),o.random=Mt(),o.generateMessageID(),u.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(o.ID))),this._grpM.get(11).pushIntoNoticeResult(a,o)&&(n?s.unreadCount++:o.setIsRead(!0),s.subType=o.conversationSubType))}return s.lastMessage=a[a.length-1],{eventDataList:0<a.length?[s]:[],result:a}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then(function(n){n.forEach(function(i){e.pendencyMap.set("".concat(i.from,"_").concat(i.groupID,"_").concat(i.to),i)});var n=e._grpM.get(11).getLocalMessageList(g.CONV_SYSTEM),o=[];n.forEach(function(i){var r=i.payload,a=r.operatorID,s=r.operationType,r=r.groupProfile;s===1&&(s="".concat(a,"_").concat(r.groupID,"_").concat(r.to),(a=e.pendencyMap.get(s))&&ge(a.handled)&&a.handled!==0&&o.push(i))}),e.deleteGroupSystemNotice({messageList:o})})}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return q(e.messageList)&&e.messageList.length!==0?(u.l("".concat(n," ")+e.messageList.map(function(o){return o.ID})),this._grpM.req({proto:h.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:e.messageList.map(function(o){return{from:g.CONV_SYSTEM,messageSeq:o.clientSequence,messageRandom:o.random}})}}).then(function(){u.l("".concat(n," ok"));var o=t._grpM.get(11);return e.messageList.forEach(function(i){o.deleteLocalMessage(i)}),V()}).catch(function(o){return u.e("".concat(n," error:"),o),v(o)})):$()}},{key:"_getPendencyList",value:function(){var e=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},t=o.type,n=o.startTime,o=o.limit;return this._grpM.req({proto:h.GET_GRP_PENDENCY,data:{type:t===void 0?void 0:t,startTime:n===void 0?0:n,limit:o===void 0?20:o,handleAccount:this._grpM.getMyUserID()}}).then(function(i){var a=i.data.pendencyList;return i.data.nextStartTime!==0?e._getPendencyList({startTime:i.data.nextStartTime}).then(function(s){return[].concat(b(a),b(s))}):a})}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then(function(t){return e._getPendencyList({type:g.GRP_COMMUNITY}).then(function(n){return t.push.apply(t,b(n)),e._handlePendencyResult(t)}).catch(function(n){return e._handlePendencyResult(t)})})}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach(function(o){t.pendencyMap.set("".concat(o.from,"_").concat(o.groupID,"_").concat(o.to),o),o.handled===0&&n.push({applicant:o.from,applicantNick:o.fromUserNickName,groupName:o.groupName,groupID:o.groupID,authentication:o.authentication,messageKey:o.time,applicationType:o.applicationType,userID:o.userID,note:o.note})}),$({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach(function(o){switch(o.payload.operationType){case 1:break;case 2:t._onApplyJoinGroup(o);break;case 3:break;case 4:t._onMemberKicked(o);break;case 5:t._onGroupDismissed(o);break;case 6:break;case 7:t._onInviteGroup(o);break;case 8:t._onQuitGroup(o);break;case 9:t._onSetManager(o);break;case 10:t._onDeleteManager(o);break;case 11:case 12:case 15:break;case 20:t._onMessageRemindTypeSynced(o);break;case 21:t._grpM.onAVChatRoomMemberBanned(o)}})}},{key:"_onApplyJoinGroup",value:function(o){var t=this,o=o.payload.groupProfile,n=o.groupID,o=o.groupType,i=this._grpM.hasLocalGroup(n);u.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(n," groupType:").concat(o," hasGroup:").concat(i)),i||et(o)||this._grpM.getGroupProfile({groupID:n}).then(function(s){var s=s.data.group;s&&(t._grpM.updateGroupMap([s]),s=!s.isSupportTopic,t._grpM.emitGroupListUpdate(!0,s))})}},{key:"_onMemberKicked",value:function(e){e=e.payload.groupProfile.groupID,this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e)}},{key:"_onGroupDismissed",value:function(t){var t=t.payload.groupProfile.groupID,n=(this._grpM.hasLocalGroup(t)&&this._grpM.deleteLocalGroupAndConversation(t),this._grpM._AVChatRoomHandler);n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(n){var t=this,n=n.payload.groupProfile.groupID;this._grpM.hasLocalGroup(n)||this._grpM.getGroupProfile({groupID:n}).then(function(o){o=o.data.group,o&&(t._grpM.updateGroupMap([o]),t._grpM.emitGroupListUpdate())})}},{key:"_onQuitGroup",value:function(n){var n=n.payload.groupProfile,t=n.groupID,n=n.groupType,o=this._grpM.hasLocalGroup(t);u.l("".concat(this._n,"._onQuitGroup groupID:").concat(t," groupType:").concat(n," hasGroup:").concat(o)),o&&this._grpM.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(n){var n=n.payload.groupProfile,t=n.to,n=n.groupID,n=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(n,t);n&&n.updateRole(g.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(n){var n=n.payload.groupProfile,t=n.to,n=n.groupID,n=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(n,t);n&&n.updateRole(g.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(n){var t=n.payload.groupProfile.groupID,n=n.payload.messageRemindType;this._grpM.get(11).onGroupMessageRemindTypeUpdated({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(a){var n=a.groupProfile,t=n.groupID,n=n.topicID,a=a.elements,o=a.operationType,i=a.topicIDList,a=a.messageRemindType,s=this._grpM.get(10);o===17?s.onTopicCreated({groupID:t,topicID:n}):o===18?s.onTopicDeleted({groupID:t,topicIDList:i}):o===20&&s.onTopicMessageRemindTypeUpdated({groupID:t,topicID:n,messageRemindType:a})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),qa),nu=["relayFlag"],ou=(F(So,xe),Dr=te(So),E(So,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),o=this.getCloudConfig("polling_simplified_msg"),i=this.getCloudConfig("paging_grp_count");u.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(o," pagingGroupCount:").concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(o),this._commonGroupHandler.setPagingGroupCount(i)}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t,n=this;return e.conversationType===g.CONV_GROUP?(t=We(e.to)?je(e.to):e.to,this.hasLocalGroup(t)?$():this.getGroupProfile({groupID:t}).then(function(i){var i=i.data.group.type;return u.l("".concat(n._n,".guardForAVChatRoom. groupID:").concat(t," type:").concat(i)),i===g.GRP_AVCHATROOM?v(new Oe({code:i=M.MSG_SEND_FAIL_NOT_IN_AVCHATROOM,message:n.getErrorMessage(i,e.from,t),data:{message:e}})):$()})):$()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t,n=this;q(e)&&(t=this.get(10),e.forEach(function(o){var i=o.conversationID.replace(g.CONV_GROUP,"");We(i)&&t.updateLastMessage(i,o.lastMessage),n.groupMap.has(i)&&(n.groupMap.get(i).nextMessageSeq=o.lastMessage.sequence+1)}))}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach(function(i){var o,i=i.elements.groupMessageReadNotice;D(i)||(o=t.get(11),i.forEach(function(r){var c=r.groupID,s=r.topicID,s=s===void 0?void 0:s,r=r.lastMessageSeq,c=(u.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(c," lastMessageSeq:").concat(r)),"".concat(g.CONV_GROUP).concat(c)),d=!0;L(s)||(c="".concat(g.CONV_GROUP).concat(s),d=!1),o.updateIsReadAfterReadReport({conversationID:c,lastMessageSeq:r}),o.updateUnreadCount(c,d),o.clearGroupAtInfoList(c,d)}))})}},{key:"onReadReceiptList",value:function(e){var t=this;u.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach(function(a){var o=a.groupProfile,a=a.elements,o=o.groupID,i=t.get(11),a=a.readReceiptList;i.updateReadReceiptInfo({groupID:o,readReceiptList:a})})}},{key:"onGroupMessageModified",value:function(e){u.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var t=this.get(11);e.dataList.forEach(function(n){t.onMessageModified(l(l({},n),{},{conversationType:g.CONV_GROUP,to:n.topicID||n.groupID}))})}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new vn(e))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,o=this.get(11);e.forEach(function(c){t=c.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(c):(n.groupMap.set(t,new vn(c)),o.deleteGroupRoamingMessageInfo(t))});var i,a=this.getMyUserID(),s=Re(this.groupMap);try{for(s.s();!(i=s.n()).done;){var r=z(i.value,2)[1];r.selfInfo.userID=a,r.selfInfo.role==="Owner"&&(r.ownerID=a)}}catch(c){s.e(c)}finally{s.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return b(this.groupMap.values()).filter(function(e){return e.type!==g.GRP_ROOM})}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=b(this.groupMap).filter(function(t){return t=z(t,2),t[0],!L(t[1].lastMessage)});e.sort(function(t,n){return n[1].lastMessage.lastTime-t[1].lastMessage.lastTime}),this.groupMap=new Map(b(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n=this.getLocalGroupList();e&&this.emitOuterEvent(K.GROUP_LIST_UPDATED),t&&(e=JSON.parse(JSON.stringify(n)),this.get(11).updateConversationGroupProfile(e))}},{key:"getMyNameCardByGroupID",value:function(e){return e=this.getLocalGroupProfile(e),e?e.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMessageRemindType",value:function(e){var t=this;!q(e)||e.length===0||(e=e.filter(function(n){return!et(t.getLocalGroupProfile(n).type)})).length!==0&&(u.l("".concat(this._n,".getMessageRemindType groupIDList:").concat(e)),this.getGroupProfileAdvance({groupIDList:e,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then(function(o){var o=o.data.successGroupList,i=t.get(11);o.forEach(function(a){i.onGroupMessageRemindTypeUpdated({groupID:a.groupID,messageRemindType:q(a.members)?a.members[0].messageRemindType:""})})}))}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),o=new R("getGroupProfile"),i=e.groupID,a=e.groupCustomFieldFilter;return u.l("".concat(n," groupID:").concat(i)),this.getGroupProfileAdvance({groupIDList:[i],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:a,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}}).then(function(c){var c=c.data,r=c.successGroupList,c=c.failureGroupList;return u.l("".concat(n," ok")),0<c.length?v(c[0]):((c=et(r[0].type)&&!t.hasLocalGroup(i)?new vn(r[0]):(t.updateGroupMap(r),t.getLocalGroupProfile(i))).isSupportTopic||t.get(11).updateConversationGroupProfile([c]),o.setMessage("groupID:".concat(i," type:").concat(c.type," muteAllMembers:").concat(c.muteAllMembers," ownerID:").concat(c.ownerID)).end(),V({group:c}))}).catch(function(s){return o.setError(s).setMessage("groupID:".concat(e.groupID)).end(),u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"getGroupProfileAdvance",value:function(e){var t,n="".concat(this._n,".getGroupProfileAdvance"),a=e.groupIDList,o=(q(a)&&50<a.length&&(this.outputWarning("GetGroupProfileLimit"),a.length=50),[]),i=[],a=(a.forEach(function(s){(rt({groupID:s})?i:o).push(s)}),[]);return 0<o.length&&(t=this._getGroupProfileAdvance(l(l({},e),{},{groupIDList:o})),a.push(t)),0<i.length&&(t=this._getGroupProfileAdvance(l(l({},e),{},{groupIDList:i,relayFlag:0<o.length})),a.push(t)),Promise.all(a).then(function(s){var r=[],c=[];return s.forEach(function(d){r.push.apply(r,b(d.successGroupList)),c.push.apply(c,b(d.failureGroupList))}),V({successGroupList:r,failureGroupList:c})}).catch(function(s){return u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,o=n!==void 0&&n,i=ae(e,nu);return this.req({proto:h.GET_GRP_PROFILE,data:i}).then(function(a){return u.l("".concat(t._n,"._getGroupProfileAdvance ok. options:"),i),a=a.data.groups,{successGroupList:a.filter(function(s){return D(s.errorCode)||s.errorCode===0}),failureGroupList:a.filter(function(s){return s.errorCode&&s.errorCode!==0}).map(function(s){return new Oe({code:s.errorCode,message:s.errorInfo,data:{groupID:s.groupID}})})}}).catch(function(a){return o&&rt({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:v(a)})}},{key:"createGroup",value:function(e){var t=this,n=[g.GRP_PUBLIC,g.GRP_WORK,g.GRP_MEETING,g.GRP_AVCHATROOM,g.GRP_COMMUNITY],o="".concat(this._n,".").concat("createGroup"),i=e.type,a=e.groupID;if(e.name&&this._filterProfanity("name",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});if(!n.includes(i))return v({code:M.ILLEGAL_GRP_TYPE});if(!rt({type:i})){if(!L(a)&&rt({groupID:a}))return v({code:M.ILLEGAL_GRP_ID});e.isSupportTopic=void 0}if(et(i)&&!D(e.memberList)&&0<e.memberList.length&&(e.memberList=void 0),this._canIUseJoinOption(i)||D(e.joinOption)||(e.joinOption=void 0),rt({type:i})){if(!L(a)&&!rt({groupID:a}))return v({code:M.ILLEGAL_GRP_ID});e.isSupportTopic=e.isSupportTopic===!0?1:0}var s=new R("createGroup"),r=(u.l("".concat(o," options:"),e),null),c=[];return this.req({proto:h.CREATE_GRP,data:l(l({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then(function(m){var m=m.data,p=m.groupID,m=m.overLimitUserIDList,_=m===void 0?[]:m,m=(r=p,c=_,"groupType:".concat(e.type," groupID:").concat(p," overLimitUserIDList:").concat(_));if(s.setMessage(m).end(),u.l("".concat(o," ok. ").concat(m)),e.type===g.GRP_AVCHATROOM)return t.getGroupProfile({groupID:p});if(e.type===g.GRP_COMMUNITY&&e.isSupportTopic===1)return t.getGroupProfile({groupID:p});L(e.memberList)||L(_)||(e.memberList=e.memberList.filter(function(P){return _.indexOf(P.userID)===-1})),t.updateGroupMap([l(l({},e),{},{groupID:p})]);var m=t.get(2),N="",f=0,I=(e.type===g.GRP_COMMUNITY?(N=t.isIntl()?"Create Community":"\u521B\u5EFA\u793E\u7FA4",f=1):N=t.isIntl()?"Create Group":"\u521B\u5EFA\u7FA4\u7EC4",t.get(4).getMyNick()),N=m.createCustomMessage({to:p,conversationType:g.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:N,cmd:f,opUser:I||t.getMyUserID(),version:4})}});return m.sendMessageInstance(N),t.emitGroupListUpdate(),t.getGroupProfile({groupID:p})}).then(function(p){var p=p.data.group,m=p.selfInfo,_=m.nameCard,m=m.joinTime;return p.updateSelfInfo({nameCard:_,joinTime:m,messageRemindType:g.MSG_REMIND_ACPT_AND_NOTE,role:g.GRP_MBR_ROLE_OWNER}),V({group:p,overLimitUserIDList:c})}).catch(function(d){var p;return s.setMessage("groupType:".concat(e.type)).setError(d).end(),d.code===10010||d.code===10007?(t._silentlyGetGroupProfile(d.code,r),t.updateGroupMap([l(l({},e),{},{groupID:r})]),(p=t.getLocalGroupProfile(r)).selfInfo.role=g.GRP_MBR_ROLE_OWNER,V({group:p,overLimitUserIDList:c})):(u.e("".concat(o," failed. error:"),d),v(d))})}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup"),o="groupID:".concat(e);if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===g.GRP_WORK)return v(new Oe({code:M.CANNOT_DISMISS_WORK}));var i=new R("dismissGroup");return i.setMessage(o),u.l("".concat(n," ").concat(o)),this.req({proto:h.DISMISS_GRP,data:{groupID:e}}).then(function(){return i.end(),u.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),V({groupID:e})}).catch(function(a){return i.setError(a).end(),u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"updateGroupProfile",value:function(e){var t,n=this,o="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)&&(t=this.getLocalGroupProfile(e.groupID).type,this._canIUseJoinOption(t)||D(e.joinOption)||(u.w("".concat(o," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)),D(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&this._filterProfanity("name",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});var i=new R("updateGroupProfile");return i.setMessage(JSON.stringify(e)),u.l("".concat(o," groupID:").concat(e.groupID)),this.req({proto:h.UPDATE_GRP_PROFILE,data:e}).then(function(){return i.end(),u.l("".concat(o," ok")),n.hasLocalGroup(e.groupID)&&n.groupMap.get(e.groupID).updateGroup(e),V({group:n.groupMap.get(e.groupID)})}).catch(function(a){return i.setError(a).end(),u.l("".concat(o," failed. error:"),a),v(a)})}},{key:"_filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],ln),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,o=e.type,i="".concat(this._n,".joinGroup");if(o===g.GRP_WORK)return v({code:M.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return $({status:g.JOIN_STATUS_ALREADY_IN_GROUP});var a=new R("applyJoinGroup");return this.getGroupProfile({groupID:n}).then(function(){return a.setMessage("groupID:".concat(n," joinedStatus:").concat(g.JOIN_STATUS_ALREADY_IN_GROUP)).end(),$({status:g.JOIN_STATUS_ALREADY_IN_GROUP})}).catch(function(s){return a.setMessage("groupID:".concat(n," unjoined")).end(),u.w("".concat(i," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)})}return u.l("".concat(i," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(a){var t=this,n="".concat(this._n,".").concat("applyJoinGroup"),o=a.groupID;if(!L(a.applyMessage)&&this._filterProfanity("applyMessage",a)===!1)return v({code:M.PROFANITY_FOUND});var i=new R("applyJoinGroup"),a=l({},a),s=this.canIUse(Ce.AV_HISTORY_MSG);return s&&(a.historyMessageFlag=1),this.get(11).deleteTopicRoamingMessageInfo(o),this.req({proto:h.APPLY_JOIN_GRP,data:a}).then(function(I){var I=I.data,c=I.joinedStatus,d=I.longPollingKey,p=I.startSeq,_=I.avChatRoomFlag,m=I.avChatRoomKey,f=I.messageList,I="groupID:".concat(o," joinedStatus:").concat(c," longPollingKey:").concat(d," startSeq:").concat(p)+" avChatRoomFlag:".concat(_," canGetAVChatRoomHistoryMessage:").concat(s,",")+" history message count:".concat(L(f)?0:f.length);switch(i.setMessage(I).end(),u.l("".concat(n," ok. ").concat(I)),c){case Ne:return V({status:Ne});case _e:return t.getGroupProfile({groupID:o}).then(function(P){return P=P.data.group,t._handleJoinResult({group:P,avChatRoomFlag:_,longPollingKey:d,startSeq:p,avChatRoomKey:m,messageList:f})}).catch(function(P){var H;return P.code===10010||P.code===10007?(t._silentlyGetGroupProfile(P.code,o),H=new vn({groupID:o}),t.updateGroupMap([H]),t._handleJoinResult({group:H,avChatRoomFlag:_,longPollingKey:d,startSeq:p,avChatRoomKey:m,messageList:f})):(u.e("".concat(n," failed. error:"),P),v(P))});default:var N=new Oe({code:M.JOIN_GRP_FAIL});return u.e("".concat(n," failed. error:"),N),v(N)}}).catch(function(r){return i.setMessage("groupID:".concat(o)).setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"_handleJoinResult",value:function(e){var t=this,n=e.group,o=e.avChatRoomFlag,i=e.longPollingKey,a=e.startSeq,s=e.avChatRoomKey,r=e.messageList,c=n.groupID;return o===1?(this.get(11).setCompleted("".concat(g.CONV_GROUP).concat(c)),this._groupAttributesHandler.initGroupAttributesCache({groupID:c,avChatRoomKey:s}),this._groupCountersHandler.initGroupCountersCache({groupID:c,avChatRoomKey:s}),(e=D(i)?this._AVChatRoomHandler.handleJoinResult({group:n}):this._AVChatRoomHandler.startRunLoop({group:n,longPollingKey:i,startSeq:a})).then(function(){t._onAVChatRoomHistoryMessage(r,c)}),e):(this.emitGroupListUpdate(!0,!1),V({status:_e,group:n}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup"),o="groupID:".concat(e),i=(u.l("".concat(n," ").concat(o)),this.checkJoinedAVChatRoomByID(e));if(!i&&!this.hasLocalGroup(e))return v({code:M.MEMBER_NOT_IN_GRP});if(i&&!this.isLoggedIn())return u.l("".concat(n," anonymously ok. ").concat(o)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),$({groupID:e});var a=new R("quitGroup");return a.setMessage(o),this.req({proto:h.QUIT_GRP,data:{groupID:e}}).then(function(){return a.end(),u.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),V({groupID:e})}).catch(function(s){return a.setError(s).end(),u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"searchGroupByID",value:function(e){var t="".concat(this._n,".").concat("searchGroupByID"),n={groupIDList:[e]},o=new R("searchGroupByID");return o.setMessage("groupID:".concat(e)),u.l("".concat(t," groupID:").concat(e)),this.req({proto:h.SEARCH_GRP,data:n}).then(function(i){if(i=i.data.groupProfile,i[0].errorCode!==0)throw new Oe({code:i[0].errorCode,message:i[0].errorInfo});return o.end(),u.l("".concat(t," ok")),V({group:new vn(i[0])})}).catch(function(i){return o.setError(i).end(),u.w("".concat(t," failed. error:"),i),v(i)})}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===g.GRP_AVCHATROOM)return v({code:M.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return v({code:M.CANNOT_CHANGE_OWNER_TO_SELF});var o=new R("changeGroupOwner");return o.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),u.l("".concat(n," groupID:").concat(e.groupID)),this.req({proto:h.CHANGE_GRP_OWNER,data:e}).then(function(){o.end(),u.l("".concat(n," ok"));var i,a=e.groupID,s=e.newOwnerID,r=(t.groupMap.get(a).ownerID=s,t._groupMemberHandler.getLocalGroupMemberList(a));return r instanceof Map&&(i=r.get(t.getMyUserID()),D(i)||(i.updateRole("Member"),t.groupMap.get(a).selfInfo.role="Member"),i=r.get(s),D(i)||i.updateRole("Owner")),t.emitGroupListUpdate(!0,!1),V({group:t.groupMap.get(a)})}).catch(function(i){return o.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i)})}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,o,i,a,s=this,r="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,d=e.handleMessage,p=e.message,_=e.application,m=(p?(t=p.payload.operatorID,n=p.payload.groupProfile.groupID,o=p.payload.authentication,i=p.payload.messageKey):_&&(t=_.applicant,n=_.groupID,o=_.authentication,i=_.messageKey),h.HANDLE_GRP_APPLICATION),f=(_&&_.applicationType===2&&(m=h.HANDLE_INVITE_JOIN_GRP,a=_.userID),new R("handleGroupApplication"));return f.setMessage("groupID:".concat(n)),u.l("".concat(r," groupID:").concat(n)),this.req({proto:m,data:{handleAction:c,handleMessage:d,applicant:t,invitee:a,groupID:n,authentication:o,messageKey:i}}).then(function(){return f.end(),u.l("".concat(r," ok")),p&&s._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),V({group:s.getLocalGroupProfile(n)})}).catch(function(I){return f.setError(I).end(),u.e("".concat(r," failed. error"),I),v(I)})}},{key:"handleGroupInvitation",value:function(e){var t=this,n="".concat(this._n,".").concat("handleGroupInvitation"),s=e.message.payload,o=s.groupProfile.groupID,i=s.authentication,a=s.messageKey,s=s.operatorID,r=e.handleAction,c=new R("handleGroupInvitation");return c.setMessage("groupID:".concat(o," inviter:").concat(s," handleAction:").concat(r)),u.l("".concat(n," groupID:").concat(o," inviter:").concat(s," handleAction:").concat(r)),this.req({proto:h.HANDLE_GRP_INVITATION,data:l(l({},e),{},{inviter:s,groupID:o,authentication:i,messageKey:a})}).then(function(){return c.end(),u.l("".concat(n," ok")),t._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),V({group:t.getLocalGroupProfile(o)})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error"),d),v(d)})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".getGroupOnlineMemberCount"),o=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e),i=this.hasLocalGroup(e);if(u.l("".concat(n," groupID:").concat(e," isAVChatRoom:").concat(o," has:").concat(i)),o)return this._AVChatRoomHandler.getGroupOnlineMemberCount(e);if(!i)return $({memberCount:0});if(o=Date.now(),this._onlineMemberCountMap.has(e)){if(i=this._onlineMemberCountMap.get(e),o-i.lastReqTime<=6e4)return $({memberCount:i.memberCount});i.lastReqTime=o}return this.requestOnlineCount(e).then(function(a){return a=a.data.memberCount,a=a===void 0?0:a,t._onlineMemberCountMap.set(e,{lastReqTime:Date.now(),memberCount:a}),u.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(a)),$({memberCount:a})}).catch(function(a){return u.w("".concat(n," failed. error:"),a),Promise.reject(a)})}},{key:"requestOnlineCount",value:function(e){return this.req({proto:h.GET_ONLINE_MBR_NUM,data:{groupID:e}})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t=this.checkJoinedAVChatRoomByID(e);u.l("".concat(this._n,".deleteLocalGroupAndConversation isJoinedAVChatRoom:").concat(t)),t&&this.get(11).deleteLocalConversation("".concat(g.CONV_GROUP).concat(e)),!rt({groupID:e})||(t=this.getLocalGroupProfile(e))&&t.isSupportTopic===!0&&this.get(10).deleteTopicListInCommunity(e),this._deleteLocalGroup(e),this._onlineMemberCountMap.delete(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this._groupMemberHandler.deleteGroupMemberList(e)}},{key:"sendMessage",value:function(e,t){return q(e._receiverList)&&0<e._receiverList.length&&!this.canIUse(Ce.MSG_TO_SPECIFIED_GRP_MBR)?this.cannotUseCommercialAbility("group direct messages"):(e=this.createGroupMessagePack(e,t),this.req(e))}},{key:"createGroupMessagePack",value:function(e,c){var n=null,o=(c&&c.offlinePushInfo&&(n=c.offlinePushInfo),""),i=(ne(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),a=(Ie(c)&&Ie(c.messageControlInfo)&&(a=(r=c.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,a===!0&&i.push("NoUnread"),s===!0&&i.push("NoLastMsg"),r===!0&&i.push("NoMsgCheck")),void 0),s=(q(e._receiverList)&&0<e._receiverList.length&&(a=e._receiverList,50<e._receiverList.length&&(a=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit"))),this.isOnlineMessage(e,c)?1:0),r=e.getGroupAtInfoList(),c={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:o,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==g.MSG_TEXT||L(r)?void 0:r,onlineOnlyFlag:s,clientTime:e.clientTime,offlinePushInfo:n?{pushFlag:n.disablePush===!0?1:0,title:n.title||"",desc:n.description||"",ext:n.extension||"",apnsInfo:{badgeMode:n.ignoreIOSBadge===!0?1:0,isVoipPush:this._isVoipPush(n)},androidInfo:{OPPOChannelID:n.androidOPPOChannelID||""}}:void 0,messageControlInfo:s==0?i:void 0,needReadReceipt:e.needReadReceipt!==!0||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:a,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0};return We(e.to)&&(c.groupID=je(e.to),c.topicID=e.to),{proto:h.SEND_GRP_MSG,tjgID:this.generateTjgID(e),data:c}}},{key:"_isVoipPush",value:function(e){var t=void 0;return t=D(e.disableVoipPush)?t:e.disableVoipPush===!1?1:0}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return We(e.to)&&(t.groupID=je(e.to),t.topicID=e.to),this.req({proto:h.REVOKE_GRP_MSG,data:t})}},{key:"deleteMessage",value:function(n){var t=n.to,n=n.keyList,n=(u.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length)),{groupID:t,deleter:this.getMyUserID(),keyList:n});return We(t)&&(n.groupID=je(t),n.topicID=t),this.req({proto:h.DEL_GRP_MSG,data:n})}},{key:"modifyRemoteMessage",value:function(a){var c=a.to,t=a.sequence,n=a.payload,o=a.type,i=a.version,i=i===void 0?0:i,a=a.cloudCustomData,s=c,r=void 0,c=(We(c)&&(s=je(c),r=c),void 0);return ir(o)&&(c=[]).push({type:o,content:n}),this.req({proto:h.MODIFY_GRP_MSG,data:{groupID:s,topicID:r,sequence:t,version:i,elements:c,cloudCustomData:a}})}},{key:"getRoamingMessage",value:function(a){var t=this,n="".concat(this._n,".getRoamingMessage"),o=a.conversationID,i=a.groupID,a=a.sequence,s=new R("getGroupRoamingMessages"),r=0,c=void 0;return We(i)&&(i=je(c=i)),this._computeLastSequence({groupID:i,topicID:c,sequence:a}).then(function(d){return r=d,u.l("".concat(n," groupID:").concat(i," startSequence:").concat(r)),t.req({proto:h.GET_GRP_ROAMING_MSG,data:{groupID:i,count:21,sequence:r,topicID:c}})}).then(function(f){var m=f.data,p=m.messageList,_=m.complete,m=m.invisibleSequenceList,m=m===void 0?[]:m,f=f.data.nextSequence,f=f===void 0?0:f,I=(D(p)?u.l("".concat(n," ok. complete:").concat(_," nextSequence:").concat(f," but messageList is undefined!")):u.l("".concat(n," ok. complete:").concat(_," nextSequence:").concat(f," count:").concat(p.length)),s.setMessage("groupID:".concat(i," topicID:").concat(c," startSequence:").concat(r," complete:").concat(_," nextSequence:").concat(f)).end(),t.get(11)),N=[];return L(p)?1<=f&&I.updateRoamingMessageSequence(o,f):(I.updateRoamingMessageSequence(o,f),N=I.onRoamingMessage(p,o),I.updateIsRead(o),I.patchConversationLastMessage(o)),(_===2||f<1)&&(I.setCompleted(o),f=""),u.l("".concat(n," nextReqID:").concat(f,", stored message count:").concat(N.length,", invisible sequence count:").concat(m.length)),{nextReqID:f+"",storedMessageList:N}}).catch(function(d){return s.setError(d).setMessage("groupID:".concat(i," topicID:").concat(c," startSequence:").concat(r)).end(),u.w("".concat(n," failed. error:"),d),v(d)})}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(g.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".").concat("getReadReceiptList"),n=this._getGroupIDOfMessage(e[0]),o=this.getMyUserID(),i=e.filter(function(s){return s.from===o&&s.needReadReceipt===!0}).map(function(s){return{sequence:s.sequence}});if(u.l("".concat(t," groupID:").concat(n," sequenceList:").concat(JSON.stringify(i))),i.length===0)return $({messageList:e});var a=new R("getReadReceiptList");return a.setMessage("groupID:".concat(n)),this.req({proto:h.GET_READ_RECEIPT,data:{groupID:n,sequenceList:i}}).then(function(s){return a.end(),u.l("".concat(t," ok")),s=s.data.readReceiptList,q(s)&&s.forEach(function(r){e.forEach(function(c){r.code===0&&r.sequence===c.sequence&&(c.readReceiptInfo.readCount=r.readCount,c.readReceiptInfo.unreadCount=r.unreadCount)})}),V({messageList:e})}).catch(function(s){return a.setError(s).end(),u.w("".concat(t," failed. error:"),s),v(s)})}},{key:"sendReadReceipt",value:function(a){var t="".concat(this._n,".").concat("sendReadReceipt"),n=this._getGroupIDOfMessage(a[0]),o=new R("sendReadReceipt"),i=(o.setMessage("groupID:".concat(n)),this.getMyUserID()),a=a.filter(function(s){return s.from!==i&&s.needReadReceipt===!0}).map(function(s){return{sequence:s.sequence}});return a.length===0?v({code:M.READ_RECEIPT_MSG_LIST_EMPTY}):(u.l("".concat(t,". sequenceList:").concat(JSON.stringify(a))),this.req({proto:h.SEND_READ_RECEIPT,data:{groupID:n,sequenceList:a}}).then(function(s){return o.end(),u.l("".concat(t," ok")),V()}).catch(function(s){return o.setError(s).end(),u.w("".concat(t," failed. error:"),s),v(s)}))}},{key:"getReadReceiptDetail",value:function(p){var t=this,i=p.message,c=p.filter,d=p.cursor,p=p.count,n=this._getGroupIDOfMessage(i),o=i.ID,i=i.sequence,a="".concat(this._n,".").concat("getReadReceiptDetail"),s=this._receiptDetailCompleteMap.get(o)||!1,r=c!==0&&c!==1?0:c,c=ne(d)?d:"",d=!ge(p)||p<=0||100<=p?100:p,p="groupID:".concat(n," sequence:").concat(i," cursor:").concat(c," filter:").concat(r," completeFlag:").concat(s),_=(u.l("".concat(a," ").concat(p)),{cursor:"",isCompleted:!1,messageID:o,unreadUserIDList:[],readUserIDList:[]}),m=new R("getReadReceiptDetail");return m.setMessage(p),this.req({proto:h.GET_READ_RECEIPT_DETAIL,data:{groupID:n,sequence:i,flag:r,cursor:c,count:d}}).then(function(H){m.end();var H=H.data,I=H.cursor,N=H.isCompleted,P=H.unreadUserIDList,H=H.readUserIDList;return _.cursor=I,N===1&&(_.isCompleted=!0,t._receiptDetailCompleteMap.set(o,!0)),r===0?_.readUserIDList=H.map(function(Z){return Z.userID}):r===1&&(_.unreadUserIDList=P.map(function(Z){return Z.userID})),u.l("".concat(a," ok")),V(_)}).catch(function(f){return m.setError(f).end(),u.w("".concat(a," failed. error:"),f),v(f)})}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),o=e.groupID,i=e.count,a=e.sequence,s=e.direction,r=a;if(D(a)){if(s===1)return $({messageList:[],isCompleted:!0,nextMessageSeq:""});this.hasLocalGroup(o)&&(r=1<(c=this.getLocalGroupProfile(o).nextMessageSeq)?c-1:0),We(o)&&(r=0)}else s===1&&(r=a+i-1);var c=void 0,d=(We(o)&&(o=je(c=o)),"".concat(c?"topicID:".concat(c):"groupID:".concat(o)," sequence:").concat(a," direction:").concat(s)),p=(u.l("".concat(n," ").concat(d)),new R("getGroupRoamingMessagesHopping"));return this.req({proto:h.GET_GRP_ROAMING_MSG,data:{groupID:o,topicID:c,count:i,sequence:r}}).then(function(f){var f=f.data,m=f.messageList,f=f.complete,I="complete:".concat(f," count:").concat(m?m.length:0);return u.l("".concat(n," ok. ").concat(I)),p.setMessage("".concat(d," ").concat(I)).end(),f===2||L(m)?(I=t._computeResult(),V(I)):(f="".concat(g.CONV_GROUP).concat(e.groupID),I=t.get(11).onRoamingMessage(m,f,!1),f=t._computeResult({direction:s,sequence:a,remoteMessageList:m,processedMessageList:I}),V(f))}).catch(function(_){return p.setError(_).setMessage("groupID:".concat(o," sequence:").concat(a," count:").concat(i)).end(),u.w("".concat(n," failed. error:"),_),v(_)})}},{key:"_computeResult",value:function(a){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(D(a))return t.isCompleted=!0,t;var n=a.direction,o=a.sequence,i=a.remoteMessageList,i=i===void 0?[]:i,a=a.processedMessageList,a=a===void 0?[]:a,s=i.length;return n===1?(t.nextMessageSeq=i[0].sequence+1,a.forEach(function(r){r.sequence>=o&&t.messageList.push(r)}),t.messageList.length===0&&i[0].sequence<o&&(t.isCompleted=!0,t.nextMessageSeq="")):(t.nextMessageSeq=i[s-1].sequence-1,t.messageList=b(a),t.nextMessageSeq===0&&(t.isCompleted=!0,t.nextMessageSeq="")),t}},{key:"setMessageRead",value:function(a){var t=this,n=a.conversationID,o=a.lastMessageSeq,i="".concat(this._n,".").concat("setMessageRead"),a="conversationID:".concat(n," lastMessageSeq:").concat(o),s=(u.l("".concat(i," ").concat(a)),ge(o)||this.outputWarning("DoNotModifyLastSeq"),new R("setMessageRead")),r=(s.setMessage(a),n.replace(g.CONV_GROUP,"")),c=void 0;return We(r)&&(r=je(c=r)),this.req({proto:h.SET_GRP_MSG_READ,data:{groupID:r,topicID:c,messageReadSeq:o}}).then(function(){s.end(),u.l("".concat(i," ok"));var d,p=t.get(11),_=(p.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:o}),!0);return D(c)||(_=!1,(d=t.get(10).getLocalTopic(r,c))&&d.updateSelfInfo({readedSequence:o})),p.updateUnreadCount(n,_),V()}).catch(function(d){return s.setError(d).end(),u.l("".concat(i," failed. error:"),d),v(d)})}},{key:"_computeLastSequence",value:function(o){var t=o.groupID,n=o.topicID,n=n===void 0?void 0:n,o=o.sequence;return 0<o?Promise.resolve(o):D(n)?this.getGroupLastSequence(t):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t="".concat(this._n,".").concat("getGroupLastSequence"),n=new R("getGroupLastSequence"),o=0,i="",a="groupID:".concat(e);if(this.hasLocalGroup(e)){var s=this.getLocalGroupProfile(e),r=s.lastMessage;if(0<r.lastSequence&&r.onlineOnlyFlag===!1)return o=r.lastSequence,i="".concat(a,", ").concat(o," from group.lastMessage.lastSequence"),u.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o);if(1<s.nextMessageSeq)return o=s.nextMessageSeq-1,i="".concat(a,", ").concat(o," from group.nextMessageSeq"),u.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o)}return r=this.get(11).getLocalConversation("GROUP".concat(e)),r&&r.lastMessage.lastSequence&&r.lastMessage.onlineOnlyFlag===!1?(o=r.lastMessage.lastSequence,i="".concat(a,", ").concat(o," from conversation.lastMessage.lastSequence"),u.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o)):this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then(function(c){return c=c.data.successGroupList,L(c)?u.w("".concat(t," ").concat(a,", empty successGroupList")):(o=c[0].nextMessageSeq-1,i="".concat(a,", ").concat(o," from remote"),u.l("".concat(t," ").concat(i))),n.setMessage(i).end(),o}).catch(function(c){return n.setError(c).setMessage(a).end(),u.w("".concat(t," failed. error:"),c),v(c)})}},{key:"isMessageFromOrToAVChatroom",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||t.onlineUserOnly!==!0)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==g.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e,t){var n;L(e)||(u.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(t," count:").concat(e.length)),n=[],e.forEach(function(o){n.push(l(l({},o),{},{isHistoryMessage:1}))}),this.onAVChatRoomMessage(n,t))}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler.onMessage(e,1<arguments.length&&arguments[1]!==void 0?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=new R("getGroupSimplifiedInfo");return this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}}).then(function(n){return n=n.data.successGroupList,t.setMessage("groupID:".concat(e," type:").concat(n[0].type)).end(),n[0]}).catch(function(n){t.setError(n).setMessage("groupID:".concat(e)).end()})}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return e===2&&!L(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return e===2&&L(t)}},{key:"getMessageExtensions",value:function(e,t){return u.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({proto:h.GET_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return u.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.req({proto:h.MODIFY_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"_genNotifyReqList",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var i=e[n],r=this.getLocalGroupProfile(i).type,a=this._getGroupLastRevokedTime(i),s=1e3*Et(),r={notifyType:1,limit:20,type:rt({type:r,groupID:i})?g.GRP_COMMUNITY:void 0,groupID:i,beginTime:a,endTime:s};t.push(r)}return t}},{key:"getGroupNotify",value:function(e){var t=this,n="".concat(this._n,".getGroupNotify"),o=e.filter(function(a){var r=t.getLocalGroupProfile(a),s=r.type,r=r.isSupportTopic;return t.hasLocalGroup(a)&&!et(s)&&!r}),i="filteredGroupIDList.length:".concat(o.length);o.length<=10&&(i="filteredGroupIDList:".concat(JSON.stringify(o))),u.l("".concat(n," ").concat(i)),o.length!==0&&this.req({proto:h.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(e)}}).then(function(c){var s,c=c.data.notifyRspList,r=[],c=(q(c)&&(s={dataList:[]},c.forEach(function(d){var p=d.nextRevokedTime,_=d.groupID;s.dataList.push({elements:{revokedInfos:t._genRevokedInfos(d)}}),p!==0?(t._setGroupLastRevokedTime(_,p),r.push(_)):t._setGroupLastRevokedTime(_,1e3*Et())}),t.onGroupMessageRevoked(s)),0<r.length&&t.getGroupNotify(r),"nextGroupIDList.length:".concat(r.length));r.length<=10&&(c="nextGroupIDList:".concat(JSON.stringify(r))),u.l("".concat(n," ").concat(c))}).catch(function(a){u.e("".concat(n," failed. error:"),a)})}},{key:"_genRevokedInfos",value:function(e){var t=e.notifyList,n=e.groupID,o=[];return q(t)&&t.forEach(function(i){o.push({groupID:n,sequence:i.sequence,random:i.random,revokerInfo:l({},i.revokerInfo)})}),o}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(e){return this._groupMemberHandler.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._groupMemberHandler.getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._groupMemberHandler.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._groupMemberHandler.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._groupMemberHandler.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._groupMemberHandler.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._groupMemberHandler.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._groupMemberHandler.setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._groupMemberHandler.markGroupMemberList(e)}},{key:"modifyGroupMemberInfo",value:function(e){return this._groupMemberHandler.modifyGroupMemberInfo(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var t=this.getLocalGroupProfile(e);return t&&et(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===g.GRP_PUBLIC||rt({type:e})}},{key:"_silentlyGetGroupProfile",value:function(e,t){var n=setTimeout(this.getGroupProfile.bind(this,{groupID:t}),3e3);this._timeoutIDs.push(n),u.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(e," groupID:").concat(t," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach(function(e){clearTimeout(e)}),this._timeoutIDs=[]}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),So),iu=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],au=(E(xa,[{key:"_initTopic",value:function(e){for(var t in e)iu.indexOf(t)<0||(t==="selfInfo"?this.updateSelfInfo(e[t]):this[t]=t==="muteAllMembers"?e[t]===1:e[t])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=yr(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){D(e.selfInfo)||this.updateSelfInfo(e.selfInfo),D(e.muteAllMembers)||(this.muteAllMembers=e.muteAllMembers===1),bt(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return bt(this.selfInfo,e,[],[""])!==0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),xa),su=(F(Do,xe),Tr=te(Do),E(Do,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");D(e)||(this.TOPIC_CACHE_TIME=Number(e)),D(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(K.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,o=e.topicIDList;(o===void 0?[]:o).forEach(function(i){t._deleteLocalTopic(n,i)}),this.emitOuterEvent(K.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(i){var t,n=i.groupID,o=i.topicID,i=i.messageRemindType,a=this.getLocalTopic(n,o);a&&((t=a.updateSelfInfo({messageRemindType:i}))&&this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:n,topic:a}),u.d("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(o)+" messageRemindType:".concat(i," isTopicUpdated:").concat(t)))}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,n=this.getLocalTopic(t,n);n&&(n.updateTopic(e),this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:t,topic:n}))}},{key:"onConversationProxy",value:function(n){var i=n.topicID,t=n.unreadCount,n=n.groupAtInfoList,o=je(i),i=this.getLocalTopic(o,i),a=!1;i&&(D(t)||i.unreadCount===t||(i.updateUnreadCount(t),a=!0),D(n)||(i.updateGroupAtInfoList(n),a=!0)),a&&this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:o,topic:i})}},{key:"onMessageSent",value:function(n){var t=n.groupID,o=n.topicID,n=n.lastMessage,o=this.getLocalTopic(t,o);o&&(o.nextMessageSeq+=1,o.updateLastMessage(n),this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:t,topic:o}))}},{key:"onMessageModified",value:function(e){var t,n=e.to,o=e.time,i=e.sequence,a=e.elements,s=e.cloudCustomData,r=e.messageVersion,c=je(n),d=this.getLocalTopic(c,n);d&&(t=d.lastMessage,u.d("".concat(this._n,".onMessageModified topicID:").concat(n," lastMessage:"),JSON.stringify(t),"options:",JSON.stringify(e)),t&&(t.payload===null||t.lastTime===o&&t.lastSequence===i&&t.version!==r)&&(t.type=a[0].type,t.payload=a[0].content,t.messageForShow=ho(t.type,t.payload,this.isIntl()),t.cloudCustomData=s,t.version=r,t.lastSequence=i,t.lastTime=o,this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:c,topic:d})))}},{key:"onMessageRevoked",value:function(e){var t,n,o,i=this;e.length!==0&&(n=t=null,o=!1,e.forEach(function(a){var s=a.to;n=je(s),(t=i.getLocalTopic(n,s))&&(t.reduceUnreadCount()&&(o=!0),t.isLastMessageRevoked(a)&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(a.revoker),o=!0))}),o&&this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"isLastMessageRevoked",value:function(t){var o=t.topicID,t=t.sequence,n=je(o),n=this.getLocalTopic(n,o),o=!1;return o=n?n.isLastMessageRevoked({sequence:t}):o}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("createTopicInCommunity"),o=e.topicID;if(!D(o)&&!We(o))return v({code:M.ILLEGAL_TOPIC_ID});if(e.topicName&&this._filterProfanity("topicName",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});var i=new R("createTopicInCommunity");return this.req({proto:h.CREATE_TOPIC,data:l({},e)}).then(function(a){return a=a.data.topicID,i.setMessage("topicID:".concat(a)).end(),u.l("".concat(n," ok. topicID:").concat(a)),t._updateTopicMap([l(l({},e),{},{topicID:a})]),V({topicID:a})}).catch(function(a){return i.setError(a).end(),u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"deleteTopicFromCommunity",value:function(i){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),o=i.groupID,i=i.topicIDList,i=i===void 0?[]:i,a=new R("deleteTopicFromCommunity");return a.setMessage("groupID:".concat(o," topicIDList:").concat(i)),this.req({proto:h.DELETE_TOPIC,data:{groupID:o,topicIDList:i}}).then(function(d){var d=d.data.resultList,r=[],c=[],d=((d===void 0?[]:d).forEach(function(f){var _=f.topicID,m=f.errorCode,f=f.errorInfo;m===0?r.push({topicID:_}):c.push({topicID:_,code:m,message:f})}),"success count:".concat(r.length,", fail count:").concat(c.length));return a.setMoreMessage(d).end(),u.l("".concat(n," ok. ").concat(d)),r.forEach(function(p){t._deleteLocalTopic(o,p.topicID)}),V({successTopicList:r,failureTopicList:c})}).catch(function(s){return a.setError(s).end(),u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"updateTopicProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateTopicProfile");if(u.l("".concat(n," options:"),e),e.topicName&&this._filterProfanity("topicName",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});var o=new R("updateTopicProfile");return o.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),D(e.muteAllMembers)||(e.muteAllMembers=e.muteAllMembers===!0?"On":"Off"),this.req({proto:h.UPDATE_TOPIC_PROFILE,data:l({},e)}).then(function(){return o.end(),u.l("".concat(n," ok")),t._updateTopicMap([e]),V({topic:t.getLocalTopic(e.groupID,e.topicID)})}).catch(function(i){return o.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i)})}},{key:"getTopicList",value:function(i){var t=this,n="".concat(this._n,".").concat("getTopicList"),o=i.groupID,i=i.topicIDList,i=i===void 0?[]:i,a=i.length===0,s=new R("getTopicList");if(s.setMessage("groupID:".concat(o)),this._getTopicTimeMap.has(o)){var c=this._getTopicTimeMap.get(o),r=c.isGetAll,c=c.time;if((r||!r&&!a)&&Date.now()-c<1e3*this.TOPIC_CACHE_TIME&&(r=this._getLocalTopicList(o,i),a||r.length===i.length))return s.setMoreMessage("from cache, topic count:".concat(r.length)).end(),u.l("".concat(n," groupID:").concat(o," from cache, topic count:").concat(r.length)),$({successTopicList:r,failureTopicList:[]})}return this.req({proto:h.GET_TOPIC_LIST,data:{groupID:o,topicIDList:i}}).then(function(f){var f=f.data.topicInfoList,p=[],_=[],m=[],f=((f===void 0?[]:f).forEach(function(Z){var N=Z.topic,P=Z.selfInfo,H=Z.errorCode,Z=Z.errorInfo,le=N.topicID;H===0?(p.push(l(l({},N),{},{selfInfo:P})),_.push(le)):m.push({topicID:le,code:H,message:Z})}),t._updateTopicMap(p),t._handleTopicAtInfo(p),"success count:".concat(_.length,", fail count:").concat(m.length)),f=(s.setMoreMessage(f).end(),u.l("".concat(n," groupID:").concat(o," from remote, ").concat(f)),[]);return L(_)||(t._getTopicTimeMap.set(o,{time:Date.now(),isGetAll:a}),f=t._getLocalTopicList(o,_)),V({successTopicList:f,failureTopicList:m})}).catch(function(d){return s.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return n=this._topicMap.has(e)?this._topicMap.get(e).get(t):n}},{key:"_getLocalTopicList",value:function(n){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],n=this._topicMap.get(n),o=[];return n&&(o=b(n.values())),t.length===0?o:o.filter(function(i){return t.includes(i.topicID)})}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&this._topicMap.get(e).has(t)&&(this._topicMap.get(e).delete(t),u.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach(function(r){var i=r.groupID,a=r.topicID,s=null,r=(t._topicMap.has(i)||t._topicMap.set(i,new Map),t._topicMap.get(i).has(a)?(s=t._topicMap.get(i).get(a)).updateTopic(r):(t._getTopicLastMessage(r),s=new au(r,t.isIntl()),t._topicMap.get(i).set(a,s)),t._computeUnreadCount(s));s.updateUnreadCount(r),n.push({conversationID:"".concat(g.CONV_GROUP).concat(a),type:g.CONV_TOPIC,unreadCount:r})}),0<n.length&&this.get(11).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;D(e)?b(this._getTopicTimeMap.keys()).forEach(function(n){t._getTopicTimeMap.set(n,0)}):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=b(this._topicMap.keys()),n=[],o=this.get(11);t.forEach(function(i){var a=[],s=e._getLocalTopicList(i);o.deleteTopicRoamingMessageInfo(i),s.forEach(function(r){var c=r.lastMessage.lastTime,c=c===void 0?0:c;Date.now()-1e3*c<1e3*e.TOPIC_LAST_ACTIVE_TIME&&a.push(r.topicID)}),0<a.length&&n.push({groupID:i,topicIDList:a})}),u.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t,n,o,i=this;e.length!==0&&(n=5<(t=e.shift()).topicIDList.length?"topicIDList.length:".concat(t.topicIDList.length):"topicIDList:".concat(t.topicIDList),(o=new R("relayGetTopicList")).setMessage(n),u.l("".concat(this._n,"._relayGetTopicList. ").concat(n)),this.getTopicList(t).then(function(){o.end(),i._relayGetTopicList(e)}).catch(function(a){o.setError(a).end(),i._relayGetTopicList(e)}))}},{key:"_handleTopicAtInfo",value:function(e){var t=this;e.length!==0&&e.forEach(function(a){var o=a.groupID,i=a.topicID,a=a.groupAtInfoList,s=[];D(a)||(a.forEach(function(r){s.push(l(l({},r),{},{groupID:o,topicID:i}))}),t.get(11).onNewGroupAtTips({dataList:s}))})}},{key:"_getTopicLastMessage",value:function(e){var t;D(e.lastMsg)||(t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,avatar:e.lastMsg.avatar,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:e.lastMsg.isPlaceMessage===2,revoker:L(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker},e.lastMessage=t)}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),o=this.get(11);n.forEach(function(i){i=i.topicID,t._deleteLocalTopic(e,i),t._getTopicTimeMap.delete(e),o.deleteLocalConversation("".concat(g.CONV_GROUP).concat(i))})}},{key:"_computeUnreadCount",value:function(e){var t,i=e.selfInfo,n=i.excludedUnreadSequenceList,o=i.readedSequence,i=e.nextMessageSeq-e.selfInfo.readedSequence-1;return q(n)&&(t=0,n.forEach(function(a){o<=a&&a<=e.nextMessageSeq-1&&(t+=1)}),1<=t&&(i-=t)),i<0?0:i}},{key:"_filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],ln),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"updateLastMessage",value:function(i,t){var n,o=je(i),i=this.getLocalTopic(o,i);i&&(n=t.sequence+1,i.updateNextMessageSeq(n),i.updateLastMessage(t),this.emitOuterEvent(K.TOPIC_UPDATED,{groupID:o,topic:i}))}},{key:"getMessageExtensions",value:function(e,t){u.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=je(e.to);return this.req({proto:h.GET_GRP_MSG_EXT,data:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=(u.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),je(e.to));return this.req({proto:h.MODIFY_GRP_MSG_EXT,data:{groupID:o,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),Do),ru=(E(Fa,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),o=e.userIDList;e.fromAccount=this._userM.getMyAccount(),100<o.length&&(u.w("".concat(n," ").concat(En(100))),o.length=100);for(var i,a=[],s=[],r=0,c=o.length;r<c;r++)i=o[r],this._userM.isMyFriend(i)&&this._contains(i)?s.push(this._getProfileFromMap(i)):a.push(i);if(a.length===0)return $(s);e.toAccount=a;var d=e.bFromGetMyProfile||!1,p=[],_=(e.toAccount.forEach(function(m){p.push({toAccount:m,standardSequence:0,customSequence:0})}),e.userItem=p,new R("getUserProfile"));return _.setMessage(5<o.length?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),this._userM.req({proto:h.GET_USER_PROFILE,data:e}).then(function(m){return _.end(),u.i("".concat(n," ok")),m=t._handleResponse(m).concat(s),V(d?m[0]:m)}).catch(function(m){return _.setError(m).end(),u.e("".concat(n," failed. error:"),m),v(m)})}},{key:"getMyProfile",value:function(){var e,t=this._userM.getMyAccount(),n="".concat(this._n,".getMyProfile");return u.l("".concat(n," myAccount:").concat(t)),this._fill(),this._contains(t)?(e=this._getProfileFromMap(t),u.d("".concat(n," from cache, myProfile:").concat(JSON.stringify(e))),$(e)):this.getUserProfile({fromAccount:t,userIDList:[t],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!q(t))return[];for(var n=[],e=Date.now(),o=0,i=t.length;o<i;o++){var s=t[o],a=s.to,s=s.profileItem;a!=="@TLS#NOT_FOUND"&&a!==""&&(a=this._update(a,this._getLatestProfileFromResponse(a,s)).latestProfile,n.push(a))}return u.l("".concat(this._n,"._handleResponse cost:").concat(Je(e))),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!L(t))for(var o=0,i=t.length;o<i;o++)if(-1<t[o].tag.indexOf("Tag_Profile_Custom"))n.profileCustomField.push({key:t[o].tag,value:t[o].value});else switch(t[o].tag){case k.NICK:n.nick=t[o].value;break;case k.GENDER:n.gender=t[o].value;break;case k.BIRTHDAY:n.birthday=t[o].value;break;case k.LOCATION:n.location=t[o].value;break;case k.SELFSIGNATURE:n.selfSignature=t[o].value;break;case k.ALLOWTYPE:n.allowType=t[o].value;break;case k.LANGUAGE:n.language=t[o].value;break;case k.AVATAR:n.avatar=t[o].value;break;case k.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case k.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case k.LEVEL:n.level=t[o].value;break;case k.ROLE:n.role=t[o].value;break;default:u.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[o].tag,t[o].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&this._userM.filterProfanity("nick",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.selfSignature&&this._userM.filterProfanity("selfSignature",e)===!1)return v({code:M.PROFANITY_FOUND});var o=new R("updateMyProfile"),i=(o.setMessage(JSON.stringify(e)),new Mo().validate(e));if(!i.valid)return o.setCode(M.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(i.tips)).end(),u.e("".concat(n," info:").concat(i.tips)),v({code:M.UPDATE_PROFILE_INVALID_PARAM});var a,s=[];for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&(a==="profileCustomField"?e.profileCustomField.forEach(function(c){s.push({tag:c.key,value:c.value})}):s.push({tag:k[a.toUpperCase()],value:e[a]}));if(s.length===0)return i=new Oe({code:M.UPDATE_PROFILE_NO_KEY}),o.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i);var r=this._userM.getMyAccount();return this._userM.req({proto:h.UPDATE_MY_PROFILE,data:{fromAccount:r,profileItem:s}}).then(function(c){o.end(),u.i("".concat(n," ok"));var p=t._update(r,e),d=p.isProfileUpdated,p=p.latestProfile;return d===!0&&t._userM.emitOuterEvent(K.PROFILE_UPDATED,[p]),$(p)}).catch(function(c){return o.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)})}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!L(t)){var n=t.length;u.d("".concat(this._n,".onProfileModified count:").concat(n," dataList:"),e.dataList);for(var o=[],i=0;i<n;i++){var s=t[i].userID,s=this._update(s,this._getLatestProfileFromResponse(s,t[i].profileList)),a=s.isProfileUpdated,s=s.latestProfile;a===!0&&o.push(s)}0<o.length&&(this._userM.emitInnerEvent(we.PROFILE_UPDATED,o),this._userM.emitOuterEvent(K.PROFILE_UPDATED,o))}}},{key:"_fill",value:function(){if(this.accountProfileMap.size===0){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);u.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,o=!1,i=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&Dn(n.profileCustomField,t.profileCustomField)===!0&&(n.lastUpdatedTime=i,o=!0),0<bt(n,t,["profileCustomField"])&&(n.lastUpdatedTime=i,o=!0)):(n=new Mo(t),!this._userM.isMyFriend(e)&&e!==this._userM.getMyAccount()||(n.lastUpdatedTime=i,o=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userM.getMyAccount()),o===!0&&u.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(o)),{isProfileUpdated:o,latestProfile:n}}},{key:"_flush",value:function(e){var t=b(this.accountProfileMap.values()),n=this._userM.getStorageModule();u.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userM.getStorageModule().getItem(this.TAG);return L(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,o,i=[],a=0,s=e.length;a<s;a++)n=(t=e[a]).userID,this._userM.isMyFriend(n)&&(this._contains(n)?(o=this._getProfileFromMap(n),0<bt(o,t)&&i.push(n)):i.push(t.userID));i.length!==0&&(u.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(i)),this.getUserProfile({userIDList:i}))}},{key:"getNickAndAvatarByUserID",value:function(e){return this._contains(e)?{nick:(e=this._getProfileFromMap(e)).nick,avatar:e.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(i){var t=this,n=b(new Set(i)),o=(u.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(i.length," uniqueUserIDList.length:").concat(n.length)),[]);if(i.length===0)return Promise.resolve(o);var i=this._createUserIDListGroup(n),a=[];return i.forEach(function(s){a.push(t.getUserProfile({userIDList:s}))}),Promise.all(a).then(function(s){return s.forEach(function(r){r=r.data.map(function(c){return{userID:c.userID,nick:c.nick,avatar:c.avatar}}),o.push.apply(o,b(r))}),o})}},{key:"_createUserIDListGroup",value:function(e){for(var t=[],n=0;n<e.length;)t.push(e.slice(n,n+=100));return t}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),Fa),Lr=E(function e(t){S(this,e)}),cu=(E(wa,[{key:"getLocalBlacklist",value:function(){return b(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userM.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},o=new R("getBlacklist");return this._userM.req({proto:h.GET_BL,data:n}).then(function(s){var s=s.data,a=s.blackListItem,s=s.currentSequence,r=L(a)?0:a.length;o.setMessage("count:".concat(r)).end(),u.i("".concat(t," ok")),e.currentSequence=s,e._handleResponse(a,!0),e._userM.emitOuterEvent(K.BLACKLIST_UPDATED,b(e._blacklistMap.keys()))}).catch(function(i){return o.setError(i).end(),u.e("".concat(t," failed. error:"),i),v(i)})}},{key:"addBlacklist",value:function(e){var t,n,o=this,i=new R("addToBlacklist"),a="".concat(this._n,".addBlacklist"),s=this._userM.getMyAccount();return e.userIDList.length===1&&e.userIDList[0]===s?(n=this._userM.getErrorMessage(t=M.CANNOT_ADD_SELF_TO_BLACKLIST),i.setCode(t).setMessage(n).end(),n=new Oe({code:t}),u.e("".concat(a," failed. error:"),n),v(n)):(e.userIDList.includes(s)&&(e.userIDList=e.userIDList.filter(function(r){return r!==s})),e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({proto:h.ADD_TO_BL,data:e}).then(function(r){return i.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),u.i("".concat(a," ok")),o._handleResponse(r.resultItem,!0),V(b(o._blacklistMap.keys()))}).catch(function(r){return i.setError(r).end(),u.e("".concat(a," failed. error:"),r),v(r)}))}},{key:"_handleResponse",value:function(e,t){if(!L(e))for(var n,o,i,a=0,s=e.length;a<s;a++)o=e[a].to,i=e[a].resultCode,!D(i)&&i!==0||(t?((n=this._blacklistMap.has(o)?this._blacklistMap.get(o):new Lr).userID=o,L(e[a].addBlackTimeStamp)||(n.timeStamp=e[a].addBlackTimeStamp),this._blacklistMap.set(o,n)):this._blacklistMap.has(o)&&(n=this._blacklistMap.get(o),this._blacklistMap.delete(o)));u.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),o=new R("removeFromBlacklist");return e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({proto:h.RM_FROM_BL,data:e}).then(function(i){return o.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),u.i("".concat(n," ok")),t._handleResponse(i.data.resultItem,!1),V(b(t._blacklistMap.keys()))}).catch(function(i){return o.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i)})}},{key:"onAccountDeleted",value:function(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];this._blacklistMap.has(o)&&this._blacklistMap.delete(o)}var i=e.length;0<i&&(u.l("".concat(this._n,".onAccountDeleted count:").concat(i," ").concat(i<30?"userIDList:".concat(e):"")),this._userM.emitOuterEvent(K.BLACKLIST_UPDATED,b(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],o=0,i=e.length;o<i;o++)t=e[o],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Lr({userID:t})),n.push(t));0<n.length&&(u.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userM.emitOuterEvent(K.BLACKLIST_UPDATED,b(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),wa),uu=(E(Ua,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userM.getCloudConfig("status_query_count"),t=this._userM.getCloudConfig("status_sub_count"),n=this._userM.getCloudConfig("status_unsub_count");u.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),D(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),D(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),D(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(o){var o=o.dataList,t=this._userM.getMyUserID(),n=this._userM.get(12),o=o.map(function(r){var a=r.to,s=r.statusType,r=r.customStatus,r=Ga(r);return a===t&&n.setCustomStatus(r),{userID:a,statusType:s,customStatus:r}});this._userM.emitOuterEvent(K.USER_STATUS_UPDATED,o)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(this._userM.filterProfanity("customStatus",e)===!1)return v({code:M.PROFANITY_FOUND});var o=new R("setSelfStatus"),i=e.customStatus;return this._userM.req({proto:h.SET_SELF_STATUS,data:{customStatus:i}}).then(function(a){return o.setMessage("customStatus:".concat(i)).end(),u.l("".concat(n," ok. customStatus:").concat(i)),t._userM.get(12).setCustomStatus(i),V({userID:t._userM.getMyUserID(),statusType:1,customStatus:i})}).catch(function(a){return o.setError(a).end(),u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"getUserStatus",value:function(o){var t="".concat(this._n,".").concat("getUserStatus"),o=o.userIDList,n=o===void 0?[]:o,o=this._userM.getMyUserID(),i=b(n),a=void 0,s=i.indexOf(o);if(-1<s&&(i.splice(s,1),a={userID:o,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),i.length===0)return $({successUserList:[a],failureUserList:[]});if(!this._userM.canIUse(Ce.USER_STATUS))return this._userM.cannotUseCommercialAbility("getUserStatus");i.length>this.MAX_QUERY_USER_COUNT&&(u.w("".concat(t," ").concat(En(this.MAX_QUERY_USER_COUNT))),i=n.slice(0,this.MAX_QUERY_USER_COUNT));var r=new R("getUserStatus");return this._userM.req({proto:h.GET_USER_STATUS,data:{userIDList:i}}).then(function(p){var p=p.data,d=p.successUserList,d=d===void 0?[]:d,p=p.failureUserList,p=p===void 0?[]:p,d=d.map(function(N){var f=N.userID,I=N.statusType,N=N.customStatus;return{userID:f,statusType:I,customStatus:Ga(N)}}),p=p.map(function(P){var f=P.userID,I=P.invalidUserID,N=P.errorCode,P=P.errorInfo;return{userID:L(I)?f:I,code:N,message:P}}),_=(D(a)||d.unshift(a),"userID count:".concat(n.length,", success count:").concat(d.length,", fail count:").concat(p.length));return r.setMessage("".concat(_)).end(),u.l("".concat(t," ok. ").concat(_,".")),V({successUserList:d,failureUserList:p})}).catch(function(c){return r.setMessage("userID count:".concat(n.length)).setError(c).end(),u.e("".concat(t," failed. error:"),c),v(c)})}},{key:"subscribeUserStatus",value:function(o){var t="subscribeUserStatus";if(!this._userM.canIUse(Ce.USER_STATUS))return this._userM.cannotUseCommercialAbility(t);var n="".concat(this._n,".").concat(t),o=o.userIDList,o=o===void 0?[]:o,i=b(o),a=(i.length>this.MAX_SUBSCRIBE_USER_COUNT&&(u.w("".concat(n," ").concat(En(this.MAX_SUBSCRIBE_USER_COUNT))),i=o.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),new R(t)),s="userID count:".concat(o.length);return u.l("".concat(n," ").concat(s)),this._userM.req({proto:h.SUB_USER_STATUS,data:{userIDList:i}}).then(function(r){return r=r.data.failureUserList,r=(r===void 0?[]:r).map(function(m){var d=m.userID,p=m.invalidUserID,_=m.errorCode,m=m.errorInfo;return{userID:L(p)?d:p,code:_,message:m}}),a.setMessage("".concat(s," fail count:").concat(r.length)).end(),u.l("".concat(n," ok. fail count:").concat(r.length,".")),V({failureUserList:r})}).catch(function(r){return a.setMessage(s).setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"unsubscribeUserStatus",value:function(n){var s="unsubscribeUserStatus";if(!this._userM.canIUse(Ce.USER_STATUS))return this._userM.cannotUseCommercialAbility(s);var t="".concat(this._n,".").concat(s),n=(n||{}).userIDList,n=n===void 0?[]:n,o=b(n),i=(n.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(u.w("".concat(t," ").concat(En(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=n.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),new R(s)),a="userID count:".concat(n.length),s=(u.l("".concat(t," ").concat(a)),{userIDList:o});return o.length===0&&(s.userIDList=void 0,s.unsubscribeAll=1),this._userM.req({proto:h.UNSUB_USER_STATUS,data:s}).then(function(r){return r=r.data.failureUserList,r=(r===void 0?[]:r).map(function(m){var d=m.userID,p=m.invalidUserID,_=m.errorCode,m=m.errorInfo;return{userID:L(p)?d:p,code:_,message:m}}),i.setMessage("".concat(a," fail count:").concat(r.length)).end(),u.l("".concat(t," ok. fail count:").concat(r.length,".")),V({failureUserList:r})}).catch(function(r){return i.setMessage("".concat(a)).setError(r).end(),u.e("".concat(t," failed. error:"),r),v(r)})}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),Ua),lu=(F(To,xe),Cr=te(To),E(To,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(e,t){u.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(e," avatar:").concat(t)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:k.NICK,value:e},{tag:k.AVATAR,value:t}]}]})}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(o){var t,n,o=o.dataList;L(o)||(t=[],o.forEach(function(i){i.blackListDelAccount&&t.push.apply(t,b(i.blackListDelAccount))}),0<t.length&&this._blacklistHandler.onAccountDeleted(t),n=[],o.forEach(function(i){i.blackListAddAccount&&n.push.apply(n,b(i.blackListAddAccount))}),0<n.length&&this._blacklistHandler.onAccountAdded(n))}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],"user_profile"),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.get(8);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getUserNickAndAvatar",value:function(e){return this._profileHandler.getUserNickAndAvatar(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return $(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),To),du=(E(ba,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return(e=this._SDKAppID)===0||2e7<=e&&e<9e7||172e7<=e&&e<179e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(e){this._isUsingChatCore=e}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(e){this._uiPlatform=e}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return Cn?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(e){this._applicationID=e}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,o=!1,r=[];me&&(r=Object.keys(fe));for(var i=0,a=(r=Ke?Object.keys(dn?uni:window):r).length;i<a;i++)if(r[i].toLowerCase().includes("uikit")){e=!0;break}var s,r=null,c=(me&&!qe(fe.createGamePortal)&&qe(getApp)&&!D(getApp())&&(s=getApp().globalData,Ie(s)&&s.isTUIKit===!0&&(t=!0)),this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))===!0&&(n=!0),null);if(ht&&!It&&typeof uni>"u"&&__wxConfig&&(c=__wxConfig.pages),Qe&&typeof uni>"u"&&__qqConfig&&(c=__qqConfig.pages),q(c)&&0<c.length){for(var d=0,p=c.length;d<p;d++)if(c[d].toLowerCase().includes("tui")){o=!0;break}c=null}return e||t||n||o}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),ba),pu={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12},gu=(F(Co,xe),Mr=te(Co),E(Co,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var e=void 0,t=this.get(36),n=this.get(28);return t.canIUseTIMPush()?e=t:n.canIUseOfflinePush()&&(e=n),e}},{key:"login",value:function(o){if(this.isLoggedIn())return t=this.getMyUserID(),(t=this.getErrorMessage("RepeatLogin",t))&&u.w(t),$({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",o.userID),v({code:M.REPEAT_LOGIN});u.l("".concat(this._n,".login userID:").concat(o.userID));var t=this._checkLoginInfo(o);if(t.code!==0)return v(t);var t=this.get(12),n=o.userID,o=o.userSig;return t.setUserID(n),t.setUserSig(o),this.get(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.get(12),n=t.getScene(),o=0,i=n,a=(n&&n.startsWith("k-")&&(i=pu[n],n="tuikit"),new R("login")),r=(a.setMessage("".concat(i)).setMoreMessage("identifier:".concat(this.getMyUserID())),n==="tuikit"),s=0,r=(dn?s=r?i===3||i===4||i===5||i===6?31:i===9||i===10||i===11||i===12?32:4:3:me?s=Gn?36:n==="tuikit"?12:11:Ke&&(s=Cn?n==="flutter_web_uikit"?21:20:this._isReactUIKit()?$t?25:24:r?i===1||i===2?29:i===7||i===8?30:$t?17:14:$t?16:13),a.setUIPlatform(s),t.setUIPlatform(s),this.getPushModule()),c=(r&&(this._isWebUniapp=r.getUniAppPlatform(),i=this._getStatusInstanceID(),t.setStatusInstanceID(i),this.get(20).updateProtocolConfig(),o=r.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({proto:h.LOGIN,data:{deviceBrand:o,isWebUniapp:this._isWebUniapp}}).then(function(d){e._lastLoginTs=0;var be=Date.now(),p=null,H=d.data,_=H.a2Key,m=H.tinyID,f=H.helloInterval,I=H.instanceID,N=H.timeStamp,P=H.customStatus,P=P===void 0?"":P,H=H.purchaseBits,Z=1e3*N,le=be-a.getStartTs(),le=Z+parseInt(le/2)-be,be=a.getStartTs()+le;if(a.start(be),be=Z,nn=le,(Z=new Date).setTime(be),u.i("baseTime from server:".concat(Z," offset:").concat(nn)),!m)throw p=new Oe({code:M.NO_TINYID}),a.setError(p).end(),p;if(!_)throw p=new Oe({code:M.NO_A2KEY}),a.setError(p).end(),p;return be=Ga(P),Z="scene:".concat(n," helloInterval:").concat(f," instanceID:").concat(I," timeStamp:").concat(N," offset:").concat(le," customStatus:").concat(be," "),u.l("".concat(c," ok. ").concat(Z)),p="",P="",ht&&qe(fe.getAccountInfoSync)&&(N=fe.getAccountInfoSync().miniProgram)&&(p=N.appId,P=N.envVersion),a.setMoreMessage("".concat(Z," href:").concat(Ke?window.location.href:""," mpAppId:").concat(p," envVersion:").concat(P)).end(),t.setA2Key(_),t.setTinyID(m),t.setStatusInstanceID(I),t.setCustomStatus(be),H&&e.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:H}),e.get(20).updateProtocolConfig(),e.emitInnerEvent(we.A2KEY_AND_TINYID_UPDATED),e._helloInterval=f,e.triggerReady(),le=e.getPushModule(),le&&(uni.setStorageSync("timUniAppInstanceID",I),le.init()),e._fetchCloudControlConfig(),e.get(29).init(),d}).catch(function(d){return a.setError(d).end(!0),e._m.setNotReadyReason(M.LOGIN_FAILED),u.e("".concat(c," failed. error:"),d),e._lastLoginTs=0,e._m.onLoginFailed(),v(d)})}},{key:"logout",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(!this.isLoggedIn())return v({code:M.USER_NOT_LOGGED_IN});new R("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0);var n="".concat(this._n,".logout");return u.i("".concat(n," type:").concat(t)),t===0&&this._m.setNotReadyReason(M.LOGGED_OUT),this.req({proto:h.LOGOUT,data:{type:t}}).then(function(){return e.resetReady(),$({})}).catch(function(o){return u.e("".concat(n," error:"),o),e.resetReady(),$({})})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.req({proto:h.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch(function(t){u.w("".concat(e._n,"._hello error:"),t)})}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return L(this.get(12).getSDKAppID())?t=M.NO_SDKAPPID:L(e.userID)?t=M.NO_IDENTIFIER:L(e.userSig)&&(t=M.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return Ke&&window.tencent_cloud_im_csig_react_uikit_23F_xa!==void 0}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new R("kickedOut").setMessage("type:".concat(g.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),u.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){t.emitOuterEvent(K.KICKED_OUT,{type:g.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(M.KICKED_OUT_MULT_ACCOUNT),t._m.reset()})}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new R("kickedOut").setMessage("type:".concat(g.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),u.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){t.emitOuterEvent(K.KICKED_OUT,{type:g.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(M.KICKED_OUT_MULT_DEVICE),t._m.reset()})}},{key:"onUserSigExpired",value:function(){new R("kickedOut").setMessage(g.KICKED_OUT_USERSIG_EXPIRED).end(!0),u.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),this.get(12).getStatusInstanceID()!==0&&(this.emitOuterEvent(K.KICKED_OUT,{type:g.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(M.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new R("kickedOut").setMessage("type:".concat(g.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),u.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.get(12).getStatusInstanceID()!==0&&(this.emitOuterEvent(K.KICKED_OUT,{type:g.KICKED_OUT_REST_API}),this._m.setNotReadyReason(M.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),Co);function Co(e){return S(this,Co),(e=Mr.call(this,e))._n="SignModule",e._helloInterval=120,e._lastLoginTs=0,e._lastWsHelloTs=0,e._isWebUniapp=0,Oa.mixin(X(e)),e}function ba(e,t){S(this,ba),this._m=e,this._isLoggedIn=!1,this._SDKAppID=t.SDKAppID,this._userID=t.userID||"",this._userSig=t.userSig||"",this._version="3.2.9",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=t.unlimitedAVChatRoom,this._scene=t.scene||"",this._oversea=t.oversea,this._instanceID=t.instanceID,this._statusInstanceID=0,this._isDevMode=t.devMode,this._isTestEnv=t.testEnv,this._proxyServer=t.proxyServer,this._fileUploadProxy=t.fileUploadProxy,this._fileDownloadProxy=t.fileDownloadProxy,this._applicationID=0,this._isUsingChatCore=!1,this._uiPlatform=0}function To(e){return S(this,To),(e=Cr.call(this,e))._n="UserModule",e._profileHandler=new ru(X(e)),e._blacklistHandler=new cu(X(e)),e._userStatusHandler=new uu(X(e)),e.getInnerEmitterInstance().on(we.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,X(e)),e}function Ua(e){S(this,Ua),this._userM=e,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function wa(e){S(this,wa),this._userM=e,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}function Fa(e){S(this,Fa),this._userM=e,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function Do(e){return S(this,Do),(e=Tr.call(this,e))._n="TopicModule",e._topicMap=new Map,e._getTopicTimeMap=new Map,e.TOPIC_CACHE_TIME=300,e.TOPIC_LAST_ACTIVE_TIME=3600,e.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function xa(e,t){S(this,xa),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=yr(e.lastMessage,t),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(e)}function So(e){return S(this,So),(e=Dr.call(this,e))._n="GroupModule",e._commonGroupHandler=new jc(X(e)),e._groupAttributesHandler=new Jc(X(e)),e._groupCountersHandler=new Xc(X(e)),e._AVChatRoomHandler=new Qc(X(e)),e._groupTipsHandler=new zc(X(e)),e._groupSystemNoticeHandler=new tu(X(e)),e._groupMemberHandler=new eu(X(e)),e.groupMap=new Map,e._unjoinedAVChatRoomList=new Map,e._receiptDetailCompleteMap=new Map,e._onlineMemberCountMap=new Map,e._timeoutIDs=[],e.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function qa(e){S(this,qa),this._grpM=e,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function Va(e){S(this,Va),this._grpM=e,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getInnerEmitterInstance().on(we.PROFILE_UPDATED,this._onProfileUpdated,this)}function Ba(e){S(this,Ba),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(e)}function Ha(e){S(this,Ha),this._grpM=e,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new Pa(200),this.messageIDLinkedList=new Pa(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function Ka(a){S(this,Ka);var t=a.manager,n=a.groupID,o=a.onInit,i=a.onSuccess,a=a.onFail;this._n="Polling",this._manager=t,this._grpM=t._grpM,this._onInit=o,this._onSuccess=i,this._onFail=a,this._groupID=n,this._timeoutID=-1,this._isRunning=!1,this._proto=h.AV_POLLING}function Wa(e){S(this,Wa),this._grpM=e,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function Ya(e){S(this,Ya),this._grpM=e,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function za(e){S(this,za),this._grpM=e,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=an,this._pagingGetCostList=[],e.getInnerEmitterInstance().on(we.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function ja(e){S(this,ja),this._grpM=e,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function Eo(e){return S(this,Eo),(e=Sr.call(this,e))._n="ConversationModule",Oa.mixin(X(e)),e._messageListHandler=new xc,e._messageRemindHandler=new Kc(X(e)),e._convGroupHandler=new Wc(X(e)),e.singlyLinkedList=new Pa(100),e._pagingStatus=an,e._pagingTimeStamp=0,e._pagingStartIndex=0,e._pagingPinnedTimeStamp=0,e._pagingPinnedStartIndex=0,e._pagingConvIDMap=new Map,e._convIDFromUnreadDBMap=new Map,e._conversationMap=new Map,e._tmpGroupList=[],e._tmpGroupAtTipsList=[],e._peerReadTimeMap=new Map,e._completedMap=new Map,e._roamingMessageKeyAndTimeMap=new Map,e._roamingMessageSequenceMap=new Map,e._remoteGroupReadSequenceMap=new Map,e._convTotalUnreadCount=0,e._pagingGetCostList=[],e._initListeners(),e}function Ja(e){S(this,Ja),this._convM=e,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=an}function Xa(e){S(this,Xa),this._convM=e,this._n="MessageRemindHandler"}function Za(e,t){var n=2<arguments.length&&arguments[2]!==void 0&&arguments[2];S(this,Za),this.conversationID=e.conversationID||"",this.unreadCount=e.unreadCount||0,this.type=e.type||"",this.lastMessage=Ir(e.lastMessage,t,n),e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=e.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=e.isPinned||!1,this.messageRemindType=e.messageRemindType,this.markList=e.markList||[],this.customData=e.customData||"",this.conversationGroupList=e.conversationGroupList||[],this.draftText=e.draftText||"",this._initProfile(e),this.subType=this.groupProfile?this.groupProfile.type:""}function Qa(e){S(this,Qa),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(e)}function $a(e){S(this,$a),this.MAX_LENGTH=e,this.pTail=null,this.pNodeToDel=null,this.map=new Map}function es(e){var t=this;S(this,es),L(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||g.ALLOW_TYPE_ALLOW_ANY,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||g.FORBID_TYPE_NONE,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],L(e.profileCustomField)||e.profileCustomField.forEach(function(n){t.profileCustomField.push({key:n.key,value:n.value})}))}function Si(){return null}function kr(e){var t=e.get(12);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:Et()}}E(as,[{key:"_errorTolerantHandle",value:function(){me||!D(window)&&this._canIUseCookies()||(this.getItem=Si,this.setItem=Si,this.removeItem=Si,this.clear=Si)}},{key:"onCheckTimer",value:function(e){e%20==0&&this._storageQueue.size!==0&&this._doFlush()}},{key:"_doFlush",value:function(){try{var e,t=Re(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=z(e.value,2),o=n[0],i=n[1];this._setStorageSync(this._getKey(o),i)}}catch(a){t.e(a)}finally{t.f()}this._storageQueue.clear()}catch(a){u.w("".concat(this._n,"._doFlush error:"),a)}}},{key:"_getPrefix",value:function(){var e=this._m.get(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(o){return u.w("".concat(this._n,".getItem error:"),o),{}}}},{key:"setItem",value:function(e,t){var n;2<arguments.length&&arguments[2]!==void 0&&arguments[2]?(n=!(3<arguments.length&&arguments[3]!==void 0)||arguments[3]?this._getKey(e):e,this._setStorageSync(n,t)):this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{me?fe.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){u.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(o){u.w("".concat(this._n,".removeItem error:"),o)}}},{key:"getSize",value:function(e){var t=this,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"b";try{var o={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(o,"leftSize",{enumerable:!0,get:function(){return o.limitSize-o.size}}),me&&(o.limitSize=1024*fe.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(me)fe.getStorageInfoSync().keys.forEach(function(a){o.size+=JSON.stringify(t.getStorageSync(a)).length+t._getKey(a).length});else if(this._canIUseCookies())for(var i in localStorage)localStorage.hasOwnProperty(i)&&(o.size+=localStorage.getItem(i).length+i.length);return this._convertUnit(o)}catch(a){u.w("".concat(this._n," error:"),a)}}},{key:"_convertUnit",value:function(e){var t,n={},o=e.unit;for(t in n.unit=o,e)typeof e[t]=="number"&&(o.toLowerCase()==="kb"?n[t]=Math.round(e[t]/1024):o.toLowerCase()==="mb"?n[t]=Math.round(e[t]/1024/1024):n[t]=e[t]);return n}},{key:"_setStorageSync",value:function(e,t){me?lt?my.setStorageSync({key:e,data:t}):fe.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return me?lt?my.getStorageSync({key:e}).data:fe.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){me?lt?my.removeStorageSync({key:e}):fe.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._doFlush()}}]);var Rr,hu=as,_u=(E(is,[{key:"pushIn",value:function(e){u.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;q(e)&&e.length!==0&&(u.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,b(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return this._report.length===0}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),is),fu=(F(Lo,xe),Rr=te(Lo),E(Lo,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.get(13),n=t.getItem(this.TAG,!1);!L(n)&&qe(n.forEach)&&(u.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach(function(o){e._reportBody.pushIn(o)}),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),o=this.getCloudConfig("evt_rpt_sdkappid_bl"),i=this.getCloudConfig("evt_rpt_tinyid_wl");D(e)||(this.MIN_THRESHOLD=Number(e)),D(t)||(this.WAITING_TIME=Number(t)),D(n)||(this.REPORT_LEVEL=n.split(",").map(function(a){return Number(a)})),D(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map(function(a){return Number(a)})),D(i)||(this.REPORT_TINYID_WHITELIST=i.split(","))}},{key:"pushIn",value:function(e){e instanceof R&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,o=this.get(12),n=o.getSDKAppID(),o=o.getTinyID();return fi(this.REPORT_SDKAPPID_BLACKLIST,n)&&!mi(this.REPORT_TINYID_WHITELIST,o)?[]:e.filter(function(i){return t.REPORT_LEVEL.includes(i.level)})}},{key:"_report",value:function(){var e,t,n=this;this._reportBody.isEmpty()||(e=this._reportBody.getLogsInMemory(),(t=this._filterLogs(e)).length!==0?(t={header:kr(this),event:t},this.req({proto:h.SSO_STAT,data:l({},t)}).then(function(){n._lastReportTime=Date.now()}).catch(function(o){u.w("".concat(n._n,"._report failed. error:"),o),n._lastReportTime=Date.now(),n._reportBody.backfill(e),n._reportBody.getLogsNumInMemory()>n.MAX_THRESHOLD&&n._flushAtOnce()})):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),o="".concat(this._n,"._flushAtOnce");L(t)?(u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):((n=n.concat(t)).length>this.MAX_THRESHOLD&&(n=n.slice(0,this.MAX_THRESHOLD)),u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1))}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),Lo),ts="none",ns="online",mu=(E(os,[{key:"start",value:function(){var e=this,t="".concat(this._n,".start");me?(fe.getNetworkType({success:function(n){e._networkType=n.networkType||n.subtype||"",n.networkType===ts?u.w("".concat(t," no network, please check!")):u.i("".concat(t," networkType:").concat(n.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),fe.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=ns,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:ns})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:ts})}},{key:"_onNetworkStatusChange",value:function(n){var t=n.isConnected,n=n.networkType,o="".concat(this._n,"._onNetworkStatusChange"),i=!1,a="previous:".concat(this._networkType," current:").concat(n);t?(u.i("".concat(o," ").concat(a)),this._networkType!==n&&(i=!0,this._m.get(21).reConnect(!0))):this._networkType!==n&&(i=!0,u.w("".concat(o," no network, please check!")),this._m.get(21).offline()),i&&(new R("networkChange").setMessage("isConnected:".concat(t," ").concat(a)).end(),this._networkType=n)}},{key:"isOnline",value:function(){return this._networkType!==ts}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),me?this._mpNetworkStatusCallback!==null&&(fe.offNetworkStatusChange&&($e||It?fe.offNetworkStatusChange(this._mpNetworkStatusCallback):fe.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(this._webOnlineCallback!==null&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),this._onWebOffline!==null&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),os);function os(e){S(this,os),this._m=e,this._networkType=ns,this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}function Lo(e){S(this,Lo),(e=Rr.call(this,e))._n="EventStatModule",e.TAG="im-ssolog-event",e._reportBody=new _u,e.MIN_THRESHOLD=20,e.MAX_THRESHOLD=100,e.WAITING_TIME=6e4,e.REPORT_LEVEL=[4,5,6],e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._lastReportTime=Date.now();var t=e.getInnerEmitterInstance();return t.on(we.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,X(e)),t.on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function is(e){S(this,is),this._n="SSOLogBody",this._report=[]}function as(e){S(this,as),this._m=e,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}ye=ve={exports:{}},Or=Object.prototype.hasOwnProperty,mt="~",Object.create&&(Ro.prototype=Object.create(null),new Ro().__proto__||(mt=!1)),Dt.prototype.eventNames=function(){var e,t,n=[];if(this._eventsCount===0)return n;for(t in e=this._events)Or.call(e,t)&&n.push(mt?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},Dt.prototype.listeners=function(t){var t=mt?mt+t:t,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,a=new Array(i);o<i;o++)a[o]=n[o].fn;return a},Dt.prototype.listenerCount=function(e){return e=mt?mt+e:e,e=this._events[e],e?e.fn?1:e.length:0},Dt.prototype.emit=function(e,t,n,o,i,a){var s=mt?mt+e:e;if(!this._events[s])return!1;var r,c=this._events[s],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,i),!0;case 6:return c.fn.call(c.context,t,n,o,i,a),!0}for(m=1,r=new Array(d-1);m<d;m++)r[m-1]=arguments[m];c.fn.apply(c.context,r)}else for(var p,_=c.length,m=0;m<_;m++)switch(c[m].once&&this.removeListener(e,c[m].fn,void 0,!0),d){case 1:c[m].fn.call(c[m].context);break;case 2:c[m].fn.call(c[m].context,t);break;case 3:c[m].fn.call(c[m].context,t,n);break;case 4:c[m].fn.call(c[m].context,t,n,o);break;default:if(!r)for(p=1,r=new Array(d-1);p<d;p++)r[p-1]=arguments[p];c[m].fn.apply(c[m].context,r)}return!0},Dt.prototype.on=function(e,t,n){return Gr(this,e,t,n,!1)},Dt.prototype.once=function(e,t,n){return Gr(this,e,t,n,!0)},Dt.prototype.removeListener=function(e,t,n,o){if(e=mt?mt+e:e,!this._events[e])return this;if(!t)return Ei(this,e),this;var i=this._events[e];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||Ei(this,e);else{for(var a=0,s=[],r=i.length;a<r;a++)(i[a].fn!==t||o&&!i[a].once||n&&i[a].context!==n)&&s.push(i[a]);s.length?this._events[e]=s.length===1?s[0]:s:Ei(this,e)}return this},Dt.prototype.removeAllListeners=function(e){return e?(e=mt?mt+e:e,this._events[e]&&Ei(this,e)):(this._events=new Ro,this._eventsCount=0),this},Dt.prototype.off=Dt.prototype.removeListener,Dt.prototype.addListener=Dt.prototype.on,Dt.prefixed=mt,ye.exports=Dt.EventEmitter=Dt;var Nr,Or,mt,ss=ve.exports,vu=["requestSnapshotUrl"],Au=(F(ko,xe),Nr=te(ko),E(ko,[{key:"_init",value:function(){var e=this.get(18);this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=e.getPlugin(e=me?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",e)):this.outputWarning("PluginUndetected"))}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit"),n=this.getCloudConfig("simple_cos");if(u.l("".concat(e," uploadSizeLimit:").concat(t," simpleCos:").concat(n)),!D(t))try{var o=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={A:o.a?1048576*parseInt(o.a):this.UPLOAD_SIZE_LIMIT.A,F:o.f?1048576*parseInt(o.f):this.UPLOAD_SIZE_LIMIT.F,I:o.i?1048576*parseInt(o.i):this.UPLOAD_SIZE_LIMIT.I,V:o.v?1048576*parseInt(o.v):this.UPLOAD_SIZE_LIMIT.V}}catch{}D(n)||(this.isSimpleCos=n==="1")}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new R("_getAuthorizationKey"),o=Math.ceil(Date.now()/1e3);this.req({proto:h.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then(function(a){var a=a.data,s=(u.l("".concat(t," ok. data:"),a),a.expiredTime-o);n.setMessage("requestId:".concat(a.requestId," requestTime:").concat(o," expiredTime:").concat(a.expiredTime," diff:").concat(s,"s")).end(),!me&&a.region&&(e.region=a.region),e.appid=a.appid,e.bucketName=a.bucketName,e.ciUrl=a.ciUrl,e.directory=a.directory,e.downloadUrl=a.downloadUrl,e.uploadUrl=a.uploadUrl,e.cosOptions={secretId:a.secretId,secretKey:a.secretKey,sessionToken:a.sessionToken,expiredTime:a.expiredTime},u.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()}).catch(function(i){n.setError(i).end(),u.w("".concat(t," failed. error:"),i)})}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),o=Math.ceil(Date.now()/1e3),i=new R("_getCosPreSigUrl"),a={uploadMethod:e.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:e.userID,conversationType:e.conversationType,uploadConfig:[{fileID:1,fileType:e.fileType,fileName:e.fileName}]},s=h.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(a={fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration},s=h.COS_PRE_SIG),this.req({proto:s,data:a}).then(function(p){t.tryCount=0;var c,d,p=p.data||{},_=(u.l("".concat(n," ok. isSimpleCos:").concat(t.isSimpleCos," data:"),p),"");return _=t.isSimpleCos?(c=(d=p.preSig[0]).uploadUrl,d=d.fileKey,"uploadIP:".concat(p.uploadIP," uploadUrl:").concat(c," fileKey:").concat(d," cost:").concat(Je(o))):"requestId:".concat(p.requestId," expiredTime:").concat(p.expiredTime," diff:").concat(p.expiredTime-o,"s"),i.setMessage(_).end(),p}).catch(function(r){return r.code===-1&&(r.code=M.COS_GET_SIG_FAIL),i.setError(r).end(),u.w("".concat(n," failed. error:"),r),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,v({code:M.COS_GET_SIG_FAIL}))})}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=me?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=me?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(e._relayFlag===!0)return Promise.resolve();var t=this.get(26);switch(e.type){case g.MSG_IMAGE:return t.addTotalCount(Tt),this._uploadImage(e);case g.MSG_FILE:return t.addTotalCount(Tt),this._uploadFile(e);case g.MSG_AUDIO:return t.addTotalCount(Tt),this._uploadAudio(e);case g.MSG_VIDEO:return t.addTotalCount(Tt),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadImage({file:i.payload.file,to:i.to,message:e,onProgress:function(a){if(o.updatePercent(a),qe(i.onProgress))try{i.onProgress(a)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(Z){var s=Z.location,r=Z.fileType,c=Z.fileSize,d=Z.width,p=Z.height,_=Z.smallImageUrl,m=Z.smallImageWidth,f=Z.smallImageHeight,I=Z.largeImageUrl,N=Z.largeImageWidth,P=Z.largeImageHeight,H=Z.imageInfoArray,Z=t.isPrivateNetWork()?s:Bn(s);o.updateImageFormat(r);var le,be,it={size:c,url:Z,width:d,height:p};if(H&&0<H.length)for(var at=0;at<H.length;at++){var pt=H[at];pt.type===1?le=pt:pt.type===2?be=pt:it=l(l({},it),pt)}else be=_&&I?(le={url:_,width:m,height:f},{url:I,width:N,height:P}):(le=po({originUrl:Z,originWidth:d,originHeight:p,min:198}),po({originUrl:Z,originWidth:d,originHeight:p,min:720}));return o.updateImageInfoArray([l({},it),l({},be),l({},le)]),e})}},{key:"_uploadFile",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:i.payload.file,to:i.to,message:e,onProgress:function(a){if(o.updatePercent(a),qe(i.onProgress))try{i.onProgress(a)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(a){return a=a.location,a=t.isPrivateNetWork()?a:Bn(a),o.updateFileUrl(a),e})}},{key:"_uploadAudio",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:i.payload.file,to:i.to,message:e,onProgress:function(a){if(o.updatePercent(a),qe(i.onProgress))try{i.onProgress(a)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(a){return a=a.location,a=t.isPrivateNetWork()?a:Bn(a),o.updateAudioUrl(a),e})}},{key:"_uploadVideo",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:i.payload.file,to:i.to,message:e,onProgress:function(a){if(o.updatePercent(a),qe(i.onProgress))try{i.onProgress(a)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(s){var r=s.location,s=s.snapshotInfo,r=t.isPrivateNetWork()?r:Bn(r);return o.updateVideoUrl(r),L(s)||o.updateSnapshotInfo(s),e})}},{key:"_checkSizeError",value:function(e){var t="";return e==="A"?t="audio":e==="I"?t="image":e==="V"?t="video":e==="F"&&(t="file"),v({code:M["MSG_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",t,"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576,"MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file||this._isEmptyFileList(e.file.files))return v({code:M.MSG_I_SELECT_F_FIRST});var n=this._checkImageType(e.file);if(n!==!0||(n=this._checkImageSize(e.file),n!==!0))return n;var o=null;return this._setUploadFileType(1),this.uploadByCOS(e).then(function(i){if(o=i,t.isPrivateNetWork())return a=t.getFileDownloadProxy(),Sn(Ct(i.location,a));if(q(o.imageInfoArray)){var a=o.imageInfoArray.find(function(s){return s.type===3});if(a)return a}return Sn("https://".concat(i.location))}).then(function(i){return o.width=i.width,o.height=i.height,Promise.resolve(o)})}},{key:"_checkImageType",value:function(e){var t="",t=me?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1);return 0<=qc.indexOf(t.toLowerCase())||v({code:M.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){return(e=(me?e:e.files[0]).size)===0?v({code:M.MSG_F_IS_EMPTY}):e<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(e){return!e.file||this._isEmptyFileList(e.file.files)?v({code:M.MSG_F_SELECT_F_FIRST}):e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):e.file.files[0].size===0?v({code:M.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e))}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):e.file.videoFile.size===0?v({code:M.MSG_F_IS_EMPTY}):Vc.indexOf(e.file.videoFile.type)===-1?v({code:M.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),me?this.handleVideoUpload(l(l({},e),{},{file:e.file.videoFile})):Ke?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise(function(n,o){t.uploadByCOS(e).then(function(i){n(i)}).catch(function(){t.uploadByCOS(e).then(function(i){n(i)}).catch(function(){o(new Oe({code:M.MSG_V_UPLOAD_FAIL}))})})})}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):e.file.size===0?v({code:M.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):v({code:M.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!qe(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),v({code:M.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new R("upload"),o="".concat(this._n,".uploadByCOS"),i=Date.now(),a=this._getFile(e);return new Promise(function(s,r){var c=me?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),d=t;t._cosUploadMethod(c,function(p,_){var m=Object.create(null);if(_){if(p||q(_.files)&&_.files[0].error)return f=new Oe({code:M.MSG_F_UPLOAD_FAIL}),n.setError(f).end(),u.l("".concat(o," failed. error:"),_.files[0].error),_.files[0].error.statusCode===403&&(u.w("".concat(o," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void r(f);m.fileName=a.name,m.fileSize=a.size,m.fileType=a.type.slice(a.type.indexOf("/")+1).toLowerCase(),m.location=(me?_:_.files[0].data).Location;var f=Date.now()-i,_=d._formatFileSize(a.size),I=d._formatSpeed(1e3*a.size/f),_="size:".concat(_," time:").concat(f,"ms speed:").concat(I),I=(u.l("".concat(o," success. name:").concat(a.name," ").concat(_)),s(m),t.get(26));return I.addCost(Tt,f),I.addFileSize(Tt,a.size),void n.setMessage(_).end()}m=new Oe({code:M.MSG_F_UPLOAD_FAIL}),n.setError(m).end(),u.w("".concat(o," failed. error:"),p),p.statusCode===403&&(u.w("".concat(o," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),r(m)})})}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),o=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then(function(i){return new Promise(function(a,s){var r=new R("upload"),c=i.requestSnapshotUrl,d=c===void 0?void 0:c,p=ae(i,vu),_=Date.now();t._cosUploadMethod(p,function(m,f){var I,N,P;return m||f.statusCode===403?(r.setError(new Oe(m)).end(),N={HttpStatusCode:9999,CostTime:Je(_,!1),error:m,url:i.url},f.data&&f.data.uploadIP&&(N.uploadIP=f.data.uploadIP),t._uploadSSOLog(N),u.l("".concat(n," failed, error:"),m),void s(new Oe({code:M.MSG_F_UPLOAD_FAIL}))):(I=Object.create(null),N=f.data.location||"",t.isPrivateNetWork()||N.indexOf("https://")!==0&&N.indexOf("http://")!==0||(N=N.split("//")[1]),I.fileName=o.name,I.fileSize=o.size,I.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),I.location=N,m=Je(_,!1),N=t._formatFileSize(o.size),P=t._formatSpeed(1e3*o.size/m),N="size:".concat(N," time:").concat(m,"ms speed:").concat(P," res:").concat(JSON.stringify(f.data)),u.l("".concat(n," ok. name:").concat(o.name," ").concat(N)),r.setMessage(N).end(),P={HttpStatusCode:f.statusCode,FileSize:o.size,CostTime:m,url:i.url},f.data&&f.data.uploadIP&&(P.uploadIP=f.data.uploadIP),t._uploadSSOLog(P),(N=t.get(26)).addCost(Tt,m),N.addFileSize(Tt,o.size),P=[],p.thumbUrl&&p.largeUrl&&P.push.apply(P,[t._getSmallImageInfoByUrl(p.thumbUrl,I),t._getLargeImageInfoByUrl(p.largeUrl,I)]),t.uploadFileType===1&&t.isSimpleCos&&!t.isPrivateNetWork()&&(P.push(t._getImageInfoArray(p.downloadUrl,I)),f.data.uploadIP&&P.push(t._getDownloadIP(p.downloadUrl.split("//")[1].split("/")[0],I))),d&&P.push(t._getSnapshotInfoByUrl(d,I)),0<P.length?Promise.all(P).then(function(){a(I)}):void a(I))})})})}},{key:"_getDownloadIP",value:function(e,t){var n="".concat(this._n,"._getDownloadIP"),o=Date.now();return this.req({proto:h.GET_IP,data:{domainName:e}}).then(function(i){var a;i.data&&i.data.ip&&(u.l("".concat(n," ok. downloadIP:").concat(i.data.ip," cost:").concat(Je(o))),(a=t.location.split("/"))[0]=i.data.ip,t.location=a.join("/"))}).catch(function(i){})}},{key:"_getImageInfoArray",value:function(e,t){var n=this,o="".concat(this._n,"._getImageInfoArray"),i=Date.now();return this.req({proto:h.GET_IMAGE_INFO,data:{imageUrl:e}}).then(function(a){return a=a.data||{},u.l("".concat(o," ok. data: ").concat(JSON.stringify(a)," cost:").concat(Je(i))),t.imageInfoArray=a.imageInfoArray,a}).catch(function(a){t.imageInfoArray=void 0,n._uploadSSOLog({HttpStatusCode:1e4,CostTime:Je(i,!1),url:e})})}},{key:"_uploadSSOLog",value:function(e){var t,n;this.isSimpleCos&&((t=new R).setEventType(18),e.error&&t.setError(new Oe(e.error)),n="HttpStatusCode:".concat(e.HttpStatusCode,"|CosRequestId:").concat(e.CosRequestId||"","|")+"FileAlreadyExist:".concat(e.FileAlreadyExist||0,"|FileSize:").concat(e.FileSize||0,"|CostTime:").concat(e.CostTime),e.uploadIP&&(n+="|FinalIP:".concat(e.uploadIP)),t.setMessage("OK").setMoreMessage(e.url).setExtension(n).end())}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.get(12).getFileUploadProxy(),n=e;return n=t?e.replace(/^https:\/\/[^/]+/,t):n}},{key:"_getFile",value:function(e){return q(e.file.files)||qn(e.file.files)?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Ut(e/1024,1)+"KB/s":Ut(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,n=n.slice(n.lastIndexOf(".")),n=this._genFileName("".concat(Mt(999999)).concat(n));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),Body:t}],SliceSize:1048576,onProgress:function(o){if(typeof e.onProgress=="function")try{e.onProgress(o.percent)}catch(i){u.w("onProgress callback error:",i)}},onFileFinish:function(o,i,a){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var n=this._getFile(e),t=this._genFileName(n.name),n=n.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(t),FilePath:n,onProgress:function(o){if(u.l(JSON.stringify(o)),typeof e.onProgress=="function")try{e.onProgress(o.percent)}catch(i){u.w("onProgress callback error:",i)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t,n=this,o="",i="",s=0,a=this._getFile(e),s=me?(o=e.message.type===g.MSG_FILE?(t=(t=a.name).slice(t.lastIndexOf(".")),this._genFileName("".concat(Mt(999999)).concat(t))):this._genFileName(a.name),i=a.url,1):(t=(t=a.name).slice(t.lastIndexOf(".")),o=this._genFileName("".concat(Mt(999999)).concat(t)),i=a,0);return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:o,uploadMethod:s,duration:this.duration,userID:e.message.from,conversationType:ct(e.message.conversationID)?1:2}).then(function(I){var f=n.isSimpleCos?I.preSig[0]:I,c=f.uploadUrl,d=f.downloadUrl,p=f.requestSnapshotUrl,p=p===void 0?void 0:p,_=f.thumbUrl,m=f.largeUrl,f=f.fileKey,I=I.uploadIP,I=I===void 0?"":I;return{url:n._getRawOrUploadProxyUrl(c),fileType:n.uploadFileType,fileName:o,resources:i,downloadUrl:d,requestSnapshotUrl:p,thumbUrl:_,largeUrl:m,fileKey:f,uploadIP:!n.isPrivateNetWork()&&I,onProgress:function(N){if(typeof e.onProgress=="function")try{e.onProgress(N.percent)}catch(P){u.w("onProgress callback error:",P),u.e(P)}}}})}},{key:"_genFileName",value:function(e){return"".concat(pi(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,o="_getSnapshotInfoByUrl",i=new R(o);return this.req({proto:h.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(Mt(99999)),requestSnapshotUrl:e}}).then(function(c){var s=(c.data||{}).snapshotUrl;if(u.l("".concat(n._n,".").concat(o," ok. snapshotUrl:").concat(s)),i.setMessage("snapshotUrl:".concat(s)).end(),L(s))return{};var r,c=s;return n.isPrivateNetWork()&&(r=n.getFileDownloadProxy(),c=Ct(s,r)),Sn(c).then(function(d){t.snapshotInfo={snapshotUrl:s,snapshotWidth:d.width,snapshotHeight:d.height}})}).catch(function(a){return u.w("".concat(n._n,".").concat(o," failed. error:"),a),i.setCode(a.errorCode).setMessage(a.errorInfo).end(),{}})}},{key:"_getSmallImageInfoByUrl",value:function(e,t){var n,o=e;return this.isPrivateNetWork()&&(n=this.getFileDownloadProxy(),o=Ct(e,n)),Sn(o).then(function(i){t.smallImageUrl=e,t.smallImageWidth=i.width,t.smallImageHeight=i.height})}},{key:"_getLargeImageInfoByUrl",value:function(e,t){var n,o=e;return this.isPrivateNetWork()&&(n=this.getFileDownloadProxy(),o=Ct(e,n)),Sn(o).then(function(i){t.largeImageUrl=e,t.largeImageWidth=i.width,t.largeImageHeight=i.height})}},{key:"_isEmptyFileList",value:function(e){return!(!qn(e)||e.length!==0)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),ko),Iu=["downloadKey","pbDownloadKey","messageList"],yu=(E(rs,[{key:"uploadMergerMessage",value:function(o,t){var n="".concat(this._n,".").concat("uploadMergerMessage"),o=(u.d("".concat(n," message:"),o,"messageBytes:".concat(t)),o.payload.messageList),i=o.length,a=new R("uploadMergerMessage");return this._msgM.req({proto:h.UPLOAD_MERGER_MSG,data:{messageList:o}}).then(function(r){u.d("".concat(n," ok. response:"),r.data);var r=r.data,c=r.pbDownloadKey,r=r.downloadKey,c={pbDownloadKey:c,downloadKey:r,messageNumber:i};return a.setMessage("".concat(i,"-").concat(t,"-").concat(r)).end(),c}).catch(function(s){throw u.w("".concat(n," failed. error:"),s),a.setError(s).end(),s})}},{key:"downloadMergerMessage",value:function(e){var t="".concat(this._n,".").concat("downloadMergerMessage"),n=(u.d("".concat(t," message:"),e),e.payload.downloadKey),o=this._msgM.getFileDownloadProxy(),i=new R("downloadMergerMessage");return i.setMessage("downloadKey:".concat(n)),this._msgM.req({proto:h.DOWNLOAD_MERGER_MSG,data:{downloadKey:n}}).then(function(a){var s,r;return u.d("".concat(t," ok. response:"),a.data),qe(e.clearElement)?((s=e.payload).downloadKey,s.pbDownloadKey,s.messageList,s=ae(s,Iu),e.clearElement(),e.setElement({type:e.type,content:l({messageList:a.data.messageList},s)},o)):(r=[],a.data.messageList.forEach(function(c){L(c)||(c=new Ar(c,o),r.push(c))}),e.payload.messageList=r,e.payload.downloadKey="",e.payload.pbDownloadKey=""),i.end(),e}).catch(function(a){throw u.w("".concat(t," failed. key:").concat(n," error:"),a),i.setError(a).end(),a})}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===g.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,c){var o=null,i=(t&&(t.offlinePushInfo&&(o=t.offlinePushInfo),t.onlineUserOnly===!0&&(o?o.disablePush=!0:o={disablePush:!0})),[]),a=(Ie(t)&&Ie(t.messageControlInfo)&&(a=(r=t.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,a===!0&&i.push("NoUnread"),s===!0&&i.push("NoLastMsg"),r===!0&&i.push("NoMsgCheck")),""),s=(ne(e.cloudCustomData)&&0<e.cloudCustomData.length&&(a=e.cloudCustomData),c.pbDownloadKey),r=c.downloadKey,c=c.messageNumber,_=e.payload,d=_.title,p=_.abstractList,_=_.compatibleText,m=this._msgM.get(6),m=m&&m.isOnlineMessage(e,t)?0:void 0;return{proto:h.SEND_C2C_MSG,tjgID:this._msgM.generateTjgID(e),data:{fromAccount:this._msgM.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:s,downloadKey:r,title:d,abstractList:p,compatibleText:_,messageNumber:c}}],cloudCustomData:a,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:m,offlinePushInfo:o?{pushFlag:o.disablePush===!0?1:0,title:o.title||"",desc:o.description||"",ext:o.extension||"",apnsInfo:{badgeMode:o.ignoreIOSBadge===!0?1:0},androidInfo:{OPPOChannelID:o.androidOPPOChannelID||""}}:void 0,messageControlInfo:m!==0?i:void 0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,f,c){var o=null,i=(f&&f.offlinePushInfo&&(o=f.offlinePushInfo),[]),a=(Ie(f)&&Ie(f.messageControlInfo)&&(a=(r=f.messageControlInfo).excludedFromUnreadCount,s=r.excludedFromLastMessage,r=r.excludedFromContentModeration,a===!0&&i.push("NoUnread"),s===!0&&i.push("NoLastMsg"),r===!0&&i.push("NoMsgCheck")),""),s=(ne(e.cloudCustomData)&&0<e.cloudCustomData.length&&(a=e.cloudCustomData),c.pbDownloadKey),r=c.downloadKey,c=c.messageNumber,_=e.payload,d=_.title,p=_.abstractList,_=_.compatibleText,m=this._msgM.get(7),f=m&&m.isOnlineMessage(e,f)?1:0;return{proto:h.SEND_GRP_MSG,tjgID:this._msgM.generateTjgID(e),data:{fromAccount:this._msgM.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:s,downloadKey:r,title:d,abstractList:p,compatibleText:_,messageNumber:c}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:a,onlineOnlyFlag:f,offlinePushInfo:o?{pushFlag:o.disablePush===!0?1:0,title:o.title||"",desc:o.description||"",ext:o.extension||"",apnsInfo:{badgeMode:o.ignoreIOSBadge===!0?1:0},androidInfo:{OPPOChannelID:o.androidOPPOChannelID||""}}:void 0,clientTime:e.clientTime,needReadReceipt:e.needReadReceipt!==!0||m.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:f==0?i:void 0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}}]),rs),Mu={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Cu=[M.MSG_ONPROGRESS_FUNCTION_ERROR,M.MSG_I_SELECT_F_FIRST,M.MSG_I_TYPES_LIMIT,M.MSG_F_IS_EMPTY,M.MSG_I_SIZE_LIMIT,M.MSG_F_SELECT_F_FIRST,M.MSG_F_SIZE_LIMIT,M.MSG_V_SIZE_LIMIT,M.MSG_V_TYPES_LIMIT,M.MSG_A_UPLOAD_FAIL,M.MSG_A_SIZE_LIMIT,M.COS_UNDETECTED];function rs(e){S(this,rs),this._n="MergerMessageHandler",this._msgM=e}function ko(e){S(this,ko),(e=Nr.call(this,e))._n="UploadModule",e.TIMUploadPlugin=null,e.timUploadPlugin=null,e.COSSDK=null,e._cosUploadMethod=null,e.expiredTimeLimit=600,e.appid=0,e.bucketName="",e.ciUrl="",e.directory="",e.downloadUrl="",e.uploadUrl="",e.region="ap-shanghai",e.cos=null,e.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},e.uploadFileType="",e.duration=900,e.tryCount=0,e.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},e.isSimpleCos=!1;var t=e.getInnerEmitterInstance();return t.on(we.A2KEY_AND_TINYID_UPDATED,e._init,X(e)),t.on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function Ro(){}function Tu(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function Gr(e,t,n,o,i){if(typeof n!="function")throw new TypeError("The listener must be a function");return n=new Tu(n,o||e,i),o=mt?mt+t:t,e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],n]:e._events[o].push(n):(e._events[o]=n,e._eventsCount++),e}function Ei(e,t){--e._eventsCount==0?e._events=new Ro:delete e._events[t]}function Dt(){this._events=new Ro,this._eventsCount=0}function Pr(e){var t=!1;return Object.values(Mu).includes(e)&&(t=!0),t=120001<=e&&e<=13e4||10100<=e&&e<=10200?!0:t}var br,Ur,wr,Fr,xr,qr,Du=["conversationID","timePosition","timePeriod"],Su=(F(Uo,xe),qr=te(Uo),E(Uo,[{key:"createTextMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new Xe(n)),n=ne(n.payload)?n.payload:n.payload.text,n=new ca({text:n}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new Xe(e));if(me){var i=e.payload.file;if(Le(i))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var o=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,i={url:o,name:o.slice(o.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:o.slice(o.lastIndexOf(".")+1).toLowerCase()};e.payload.file=i}else Ke&&(Le(e.payload.file)?(o=e.payload.file,e.payload.file={files:[o]}):Ie(e.payload.file)&&typeof uni<"u"&&(i=e.payload.file.tempFiles[0],e.payload.file={files:[i]}));return o=new ua({imageFormat:Lt.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),i=this._getNickAndAvatarByUserID(t),n.setElement(o),n.setNickAndAvatar(i),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var n=e.payload.file,o=(me&&(o={url:n.tempFilePath,name:n.tempFilePath.slice(n.tempFilePath.lastIndexOf("/")+1),size:n.fileSize,second:parseInt(n.duration)/1e3,type:n.tempFilePath.slice(n.tempFilePath.lastIndexOf(".")+1).toLowerCase()},e.payload.file=o),this.getMyUserID()),t=(e.currentUser=o,e.senderTinyID=this.getMyTinyID(),new Xe(e)),n=new da({second:Math.floor(n.duration/1e3),size:n.fileSize||n.size,url:n.tempFilePath,uuid:this._generateUUID(e.payload.file)}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),this._messageOptionsMap.set(t.clientSequence,e),t}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0,{});if(me){if(lt)return void this.outputWarning("VideoUnsupportedInAlipay");if(Le(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var o=e.payload.file;q(o.tempFiles)&&(o=o.tempFiles[0]),n.url=o.tempFilePath,n.name=o.tempFilePath.slice(o.tempFilePath.lastIndexOf("/")+1),n.size=o.size||1,n.second=o.duration||0,n.type=o.tempFilePath.slice(o.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else Ke&&(Le(e.payload.file)?(o=e.payload.file,e.payload.file.files=[o]):Ie(e.payload.file)&&typeof uni<"u"&&(o=e.payload.file.tempFile,e.payload.file.files=[o]),o=e.payload.file,n.url=window.URL.createObjectURL(o.files[0]),n.name=o.files[0].name,n.size=o.files[0].size||1,n.second=o.files[0].duration||0,n.type=o.files[0].type.split("/")[1]);return e.payload.file.videoFile=n,o=new Xe(e),n=new ha({videoFormat:n.type,videoSecond:Ut(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),t=this._getNickAndAvatarByUserID(t),o.setElement(n),o.setNickAndAvatar(t),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createCustomMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new Xe(n)),n=new ga({data:n.payload.data,description:n.payload.description,extension:n.payload.extension}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"createFaceMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new Xe(n)),n=new la(n.payload),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"createMergerMessage",value:function(o){var t=this.getMyUserID(),t=(o.currentUser=t,o.senderTinyID=this.getMyTinyID(),this._getNickAndAvatarByUserID(t)),n=new Xe(o),o=new Ci(o.payload);return n.setElement(o),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n.setRelayFlag(!0),n}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,o=e.priority,i=e.payload,a=e.needReadReceipt,s=e.receiverList;if(!q(i._elements))return v({code:M.MSG_FORWARD_INVALID_ELEMENTS});var r=this.getMyUserID(),c=this._getNickAndAvatarByUserID(r);return i.type===g.MSG_GRP_TIP?v({code:M.MSG_FORWARD_TYPE_INVALID}):(n={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:o,isPlaceMessage:0,status:Mi,currentUser:r,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||i.cloudCustomData||"",needReadReceipt:a,receiverList:s,isSupportExtension:e.isSupportExtension||!1},t=new Xe(n),t.setElement(i._elements[0]),t.setNickAndAvatar(c),t.setNameCard(this._getNameCardByGroupID(i)),t.setRelayFlag(!0),t)}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(me){if(!ht&&!Qe&&!$e)return;var n=fe.getSystemInfoSync().SDKVersion;if(ht&&hi(n,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if(Qe&&hi(n,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}Ke||$e?Le(e.payload.file)?(n=e.payload.file,e.payload.file={files:[n]}):Ie(e.payload.file)&&typeof uni<"u"&&(t=(n=e.payload.file).tempFiles,n=n.files,o=null,q(t)?o=t[0]:q(n)&&(o=n[0]),e.payload.file={files:[o]}):(ht||Qe)&&(n=l(l({},(t=e.payload.file.tempFiles)[0]),{},{url:t[0].path}),e.payload.file={files:[n]});var o=this.getMyUserID(),t=(e.currentUser=o,e.senderTinyID=this.getMyTinyID(),new Xe(e)),n=new pa({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),this._messageOptionsMap.set(t.clientSequence,e),t}},{key:"createLocationMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new Xe(n)),n=new _a(n.payload),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"_onCannotFindModule",value:function(){return v({code:M.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(this.get(29).filterMessage(e,t)===!1)return e.hasRiskContent=!0,this._onSendMessageFailed(e,new Oe({code:M.PROFANITY_FOUND}));var o=null;if(e.conversationType===g.CONV_C2C)o=this.get(6);else{if(e.conversationType!==g.CONV_GROUP)return v({code:M.MSG_INVALID_CONV_TYPE});o=this.get(7)}if(!o)return v({code:M.CANNOT_FIND_MODULE});var i,a="".concat(this._n,".sendMessageInstance"),s=this.get(11),r=o.isOnlineMessage(e,t);return this.get(17).upload(e).then(function(){return n._getSendMessageSpecifiedKey(e)===Rn&&n.get(26).addSuccessCount(Tt),n._guardForGroup(e).then(function(){if(!e.isSendable())return v({code:M.MSG_F_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var c=function(d){var p="utf-8";Ke&&document&&(p=document.charset.toLowerCase());var _,m=0,f=d.length;if(p==="utf-8"||p==="utf8")for(var I=0;I<f;I++)(_=d.codePointAt(I))<=127?m+=1:_<=2047?m+=2:_<=65535?m+=3:(m+=4,I++);else if(p==="utf-16"||p==="utf16")for(var N=0;N<f;N++)(_=d.codePointAt(N))<=65535?m+=2:(m+=4,N++);else m=d.replace(/[^\x00-\xff]/g,"aa").length;return m}(JSON.stringify(e));return e.type===g.MSG_MERGER&&11264<c?n._mergerMessageHandler.uploadMergerMessage(e,c).then(function(d){return d=n._mergerMessageHandler.createMergerMessagePack(e,t,d),n.req(d)}):(s.setMessageRandom(e),o.sendMessage(e,t))}).then(function(m){var d,m=m.data,p=m.time,_=m.sequence,f=m.readReceiptCode,m=m.messageDropReason,f=(ge(f)&&f!==0&&(new R("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(_," readReceiptCode:").concat(f)).end(),u.w("".concat(a," readReceiptCode:").concat(f," message:").concat(n.getErrorMessage(f)))),m&&(f=new R("messageDropReason"),m="from:".concat(e.from," to:").concat(e.to," sequence:").concat(_," messageDropReason:").concat(m),f.setMessage(m).end(),u.w("".concat(a," ").concat(m))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence),e.isResend===!0&&(d=s.findMessage(e.ID))&&(u.l("".concat(a," resend ok. ID:").concat(d.ID)),s.deleteLocalMessage(d)),e.status=Ft,e.time=p,!1);return e.conversationType===g.CONV_GROUP?e.sequence=_:e.conversationType!==g.CONV_C2C||(m=s.getLatestMessageSentByMe(e.conversationID))&&(d=m.nick,p=m.avatar,d===e.nick&&p===e.avatar||(f=!0)),f&&s.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),r===!0?e._onlineOnlyFlag=!0:(s.appendToMessageList(e),_=e,Ie(t)&&Ie(t.messageControlInfo)&&(t.messageControlInfo.excludedFromLastMessage===!0&&(e._isExcludedFromLastMessage=!0,_=""),t.messageControlInfo.excludedFromUnreadCount===!0&&(e._isExcludedFromUnreadCount=!0)),m=e.conversationType,We(e.to)&&(m=g.CONV_TOPIC,n.get(10).onMessageSent({groupID:je(e.to),topicID:e.to,lastMessage:_})),s.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:m,subType:e.conversationSubType,lastMessage:_}]})),e._relayFlag||e.type!=="TIMImageElem"||_i(e.payload.imageInfoArray),V({message:e})})}).catch(function(c){return n._onSendMessageFailed(e,c,r)})}},{key:"_guardForGroup",value:function(e){if(e.conversationType!==g.CONV_GROUP)return Promise.resolve();var t=this.get(7);if(!t)return this._onCannotFindModule();if(rt({groupID:e.to})){var n=t.getLocalGroupProfile(e.to);if(n&&n.isSupportTopic)return v({code:M.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return t.guardForAVChatRoom(e)}},{key:"_onSendMessageFailed",value:function(e,t){var a=2<arguments.length&&arguments[2]!==void 0&&arguments[2],n="".concat(this._n,"._onSendMessageFailed"),o=(e.status=aa,t.code!==80001&&t.code!==80004||(e.hasRiskContent=!0),this.get(11)),i=(o.deleteMessageRandom(e),10100<=t.code&&t.code<=10200||120001<=t.code&&t.code<=13e4),a=(a||i||o.appendToMessageList(e)===!0&&u.l("".concat(n," message stored, ID:").concat(e.ID)),this._addSendMessageFailCountOnUser(e,t),new R("sendMessage"));return a.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),a.setError(t).end(),u.e("".concat(n," error:"),t),v(new Oe({code:t&&t.code?t.code:M.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([g.MSG_IMAGE,g.MSG_AUDIO,g.MSG_VIDEO,g.MSG_FILE].includes(e.type))return Rn;if(e.conversationType===g.CONV_C2C)return jn;if(e.conversationType===g.CONV_GROUP){var t=this.get(7);if(t&&(t=t.getLocalGroupProfile(e.to),t))return e=t.type,et(e)?Xn:Jn}}},{key:"_addSendMessageTotalCount",value:function(e){e=this._getSendMessageSpecifiedKey(e),e&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(o,t){var n,o=this._getSendMessageSpecifiedKey(o);o&&((n=this.get(26)).addSuccessCount(o),n.addCost(o,Je(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(a,o){var n,o=o.code,o=o===void 0?-1:o,i=this.get(26),a=this._getSendMessageSpecifiedKey(a);a===Rn&&(n=!1,n=Cu.includes(o)?!0:n)?i.addFailedCountOfUserSide(Tt):Pr(o)&&a&&i.addFailedCountOfUserSide(a)}},{key:"resendMessage",value:function(e,t){return e.isResend=!0,e.status=Mi,this.sendMessageInstance(e,t)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===g.CONV_C2C?n=this.get(6):e.conversationType===g.CONV_GROUP&&(n=this.get(7)),!n)return this._onCannotFindModule();var o=new R("revokeMessage"),i=(o.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),"".concat(this._n,".").concat("revokeMessage"));return n.revokeMessage(e).then(function(s){var s=s.data.recallRetList;return L(s)||s[0].retCode===0?(u.i("".concat(i," ok. ID:").concat(e.ID)),e.isRevoked=!0,o.end(),t.get(11).onMessageRevoked([e]),V({message:e})):(s=new Oe({code:s[0].retCode,data:{message:e}}),o.setCode(s.code).setMoreMessage(s.message).end(),v(s))}).catch(function(a){o.setError(a).end();var s=new Oe({code:a&&a.code?a.code:M.MSG_REVOKE_FAIL,message:a&&a.message?a.message:void 0,data:{message:e}});return u.w("".concat(i," failed. error:"),a),v(s)})}},{key:"deleteMessage",value:function(e){var t=this,n=null,o=e[0],i=o.conversationID,a="",s=[],r=[];if(o.conversationType===g.CONV_C2C)n=this.get(6),a=i.replace(g.CONV_C2C,""),e.forEach(function(p){p&&p.status===Ft&&p.conversationID===i&&(p._onlineOnlyFlag||s.push("".concat(p.sequence,"_").concat(p.random,"_").concat(p.time)),r.push(p))});else if(o.conversationType===g.CONV_GROUP)n=this.get(7),a=i.replace(g.CONV_GROUP,""),e.forEach(function(p){p&&p.status===Ft&&p.conversationID===i&&(p._onlineOnlyFlag||s.push("".concat(p.sequence)),r.push(p))});else if(o.conversationType===g.CONV_SYSTEM)return v({code:M.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(s.length===0)return this._onMessageDeleted(r);30<s.length&&(s=s.slice(0,30),r=r.slice(0,30));var c=new R("deleteMessage"),d=(c.setMessage("to:".concat(a," count:").concat(s.length)),"".concat(this._n,".").concat("deleteMessage"));return n.deleteMessage({to:a,keyList:s}).then(function(p){return c.end(),u.i("".concat(d," ok")),t._onMessageDeleted(r)}).catch(function(p){return c.setError(p).end(),u.w("".concat(d," failed. error:"),p),p=new Oe({code:p&&p.code?p.code:M.MSG_DELETE_FAIL,message:p&&p.message?p.message:void 0}),v(p)})}},{key:"_onMessageDeleted",value:function(e){return this.get(11).onMessageDeleted(e),$({messageList:e})}},{key:"translateText",value:function(i){var t="".concat(this._n,".").concat("translateText"),n=i.sourceTextList,o=i.sourceLanguage,i=i.targetLanguage,a=new R("translateText");return a.setMessage("sourceLanguage:".concat(o," targetLanguage:").concat(i)),this.req({proto:h.TRANSLATE_TEXT,data:{sourceTextList:n,source:o||"auto",target:i,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then(function(d){var d=d.data,r=d.error,c=d.requestID,d=d.translatedTextList;if(r.code===0)return a.end(),u.i("".concat(t," ok. requestID:").concat(c)),V({translatedTextList:d});throw l(l({},r),{},{requestID:c})}).catch(function(s){return a.setCode(s.code).setMoreMessage(s.requestID).end(),u.w("".concat(t," failed. error:"),s),v({code:M.TRANSLATE_TEXT_FAIL})})}},{key:"convertVoiceToText",value:function(i){var n=i.message,i=i.language,t=n.payload.url,n=(n.from===this.getMyUserID()&&n.flow==="out"&&(t=n.payload.remoteAudioUrl),/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/);if(!n.test(t))return v({code:M.UNSUPPORTED_VOICE_FORMAT});var n=n.exec(t)[1]||"mp3",o="16k_zh-PY",i=(i?i==="zh (cmn-Hans-CN)"?o="16k_zh":i==="en-US"?o="16k_en":i==="yue-Hant-HK"?o="16k_yue":i==="ja-JP"&&(o="16k_ja"):o="16k_zh-PY","serviceType:".concat(o," url:").concat(t)),a="".concat(this._n,".").concat("convertVoiceToText"),s=(u.i("".concat(a," ").concat(i)),new R("convertVoiceToText"));return s.setMessage(i),this.req({proto:h.VOICE_TO_TEXT,data:{url:t,language:o,SDKAppID:this.getSDKAppID(),format:n}}).then(function(p){var p=p.data,c=p.error,d=p.requestID,p=p.result;if(c.code===0)return s.end(),u.i("".concat(a," ok. requestID:").concat(d)),V({result:p});throw l(l({},c),{},{requestID:d})}).catch(function(r){return s.setCode(r.code).setMoreMessage(r.requestID||"").end(),u.w("".concat(a," failed. error:"),r),v({code:M.VOICE_TO_TEXT_FAIL})})}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,o=e.conversationType,i=e.to,a=this.get(7);if(!a)return this._onCannotFindModule();if(a.isMessageFromOrToAVChatroom(i))return v({code:M.MSG_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(this.get(29).filterMessage(e)===!1)return e.hasRiskContent=!0,v({code:M.PROFANITY_FOUND,data:{message:e}});o===g.CONV_C2C?n=this.get(6):o===g.CONV_GROUP&&(n=this.get(7));var s=new R("modifyMessage"),r=(s.setMessage("to:".concat(i)),"".concat(this._n,".modifyRemoteMessage"));return n.modifyRemoteMessage(e).then(function(c){return s.end(),u.i("".concat(r," ok")),c=t._onModifyRemoteMessageResp(e,c.data),V({message:c})}).catch(function(c){var d;return s.setCode(c.code).setMoreMessage(c.message).end(),u.w("".concat(r," failed. error:"),c),c.code===20027?(d=t._onModifyRemoteMessageResp(e,c.data),v({code:M.MSG_MODIFY_CONFLICT,data:{message:d}})):v({code:c.code,message:c.message,data:{message:e}})})}},{key:"_generateSearchdata",value:function(i){var t=i.conversationID,n=i.timePosition,o=i.timePeriod,i=ae(i,Du);return D(t)||(ct(t)&&(i.account=t.replace(g.CONV_C2C,"")),ot(t)&&(i.groupID=t.replace(g.CONV_GROUP,""))),ge(o)&&0<o&&(ge(n)&&0<n?i.startTime=n-o:i.startTime=tn()-o),i.startTime&&i.startTime<0&&(i.startTime=void 0),ge(n)&&0<n&&(i.endTime=n),i}},{key:"searchCloudMessages",value:function(e){var t=this,n="searchCloudMessages",o="".concat(this._n,".").concat(n);if(!e)return v({code:M.OPTIONS_IS_EMPTY,message:this.getErrorMessage(M.OPTIONS_IS_EMPTY,n)});var i=e.keywordList,a=e.keywordListMatchType,s=e.conversationID,r=e.cursor,c=q(e.senderUserIDList)&&0<e.senderUserIDList.length,d=q(e.messageTypeList)&&0<e.messageTypeList.length;if(!i&&!c&&!d)throw u.e("[".concat(n,'] Missing required params: "keywordList".')),new Error("Params validate failed.");var p=Date.now(),_=new R(n),m="keywordList:".concat(i," keywordListMatchType:").concat(a," ")+"conversationID:".concat(s," cursor:").concat(r);return u.l("".concat(o," ").concat(m)),this.req({proto:h.MSG_CLOUD_SEARCH,data:this._generateSearchdata(e)}).then(function(N){var P=N.data,I=P.code,P=P.message;if(I!==0)return P=t.getErrorMessage(I===60020?"SearchCloudMessagesUnavailable":I)||P,I=new Oe({code:I,message:P}),_.setMessage(m).setError(I).end(),v(I);var P=N.data,I=P.cursor,N=P.totalCount,P=P.searchResult,H="totalCount:".concat(N," cost:").concat(Je(p)),H=(u.l("".concat(o," ok. cursor:").concat(I," ").concat(H)),_.setMessage("".concat(m," ").concat(H)).end(),t._handleSearchResults(P,!e.conversationID));return V({searchResultList:H,cursor:I,totalCount:N})}).catch(function(f){return _.setMessage(m).setError(f).end(),v(f)})}},{key:"_handleSearchResults",value:function(e,t){var n=this.get(11);return q(e)&&e.length!==0?e.map(function(s){var i=s.groupID,r=s.userID,a=s.messageCount,s=s.messageList,r=i?"".concat(g.CONV_GROUP).concat(i):"".concat(g.CONV_C2C).concat(r),c={conversationID:r,messageCount:a,messageList:[]};return t&&1<a||s&&0<s.length&&(a=n.onRoamingMessage(s,r,!1),i&&a.reverse(),c.messageList=a),c}):[]}},{key:"_onModifyRemoteMessageResp",value:function(r,p){u.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),p);var n=r.conversationType,o=r.from,i=r.to,a=r.random,s=r.sequence,r=r.time,c=p.elements,d=p.messageVersion,p=p.cloudCustomData,p=p===void 0?"":p;return this.get(11).onMessageModified({conversationType:n,from:o,to:i,time:r,random:a,sequence:s,elements:c,cloudCustomData:p,messageVersion:d})}},{key:"_generateUUID",value:function(n){var t=this.get(12),t="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(ci()),n=n.name||n.value||n.url||n.tempFilePath,n=n&&n.slice(n.lastIndexOf(".")+1);return t=n?"".concat(t,".").concat(n):t}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.get(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===g.CONV_GROUP){var t=this.get(7);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),Uo),Eu=(F(bo,xe),xr=te(bo),E(bo,[{key:"onMessageExtensionNotify",value:function(a){var t=this,a=a.dataList,r=a.messageInfo,n=a.operateType,o=a.operateResultList,i=a.tinyID,a=a.globalSequence,s=r.clientTime,r=r.random,c="".concat(i,"-").concat(s,"-").concat(r),d=[],p=[],_=(u.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(c," operateType:").concat(n," globalSequence:").concat(a)),this._updateGlobalSequence(c,a),!1),m=!1;o.forEach(function(f){var I=f.extensions,I=I===void 0?[]:I,N=f.clearSequence;n===1?(_=!0,I.forEach(function(P){d.push({key:P.key,value:P.value})}),t._updateLocalExtension(c,I)):n===2?(m=!0,I.forEach(function(P){p.push(P.key)}),t._updateLocalExtension(c,I)):n===3&&(m=!0,t._hasLocalExtension(c)&&t._getLocalExtension(c).forEach(function(P,H){P.seq<=N&&!L(P.value)&&p.push(H)}),t._clearLocalExtension(c,N))}),_&&this.emitOuterEvent(K.MESSAGE_EXTENSIONS_UPDATED,{messageID:c,extensions:d}),m&&this.emitOuterEvent(K.MESSAGE_EXTENSIONS_DELETED,{messageID:c,keyList:p})}},{key:"setMessageExtensions",value:function(e,d){var n="setMessageExtensions";if(!this.canIUse(Ce.MSG_EXT))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),i=e.ID,a=e.conversationID,s=e.sequence,r=e.time,c=b(d),d=(20<d.length&&(c=d.slice(0,20),u.w("".concat(o,". the length of extensions cannot exceed 20."))),"conversationID:".concat(a," messageID:").concat(i," sequence:").concat(s," time:").concat(r," count:").concat(c.length)),p=new R(n);return p.setMessage(d),u.l("".concat(o," ").concat(d)),this._modifyMessageExtensions(e,c).then(function(f){var m=f.resultList,I=f.successCount,f=f.failureCount,I="success count:".concat(I," fail count:").concat(f);return p.setMoreMessage(I).end(),u.l("".concat(o," ok. ").concat(I)),V({extensions:m})}).catch(function(_){return p.setError(_).end(),u.e("".concat(o," failed. error:"),_),v(_)})}},{key:"getMessageExtensions",value:function(e){var t=this,n="getMessageExtensions";if(!this.canIUse(Ce.MSG_EXT))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),i=e.ID,r=e.conversationID,a=e.sequence,s=e.time,r="conversationID:".concat(r," messageID:").concat(i," sequence:").concat(a," time:").concat(s),c=new R(n),d=(c.setMessage(r),u.l("".concat(o," ").concat(r)),void 0);return this.getMessageExtensionsMap.has(i)&&(d=this._getGlobalSequence(i)),this._getMessageExtensions(e,d).then(function(p){return c.end(),u.l("".concat(o," ok. total count:").concat(p.length)),D(d)&&0<p.length&&t.getMessageExtensionsMap.set(i,1),V({extensions:p})}).catch(function(p){return c.setError(p).end(),u.e("".concat(o," failed. error:"),p),v(p)})}},{key:"deleteMessageExtensions",value:function(e,s){var n="deleteMessageExtensions";if(!this.canIUse(Ce.MSG_EXT))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),i=[],a=3,s=(L(s)||(a=2,s.forEach(function(_){i.push({key:_,value:"",seq:0})})),e.ID),d=e.conversationID,r=e.sequence,c=e.time,d="conversationID:".concat(d," messageID:").concat(s," sequence:").concat(r," time:").concat(c," operateType:").concat(a),p=new R(n);return p.setMessage(d),u.l("".concat(o," ").concat(d)),this._modifyMessageExtensions(e,i,a).then(function(I){var m=I.resultList,f=I.successCount,I=I.failureCount,N="";return a===2&&(N="success count:".concat(f," fail count:").concat(I)),p.setMoreMessage("".concat(N)).end(),u.l("".concat(o," ok. ").concat(N)),V({extensions:m})}).catch(function(_){return p.setError(_).end(),u.e("".concat(o," failed. error:"),_),v(_)})}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,i=We(e.to)?g.CONV_TOPIC:e.conversationType,a=void 0,s=(o!==3&&(a=this._getRequestExtensions(e,t)),null);switch(i){case g.CONV_C2C:s=this.get(6);break;case g.CONV_GROUP:s=this.get(7);break;case g.CONV_TOPIC:s=this.get(10);break;default:return v({code:M.CANNOT_FIND_MODULE})}return s.modifyMessageExtensions(e,a,o).then(function(d){var d=d.data,c=d.extensions,d=d.seq,p=[],_=0,m=0,f=[];return(c=L(c)?[]:c).forEach(function(Z){var N=Z.errorCode,Z=Z.extension,P=Z.key,H=Z.value,Z=Z.seq;p.push({code:N,key:P,value:H}),N===0?_++:m++,f.push({key:P,value:H,seq:Z})}),n._updateGlobalSequence(e.ID,d),0<f.length&&(n._updateLocalExtension(e.ID,f),f=null),{resultList:p,successCount:_,failureCount:m}}).catch(function(r){return v(r)})}},{key:"_getRequestExtensions",value:function(e,t){var n,o=[];return this._hasLocalExtension(e.ID)?(n=this._getLocalExtension(e.ID),t.forEach(function(s){var a=s.key,s=s.value,r=0;n.has(a)&&(r=n.get(a).seq),o.push({key:a,value:s,seq:r})})):t.forEach(function(s){var a=s.key,s=s.value;o.push({key:a,value:s,seq:0})}),o}},{key:"_getMessageExtensions",value:function(e,t){var n=this,o="".concat(this._n,"._getMessageExtensions"),i=e.ID,a=e.to,s=null;switch(We(a)?g.CONV_TOPIC:e.conversationType){case g.CONV_C2C:s=this.get(6);break;case g.CONV_GROUP:s=this.get(7);break;case g.CONV_TOPIC:s=this.get(10);break;default:return v({code:M.CANNOT_FIND_MODULE})}return s.getMessageExtensions(e,t).then(function(p){var p=p.data,_=p.extensions,c=p.completeFlag,d=p.globalSequence,p=p.clearSequence,_=L(_)?[]:_;return u.l("".concat(o," ok. completeFlag:").concat(c," globalSequence:").concat(d," clearSequence:").concat(p," count:").concat(_.length)),n._updateLocalExtension(i,_),n._clearLocalExtension(i,p),n._updateGlobalSequence(i,d),c!==1?(p=_.slice(-1)[0].seq+1,n._getMessageExtensions(e,p)):n._getLocalExtensions(i)}).catch(function(r){return v(r)})}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach(function(s){var i=s.key,a=s.value,s=s.seq;n.set(i,{value:a===void 0?"":a,seq:s})})}},{key:"_clearLocalExtension",value:function(e,t){var n;t<=0||!this._hasLocalExtension(e)||(n=this._getLocalExtension(e)).forEach(function(o,i){o.seq<=t&&n.delete(i)})}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach(function(n,o){n=n.value,L(n)||t.push({key:o,value:n})}),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),bo),Lu=(F(Po,xe),Fr=te(Po),E(Po,[{key:"onMessageReactionNotifyList",value:function(n){var t=this,n=(n||{}).dataList;(n===void 0?[]:n).forEach(function(i){var s=i.C2CMessageInfo,r=i.groupMessageInfo,r=r===void 0?{}:r,i=i.reactionList,i=i===void 0?[]:i,s=l(l({},s===void 0?{}:s),r),r=s.tinyID,a=s.clientTime,s=s.random,r="".concat(r,"-").concat(a,"-").concat(s),c=[];i.forEach(function(d){D(d.userIDList)&&(d.userIDList=[],d.count=0),c.push.apply(c,b(d.userIDList))}),u.l("".concat(t._n,".onMessageReactionNotifyList messageID:").concat(r," reactionList:").concat(i.length)),t._handleReactionSummary([{messageID:r,reactionList:i}],c).then(function(d){t.emitOuterEvent(K.MESSAGE_REACTIONS_UPDATED,l({},d[0]))})})}},{key:"onMessageReactionNotify",value:function(n){var n=n.dataList||{},o=n.C2CMessageInfo,i=n.groupMessageInfo,i=i===void 0?{}:i,t=n.reactionID,n=n.operateType,o=l(l({},o===void 0?{}:o),i),i=o.tinyID,a=o.clientTime,o=o.random,i="".concat(i,"-").concat(a,"-").concat(o),a=(u.l("".concat(this._n,".onMessageReactionNotify messageID:").concat(i," reactionID:").concat(t," operateType:").concat(n)),n===1?this._addReactedByMyselfMap(i,t):this._removeReactedByMyselfMap(i,t),"".concat(i,"-").concat(t));this._reactionInfoMap.has(a)&&((o=this._reactionInfoMap.get(a)).reactedByMyself=n===1,this.emitOuterEvent(K.MESSAGE_REACTIONS_UPDATED,{messageID:i,reactionList:[o]}))}},{key:"addMessageReaction",value:function(e,t){var n=this,o="addMessageReaction";if(!this.canIUse(Ce.MSG_REACTION))return this.cannotUseCommercialAbility(o);var i="".concat(this._n,".").concat(o),r=e.ID,a=e.conversationID,a="conversationID:".concat(a," messageID:").concat(r," reactionID:").concat(t),s=new R(o),r=(s.setMessage(a),u.l("".concat(i," ").concat(a)),this._createReactionOperationPack(e,t,1));return this._addReactedByMyselfMap(e.ID,t),this.req(r).then(function(){return s.end(),u.l("".concat(i," ok.")),V()}).catch(function(c){return n._removeReactedByMyselfMap(e.ID,t),s.setError(c).end(),u.e("".concat(i," failed. error:"),c),v(c)})}},{key:"removeMessageReaction",value:function(e,t){var n="removeMessageReaction";if(!this.canIUse(Ce.MSG_REACTION))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=e.ID,i=e.conversationID,i="conversationID:".concat(i," messageID:").concat(s," reactionID:").concat(t),a=new R(n),s=(a.setMessage(i),u.l("".concat(o," ").concat(i)),this._createReactionOperationPack(e,t,2));return this._removeReactedByMyselfMap(e.ID,t),this.req(s).then(function(){return a.end(),u.l("".concat(o," ok.")),V()}).catch(function(r){return a.setError(r).end(),u.e("".concat(o," failed. error:"),r),v(r)})}},{key:"getMessageReactions",value:function(e){var t=this,n="getMessageReactions";if(!this.canIUse(Ce.MSG_REACTION))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),i=e.messageList,c=e.maxUserCountPerReaction,a=i[0].conversationID,a="conversationID:".concat(a," maxUserCountPerReaction:").concat(c," messageList:").concat(i.length),s=new R(n),r=(s.setMessage(a),u.l("".concat(o," ").concat(a)),new Map),c=this._createReactionSummaryPack(l(l({},e),{},{messageIDMap:r}));return this.req(c).then(function(p){var p=p.data.resultList,_=[],m=[];return(p===void 0?[]:p).forEach(function(N){var I=N.messageKey,I=I===void 0?void 0:I,P=N.messageSequence,P=P===void 0?void 0:P,N=N.reactionList,N=N===void 0?[]:N,P=D(I)?r.get(P):r.get(I);_.push({messageID:P,reactionList:N}),N.forEach(function(H){m.push.apply(m,b(H.userIDList))})}),t._handleReactionSummary(_,m)}).then(function(d){return s.end(),u.l("".concat(o," ok.")),r.clear(),V({resultList:d})}).catch(function(d){return s.setError(d).end(),u.e("".concat(o," failed. error:"),d),v(d)})}},{key:"getAllUserListOfMessageReaction",value:function(e){var t=this,n="getAllUserListOfMessageReaction";if(!this.canIUse(Ce.MSG_REACTION))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),r=e.message,i=e.reactionID,a=e.nextSeq,s=e.count,p=r.ID,r=r.conversationID,r="conversationID:".concat(r," messageID:").concat(p," reactionID:").concat(i," nextSeq:").concat(a," count:").concat(s),c=new R(n),d=(c.setMessage(r),u.l("".concat(o," ").concat(r)),{userList:[],nextSeq:0,isCompleted:!1}),p=this._createReactionUserListPack(e);return this.req(p).then(function(f){var f=f.data,m=f.userIDList,m=m===void 0?[]:m,f=f.nextSeq,f=f===void 0?0:f;return d.nextSeq=f,d.isCompleted=f===0,t.get(4).getUserNickAndAvatar(m)}).then(function(_){return d.userList=_,c.end(),u.l("".concat(o," ok.")),V(d)}).catch(function(_){return c.setError(_).end(),u.e("".concat(o," failed. error:"),_),v(_)})}},{key:"_createReactionOperationPack",value:function(e,s,n){var o,i,a=void 0,s={reactionID:s,userIDList:[this.getMyUserID()]};return e.conversationType===g.CONV_C2C&&(o=this.get(6),a=n===1?h.ADD_C2C_MSG_REACTION:h.RM_C2C_MSG_REACTION,s.from=e.from,s.to=e.to,s.messageKey=o.getMessageKey(e)),e.conversationType===g.CONV_GROUP&&(o=void 0,i=e.to,We(e.to)&&(i=je(o=e.to)),a=n===1?h.ADD_GRP_MSG_REACTION:h.RM_GRP_MSG_REACTION,s.groupID=i,s.topicID=o,s.messageSequence=e.sequence),{proto:a,data:s}}},{key:"_createReactionSummaryPack",value:function(r){var t,n,o,i=r.messageList,a=r.maxUserCountPerReaction,a=a===void 0?10:a,s=r.messageIDMap,r=i[0],c=void 0,d=void 0;return r.conversationType===g.CONV_C2C&&(t=this.get(6),n=i.map(function(p){var _=t.getMessageKey(p);return s.set(_,p.ID),_}),c=h.GET_C2C_MSG_REACTIONS,d={from:r.from,to:r.to,messageKeyList:n,count:a}),r.conversationType===g.CONV_GROUP&&(n=void 0,o=r.to,We(r.to)&&(o=je(n=r.to)),r=i.map(function(p){return s.set(p.sequence,p.ID),p.sequence}),c=h.GET_GRP_MSG_REACTIONS,d={groupID:o,topicID:n,messageSequenceList:r,count:a}),{proto:c,data:d}}},{key:"_createReactionUserListPack",value:function(o){var t=o.message,a=o.reactionID,n=o.nextSeq,o=o.count,o=o===void 0?100:o,i=void 0,a={reactionID:a,nextSeq:n===void 0?0:n,count:100<o?100:o};return t.conversationType===g.CONV_C2C&&(n=this.get(6),i=h.GET_C2C_MSG_REACTION_USER_LIST,a.from=t.from,a.to=t.to,a.messageKey=n.getMessageKey(t)),t.conversationType===g.CONV_GROUP&&(o=void 0,n=t.to,We(t.to)&&(n=je(o=t.to)),i=h.GET_GRP_MSG_REACTION_USER_LIST,a.groupID=n,a.topicID=o,a.messageSequence=t.sequence),{proto:i,data:a}}},{key:"_handleReactionSummary",value:function(e,t){var n=this;return this.get(4).getUserNickAndAvatar(t).then(function(o){var i=[];return e.forEach(function(a){var s=[];a.reactionList.forEach(function(p){var c=p.reactionID,d=p.count,m=p.userIDList,p=p.reactedByMyself,p=p===void 0?void 0:p,_=[],m=(m.forEach(function(f){o.forEach(function(I){f===I.userID&&_.push(I)})}),{reactionID:c,totalUserCount:d,partialUserList:_,reactedByMyself:n._computeReactedByMyself({reactedByMyself:p,messageID:a.messageID,reactionID:c})});s.push(m),D(p)&&!n._reactedByMyselfMap.has(a.messageID)&&(d="".concat(a.messageID,"-").concat(c),n._reactionInfoMap.set(d,m))}),i.push({messageID:a.messageID,reactionList:s})}),i})}},{key:"_addReactedByMyselfMap",value:function(e,t){this._reactedByMyselfMap.has(e)||this._reactedByMyselfMap.set(e,[]),e=this._reactedByMyselfMap.get(e),e.indexOf(t)===-1&&e.push(t)}},{key:"_removeReactedByMyselfMap",value:function(e,t){!this._reactedByMyselfMap.has(e)||-1<(t=(e=this._reactedByMyselfMap.get(e)).indexOf(t))&&e.splice(t,1)}},{key:"_computeReactedByMyself",value:function(o){var t=o.reactedByMyself,n=o.messageID,o=o.reactionID;return D(t)?!!this._reactedByMyselfMap.has(n)&&this._reactedByMyselfMap.get(n).includes(o):t===1}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),Po),ku=(F(Go,xe),wr=te(Go),E(Go,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(n===null)return v({code:M.MSG_SEND_FAIL});this._addSendMessageTotalCount(n);var o=Date.now();return this.get(11).setMessageRandom(n),this._sendComboMessage(n,e).then(function(s){var s=s.data,r=s.time,a=s.sequence,s=s.readReceiptCode,s=(ge(s)&&s!==0&&(new R("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(a," readReceiptCode:").concat(s)).end(),u.w("".concat(t._n,".sendMessage readReceiptCode:").concat(s," message:").concat(t.getErrorMessage(s)))),t._addSendMessageSuccessCount(n,o),t.get(11)),r=(n.status=Ft,n.time=r,n.conversationType===g.CONV_GROUP&&(n.sequence=a),s.appendToMessageList(n),n);return n._isExcludedFromLastMessage===!0&&(r=""),s.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:r}]}),V({message:n})}).catch(function(i){return t._onSendMessageFailed(n,i)})}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.get(20),o="";return e.conversationType===g.CONV_C2C&&(o="".concat(O.NAME.OPEN_IM,".").concat(h.SEND_C2C_MSG)),e.conversationType===g.CONV_GROUP&&(o="".concat(O.NAME.GROUP,".").concat(h.SEND_GRP_MSG)),n.sendComboMessage({servcmd:o,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var o,i=this.getMyUserID(),a={};a.senderTinyID=this.getMyTinyID(),a.currentUser=i,a.from=e.From_Account||i,e.GroupId?(a.conversationID="".concat(g.CONV_GROUP).concat(e.GroupId),a.conversationType=g.CONV_GROUP,a.to=e.GroupId):e.To_Account&&(a.conversationID="".concat(g.CONV_C2C).concat(e.To_Account),a.conversationType=g.CONV_C2C,a.to=e.To_Account),a.time=e.MsgTimeStamp||0,a.random=e.Random||e.MsgRandom||0,a.priority=e.MsgPriority,ne(e.CloudCustomData)&&0<e.CloudCustomData.length&&(a.cloudCustomData=e.CloudCustomData),q(e.SendMsgControl)&&(a.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(a.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(a.messageControlInfo.excludedFromLastMessage=1)),a.conversationType===g.CONV_GROUP&&q(e.To_Account)&&0<e.To_Account.length&&(o=e.To_Account,50<e.To_Account.length&&(o=e.To_Account.slice(0,50),u.w("".concat(t," To_Account must be less than or equal to 50."))),a.receiverList=b(o),e.To_Account=b(o)),e.IsNeedReadReceipt!==1&&e.NeedReadReceipt!==1||(a.needReadReceipt=!0),e.SupportMessageExtension===1&&(a.isSupportExtension=!0),(n=new Xe(a)).status=Mi,e.MsgClientTime=n.clientTime,n.conversationType===g.CONV_C2C&&(e.MsgSeq=n.sequence);for(var s,r=e.MsgBody.length,c=0;c<r;c++)(s=e.MsgBody[c]).MsgType==="TIMTextElem"?n.setTextElement(s.MsgContent.Text):s.MsgType==="TIMCustomElem"?n.setCustomElement({data:s.MsgContent.Data||"",description:s.MsgContent.Desc||"",extension:s.MsgContent.Ext||""}):s.MsgType==="TIMFaceElem"&&n.setFaceElement({index:s.MsgContent.Index,data:s.MsgContent.Data});var d=n.getElements();n.payload=d[0].content,n.type=d[0].type}catch(p){n=null,u.e("".concat(t," failed. error:"),p)}return n}},{key:"_onSendMessageFailed",value:function(e,t){return e.status=aa,this.get(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t),new R("sendMessage").setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)).setError(t).end(),u.e("".concat(this._n,"._onSendMessageFailed error:"),t),v(new Oe({code:t&&t.code?t.code:M.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===g.CONV_C2C)return jn;if(e.conversationType===g.CONV_GROUP){var e=this.get(7).getLocalGroupProfile(e.to);if(e)return e=e.type,et(e)?Xn:Jn}}},{key:"_addSendMessageTotalCount",value:function(e){e=this._getSendMessageSpecifiedKey(e),e&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(o,t){var n,o=this._getSendMessageSpecifiedKey(o);o&&((n=this.get(26)).addSuccessCount(o),n.addCost(o,Je(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(i,n){var n=n.code,n=n===void 0?-1:n,o=this.get(26),i=this._getSendMessageSpecifiedKey(i);Pr(n)&&i&&o.addFailedCountOfUserSide(i)}}]),Go),Ru=(F(Oo,xe),Ur=te(Oo),E(Oo,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach(function(n){t.plugins[n]=e[n]}),new R("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),Oo),Nu=(F(No,xe),br=te(No),E(No,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(i){var t=this,n=i.cookie,o=i.syncFlag,i=i.isOnlineSync,a="".concat(this._n,"._startSync");u.l("".concat(a," cookie:").concat(n," syncFlag:").concat(o," isOnlineSync:").concat(i)),this.req({proto:h.SYNC_UNREAD_MSG,data:{cookie:n,syncFlag:o,isOnlineSync:i}}).then(function(s){var c=s.data,r=c.cookie,c=c.syncFlag;L(t._cookie=r)||(c===0||c===1?(t._dispatchUnreadMessage(l(l({},s.data),{},{isSyncingEnded:!1})),t._startSync({cookie:r,syncFlag:c,isOnlineSync:0})):c===2&&t._dispatchUnreadMessage(l(l({},s.data),{},{isSyncingEnded:!0})))}).catch(function(s){u.e("".concat(a," failed. error:"),s)})}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.get(6).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList,isSyncingEnded:e.isSyncingEnded})}},{key:"startOnlineSync",value:function(){u.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){u.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),No),Li={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself"},ignoreKeyWord:["C2C","ID","USP"]};function No(e){return S(this,No),(e=br.call(this,e))._n="SyncUnreadMessageModule",e._cookie="",e._onlineSyncFlag=!1,e.getInnerEmitterInstance().on(we.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,X(e)),e}function Oo(e){return S(this,Oo),(e=Ur.call(this,e))._n="PluginModule",e.plugins={},e}function Go(e){return S(this,Go),(e=wr.call(this,e))._n="ComboMessageModule",e}function Po(e){return S(this,Po),(e=Fr.call(this,e))._n="MessageReactionModule",e._reactedByMyselfMap=new Map,e._reactionInfoMap=new Map,e}function bo(e){return S(this,bo),(e=xr.call(this,e))._n="MessageExtensionModule",e.messageExtensionMap=new Map,e.globalSeqMap=new Map,e.getMessageExtensionsMap=new Map,e}function Uo(e){return S(this,Uo),(e=qr.call(this,e))._n="MessageModule",e._messageOptionsMap=new Map,e._mergerMessageHandler=new yu(X(e)),e}function cs(e,t){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");return t=Object.assign({pascalCase:!1},t),(e=Array.isArray(e)?e.map(function(n){return n.trim()}).filter(function(n){return n.length}).join("-"):e.trim()).length===0?"":e.length===1?t.pascalCase?e.toUpperCase():e.toLowerCase():(e=e=(e=e!==e.toLowerCase()?Ou(e):e).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(n,o){return o.toUpperCase()}).replace(/\d+(\w|$)/g,function(n){return n.toUpperCase()}),t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e)}var Ou=function(e){for(var t=!1,n=!1,o=!1,i=0;i<e.length;i++){var a=e[i];t&&/[a-zA-Z]/.test(a)&&a.toUpperCase()===a?(e=e.slice(0,i)+"-"+e.slice(i),o=n,n=!(t=!1),i++):n&&o&&/[a-zA-Z]/.test(a)&&a.toLowerCase()===a?(e=e.slice(0,i-1)+"-"+e.slice(i-1),o=n,t=!(n=!1)):(t=a.toLowerCase()===a&&a.toUpperCase()!==a,o=n,n=a.toUpperCase()===a&&a.toLowerCase()!==a)}return e};function Gu(e,t){var n=0;return function o(i,a){return 100<++n?(n--,i):q(i)?(s=i.map(function(p){return dt(p)?o(p,a):p}),n--,s):dt(i)?(r=i,c=function(p,_){if(!ri(_))return!1;if(_!==cs(_))for(var m=0;m<Li.ignoreKeyWord.length&&!_.includes(Li.ignoreKeyWord[m]);m++);var f;return D(a[_])?(f=_)==="OPPOChannelID"?f:f[0].toUpperCase()+cs(f).slice(1):a[_]},d=Object.create(null),Object.keys(r).forEach(function(p){var _=c(r[p],p);_&&(d[_]=r[p])}),s=di(s=d,function(p,_){return q(p)||dt(p)?o(p,a):p}),n--,s):void 0;var s,r,c,d}(e,t)}for(var Vr,us=String.fromCharCode,Pu=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320)if(e=0|e.charCodeAt(1),56320<=e&&e<=57343){if(65535<(t=(t<<10)+e-56613888|0))return us(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533;else t<=57343&&(t=65533);return t<=2047?us(192|t>>>6,128|63&t):us(224|t>>>12,128|t>>>6&63,128|63&t)},ls=function(e){for(var t=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,Pu),n=0|t.length,o=new Uint8Array(n),i=0;i<n;i=i+1|0)o[i]=0|t.charCodeAt(i);return o},bu=(E(fs,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(){this._handler.onOpen({id:this._id})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e})}},{key:"_onMessage",value:function(e){this._handler.onMessage({data:this._canIUseBinaryFrame?function(t){for(var n=new Uint8Array(t),o="",i=0,a=n.length;i<a;){var s=n[i],r=0,c=0;if(s<=127?(r=0,c=255&s):s<=223?(r=1,c=31&s):s<=239?(r=2,c=15&s):s<=244&&(r=3,c=7&s),0<a-i-r)for(var d=0;d<r;)c=c<<6|63&(s=n[i+d+1]),d+=1;else c=65533,r=a-i;o+=String.fromCodePoint(c),i+=r+1}return o}(e.data):e.data})}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),lt)return fe.offSocketClose(),fe.offSocketMessage(),fe.offSocketOpen(),fe.offSocketError(),void fe.closeSocket();this._socket&&(me?(this._socket.onClose(function(){}),this._socket.onOpen(function(){}),this._socket.onMessage(function(){}),this._socket.onError(function(){})):Ke&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),Wt?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?ls(e.data).buffer:e.data}):lt?fe.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket&&(me?this._socket.send({data:this._canIUseBinaryFrame?ls(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):Ke&&this._socket.send(this._canIUseBinaryFrame?ls(e.data).buffer:e.data))}}]),fs),Uu=["keyMap"],wu=["keyMap"],wo="connected",Br="connecting",ki="disconnected",Fu=(E(_s,[{key:"_setWebsocketHost",value:function(){var e=this._chM.get(12);this._currentSite=un,this._chM.isOversea()&&(this._currentSite="OVERSEA"),e.isSingaporeSite()?this._currentSite="SINGAPORE":e.isKoreaSite()?this._currentSite="KOREA":e.isGermanySite()?this._currentSite="GERMANY":e.isIndiaSite()?this._currentSite="IND":e.isJapanSite()?this._currentSite="JPN":e.isUSASite()?this._currentSite="USA":e.isIndonesiaSite()&&(this._currentSite="INDONESIA"),O.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){D(O.HOST.CURRENT.BACKUP)||this._url===""?this._url=O.HOST.CURRENT.DEFAULT:this._url===O.HOST.CURRENT.DEFAULT?this._url=O.HOST.CURRENT.BACKUP:this._url===O.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?O.HOST.CURRENT.ANYCAST:O.HOST.CURRENT.DEFAULT:this._url===O.HOST.CURRENT.ANYCAST&&(O.HOST.CURRENT.ANYCAST="",this._url=O.HOST.CURRENT.DEFAULT);var e=this._chM.get(12),t=e.getProxyServer();L(t)||(this._url=t),e.isTestEnv()&&(this._url=Nt.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return Ke&&O.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&this._checkPromiseMap()}},{key:"_checkPromiseMap",value:function(){var e=this;this._promiseMap.size!==0&&this._promiseMap.forEach(function(i,n){var o=i.reject,i=i.timestamp,a=15e3;n.indexOf(h.LOGIN)!==-1&&(a=9e4),Date.now()-i>=a&&(u.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),o(new Oe({code:M.NETWORK_TIMEOUT})),e._chM.onRequestTimeout(n))})}},{key:"onOpen",value:function(e){var t,n;this._readyState!==""&&(this._onOpenTs=Date.now(),t=e.id,this._socketID=t,n=Je(this._startTs,!1),u.l("".concat(this._n,"._onOpen cost:").concat(n," ms. socketID:").concat(t)),new R("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage("socketID:".concat(t)).end(),e.id===this._socketID&&(this._readyState=wo,this._reConnectCount=0,this._resend(),this._reConnectFlag===!0&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen()))}},{key:"onClose",value:function(o){var t=new R("wsOnClose"),n=o.id,o=o.e,i="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(o.code," reason:").concat(o.reason),a=0;this._onOpenTs!==0&&(a=Date.now()-this._onOpenTs),t.setMessage(a).setCostTime(a).setMoreMessage(i).setCode(o.code).end(),u.l("".concat(this._n,"._onClose ").concat(i," onlineTime:").concat(a)),n===this._socketID&&(this._readyState=ki,a<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(n){var t=n.id,n=n.e,o="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new R("wsOnError").setMessage(n.errMsg||ui(n)).setMoreMessage(o).setLevel("error").end(),u.w("".concat(this._n,"._onError"),n,o),t===this._socketID&&(this._readyState="",this._chM.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch{new R("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n,o,i,e=this._getRequestIDFromHead(t.head),a=t.body;if(this._chM.get(30).isTRTCCommand(e)||(i=go(t.head),a=function r(c,d){return q(c)?c.map(function(f){return dt(f)?r(f,d):f}):dt(c)?(p=c,_=function(f,I){return D(d[I])?cs(I):d[I]},m={},Object.keys(p).forEach(function(f){m[_(p[f],f)]=p[f]}),di(m,function(f){return q(f)||dt(f)?r(f,d):f})):void 0;var p,_,m}(t.body,this._getResponseKeyMap(i))),u.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(a)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e))return n=(i=this._promiseMap.get(e)).resolve,o=i.reject,i=i.timestamp,this._promiseMap.delete(e),this._calcRTT(i),void(a.errorCode&&a.errorCode!==0?(this._chM.onErrorCodeNotZero(a),o(new Oe({code:a.errorCode,message:a.errorInfo||"",data:e.includes(h.MODIFY_C2C_MSG)||e.includes(h.MODIFY_GRP_MSG)?{elements:a.elements,messageVersion:a.messageVersion,cloudCustomData:a.cloudCustomData}:void 0}))):n(V(a)));this._chM.onMessage({head:t.head,body:a})}}},{key:"_calcRTT",value:function(e){e=Date.now()-e,this._chM.get(26).addRTT(e)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new bu(this),this._socketID=this._socket.getID(),this._readyState=Br,u.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new R("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=gi(),t=((lt||ht&&e==="windows"||$e)&&(this._canIUseBinaryFrame=!1),-1),o=(e==="ios"?t=ro||-1:e==="android"&&(t=pn||-1),this._chM.get(12)),n=this._chM.getPlatform(),i=o.getSDKAppID(),o=o.getInstanceID(),i="sdkappid=".concat(i,"&instanceid=").concat(o,"&random=").concat(this._getRandom(),"&platform=").concat(n,"&host=").concat(e,"&version=").concat(t,"&sdkversion=").concat("3.2.9");return Gn&&(i+="&isminigame=1"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(i)}},{key:"_closeConnection",value:function(e){u.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=ki)}},{key:"_resend",value:function(){var e=this;if(u.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach(function(p,r){var c=p.uplinkData,d=p.resolve,p=p.reject;r.indexOf(h.AV_POLLING)!==-1?e._promiseMap.delete(r):(e._promiseMap.set(r,{resolve:d,reject:p,timestamp:Date.now(),uplinkData:c}),e._execute(r,c))}),0<this._simpleRequestMap.size){var t,n=Re(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var o=z(t.value,2),i=o[0],a=o[1];this._execute(i,a)}}catch(s){n.e(s)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this,n=(e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap,ae(e,Uu)),o=this._getRequestIDFromHead(e.head),i=JSON.stringify(n);return new Promise(function(a,s){t._promiseMap.set(o,{resolve:a,reject:s,timestamp:Date.now(),uplinkData:i}),u.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(o," readyState:").concat(t._readyState)),t._readyState!==wo?t._reConnect():(t._execute(o,i),t._chM.get(26).addRequestCount())})}},{key:"simplySend",value:function(t){t.head.seq=this._getSequence(),t.head.reqtime=Math.floor(Date.now()/1e3),t.keyMap;var n=ae(t,wu),t=this._getRequestIDFromHead(t.head),n=JSON.stringify(n);this._readyState!==wo?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(t,n):u.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(t,n)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:me?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){u.l("".concat(this._n,"._onSendFail requestID:").concat(e))}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,this._startSequence===2415919103&&(this._startSequence=Mt()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){return e=this._chM.getKeyMap(e),l(l({},Li.response),e.response)}},{key:"_reConnect",value:function(){this._readyState!==wo&&this._readyState!==Br&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e="".concat(this._n,".forcedReconnect");u.l("".concat(e," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(u.w("".concat(e," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===wo}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"setIsWorkerEnabled",value:function(e){u.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&St}},{key:"_getRandom",value:function(){return this._random===0&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){u.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=Mt(),this._readyState=ki,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),_s),ds=function(e,t,n){return new Promise(function(o,i){var a,s,r="application/x-www-form-urlencoded;charset=UTF-8";me?fe.request({url:t,data:n,method:e,timeout:3e3,header:{"content-type":r},success:function(c){c&&c.data&&c.data.NetCheckInfo&&u.l("".concat("getconninfo ok in"," miniapp. ret:"),c.data),o()},fail:function(){i(new Oe({code:M.NETWORK_ERROR}))}}):(a=new XMLHttpRequest,s=setTimeout(function(){a.abort(),i(new Oe({code:M.NETWORK_TIMEOUT}))},3e3),a.onreadystatechange=function(){a.readyState===4&&(clearTimeout(s),a.status===200||a.status===304?(a.responseText&&-1<a.responseText.indexOf("NetCheckInfo")&&u.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(a.responseText)),o()):i(new Oe({code:M.NETWORK_ERROR})))},a.open(e,t,!0),a.setRequestHeader("Content-type",r),n?a.send(n):a.send())})},xu=(F(Fo,xe),Vr=te(Fo),E(Fo,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.get(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.get(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==g.NET_STATE_CONNECTED&&e.head.servcmd.includes(h.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(n){var t=O.HOST.CURRENT.STAT,t="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(n.head.sdkappid,"&reqtime=").concat(Date.now()),n=JSON.stringify(n.body);return ds("POST",t,n)}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(g.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){me&&!$e&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(g.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.get(20).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(e){15e3<=Date.now()-this._disconnectedTS&&this.diagnose()}},{key:"onReconnected",value:function(){u.l("".concat(this._n,".onReconnected cost:").concat(Je(this._disconnectedTS,!0,!1))),this._m.restartTimer(),this.get(20).onReconnected(Je(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(g.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){u.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(g.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(g.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],t=!1,n=(this._socketHandler&&(t=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t));if(u.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(e===!0)this._socketHandler.forcedReconnect();else{if(this._previousState===g.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(g.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(u.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),e===g.NET_STATE_DISCONNECTED&&this._disconnectedTS===0&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=e,this.emitOuterEvent(K.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e,t=this;this._probing!==!0&&(this._probing=!0,e=this.get(20).getProtocolData({proto:h.PING}),this.send(e).then(function(){t._probing=!1}).catch(function(n){if(u.w("".concat(t._n,"._ping failed. error:"),n),t._probing=!1,n&&n.code===60002)return new R("error").setMessage("code:".concat(n.code," message:").concat(n.message)).end(),t._fatalErrorFlag=!0,void t._emitNetStateChangeEvent(g.NET_STATE_DISCONNECTED);t.get(15).isOnline()?t.reConnect():t._emitNetStateChangeEvent(g.NET_STATE_DISCONNECTED)}))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._disconnectedTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var e=this,t=this._socketHandler.getURL(),n=t.split("/")[2];n.startsWith("ws")&&(t=t.slice(t.indexOf("info?")+5),n="https://".concat(n,"/v3/netcheck/getconninfo?").concat(t,"&reqtime=").concat(Date.now()),ds("GET",n).catch(function(o){u.w("".concat(e._n,"._diagnoseBySSO failed. error:"),o)}))}},{key:"_diagnoseByCDN",value:function(){var e=this,t=this._socketHandler.getURL(),t=t.slice(t.indexOf("info?")+5),t="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(t,"&reqtime=").concat(Date.now());ds("GET",t).catch(function(n){u.w("".concat(e._n,"._diagnoseByCDN failed. error:"),n)})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._previousState=g.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0}}]),Fo),qu=["a2","tinyid"],Vu=["a2","tinyid"],Bu=(E(hs,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionM.genCommonHead(),t=this._sessionM.genCosSpecifiedHead(),n=this._sessionM.genSSOReportHead();this._configMap.set(h.LOGIN,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}),this._configMap.set(h.LOGOUT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}),this._configMap.set(h.HELLO,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}),this._configMap.set(h.KICK_OTHER,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.STAT_SERVICE,".").concat(h.KICK_OTHER)}),body:{}}),this._configMap.set(h.COS_SIGN,{head:l(l({},t),{},{servcmd:"".concat(O.NAME.IM_COS_SIGN,".").concat(h.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._configMap.set(h.COS_PRE_SIG,{head:l(l({},t),{},{servcmd:"".concat(O.NAME.CUSTOM_UPLOAD,".").concat(h.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._configMap.set(h.SIMPLE_COS_PRE_SIG,{head:l(l({},t),{},{servcmd:"".concat(O.NAME.CUSTOM_UPLOAD,".").concat(h.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{request:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},response:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._configMap.set(h.GET_IMAGE_INFO,{head:l(l({},t),{},{servcmd:"".concat(O.NAME.CUSTOM_UPLOAD,".").concat(h.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{request:{imageUrl:"str_image_url"},response:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._configMap.set(h.GET_IP,{head:l(l({},t),{},{servcmd:"".concat(O.NAME.CUSTOM_UPLOAD,".").concat(h.GET_IP)}),body:{domainName:""},keyMap:{request:{domainName:"str_domain"},response:{str_final_ip:"ip"}}}),this._configMap.set(h.VIDEO_COVER,{head:l(l({},t),{},{servcmd:"".concat(O.NAME.CUSTOM_UPLOAD,".").concat(h.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._configMap.set(h.FETCH_COMMERCIAL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_CONFIG_MANAGER,".").concat(h.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._configMap.set(h.PUSHED_COMMERCIAL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_CONFIG_MANAGER,".").concat(h.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._configMap.set(h.FETCH_CLOUD_CTRL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_CONFIG_MANAGER,".").concat(h.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._configMap.set(h.PUSHED_CLOUD_CTRL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_CONFIG_MANAGER,".").concat(h.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._configMap.set(h.OVERLOAD_NOTIFY,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OVERLOAD_PUSH,".").concat(h.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._configMap.set(h.SYNC_UNREAD_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._configMap.set(h.GET_PROFANITY_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_MSG_AUDIT_MGR,".").concat(h.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._configMap.set(h.SEND_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt"}}}),this._configMap.set(h.SEND_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{badgeMode:0,isVoipPush:void 0},androidInfo:{OPPOChannelID:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account"},response:{MsgTime:"time",MsgSeq:"sequence"}}}),this._configMap.set(h.REVOKE_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._configMap.set(h.REVOKE_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._configMap.set(h.GET_C2C_ROAMING_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._configMap.set(h.MODIFY_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._configMap.set(h.GET_GRP_ROAMING_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._configMap.set(h.SET_C2C_MSG_READ,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}),this._configMap.set(h.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._configMap.set(h.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Peer_Account"},response:{MuteNotificationsList:"muteFlagList"}}}),this._configMap.set(h.SET_GRP_MSG_READ,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}),this._configMap.set(h.SET_ALL_MSG_READ,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._configMap.set(h.DEL_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}),this._configMap.set(h.DEL_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._configMap.set(h.TRANSLATE_TEXT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_TRANSLATE,".").concat(h.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._configMap.set(h.VOICE_TO_TEXT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_SPEECH,".").concat(h.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{request:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},response:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._configMap.set(h.MODIFY_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._configMap.set(h.GET_READ_RECEIPT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}),this._configMap.set(h.SEND_C2C_READ_RECEIPT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._configMap.set(h.SEND_READ_RECEIPT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._configMap.set(h.GET_READ_RECEIPT_DETAIL,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._configMap.set(h.MODIFY_C2C_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._configMap.set(h.GET_C2C_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._configMap.set(h.MODIFY_GRP_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._configMap.set(h.GET_GRP_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._configMap.set(h.MSG_CLOUD_SEARCH,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.MSG_SEARCH,".").concat(h.MSG_CLOUD_SEARCH)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{request:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList"},response:{GroupID:"groupID",UserID:"userID",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",ErrorCode:"code",ErrorInfo:"message"}}}),this._configMap.set(h.ADD_C2C_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Add_Account"}}}),this._configMap.set(h.RM_C2C_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Del_Account"}}}),this._configMap.set(h.GET_C2C_MSG_REACTIONS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._configMap.set(h.GET_C2C_MSG_REACTION_USER_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._configMap.set(h.ADD_GRP_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Add_Account"}}}),this._configMap.set(h.RM_GRP_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Del_Account"}}}),this._configMap.set(h.GET_GRP_MSG_REACTIONS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{response:{MsgSeq:"messageSequence"}}}),this._configMap.set(h.GET_GRP_MSG_REACTION_USER_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM_MSG_EXT,".").concat(h.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._configMap.set(h.GET_C2C_PEER_READ_TIME,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}),this._configMap.set(h.PAGING_GET_CONV_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._configMap.set(h.DEL_CONV,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._configMap.set(h.CLEAR_HISTORY_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}),this._configMap.set(h.PIN_CONV,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}),this._configMap.set(h.DEL_GROUP_AT_TIPS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._configMap.set(h.SET_CONV_CUSTOM_DATA,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}),this._configMap.set(h.MARK_CONV,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}),this._configMap.set(h.CREATE_CONV_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._configMap.set(h.DEL_CONV_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}),this._configMap.set(h.RENAME_CONV_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._configMap.set(h.ADD_CONV_TO_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}),this._configMap.set(h.DEL_CONV_FROM_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}),this._configMap.set(h.GET_CONV_GRP_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.RECENT_CONTACT,".").concat(h.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startTime:void 0,startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._configMap.set(h.GET_USER_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.PROFILE,".").concat(h.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._configMap.set(h.UPDATE_MY_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.PROFILE,".").concat(h.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:k.NICK,value:""},{tag:k.GENDER,value:""},{tag:k.ALLOWTYPE,value:""},{tag:k.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._configMap.set(h.GET_BL,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}),this._configMap.set(h.ADD_TO_BL,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._configMap.set(h.RM_FROM_BL,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._configMap.set(h.SET_SELF_STATUS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}),this._configMap.set(h.GET_USER_STATUS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._configMap.set(h.SUB_USER_STATUS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._configMap.set(h.UNSUB_USER_STATUS,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._configMap.set(h.GET_FD_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{response:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._configMap.set(h.ADD_FD,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{request:{source:"AddSource",wording:"AddWording",type:"AddType"},response:{ResultItem:"resultList"}}}),this._configMap.set(h.UPDATE_FD,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{request:{snsItem:"SnsItem"},response:{ResultItem:"resultList"}}}),this._configMap.set(h.DEL_FD,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{request:{type:"DeleteType"},response:{ResultItem:"resultList"}}}),this._configMap.set(h.GET_FD_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{response:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._configMap.set(h.CHECK_FD,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{request:{type:"CheckType"},response:{InfoItem:"resultList"}}}),this._configMap.set(h.GET_FD_APPLICATION_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{response:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._configMap.set(h.RESPOND_FD_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{request:{tag:"TagName",action:"ResponseAction"},response:{ResultItem:"resultList"}}}),this._configMap.set(h.DEL_FD_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{request:{type:"PendencyType",userIDList:"To_Account"},response:{ResultItem:"resultList"}}}),this._configMap.set(h.REPORT_FD_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{request:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._configMap.set(h.CREATE_FD_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{request:{groupName:"GroupName",userIDList:"To_Account"},response:{ResultItem:"resultList"}}}),this._configMap.set(h.DEL_FD_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{request:{nameList:"GroupName"}}}),this._configMap.set(h.GET_FD_GRP_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{response:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._configMap.set(h.UPDATE_FD_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FD,".").concat(h.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{request:{oldName:"GroupOldName",newName:"GroupNewName"},response:{UpdateType:"type",ResultItem:"resultList"}}}),this._configMap.set(h.GET_GRP_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}),this._configMap.set(h.GET_GRP_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._configMap.set(h.CREATE_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._configMap.set(h.DISMISS_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.DISMISS_GRP)}),body:{groupID:void 0}}),this._configMap.set(h.UPDATE_GRP_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._configMap.set(h.APPLY_JOIN_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._configMap.set(h.APPLY_JOIN_GRP_NOAUTH,(e.a2,e.tinyid,{head:l(l({},ae(e,qu)),{},{servcmd:"".concat(O.NAME.BIG_GRP_NO_AUTH,".").concat(h.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}})),this._configMap.set(h.QUIT_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.QUIT_GRP)}),body:{groupID:void 0}}),this._configMap.set(h.SEARCH_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}),this._configMap.set(h.CHANGE_GRP_OWNER,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}),this._configMap.set(h.HANDLE_GRP_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._configMap.set(h.HANDLE_INVITE_JOIN_GRP,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._configMap.set(h.HANDLE_GRP_INVITATION,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._configMap.set(h.GET_GRP_PENDENCY,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._configMap.set(h.DEL_GRP_SYSTEM_NOTICE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._configMap.set(h.AV_POLLING,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.BIG_GRP_POLLING,".").concat(h.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._configMap.set(h.AV_NOAUTH_POLLING,(e.a2,e.tinyid,{head:l(l({},ae(e,Vu)),{},{servcmd:"".concat(O.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(h.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._configMap.set(h.GET_ONLINE_MBR_NUM,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{response:{OnlineMemberNum:"memberCount"}}}),this._configMap.set(h.SET_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}),this._configMap.set(h.MODIFY_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}),this._configMap.set(h.DEL_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}),this._configMap.set(h.CLEAR_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._configMap.set(h.GET_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_ATTR,".").concat(h.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._configMap.set(h.GET_GRP_NOTIFY,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{request:{notifyReqList:"NotifyReqList"},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._configMap.set(h.UPDATE_GRP_COUNTER,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}),this._configMap.set(h.GET_GRP_COUNTER,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}),this._configMap.set(h.CREATE_TOPIC,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_COMMUNITY,".").concat(h.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}),this._configMap.set(h.DEL_TOPIC,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_COMMUNITY,".").concat(h.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}),this._configMap.set(h.UPDATE_TOPIC_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_COMMUNITY,".").concat(h.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._configMap.set(h.GET_TOPIC_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_COMMUNITY,".").concat(h.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}),this._configMap.set(h.GET_GRP_MBR_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._configMap.set(h.GET_AV_MBR_LIST,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_AV,".").concat(h.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}),this._configMap.set(h.GET_GRP_MBR_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._configMap.set(h.ADD_GRP_MBR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}),this._configMap.set(h.DEL_GRP_MBR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}),this._configMap.set(h.BAN_AV_MBR,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._configMap.set(h.MODIFY_GRP_MBR_INFO,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP,".").concat(h.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._configMap.set(h.MARK_AV_MBR_INFO,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.GRP_AV,".").concat(h.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._configMap.set(h.SSO_STAT,{head:l(l({},n),{},{servcmd:"".concat(O.NAME.IM_OPEN_STAT,".").concat(h.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._configMap.set(h.PING,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.HEARTBEAT,".").concat(h.PING)}),body:{}}),this._configMap.set(h.MSG_PUSH,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_PUSH,".").concat(h.MSG_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType",CurrFollowType:"followType",Follow_Account:"userID"}}}),this._configMap.set(h.MULTI_MSG_PUSH,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_PUSH,".").concat(h.MULTI_MSG_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._configMap.set(h.MSG_PUSH_ACK,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OPEN_IM,".").concat(h.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}),this._configMap.set(h.STATUS_FORCE_OFFLINE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._configMap.set(h.DOWNLOAD_MERGER_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_LONG_MSG,".").concat(h.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._configMap.set(h.UPLOAD_MERGER_MSG,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_LONG_MSG,".").concat(h.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._configMap.set(h.FOLLOW,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FOLLOW,".").concat(h.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"FollowItem"},response:{ResultItem:"resultList",To_Account:"userID"}}}),this._configMap.set(h.UNFOLLOW,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FOLLOW,".").concat(h.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"To_Account"},response:{ResultItem:"resultList",To_Account:"userID"}}}),this._configMap.set(h.GET_FOLLOW_INFO,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FOLLOW,".").concat(h.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"To_Account"},response:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._configMap.set(h.GET_FOLLOW,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FOLLOW,".").concat(h.GET_FOLLOW)}),body:{fromAccount:"",type:1,startCursor:"",count:100},keyMap:{request:{type:"FollowType",count:"WantNum"},response:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._configMap.set(h.CHECK_FOLLOW_TYPE,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.FOLLOW,".").concat(h.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"To_Account"},response:{ResultItem:"resultList",To_Account:"userID"}}}),this._configMap.set(h.SET_TOKEN,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._configMap.set(h.STAT_FOREGROUND,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._configMap.set(h.STAT_BACKGROUND,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.IM_OPEN_STATUS,".").concat(h.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._configMap.set(h.PUSH_REPORT,{head:l(l({},e),{},{servcmd:"".concat(O.NAME.OFFLINE_PUSH_REPORT,".").concat(h.PUSH_REPORT)}),body:{eventList:[]},keyMap:{request:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}})}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(u.w("".concat(this._n,".getKeyMap unknown proto:").concat(e)),{})}},{key:"getProtocolData",value:function(n){var o=n.proto,t=n.data,n=this.get(o),o=null;if(t){var i,a=this._simpleDeepCopy(n),a=this._updateService(t,a),s=a.body,r=Object.create(null);for(i in s)if(Object.prototype.hasOwnProperty.call(s,i)){if(r[i]=s[i],t[i]===void 0)continue;r[i]=t[i]}a.body=r,o=this._getUplinkData(a)}else o=this._getUplinkData(n);return o}},{key:"_getUplinkData",value:function(t){var t=this._dataCleaner(t),n=go(t.head),n=Gu(t.body,this._getRequestKeyMap(n));return t.body=n,t}},{key:"_updateService",value:function(e,t){var n,o,i=go(t.head);return this._isFromGroupRequest(t)&&(n=e.type,o=e.groupID,e=(e=e.groupIDList)===void 0?[]:e,D(o=o===void 0?void 0:o)&&(o=e[0]||""),rt({type:n,groupID:o})&&(t.head.servcmd="".concat(O.NAME.GRP_COMMUNITY,".").concat(i))),t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(O.NAME.GRP)||e.head.servcmd.includes(O.NAME.GRP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){return e=this.getKeyMap(e),l(l({},Li.request),e.request)}},{key:"_dataCleaner",value:function(e){var t,n=Array.isArray(e)?[]:Object.create(null);for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&ri(t)&&e[t]!==null&&e[t]!==void 0&&(G(e[t])!=="object"?n[t]=e[t]:n[t]=this._dataCleaner.bind(this)(e[t]));return n}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),o={},i=0,a=n.length;i<a;i++)t=n[i],q(e[t])?o[t]=Array.from(e[t]):dt(e[t])?o[t]=this._simpleDeepCopy(e[t]):o[t]=e[t];return o}}]),hs),Hu=[h.MSG_PUSH_ACK],Ku=(E(gs,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionM.get(6);t&&(e.dataList.forEach(function(n){var o;n.isSyncMessage===1&&(o=n.from,n.from=n.to,n.to=o)}),e.needSync===1&&this._sessionM.get(19).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionM.get(6);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionM.get(7);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionM.get(7);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionM.get(7);if(t){var n=e.event,o=e.dataList,i=e.isInstantMessage,a=i===void 0||i,s=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:o});break;case 5:for(var r=0;r<o.length;r++)if(q(o[r].elements.revokedInfos))t.onGroupMessageRevoked({dataList:o});else if(q(o[r].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:o});else{if(!q(o[r].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:o,isInstantMessage:a,isSyncingEnded:s});break}t.onReadReceiptList({dataList:o})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:o});break;default:u.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),o)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t,n=this,o=e.dataList;q(o)&&(t=this._sessionM.get(6),o.forEach(function(i){var a,s;Ie(i)&&(i.hasOwnProperty("kickoutMsgNotify")?(a=(s=i.kickoutMsgNotify).kickType,s=(s=s.newInstanceInfo)===void 0?{}:s,a===1?n._sessionM.onMultipleAccountKickedOut(s):a===2?n._sessionM.onMultipleDeviceKickedOut(s):a===3&&n._sessionM.onRestApiKickedOut(s)):i.hasOwnProperty("c2cMessageRevokedNotify")?t&&t.onC2CMessageRevoked({dataList:o}):i.hasOwnProperty("c2cMessageReadReceipt")?t&&t.onC2CMessageReadReceipt({dataList:o}):i.hasOwnProperty("c2cMessageReadNotice")?t&&t.onC2CMessageReadNotice({dataList:o}):i.hasOwnProperty("muteNotificationsSync")&&n._sessionM.get(11).onC2CMessageRemindTypeSynced({dataList:o}))}))}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionM.get(6).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionM.get(4).onProfileModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionM.get(4).onRelationChainModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(n){var t,n=n.dataList;!q(n)||(t=this._sessionM.get(11))&&n.forEach(function(o){var i,a,s=o.pushType;s===1?(i=o.recentContactDeleteItem,t.onConversationDeleted(i.recentContactList)):s===2?(i=o.recentContactTopItem,t.onConversationPinned(i.recentContactList)):s===3?(i=o.recentContactTopItem,t.onConversationUnpinned(i.recentContactList)):s===4?(i=o.recentContactMarkContact,t.onConversationMarkUpdated(i.recentContactMarkContactItem)):s===5?(i=o.recentContactCreateContactGroup,t.onConversationGroupCreated(i.msgContactGroupContactItem)):s===6?(i=o.recentContactDelContactGroup,t.onConversationGroupDeleted(i.msgGroupItem)):s===7&&(s=(i=o.recentContactUpdateContactGroup).updateType,o=i.msgUpdateGroup,i=i.msgUpdateContact,s===1?(a=o.updateGroupType)===1?t.onConversationGroupNameUpdated(o):a===2&&t.onConversationInGroupUpdated(o):s===2&&t.onConversationAddedToOrDeletedFromGroup(i))})}},{key:"_allMessageReadHandler",value:function(t){var t=t.dataList,n=this._sessionM.get(11);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionM.get(4).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionM.get(3).onMessageExtensionNotify(e)}},{key:"_messageReactionNotifyListHandler",value:function(e){this._sessionM.get(34).onMessageReactionNotifyList(e)}},{key:"_messageReactionNotifyHandler",value:function(e){this._sessionM.get(34).onMessageReactionNotify(e)}},{key:"_followInfoHandler",value:function(e){this._sessionM.get(35).onFollowInfoNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var o,i=n.eventArray,a=n.isInstantMessage,s=n.isSyncingEnded,r=n.needSync;if(q(i))for(var c,d,p,_=0,m=i.length;_<m;_++)(p=(c=i[_]).event)!==100?(o=Object.keys(c).find(function(f){return t._keys.indexOf(f)!==-1}))?(d=p===14?{readAllC2CMessage:c[o],groupMessageReadInfoList:c.groupMessageReadNotice||[]}:p===16?{userID:c.userID,readReceiptList:c[o]}:c[o],this._eventHandlerMap.get(o)({event:p,dataList:d,isInstantMessage:a,isSyncingEnded:s,needSync:r})):u.l("".concat(this._n,".onMessage unknown eventItem:").concat(c)):this._onRoomCustomData(c.content)}}},{key:"_onRoomCustomData",value:function(e){this._sessionM.get(30).onRoomCustomDataReceived(e),u.l("".concat(this._n,"._onRoomCustomData data:").concat(JSON.stringify(e)))}},{key:"_filterMessageFromIMOpenPush",value:function(t){var n=t.head,t=t.body,n=n.servcmd,o=!1;return!(o=D(n)?o:n.includes(O.NAME.IM_CONFIG_MANAGER)||n.includes(O.NAME.OVERLOAD_PUSH)||n.includes(O.NAME.STAT_SERVICE))||(n.includes(h.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedCloudControlConfig(t):n.includes(h.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(t):n.includes(h.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(t):n.includes(h.KICK_OTHER)&&(o=Date.now(),this._sessionM.reLoginOnKickOther(),t=new R("kickOther"),o=o-(n=this._sessionM.get(1).getLastWsHelloTs()),t.setMessage("last wshello time:".concat(n," diff:").concat(o,"ms")).end()),!1)}}]),gs),Hr=[{cmd:h.GET_GRP_PROFILE,interval:1,count:8},{cmd:h.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:h.GET_AVCHATROOM_MBR_LIST,interval:3,count:1},{cmd:h.GET_GRP_PENDENCY,interval:1,count:15},{cmd:h.GET_TOPIC_LIST,interval:1,count:10},{cmd:h.SET_GRP_ATTR,interval:5,count:10},{cmd:h.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:h.DEL_GRP_ATTR,interval:5,count:10},{cmd:h.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:h.GET_GRP_ATTR,interval:5,count:20},{cmd:h.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:h.GET_GRP_COUNTER,interval:5,count:20},{cmd:h.SET_ALL_MSG_READ,interval:1,count:1},{cmd:h.GET_USER_STATUS,interval:5,count:20},{cmd:h.SUB_USER_STATUS,interval:5,count:20},{cmd:h.UNSUB_USER_STATUS,interval:5,count:20},{cmd:h.MSG_CLOUD_SEARCH,interval:1,count:2},{cmd:h.CHECK_FOLLOW_TYPE,interval:5,count:20}],ps=new Map,Kr=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Ri=0,Wu=Kr.length;Ri<Wu;Ri++)ps.set(Ri,Kr[Ri]);function gs(e){S(this,gs),this._sessionM=e,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._messageReactionNotifyListHandler.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._messageReactionNotifyHandler.bind(this)),this._eventHandlerMap.set("follow",this._followInfoHandler.bind(this)),this._keys=b(this._eventHandlerMap.keys())}function hs(e){S(this,hs),this._n="ProtocolHandler",this._sessionM=e,this._configMap=new Map,this._fillConfigMap()}function Fo(e){var t,n;return S(this,Fo),(e=Vr.call(this,e))._n="ChannelModule",e._socketHandler=new Fu(X(e)),e._probing=!1,e._isAppShowing=!0,e._previousState=g.NET_STATE_CONNECTED,me&&typeof fe.onAppShow=="function"&&typeof fe.onAppHide=="function"&&(t=e._onAppHide.bind(X(e)),n=e._onAppShow.bind(X(e)),typeof fe.offAppHide=="function"&&fe.offAppHide(t),typeof fe.offAppShow=="function"&&fe.offAppShow(n),fe.onAppHide(t),fe.onAppShow(n)),e._timerForNotLoggedIn=-1,e._timerForNotLoggedIn=setInterval(e.onCheckTimer.bind(X(e)),1e3),e._fatalErrorFlag=!1,e._disconnectedTS=0,e}function _s(e){S(this,_s),this._chM=e,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=ki,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=Mt(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=un,this._setWebsocketHost(),this._initConnection()}function fs(e){S(this,fs);var t,n,o=(this._handler=e).getURL();this._socket=null,this._workerSocket=null,this._id=Mt(),this._handler.getIsWorkerEnabled()?(t=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen" });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(t),(n=this)._workerSocket.onmessage=function(i){var s=i.data,a=s.callback,s=s.e;a==="onOpen"?n._onOpen():a==="onClose"?n._onClose(s):a==="onError"?n._onError(s):a==="onMessage"&&n._onMessage(i.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:o})):me?lt?(fe.connectSocket({url:o,header:{"content-type":"application/json"}}),fe.onSocketClose(this._onClose.bind(this)),fe.onSocketOpen(this._onOpen.bind(this)),fe.onSocketMessage(this._onMessage.bind(this)),fe.onSocketError(this._onError.bind(this))):(this._socket=fe.connectSocket({url:o,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):Ke&&(this._socket=new WebSocket(o),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=e.canIUseBinaryFrame()}function ms(e){for(var t,n,o=e,i="",a=0,s=(o=e.length%8!=0?"0".repeat(8-e.length%8)+e:o).length;a<s;a+=8)t=parseInt(o.slice(a,a+4),2),n=parseInt(o.slice(a+4,a+8),2),i+=ps.get(t)+ps.get(n);return i}function Yu(e){if(e<0||53<e)return NaN;var t=0|1073741824*Math.random();return 30<e?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e}function zu(e,t){for(var n=e.toString(16),o=t-n.length,i="0";0<o;o>>>=1,i+=i)1&o&&(n=i+n);return n}F(Jo,xe),tc=te(Jo),E(Jo,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(Hr)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");D(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach(function(n){t._commandFrequencyLimitMap.set(n.cmd,{interval:n.interval,count:n.count})})}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"req",value:function(o){u.d("".concat(this._n,".req options:"),o);var t=o.proto,n=o.tjgID;if(!this._protocolHandler.has(t))return u.w("".concat(this._n,".req unknown proto:").concat(t)),v({code:M.CANNOT_FIND_PROTOCOL});var o=this.getProtocolData(o),i=o.head.servcmd;if(this._isFrequencyOverLimit(i))return v({code:a=M.OVER_FREQUENCY_LIMIT,message:this.getErrorMessage(a,this._getCmd(i))});if(this._isServerOverload(i))return v({code:a=M.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrorMessage(a,this._getCmd(i))});L(n)||(o.head.tjgID=n);var a=this.get(21);return Hu.includes(t)?a.simplySend(o):a.send(o)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:qt,websdkversion:Xt,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,sdkability_ext:ms(""),cappid:e.getApplicationID(),tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:qt,websdkversion:Xt,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371,sdkability_ext:ms(""),cappid:e.getApplicationID()}}},{key:"genSSOReportHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:qt,websdkversion:Xt,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371,sdkability_ext:ms(""),cappid:e.getApplicationID()}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(t){var n=t.servcmd,t=t.data,n={head:l(l({},this.genCommonHead()),{},{servcmd:n}),body:t};return this.get(21).send(n)}},{key:"sendComboMessage",value:function(t){var n=t.servcmd,t=t.data,n={head:l(l({},this.genCommonHead()),{},{servcmd:n}),body:t};return this.get(21).send(n)}},{key:"onErrorCodeNotZero",value:function(e){var t,n=e.errorCode;n===M.HELLO_ANSWER_KICKED_OUT&&(t=e.kickType,e=(e=e.newInstanceInfo)===void 0?{}:e,t===1?this.onMultipleAccountKickedOut(e):t===2?this.onMultipleDeviceKickedOut(e):t===3&&this.onRestApiKickedOut(e)),n!==M.MSG_A2KEY_EXPIRED&&n!==M.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(e){var n=e.body,t=n.needAck,n=n.sessionData;(t===void 0?0:t)===1&&this._sendACK(n),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(e){this._incrementalPullContactFlag=e<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){u.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){u.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e,t,n=this,o="".concat(this._n,"._reLogin");this.isLoggedIn()&&(e=0,(t=this.get(1).getPushModule())&&(e=t.getUniAppPlatform()),this.req({proto:h.LOGIN,data:{isWebUniapp:e}}).then(function(i){i=i.data.instanceID,n.get(12).setStatusInstanceID(i),u.l("".concat(o," ok. instanceID:").concat(i)),n.get(21).diagnose(),n.get(11).syncConversationList(n._incrementalPullContactFlag).then(function(){u.l("".concat(o,", sync conversation list ok.")),n.get(25).start()}),i=n.get(7),i&&i.updateLocalMainSequenceOnReconnected(),i=n.get(10),i.resetGetTopicTime(),i.getTopicListOnReconnected(),i=n.get(35),i&&i.clearCacheOnReconnected()}))}},{key:"onMultipleAccountKickedOut",value:function(e){this.get(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.get(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.get(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.req({proto:h.MSG_PUSH_ACK,data:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){if(e=e.split(".")[1],!this._commandFrequencyLimitMap.has(e))return!1;if(!this._commandRequestInfoMap.has(e))return this._commandRequestInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(e),t=n.count,n=n.interval,i=this._commandRequestInfoMap.get(e),o=i.startTime,i=i.requestCount;return Date.now()-o>1e3*n?(this._commandRequestInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1):(this._commandRequestInfoMap.set(e,{startTime:o,requestCount:i+=1}),t<i)}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var n=this._serverOverloadInfoMap.get(e),t=n.overloadTime,n=n.waitingTime;return Date.now()-t<=1e3*n||(this._serverOverloadInfoMap.delete(e),!1)}},{key:"_getCmd",value:function(e){var t="";if(!e.includes("."))return t;var n,o=e.split(".")[1];for(n in h)if(h[n]===o){t=n;break}return t}},{key:"onPushedServerOverload",value:function(n){var t=n.overloadCommand,n=n.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),u.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s cmd:").concat(this._getCmd(t)))}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(Hr),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var Wr,Yr,zr,jr,Jr,Xr,Zr,Qr,$r,ec,tc,ju=Jo,Ju=(F(jo,xe),ec=te(jo),E(jo,[{key:"getCloudConfig",value:function(e){return D(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"getServerConfig",value:function(e){var t={code:0,data:""};return!D(e)&&this._cloudConfig.has(e)&&(t.data=this._cloudConfig.get(e)),Promise.resolve(t)}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e,t=this,n=this._canFetchConfig();u.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(n)),n&&(e=new R("fetchCloudControlConfig"),n=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({proto:h.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:n,version:this._version}}).then(function(o){t._isFetching=!1,e.setMessage("version:".concat(t._version," newVersion:").concat(o.data.version," config:").concat(o.data.cloudControlConfig)).end(),u.l("".concat(t._n,".fetchConfig ok")),t._parseCloudControlConfig(o.data)}).catch(function(o){t._isFetching=!1,e.setError(o).end(),u.l("".concat(t._n,".fetchConfig failed. error:"),o),t._setExpiredTimeOnResponseError(12e4)}))}},{key:"onPushedCloudControlConfig",value:function(e){u.l("".concat(this._n,".onPushedCloudControlConfig")),new R("pushedCloudControlConfig").setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),o=e.errorCode,i=e.errorMessage,a=e.cloudControlConfig,s=e.version,r=e.expiredTime;if(o===0){if(this._version!==s){var c=null;try{c=JSON.parse(a)}catch{this.isPrivateNetWork()||u.e("".concat(n," JSON parse error. cloudControlConfig:"),a)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach(function(d){t._cloudConfig.set(d,c[d])}),this._version=s,this.emitInnerEvent(we.CLOUD_CONFIG_UPDATED))}this._expiredTime=Date.now()+1e3*r}else D(o)?(u.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(u.e("".concat(n," errorCode:").concat(o," errorMessage:").concat(i)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),jo),Xu=(F(zo,xe),$r=te(zo),E(zo,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n,o,i=this,a=this._getLocalConversationList().filter(function(c){return c.type===g.CONV_GROUP&&c.groupProfile.type!==g.GRP_AVCHATROOM}),s=this.get(11),r=[];a.forEach(function(p){var d=p.conversationID,p=p.lastMessage;e=d.replace(g.CONV_GROUP,""),t=s.getLocalLastMessage(d),p&&p.lastSequence!==0&&t?(n=p.lastSequence,t=t.sequence,o=n-t,0<t&&1<=o&&o<300?i._recoverGroupMessage({groupID:e,localLastMessageSequence:t,remoteLastMessageSequence:n}):r.push(e)):r.push(e)}),this._getGroupNotify(r)}},{key:"_recoverC2CChat",value:function(){var e,t,n,o=this,i=this._getLocalConversationList().filter(function(r){return r.type===g.CONV_C2C}),a=this.get(11),s=[Promise.resolve()];i.forEach(function(d){var c=d.conversationID,d=d.lastMessage;e=a.getLocalLastMessage(c),d&&d.lastTime!==0&&e&&(t=d.lastTime,e=e.time,n=t-e,0<e&&1<=n&&n<=600&&s.push(o._recoverC2CMessage({conversationID:c,localLastMessageTime:e,remoteLastMessageTime:t})))}),Promise.all(s).then(function(){u.l("".concat(o._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),o.get(19).startSyncOnReconnected()})}},{key:"_getLocalConversationList",value:function(){return this.get(11).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage"),o=(u.l("".concat(n," options:"),e),e.groupID),i=e.localLastMessageSequence,a=e.remoteLastMessageSequence;this._getGroupRoamingMessage({groupID:o,sequence:i}).then(function(r){var r=r.data,c=r.complete,d=r.messageList;if(!D(d)){var r=d[0].sequence,p="groupID:".concat(o," pkgLastSequence:").concat(r," remoteLastSequence:").concat(a," complete:").concat(c," count:").concat(d.length),_=(u.l("".concat(n," ").concat(p)),r<a&&c!==2&&t._recoverGroupMessage({groupID:o,localLastMessageSequence:r,remoteLastMessageSequence:a}),new R("recoverMessage").setMessage(p).end(),t.get(7));1<d.length&&d.sort(function(N,P){return N.sequence-P.sequence});for(var m=0;m<d.length;m++){var f=d[m];f.from!==g.CONV_SYSTEM?_.onNewGroupMessage({dataList:[f],isInstantMessage:!1,updateUnreadCount:!1}):_.onNewGroupTips({event:f.event,dataList:[f]})}t._getGroupNotify([o])}})}},{key:"_genMultiGroupIDList",value:function(e,t){var n=t&&1<t?t:1,o=e.length,i=[];if(0<o)for(var a=0;a<o;a+=n)i.push(e.slice(a,a+n));return i}},{key:"_getGroupNotify",value:function(e){var t=this._genMultiGroupIDList(e,10);if(0<t.length)for(var n=this.get(7),o=0,i=t.length;o<i;o++)n.getGroupNotify(t[o])}},{key:"_getGroupRoamingMessage",value:function(n){var t=n.groupID,n=n.sequence;return this.req({proto:h.GET_GRP_ROAMING_MSG,data:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage"),o=(u.l("".concat(n," options:"),e),e.conversationID),i=e.localLastMessageTime,a=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:o,time:i}).then(function(c){var c=c.data,r=c.complete,c=c.messageList;if(!D(c)){var d=c.length,c=(t.get(6).onNewC2CMessage({dataList:c,isInstantMessage:!0}),c[d-1].time),p=o.replace(g.CONV_C2C,""),p="peerAccount:".concat(p," pkgLastTime:").concat(c," remoteLastTime:").concat(a," complete:").concat(r," count:").concat(d);if(u.l("".concat(n," ").concat(p)),new R("recoverMessage").setMessage(p).end(),c<a&&r!==1)return t._recoverC2CMessage({conversationID:o,localLastMessageTime:c,remoteLastMessageTime:a})}})}},{key:"_getC2CRoamingMessage",value:function(n){var t=n.conversationID,n=n.time;return this.req({proto:h.GET_C2C_ROAMING_MSG,data:{peerAccount:t.replace(g.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),zo),Zu=(E(ws,[{key:"addMessageDelay",value:function(e){e=tn()-e,0<=e&&this._e2eDelayArray.push(e)}},{key:"_calcAvg",value:function(e,t){if(t===0)return 0;var n=0;return e.forEach(function(o){n+=o}),Ut(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,o=e.max;return t.filter(function(i){return n<=i&&i<o}).length}},{key:"_calcPercent",value:function(e,t){return e=Ut(e/t*100,2),e=100<e?100:e}},{key:"_checkE2EDelayException",value:function(e,t){var n,o,i,a=e.filter(function(s){return t<s});0<a.length&&(n=a.length,o=Math.min.apply(Math,b(a)),i=Math.max.apply(Math,b(a)),a=this._calcAvg(a,n),50<(e=Ut(n/e.length*100,2))&&new R("messageE2EDelayException").setMessage("count:".concat(n," min:").concat(o," max:").concat(i," avg:").concat(a," percent:").concat(e)).setLevel("warning").end())}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(e===0)return null;var t=b(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),o=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),i=this._calcPercent(n,e),a=this._calcPercent(o,e),s=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:i,countLessThan3Second:o,percentOfCountLessThan3Second:a,avgDelay:s}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),ws),Qu=(E(Us,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){return t===0?0:(e=Ut(e/t*100,2),e=100<e?100:e)}},{key:"_calcAvg",value:function(e,t){if(t===0)return 0;var n=0;return e.forEach(function(o){n+=o}),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,b(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,b(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),o=b(this._rttArray);if(e===0)return null;var t=this._calcRTTCount(o),n=this._calcSuccessRateOfRequest(t,e),o=this._calcAvg(o,t);return u.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(o)),this.reset(),{totalCount:e,rttCount:t,successRateOfRequest:n,avgRTT:o}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),Us),$u=(E(bs,[{key:"initMap",value:function(e){var t=this;e.forEach(function(n){t._map.set(n,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})})}},{key:"addTotalCount",value:function(e){return!(D(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(D(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(D(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(D(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(D(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){return D(e)||!this._map.has(e)?-1:(e=this._map.get(e),e=Ut(e.successCount/e.totalCount*100,2),e=100<e?100:e)}},{key:"_calcSuccessRateOfPlatform",value:function(n){if(D(n)||!this._map.has(n))return-1;var t=this._map.get(n),n=this._calcSuccessCountOfPlatform(n)/t.totalCount*100;return n=100<(n=Ut(n,2))?100:n}},{key:"_calcTotalCount",value:function(e){return D(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return D(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){return D(e)||!this._map.has(e)?-1:(e=this._map.get(e),e.successCount+e.failedCountOfUserSide)}},{key:"_calcAvg",value:function(e){return D(e)||!this._map.has(e)?-1:e===Tt?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(t===0)return 0;var n=0;return this._map.get(e).costArray.forEach(function(o){n+=o}),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach(function(o){t+=o}),this._map.get(e).fileSizeArray.forEach(function(o){n+=o}),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(t===0)return null;var n=this._calcSuccessCountOfBusiness(e),o=this._calcSuccessRateOfBusiness(e),i=this._calcSuccessCountOfPlatform(e),a=this._calcSuccessRateOfPlatform(e),s=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:o,successCountOfPlatform:i,successRateOfPlatform:a,avgValue:s}}},{key:"reset",value:function(e){D(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),bs),el=(E(Ps,[{key:"initMap",value:function(e){var t=this;e.forEach(function(n){t._lastMap.set(n,new Map),t._currentMap.set(n,new Map)})}},{key:"addMessageSequence",value:function(e){var t=e.key,i=e.message;if(D(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var n,o,a=i.conversationID,i=i.sequence,a=a.replace(g.CONV_GROUP,"");return this._lastMap.get(t).size!==0&&this._lastMap.get(t).has(a)?(o=(n=this._lastMap.get(t).get(a)).length-1,i>n[0]&&i<n[o]?(n.push(i),n.sort(),this._lastMap.get(t).set(a,n)):this._addCurrentMap(e)):this._addCurrentMap(e),!0}},{key:"_addCurrentMap",value:function(n){var t=n.key,n=n.message,o=n.conversationID,n=n.sequence,o=o.replace(g.CONV_GROUP,"");this._currentMap.get(t).has(o)||this._currentMap.get(t).set(o,[]),this._currentMap.get(t).get(o).push(n)}},{key:"_copyData",value:function(e){if(!D(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),o=Re(this._currentMap.get(e));try{for(o.s();!(t=o.n()).done;){var i=z(t.value,2),a=i[0],s=i[1];n.set(a,s)}}catch(r){o.e(r)}finally{o.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(D(this._currentMap.get(e))||D(this._lastMap.get(e)))return null;if(this._lastMap.get(e).size===0)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach(function(r,a){var r=b(r.values()),s=r.length,r=r[s-1]-r[0]+1;t+=r,n+=s}),t===0)return null;var o=Ut(n/t*100,2);return 100<o&&(o=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:o}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),Ps),tl=(F(Yo,xe),Qr=te(Yo),E(Yo,[{key:"_onLoginSuccess",value:function(){var e=this,t=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),n=t.getItem(this.TAG,!1);!L(n)&&qe(n.forEach)&&(u.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach(function(o){e._statInfoArr.push(o)}),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");D(e)||(this.REPORT_INTERVAL=Number(e)),D(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map(function(o){return Number(o)})),D(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||u.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||u.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||u.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||u.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||u.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||u.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var t={},n=fr[this.get(15).getNetworkType()],n=(D(n)&&(n=8),{qualityType:Gc[e],timestamp:Et(),networkType:n,extension:""});switch(e){case sa:t=this._avgRTT.getStatResult();break;case ra:t=this._avgE2EDelay.getStatResult();break;case jn:case Jn:case Xn:case Rn:case Tt:t=this._rateMessageSent.getStatResult(e);break;case Zn:case vo:case Ao:t=this._rateMessageReceived.getStatResult(e)}return t===null?null:l(l({},n),t)}},{key:"_report",value:function(a){var t=this,n=[],o=null,a=(D(a)?this._qualityItems.forEach(function(s){(o=t._getQualityItem(s))!==null&&(o.reportIndex=t.reportIndex,o.wholePeriod=t.wholePeriod,n.push(o))}):(o=this._getQualityItem(a))!==null&&(o.reportIndex=this.reportIndex,o.wholePeriod=this.wholePeriod,n.push(o)),u.d("".concat(this._n,"._report"),n),0<this._statInfoArr.length&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]),this.get(12)),i=a.getSDKAppID(),a=a.getTinyID();0<(n=fi(this.REPORT_SDKAPPID_BLACKLIST,i)&&!mi(this.REPORT_TINYID_WHITELIST,a)?[]:n).length&&this._doReport(n)}},{key:"_doReport",value:function(e){var t=this,n={header:kr(this),quality:e};this.req({proto:h.SSO_STAT,data:l({},n)}).then(function(){t.reportIndex++,t.wholePeriod=!1}).catch(function(o){u.w("".concat(t._n,"._doReport failed. error:"),o),t._statInfoArr=t._statInfoArr.concat(e),t._flushAtOnce()})}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._statInfoArr,o="".concat(this._n,"._flushAtOnce");L(t)?(u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):(10<(n=n.concat(t)).length&&(n=n.slice(0,10)),u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),Yo),nc=E(function e(t){S(this,e),L(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.time=t.time||0,this.source=t.source||"",this.wording=t.wording||"",this.type=t.type||"")}),nl=(E(Gs,[{key:"getLocalFriendApplicationList",value:function(){return{friendApplicationList:b(this._friendApplicationMap.values()),unreadCount:this._unreadCount}}},{key:"_onFriendApplicationListUpdated",value:function(){this._snsM.emitOuterEvent(K.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:b(this._friendApplicationMap.values()),unreadCount:this._unreadCount})}},{key:"onFriendApplicationRead",value:function(){this._unreadCount=0,this._onFriendApplicationListUpdated()}},{key:"onFriendApplicationAdded",value:function(e,t){var n,o,i=this;L(e)||(n="",n=t===this._snsM.getMyUserID()?g.SNS_APPLICATION_SENT_BY_ME:g.SNS_APPLICATION_SENT_TO_ME,o=!1,e.forEach(function(a){var s="".concat(a.userID,"_").concat(n);n!==g.SNS_APPLICATION_SENT_TO_ME||i._friendApplicationMap.has(s)||(i._unreadCount+=1),i._friendApplicationMap.set(s,new nc(l(l({},a),{},{type:n}))),o=!0}),o&&this._onFriendApplicationListUpdated())}},{key:"onFriendApplicationDeleted",value:function(e){L(e)||(this._startTime=0,this._currentSequence=0,this.getFriendApplicationList())}},{key:"getFriendApplicationList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendApplicationList"),n=new R("getFriendApplicationList");return this._snsM.req({proto:h.GET_FD_APPLICATION_LIST,data:{applicationType:g.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSequence}}).then(function(r){var r=r.data,i=r.resultList,a=r.unreadCount,s=r.startTime,r=r.currentSequence,c=(e._startTime=s,e._currentSequence=r,e._unreadCount=a,q(i)?i.length:0),c="applicationCount:".concat(c," unreadCount:").concat(a," startTime:").concat(s," currentSequence:").concat(r);n.setMessage(c).end(),u.i("".concat(t," ok. ").concat(c)),e._friendApplicationMap.clear(),q(i)&&i.forEach(function(m){var p=m.userID,_=m.type,m=new nc(m);e._friendApplicationMap.set("".concat(p,"_").concat(_),m)}),e._onFriendApplicationListUpdated()}).catch(function(o){return n.setError(o).end(),u.w("".concat(t," failed. error:"),o),v(o)})}},{key:"deleteFriendApplication",value:function(e){var t="".concat(this._n,".").concat("deleteFriendApplication"),n=e.userID,o=e.type;if(o&&(o===g.SNS_APPLICATION_SENT_BY_ME||o===g.SNS_APPLICATION_SENT_TO_ME)||(o=g.SNS_APPLICATION_SENT_TO_ME),!this._friendApplicationMap.has("".concat(n,"_").concat(o)))return v({code:M.FRIEND_APPLICATION_NOT_EXIST});var i=new R("deleteFriendApplication");return i.setMessage("userID:".concat(n," type:").concat(o)),this._snsM.req({proto:h.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[n],type:o}}).then(function(s){var s=s.data.resultList,d=s[0],r=d.to,c=d.resultCode,d=d.resultInfo;return i.setMoreMessage("resultList:".concat(JSON.stringify(s))).end(),u.i("".concat(t," ok. userID:").concat(n," type:").concat(o)),c===0?V():v({userID:r,code:c,message:d})}).catch(function(a){return i.setError(a).end(),u.w("".concat(t," failed. error:"),a),v(a)})}},{key:"acceptFriendApplication",value:function(e){var t="".concat(this._n,".").concat("acceptFriendApplication"),n=e.userID,o=e.remark,i=e.tag,a=e.type,s=(a&&(a===g.SNS_APPLICATION_AGREE||a===g.SNS_APPLICATION_AGREE_AND_ADD)||(a=g.SNS_APPLICATION_AGREE_AND_ADD),new R("acceptFriendApplication"));return s.setMessage("userID:".concat(n," type:").concat(a)),this._snsM.req({proto:h.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,remark:o,tag:i,action:a}]}}).then(function(d){s.end();var d=d.data.resultList[0],c=d.resultCode,d=d.resultInfo;if(c!==0)return v({code:c,message:d});u.i("".concat(t," ok. userID:").concat(n," type:").concat(a))}).catch(function(r){return s.setError(r).end(),u.w("".concat(t," failed. error:"),r),v(r)})}},{key:"refuseFriendApplication",value:function(e){var t="".concat(this._n,".").concat("refuseFriendApplication"),n=e.userID,o=new R("refuseFriendApplication");return o.setMessage("userID:".concat(n)),this._snsM.req({proto:h.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,action:"Response_Action_Reject"}]}}).then(function(s){o.end();var s=s.data.resultList[0],a=s.resultCode,s=s.resultInfo;if(a!==0)return v({code:a,message:s});u.i("".concat(t," ok. userID:").concat(n))}).catch(function(i){return o.setError(i).end(),u.w("".concat(t," failed. error:"),i),v(i)})}},{key:"_onFriendApplicationProcessed",value:function(e){var t,n=this;e.length!==0&&(t=!1,e.forEach(function(o){o="".concat(o.to,"_").concat(g.SNS_APPLICATION_SENT_TO_ME),n._friendApplicationMap.has(o)&&(n._friendApplicationMap.delete(o),--n._unreadCount,t=!0)}),this._unreadCount<0&&(this._unreadCount=0),t&&this._onFriendApplicationListUpdated())}},{key:"setFriendApplicationRead",value:function(){var e=this,t="".concat(this._n,".").concat("setFriendApplicationRead"),n=new R("setFriendApplicationRead");return this._snsM.req({proto:h.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:Ut(Et()/1e3,0)}}).then(function(o){n.end(),u.i("".concat(t," ok")),e._unreadCount=0}).catch(function(o){return n.setError(o).end(),u.w("".concat(t," failed. error:"),o),v(o)})}},{key:"reset",value:function(){this._startIndex=0,this._maxLimited=100,this._currentSequence=0,this._unreadCount=0,this._friendApplicationMap.clear()}}]),Gs),vs=(E(Os,[{key:"validate",value:function(e){var t,n=!0,o="";if(L(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,a=null,s=0;s<i;s++){if(a=e.profileCustomField[s],!ne(a.key)||a.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ne(a.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if(t==="profileCustomField")continue;if(L(e[t])&&!ne(e[t])&&!ge(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":ne(e[t])||(n=!(o="nick must be a string")),500<Vn(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(Vn(e[t])," bytes"),n=!1);break;case"gender":_n(se,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":ge(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":ne(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":ne(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":_n(Se,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":ge(e.language)||(n=!(o="language must be a number"));break;case"avatar":ne(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":e.messageSettings!==0&&e.messageSettings!==1&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":_n(Te,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":ge(e.level)||(n=!(o="level must be a number"));break;case"role":ge(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}},{key:"update",value:function(e){var t,n="",o=[];this.friendCustomField.forEach(function(r){o.push(r.key)});for(var i=0,a=e.length;i<a;i++)if(n=e[i].tag,t=e[i].value,-1<n.indexOf("Tag_SNS_Custom"))-1<o.indexOf(n)?this.friendCustomField.forEach(function(r){r.key===n&&(r.value=t)}):this.friendCustomField.push({key:n,value:t});else if(-1<n.indexOf("Tag_Profile_Custom")){var s=!1;this.profile.profileCustomField.forEach(function(r){r.key===n&&(r.value=t,s=!0)}),s||this.profile.profileCustomField.push({key:n,value:t})}else switch(n){case k.NICK:this.profile.nick=t;break;case k.GENDER:this.profile.gender=t;break;case k.BIRTHDAY:this.profile.birthday=t;break;case k.LOCATION:this.profile.location=t;break;case k.SELFSIGNATURE:this.profile.selfSignature=t;break;case k.ALLOWTYPE:this.profile.allowType=t;break;case k.LANGUAGE:this.profile.language=t;break;case k.AVATAR:this.profile.avatar=t;break;case k.MESSAGESETTINGS:this.profile.messageSettings=t;break;case k.ADMINFORBIDTYPE:this.profile.adminForbidType=t;break;case k.LEVEL:this.profile.level=t;break;case k.ROLE:this.profile.role=t;break;case Y.REMARK:this.remark=t;break;case Y.ADDTIME:this.addTime=t;break;case Y.GROUP:this.groupList=JSON.parse(JSON.stringify(t));break;case Y.ADDSOURCE:this.source=t;break;case Y.ADDWORDING:break;default:u.d("snsProfileItem unkown tag->",e[i].tag)}this.timestamp=Date.now(),o.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){this.groupList.indexOf(e)===-1&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){e=this.groupList.indexOf(e),-1<e&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}]),Os),ol=(E(Ns,[{key:"getLocalFriendList",value:function(){return b(this._friendMap.values())}},{key:"getFriendRemark",value:function(e){return this._friendMap.has(e)?this._friendMap.get(e).remark:""}},{key:"onFriendProfileModified",value:function(o){var t,n=this,o=o.dataList;L(o)||(t=this._snsM.get(11),o.forEach(function(r){var a,s=r.userID,r=r.profileList;n.isMyFriend(s)&&(u.l("".concat(n._n,".onFriendProfileModified. friend account:").concat(s,", profileList:").concat(JSON.stringify(r))),(a=n._friendMap.get(s)).update(r),t.modifyMessageSentByPeer({conversationID:"".concat(g.CONV_C2C).concat(s),latestNick:a.profile.nick,latestAvatar:a.profile.avatar}))}),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(e){var t=this;e.length!==0&&(u.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach(function(n){t._friendMap.set(n,new vs(n))}),this.getFriendProfile({userIDList:e}).then(function(n){e.forEach(function(o){var i=t._friendMap.get(o);0<i.groupList.length&&t._snsM.updateWhenFriendAdded({nameList:i.groupList,userID:o})}),t._onFriendListUpdated()}))}},{key:"onFriendDeleted",value:function(e){var t=this;e.length!==0&&(u.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach(function(n){var o=t._friendMap.get(n);0<o.groupList.length&&t._snsM.updateWhenFriendDeleted({nameList:o.groupList,userID:n}),t._friendMap.delete(n)}),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOuterEvent(K.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(o){var t=this,n="".concat(this._n,".").concat("getFriendProfile"),o=o.userIDList,i=[],a=[],s=[];if(o.forEach(function(c){var d;t._friendMap.has(c)?(d=t._friendMap.get(c),Date.now()-d.timestamp<t._expirationTime?a.push(d):s.push(c)):i.push({userID:c,code:M.NOT_MY_FRIEND,message:t._snsM.getErrorMessage(M.NOT_MY_FRIEND)})}),s.length===0)return u.i("".concat(n," newUserIDList is empty")),$({friendList:a,failureUserIDList:i});var r=new R("getFriendProfile");return r.setMessage("userIDList:".concat(s)),u.i("".concat(n," userIDList:").concat(s)),this._snsM.req({proto:h.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:s}}).then(function(c){return r.end(),u.i("".concat(n," ok")),c.data.resultList.forEach(function(I){var p,_=I.to,m=I.resultCode,f=I.resultInfo,I=I.tagValueList;D(m)||m===0?(t._friendMap.has(_)?(p=t._friendMap.get(_)).update(I):(p=new vs(_,I),t._friendMap.set(_,p)),a.push(p)):i.push({userID:_,code:m,message:f})}),V({friendList:a,failureUserIDList:i})}).catch(function(c){return r.setError(c).end(),u.w("".concat(n," failed. error:"),c),v(c)})}},{key:"isMyFriend",value:function(e){return this._friendMap.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendList"),n=new R("getFriendList"),o=Date.now();this._snsM.req({proto:h.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIndex,standardSequence:this._standardSequence,customSequence:this._customSequence}}).then(function(d){var d=d.data,p=d.friendCount,a=d.resultList,s=d.nextStartIndex,r=d.standardSequence,c=d.customSequence,d=d.completeFlag,p=(e._startIndex=s,e._standardSequence=r,e._customSequence=c,"friendCount:".concat(p," nextStartIndex:").concat(s," standardSequence:").concat(r," ")+"customSequence:".concat(c," completeFlag:").concat(d," cost:").concat(Je(o)));n.setMessage(p).end(),u.i("".concat(t," ok."),p),L(a)||a.forEach(function(f){var m=f.to,f=f.tagValueList;e._friendMap.set(m,new vs(m,f))}),d===0?e.pagingGetFriendList():(e._snsM.emitOuterEvent(K.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())}).catch(function(i){return n.setError(i).end(),u.w("".concat(t," failed. error:"),i),v(i)})}},{key:"_pagingGetFriendProfile",value:function(){var e=this,t=b(this._friendMap.keys()),n=this._snsM.get(4),o=t.length,i=o<=100?1:Math.ceil(o/100);u.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(o," pageCount:").concat(i));for(var a=0;a<i;a++)n.getUserProfile({userIDList:t.slice(100*a,100*(a+1))}).then(function(s){s.data.forEach(function(r){var c=e._friendMap.get(r.userID);c&&c.updateProfile(r)}),e._onFriendListUpdated()})}},{key:"addFriend",value:function(c){var t=this,n="".concat(this._n,".").concat("addFriend");if(this._friendMap.has(c.to))return v({code:M.ALREADY_MY_FRIEND});if(c.wording&&this._snsM.filterProfanity("wording",c)===!1)return v({code:M.PROFANITY_FOUND});var o=c.to,i=c.source,a=c.type,s=c.wording,r=c.remark,c=c.groupName,d=a,p=(d&&(d===g.SNS_ADD_TYPE_SINGLE||d===g.SNS_ADD_TYPE_BOTH)||(d=g.SNS_ADD_TYPE_BOTH),new R("addFriend"));return p.setMessage("to:".concat(o," source:").concat(i," type:").concat(d)),this._snsM.req({proto:h.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:o,source:i,wording:s,remark:r,groupName:c}],type:d}}).then(function(I){var I=I.data.resultList,I=(p.setMoreMessage("resultList:".concat(JSON.stringify(I))).end(),I[0]),m=I.to,f=I.resultCode,I=I.resultInfo;return u.i("".concat(n," ok. to:").concat(m," type:").concat(d," code:").concat(f)),D(f)||f===0?V({userID:m,code:0}):f===30539?V({userID:m,code:f,message:t._snsM.getErrorMessage(f)}):v({userID:m,code:f,message:t._snsM.getErrorMessage(f)||I})}).catch(function(_){return p.setError(_).end(),u.w("".concat(n," failed. error:"),_),v(_)})}},{key:"deleteFriend",value:function(o){var t=this,n="".concat(this._n,".").concat("deleteFriend"),r=o.userIDList,o=o.type,i=(1e3<r.length&&(u.w("".concat(n," ").concat(En(1e3))),r.length=1e3),[]),a=[],s=[];if(r.forEach(function(d){t._friendMap.has(d)?s.push(d):i.push({userID:d,code:M.NOT_MY_FRIEND,message:t._snsM.getErrorMessage(M.NOT_MY_FRIEND)})}),s.length===0)return $({successUserIDList:a,failureUserIDList:i});var r=o,c=(r&&(r===g.SNS_DELETE_TYPE_SINGLE||r===g.SNS_DELETE_TYPE_BOTH)||(r=g.SNS_DELETE_TYPE_BOTH),new R("deleteFriend"));return c.setMessage("userIDList:".concat(s," type:").concat(r)),this._snsM.req({proto:h.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:s,type:r}}).then(function(d){return c.end(),u.i("".concat(n," ok")),d=d.data.resultList,L(d)||d.forEach(function(f){var _=f.to,m=f.resultCode,f=f.resultInfo;D(m)||m===0?a.push({userID:_}):i.push({userID:_,code:m,message:f})}),V({successUserIDList:a,failureUserIDList:i})}).catch(function(d){return c.setError(d).end(),u.w("".concat(n," error:"),d),v(d)})}},{key:"updateFriend",value:function(e){var t=this,n=e.userID,o=e.remark,i=e.friendCustomField;if(!this._friendMap.has(n))return v({code:M.NOT_MY_FRIEND});var a="".concat(this._n,".").concat("updateFriend"),s=new R("updateFriend"),r=(s.setMessage("userID:".concat(n," remark:").concat(o," friendCustomField:").concat(i)),[]);return D(o)||r.push({tag:Y.REMARK,value:o}),q(i)&&0<i.length&&i.forEach(function(c){r.push({tag:c.key,value:c.value})}),this._snsM.req({proto:h.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:n,snsItem:r}]}}).then(function(_){s.end(),u.i("".concat(a," ok"));var _=_.data.resultList[0],d=_.to,p=_.resultCode,_=_.resultInfo;return D(p)||p===0?((d=t._friendMap.get(d))&&(D(o)||(d.remark=o),q(i)&&0<i.length&&Dn(d.friendCustomField,i),t._onFriendListUpdated()),V(d)):v({code:p,message:_})}).catch(function(c){return s.setError(c).end(),u.w("".concat(a," failed. error:"),c),v(c)})}},{key:"checkFriend",value:function(e){var t="".concat(this._n,".").concat("checkFriend"),n=e.userIDList,o=e.type,i=(o&&(o===g.SNS_CHECK_TYPE_SINGLE||o===g.SNS_CHECK_TYPE_BOTH)||(o=g.SNS_CHECK_TYPE_BOTH),new R("checkFriend"));return i.setMessage("userIDList:".concat(n," type:").concat(o)),this._snsM.req({proto:h.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:n,type:o}}).then(function(c){i.end(),u.i("".concat(t," ok. userIDList:").concat(n," type:").concat(o));var s=[],r=[],c=c.data.resultList;return q(c)&&c.forEach(function(f){var p=f.to,_=f.relation,m=f.resultCode,f=f.resultInfo;D(m)||m===0?s.push({userID:p,code:0,relation:_}):r.push({userID:p,code:m,message:f})}),V({successUserIDList:s,failureUserIDList:r})}).catch(function(a){return i.setError(a).end(),u.w("".concat(t," failed. error:"),a),v(a)})}},{key:"updateWhenAddedToFriendGroup",value:function(o){var t=this,n=o.name,o=o.userIDList;u.l("".concat(this._n,".updateWhenAddedToFriendGroup groupName:").concat(n," userIDList:").concat(o)),n&&!L(o)&&o.forEach(function(i){t._friendMap.has(i)&&t._friendMap.get(i).addToGroupList(n)})}},{key:"updateWhenRemovedFromFriendGroup",value:function(o){var t=this,n=o.name,o=o.userIDList;u.l("".concat(this._n,".updateWhenRemovedFromFriendGroup groupName:").concat(n," userIDList:").concat(o)),n&&!L(o)&&o.forEach(function(i){t._friendMap.has(i)&&t._friendMap.get(i).removeFromGroupList(n)})}},{key:"reset",value:function(){this._friendMap.clear(),this._startIndex=0,this._standardSequence=0,this._customSequence=0}}]),Ns),oc=(E(Rs,[{key:"addToUserIDList",value:function(e){this.userIDList.indexOf(e)===-1&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){e=this.userIDList.indexOf(e),-1<e&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}]),Rs),il=(E(ks,[{key:"getLocalFriendGroupList",value:function(){return b(this._friendGroupMap.values())}},{key:"_emitFriendGroupListUpdated",value:function(){var e=b(this._friendGroupMap.values());this._snsM.emitOuterEvent(K.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getFriendGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendGroupList"),n=new R("getFriendGroupList");return this._snsM.req({proto:h.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then(function(o){n.end(),o=o.data.resultList,L(o)?u.i("".concat(t," ok. friend group count:0")):(u.i("".concat(t," ok. friend group count:").concat(o.length)),e._friendGroupMap.clear(),o.forEach(function(i){var a=new oc(i);e._friendGroupMap.set(i.name,a)}),e._emitFriendGroupListUpdated())}).catch(function(o){return n.setError(o).end(),u.w("".concat(t," error:"),o),v(o)})}},{key:"createFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("createFriendGroup"),o=e.name,i=e.userIDList;if(this._friendGroupMap.has(o))return v({code:M.FRIEND_GRP_EXISTED});var a=new R("createFriendGroup");return a.setMessage("name:".concat(o," userIDList:").concat(i)),this._snsM.req({proto:h.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[o],userIDList:q(i)?i:void 0}}).then(function(d){a.end(),u.l("".concat(n," ok. name:").concat(o," userIDList:").concat(i));var d=d.data.resultList,r=[],c=[],d=(d&&d.forEach(function(p){var _=p.to,m=p.resultCode,f=p.resultInfo;D(m)||m===0?r.push(_):(_={userID:p.to,code:m,message:f},c.push(_))}),new oc({name:o,userIDList:r}));return t._friendGroupMap.set(o,d),t._snsM.updateWhenAddedToFriendGroup({name:o,userIDList:r}),t._emitFriendGroupListUpdated(),V({friendGroup:d,failureUserIDList:c})}).catch(function(s){return a.setError(s).end(),u.w("".concat(n," failed. error:"),s),v(s)})}},{key:"deleteFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriendGroup"),o=e.name;if(!this._friendGroupMap.has(o))return v({code:M.FRIEND_GRP_NOT_EXIST});var i=new R("deleteFriendGroup");return i.setMessage("name:".concat(o)),this._snsM.req({proto:h.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[o]}}).then(function(a){i.end(),u.l("".concat(n," ok. name:").concat(o));var s=t._friendGroupMap.get(o);return s&&(t._snsM.updateWhenRemovedFromFriendGroup({name:o,userIDList:s.userIDList}),t._friendGroupMap.delete(o),s.userIDList.length=0),t._emitFriendGroupListUpdated(),V(s)}).catch(function(a){return i.setError(a).end(),u.w("".concat(n," failed. error:"),a),v(a)})}},{key:"renameFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("renameFriendGroup"),o=e.oldName,i=e.newName;if(!this._friendGroupMap.has(o))return v({code:M.FRIEND_GRP_NOT_EXIST});var a=new R("renameFriendGroup");return a.setMessage("oldName:".concat(o," newName:").concat(i)),this._snsM.req({proto:h.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,newName:i}}).then(function(){var s;return a.end(),u.l("".concat(n," ok. oldName:").concat(o," newName:").concat(i)),t._friendGroupMap.has(o)?((s=t._friendGroupMap.get(o)).name=i,t._friendGroupMap.delete(o),t._friendGroupMap.set(i,s),t._snsM.updateWhenRemovedFromFriendGroup({name:o,userIDList:s.userIDList}),t._snsM.updateWhenAddedToFriendGroup({name:i,userIDList:s.userIDList}),t._emitFriendGroupListUpdated(),V(s)):V()}).catch(function(s){return a.setError(s).end(),u.w("".concat(n," failed. error:"),s),v(s)})}},{key:"addToFriendGroup",value:function(i){var t=this,n="".concat(this._n,".").concat("addToFriendGroup"),o=i.name,i=i.userIDList;if(!this._friendGroupMap.has(o))return this._onFriendGroupNotExist(o);var a=new R("addToFriendGroup");return a.setMessage("name:".concat(o," userIDList:").concat(i)),u.l("".concat(n," name:").concat(o," userIDList:").concat(i)),this._snsM.req({proto:h.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:i.filter(function(s){return t._snsM.isMyFriend(s)}).map(function(s){return{to:s,updateType:"Update_Type_Add"}})}}).then(function(s){return a.end(),t._onFriendGroupUpdated(o,s)}).catch(function(s){return a.setError(s).end(),u.w("".concat(n," failed. error:"),s),v(s)})}},{key:"removeFromFriendGroup",value:function(i){var t=this,n="".concat(this._n,".").concat("removeFromFriendGroup"),o=i.name,i=i.userIDList;if(!this._friendGroupMap.has(o))return this._onFriendGroupNotExist(o);var a=new R("removeFromFriendGroup");return a.setMessage("name:".concat(o," userIDList:").concat(i)),u.l("".concat(n," name:").concat(o," userIDList:").concat(i)),this._snsM.req({proto:h.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:i.filter(function(s){return t._snsM.isMyFriend(s)}).map(function(s){return{to:s,updateType:"Update_Type_Delete"}})}}).then(function(s){return a.end(),t._onFriendGroupUpdated(o,s)}).catch(function(s){return a.setError(s).end(),u.w("".concat(n," failed. error:"),s),v(s)})}},{key:"_onFriendGroupUpdated",value:function(e,n){var n=n.data.resultList,o=this._friendGroupMap.get(e),i=[],a=[],s=[];return q(n)&&n.forEach(function(r){var c=r.to,d=r.resultCode,p=r.resultInfo,_=r.type;d===0?_==="Update_Type_Add"?o&&(o.addToUserIDList(c),a.push(c)):_==="Update_Type_Delete"&&o&&(o.removeFromUserIDList(c),s.push(c)):i.push({to:r.to,code:d,message:p})}),u.l("".concat(this._n,"._onFriendGroupUpdated name:").concat(e," userIDList:").concat(o.userIDList)),0<a.length&&this._snsM.updateWhenAddedToFriendGroup({name:e,userIDList:a}),0<s.length&&this._snsM.updateWhenRemovedFromFriendGroup({name:e,userIDList:s}),V({friendGroup:o,failureUserIDList:i})}},{key:"updateWhenFriendAdded",value:function(e){var t=this,n=e.nameList,o=e.userID;u.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(o," nameList:").concat(n)),L(n)||n.forEach(function(i){t._friendGroupMap.has(i)&&t._friendGroupMap.get(i).addToUserIDList(o)})}},{key:"updateWhenFriendDeleted",value:function(e){var t=this,n=e.nameList,o=e.userID;u.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(o," nameList:").concat(n)),L(n)||n.forEach(function(i){t._friendGroupMap.has(i)&&t._friendGroupMap.get(i).removeFromUserIDList(o)})}},{key:"reset",value:function(){this._friendGroupMap.clear()}}]),ks),al=(F(Wo,xe),Zr=te(Wo),E(Wo,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getFriendGroupList(),this._friendApplicationHandler.getFriendApplicationList()}},{key:"onRelationChainModified",value:function(c){var t,n,o,i,a,s,r=this,c=c.dataList;L(c)||(t=[],n=[],o=[],a=!(i=[]),s="",c.forEach(function(d){var p;d.pushType!==3&&d.pushType!==4||!d.from||(s=d.from),d.friendAddAccount&&(t.push.apply(t,b(d.friendAddAccount)),i.push.apply(i,b(d.friendAddAccount))),d.friendDelAccount&&n.push.apply(n,b(d.friendDelAccount)),d.friendApplicationAdded&&o.push.apply(o,b(d.friendApplicationAdded)),d.friendApplicationDeletedUserIDList&&i.push.apply(i,b(d.friendApplicationDeletedUserIDList)),d.reportTime&&d.pushType===7&&(a=!0),d.friendUpInfo&&(p={dataList:[]},d.friendUpInfo.forEach(function(_){p.dataList.push({userID:_.friendAccount,profileList:b(_.sns)})}),r.onFriendProfileModified(p))}),a&&this._friendApplicationHandler.onFriendApplicationRead(),this._friendApplicationHandler.onFriendApplicationAdded(o,s),this._friendApplicationHandler.onFriendApplicationDeleted(i),this._friendHandler.onFriendAdded(t),this._friendHandler.onFriendDeleted(n))}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],"sns"),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],t=this._friendHandler.getLocalFriendList();return e?$(t):t}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"updateWhenAddedToFriendGroup",value:function(e){this._friendHandler.updateWhenAddedToFriendGroup(e)}},{key:"updateWhenRemovedFromFriendGroup",value:function(e){this._friendHandler.updateWhenRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){var e=this._friendApplicationHandler.getLocalFriendApplicationList();return $(e)}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteFriendApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseFriendApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptFriendApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setFriendApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){var e=this._friendGroupHandler.getLocalFriendGroupList();return $(e)}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createFriendGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteFriendGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToFriendGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromFriendGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameFriendGroup(e)}},{key:"onAddToFriendGroup",value:function(e){return this._friendGroupHandler.onAddToFriendGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Wo),sl=(F(Ko,xe),Xr=te(Ko),E(Ko,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&St}},{key:"startWorkerTimer",value:function(){u.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){u.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var e,t;St&&(e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(e),(t=this)._workerTimer.onmessage=function(n){n.data?(t._timerID=n.data,u.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()})}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");u.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),D(e)||e==="1"?!this._isWorkerEnabled&&St&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&St&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){u.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),Ko),rl=(E(Ls,[{key:"isValidPurchaseBits",value:function(e){return e&&typeof e=="string"&&1<=e.length&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._featureMap.clear();for(var t,n=e.length-1,o=0;0<=n;n--,o++)t=(o<32?new Pe(0,Math.pow(2,o)):new Pe(Math.pow(2,o-32),0)).toString(),e[n]==="1"?this._featureMap.set(t,!0):this._featureMap.set(t,!1)}else u.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._featureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,o=!0,i=t.length-1,a=0;0<=i;i--,a++)if(t.charAt(i)==="1"&&(n=(a<32?new Pe(0,Math.pow(2,a)):new Pe(Math.pow(2,a-32),0)).toString(),!this._featureMap.get(n))){o=!1;break}return u.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," key:").concat(n," ret:").concat(o)),$({enabled:o})}},{key:"isFeatureEnabledForStat",value:function(e){for(var t=parseInt(e).toString(2),n=t.length-1,o=0;0<=n;n--,o++)if(t.charAt(n)==="1"){if(i=(o<32?new Pe(0,Math.pow(2,o)):new Pe(Math.pow(2,o-32),0)).toString(),!this._featureMap.get(i))break;var i,a="",s=0;i===Ce.SEARCH_MSG?(a="plugin_search",s=6):i===Ce.PLUGIN_TRANSLATE?(a="plugin_translate",s=16):i===Ce.PLUGIN_VOICE_TO_TEXT?(a="plugin_voice_to_text",s=17):i===Ce.PLUGIN_CS?(a="plugin_cs",s=14):i===Ce.PLUGIN_PUSH?(a="plugin_push",s=13):i===Ce.PLUGIN_BOT?(a="plugin_bot",s=15):i===Ce.MSG_REACTION&&(a="plugin_emoji_reaction",s=18),a!==""&&(i=this._commercialConfigM.get(12).getUIPlatform(),new R(a).setCode(s).setUIPlatform(i).end(),u.l("".concat(this._n,".isFeatureEnabledForStat ").concat(a," code:").concat(s," uiPlatform:").concat(i)))}}},{key:"clear",value:function(){this._featureMap.clear()}}]),Ls),cl=(E(Es,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e,t,n=this,o=this._canFetch(),i="".concat(this._n,".fetchConfig");u.l("".concat(i," canFetch:").concat(o)),o&&(e=new R("fetchCommercialConfig"),o=this.get(12).getSDKAppID(),t=this.get(20),this._isFetching=!0,t.req({proto:h.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:o}}).then(function(a){e.setMessage("purchaseBits:".concat(a.data.purchaseBits)).end(),u.l("".concat(i," ok.")),n._parseConfig(a.data),n._isFetching=!1}).catch(function(a){e.setError(a).end(),n._isFetching=!1}))}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));u.l("".concat(t)),new R("pushedCommercialConfig").setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,o=e.errorMessage,i=e.purchaseBits,a=e.expiredTime;n===0?(this._purchasedFeatureHandler.parsePurchaseBits(i),this._expiredTime=Date.now()+1e3*a):D(n)?(u.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(u.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"isFeatureEnabledForStat",value:function(e){this._purchasedFeatureHandler.isFeatureEnabledForStat(e)}},{key:"get",value:function(e){return this._m.get(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),Es),ul=(F(Ho,xe),Jr=te(Ho),E(Ho,[{key:"registerPlugin",value:function(e){var t,n,o,i,a,s,r,c,d,p,_,m,f;$e?(this._offlinePushPlugin=e["tim-offline-push-plugin"],t=(f=e.offlinePushConfig||{}).huaweiBusinessID,n=f.xiaomiBusinessID,o=f.xiaomiAppID,i=f.xiaomiAppKey,a=f.meizuBusinessID,s=f.meizuAppID,r=f.meizuAppKey,c=f.vivoBusinessID,d=f.oppoBusinessID,p=f.oppoAppKey,_=f.oppoAppSecret,m=f.honorBusinessID,f=f.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=t,this._androidPushConfig.xiaomiPushBussinessId=n,this._androidPushConfig.xiaomiPushAppId=o,this._androidPushConfig.xiaomiPushAppKey=i,this._androidPushConfig.meizuPushBussinessId=a,this._androidPushConfig.meizuPushAppId=s,this._androidPushConfig.meizuPushAppKey=r,this._androidPushConfig.vivoPushBussinessId=c,this._androidPushConfig.oppoPushBussinessId=d,this._androidPushConfig.oppoPushAppKey=p,this._androidPushConfig.oppoPushAppSecret=_,this._androidPushConfig.honorPushBussinessId=m,new R("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!D(this._offlinePushPlugin))).end(!0),u.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=f,this._setAppShowListener()):this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");qe(this._offlinePushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),u.l("".concat(n," start. ").concat(e)),new R("_getDeviceToken").setMessage("".concat(e)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,function(o){var i,a,s,r,c=new R("getDeviceTokenRes"),d=o.code,p=o.msg;d===0?(i=(r=o.data).deviceToken,a=r.deviceBrand,s=r.deviceType,r=r.bussinessId,t._deviceToken=i,t._businessID=r||t._iosBusinessID,e="deviceToken:".concat(i,", deviceBrand:").concat(a||s,", businessID:").concat(t._businessID),u.l("".concat(n," ok. ").concat(e)),c.setMessage(e).end(!0),t._setToken()):(c.setMessage("code:".concat(d,", msg:").concat(p)).end(!0),u.e("".concat(n," failed. error:"),o))})):u.e("".concat(n," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return $e&&!D(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");D(this._offlinePushPlugin)?u.e("".concat(t," offlinePushPlugin is undefined")):qe(this._offlinePushPlugin.setAppShowListener)?(new R("_setAppShowListener").end(!0),u.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener(function(n){n=(n||{}).appShow,new R("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),u.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(n===0?(e._getConvUnreadCount(),e._onBackground()):n===1&&e._onForeground())})):u.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!D(this._offlinePushPlugin)&&qe(this._offlinePushPlugin.getDeviceType))return e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,u.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,"._setToken"),t=this.get(12),n=1,o="",i="",r=(L(this._deviceToken)&&(n=0),this.getUniAppPlatform()),a=this.getDeviceBrand(),s=(r===ze.IOS||r===ze.IPAD||r===ze.MAC?i=this._deviceToken:r===ze.ANDROID&&(o=this._deviceToken),new R("offlinePushSetToken")),r="deviceToken:".concat(i||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(a,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(n,", platform:").concat(r);return s.setMessage("".concat(r)),u.l("".concat(e," ").concat(r)),this.req({proto:h.SET_TOKEN,data:{tokenID:o,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:a,deviceToken:i,isWebUniapp:this._isWebUniapp}}).then(function(c){return s.end(),u.l("".concat(e," ok")),c}).catch(function(c){return s.setError(c).end(),u.e("".concat(e," failed. error:"),c),v(c)})}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConversationList().forEach(function(t){t.type===g.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===g.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)})}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new R("_onBackground");this.req({proto:h.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(o){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),u.l("".concat(t," ok")),o}).catch(function(o){n.setError(o).end(),u.e("".concat(t," failed. error:"),o)})}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new R("_onForeground");this.req({proto:h.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(n){return t.end(),u.l("".concat(e," ok")),n}).catch(function(n){t.setError(n).end(),u.e("".concat(e," failed. error:"),n)})}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return e==="ios"?ze.IOS:e==="android"?ze.ANDROID:t===1002?ze.IPAD:t===1001?ze.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,u.l("".concat(this._n,".reset"))}}]),Ho),ll=(F(Bo,xe),jr=te(Bo),E(Bo,[{key:"registerPlugin",value:function(e){var t,n,o;$e?(t="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=e["tim-push"],this._getDeviceInfo(),n=(o=e.pushConfig||{}).androidConfig,o=o.iOSConfig,dt(n)&&(this._androidPushConfig=n[this._deviceInfo.packageName]),n=(o||{}).iOSBusinessID,this._iOSBusinessID=n,o=!D(this._pushPlugin),new R("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(o)).end(!0),u.l("".concat(t," ok. pushConfig:").concat(JSON.stringify(e.pushConfig))),o?(this._setAppShowListener(),this._setPushEventReportListener()):u.e("".concat(t," ").concat(this._pluginName," is undefined"))):this.outputWarning("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var e=this,t="".concat(this._n,".").concat("_reportEventCacheList");qe(this._pushPlugin.getPushEventCacheList)?(new R("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList(function(n){var o=n.code,i=n.data.eventList,a=new R("getPushEventCacheListRes");if(a.setCode(o),o!==0)a.setMessage("res:".concat(JSON.stringify(n))).end(!0),u.e("".concat(t," failed. error:").concat(JSON.stringify(n)));else{o=i.length<10?"eventList:".concat(JSON.stringify(i)):"eventList.length:".concat(i.length),u.l("".concat(t," ok. ").concat(o)),a.setMessage(o).end(!0);for(var s=l(l({},n.data),{},{eventList:[]});0<i.length;)s.eventList=i.splice(0,40),e._pushReport(s)}})):u.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");qe(this._pushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),u.l("".concat(n," start. ").concat(e)),new R("_getDeviceToken").setMessage("".concat(e)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,function(o){var i,a,s,r=o.code,c=o.msg,d=new R("getDeviceTokenRes");if(d.setCode(r),r===0)return i=(r=o.data).deviceToken,a=r.deviceBrand,s=r.deviceType,r=r.bussinessId,t._deviceToken=i,t._businessID=r||t._iOSBusinessID,e="deviceToken:".concat(i," deviceBrand:").concat(a||s," businessID:").concat(t._businessID),u.l("".concat(n," ok. ").concat(e)),d.setMessage(e).end(!0),void t._setToken();d.setMessage(c).end(!0),u.e("".concat(n," failed. error:").concat(JSON.stringify(o)))})):u.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var e="".concat(this._n,".").concat("_getDeviceInfo");if(qe(this._pushPlugin.getDeviceInfo)){var t=this._pushPlugin.getDeviceInfo(),n=t.code,o=t.data,i=new R("_getDeviceInfo");if(i.setCode(n),n===0)return this._deviceInfo=l(l({},this._deviceInfo),o),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),n="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),u.l("".concat(e," ok. ").concat(n)),void i.setMessage(n).end(!0);i.setMessage("deviceInfoRes:".concat(JSON.stringify(t))).end(!0),u.e("".concat(e," failed. error:").concat(JSON.stringify(t)))}else u.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return $e&&!D(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");qe(this._pushPlugin.setAppShowListener)?(new R("_setAppShowListener").end(!0),u.l("".concat(t," start")),this._pushPlugin.setAppShowListener(function(n){n=(n||{}).appShow,new R("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),u.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(n===0?(e._getConvUnreadCount(),e._onBackground()):n===1&&e._onForeground())})):u.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setPushEventReportListener");qe(this._pushPlugin.setPushEventReportListener)?(new R("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener(function(n){var o=n.code,i=n.data,a=i.eventList,s=new R("setPushEventReportListenerRes");if(s.setCode(o),o===0)return o="eventList:".concat(JSON.stringify(a)),u.l("".concat(t," ok. ").concat(o)),s.setMessage(o).end(!0),void(e._m.isReady()&&q(a)&&0<a.length&&e._pushReport(i));s.setMessage("res:".concat(JSON.stringify(n))).end(!0),u.e("".concat(t," failed. error:").concat(JSON.stringify(n)))})):u.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!D(this._pushPlugin)&&qe(this._pushPlugin.getDeviceType))return e=(this._pushPlugin.getDeviceType()||{}).deviceType,u.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,".").concat("_setToken"),t=this.get(12),n=1,r="",o="",a=(L(this._deviceToken)&&(n=0),this.getUniAppPlatform()),i=this.getDeviceBrand(),a=(a===ze.IOS||a===ze.IPAD||a===ze.MAC?o=this._deviceToken:a===ze.ANDROID&&(r=this._deviceToken),l({tokenID:r,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:i,deviceToken:o,isWebUniapp:this._isWebUniapp},this._deviceInfo)),s=new R("_setToken"),r="data:".concat(JSON.stringify(a));s.setMessage("".concat(r)),u.l("".concat(e," ").concat(r)),this.req({proto:h.SET_TOKEN,data:a}).then(function(){s.end(),u.l("".concat(e," ok"))}).catch(function(c){s.setError(c).end(),u.e("".concat(e," failed. error:"),c),v(c)})}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConversationList().forEach(function(t){t.type===g.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===g.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)})}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new R("_onBackground");this.req({proto:h.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(){n.setMessage("c2cUnreadCount:".concat(e._c2cUnreadCount," groupUnreadCount:").concat(e._groupUnreadCount)).end(),u.l("".concat(t," ok"))}).catch(function(o){n.setError(o).end(),u.e("".concat(t," failed. error:"),o)})}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new R("_onForeground");this.req({proto:h.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(){t.end(),u.l("".concat(e," ok"))}).catch(function(n){t.setError(n).end(),u.e("".concat(e," failed. error:"),n)})}},{key:"_pushReport",value:function(e){var t=this,n="".concat(this._n,".").concat("_pushReport"),o=new R("_pushReport");this.req({proto:h.PUSH_REPORT,data:{eventList:e.eventList}}).then(function(){o.end(),t._notifyReportSuccess(e)}).catch(function(i){o.setError(i).end(),u.e("".concat(n," failed. error:"),i)})}},{key:"_notifyReportSuccess",value:function(e){!D(this._pushPlugin)&&qe(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(e),u.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return e==="ios"?ze.IOS:e==="android"?ze.ANDROID:t===1002?ze.IPAD:t===1001?ze.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,u.l("".concat(this._n,".reset"))}}]),Bo),dl=(F(Vo,xe),zr=te(Vo),E(Vo,[{key:"init",value:function(){var e=this.get(18).getPlugin("tim-profanity-filter-plugin");e?(this._plugin=new e({logger:u,isArray:q,isMap:Fe,isDevMode:this.isDevMode()}),this._getLexicon()):this.outputWarning("ProfanityPluginNotFound")}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,o){var n=!0;if(!this._plugin||!this._canIUseLexicon||o&&o.messageControlInfo&&o.messageControlInfo.excludedFromContentModeration===!0)return n;var o=e.type,i=e.conversationType;if(o!==g.MSG_TEXT&&o!==g.MSG_CUSTOM)return n;var a,s="".concat(this._n,".filterMessage");if(u.l("".concat(s)),o===g.MSG_TEXT){if(i===g.CONV_C2C?a="c2c_text_message":i===g.CONV_GROUP&&(a="group_text_message"),!this._isConfigOn(a))return n;var c=this._plugin.filter(e.payload.text),r=c.type,c=c.modifiedText;r===1?n=!1:r===2&&(e.payload.text=c)}else if(o===g.MSG_CUSTOM){if(i===g.CONV_C2C?a="c2c_custom_message":i===g.CONV_GROUP&&(a="group_custom_message"),!this._isConfigOn(a))return n;r=this._plugin.filter(e.payload.data),c=this._plugin.filter(e.payload.description),o=this._plugin.filter(e.payload.extension),r.type===1||c.type===1||o.type===1?n=!1:(r.type===2&&(e.payload.data=r.modifiedText),c.type===2&&(e.payload.description=c.modifiedText),o.type===2&&(e.payload.extension=o.modifiedText))}return u.l("".concat(s," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),o={isAllowedToSend:!0,modifiedText:e};return!this._plugin||!this._canIUseLexicon||!this._isConfigOn(t)?o:(u.l("".concat(n)),t=this._plugin.filter(e),e=t.type,t=t.modifiedText,e===1?o.isAllowedToSend=!1:e===2&&(o.modifiedText=t),u.l("".concat(n," done. ret:"),o),o)}},{key:"_getLexicon",value:function(){var e=this,t=new R("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({proto:h.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then(function(_){var _=_.data,i=_.errorInfo,a=_.filterConfig,s=_.lexicon,r=_.strToken,c=_.completeFlag,d=_.nextStartIndex,p=_.version,_=_.expiredTime,m=i.errorCode,f=i.errorMessage;return m!==0?(e._isFetching=!1,u.w("".concat(n," failed. error:"),i),void t.setCode(m).setMessage(f).end()):(e._onFilterConfig(a),e._getToken(r),c===1?(u.l("".concat(n," done. version:").concat(p," expiredTime:").concat(_)),e._version=p,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*_,void e._plugin.onLexiconCompleted(s)):(e._startIndex=d,e._plugin.onLexiconSliced(s),void e._getLexicon()))}).catch(function(o){t.setError(o).end(),e._isFetching=!1,u.l("".concat(n," failed. error:"),o)})}},{key:"_onFilterConfig",value:function(e){var t=this;L(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach(function(n){t._filterConfigMap.set(n,e[n])}),u.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return this._filterConfigMap.get(e)===1}},{key:"_getToken",value:function(e){if(ne(e)){var t=e.length,n="";if(t%2==0)for(var o=0;o<=t-1;o+=2)n=(n+=e[o+1])+e[o];else{for(var i=0;i<t-1;i+=2)n=(n+=e[i+1])+e[i];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),Vo),pl=(E(Ss,[{key:"_onCloudConfigUpdated",value:function(){var e=this,t=this._m.get(23).getCloudConfig("rtc_cmd");D(t)||((t=JSON.parse(t)).forEach(function(n){e._TRTCCommandList.includes(n)||e._TRTCCommandList.push(n)}),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var e,t=0,n=this._TRTCCommandList.length;t<n;t++)e=this._TRTCCommandList[t].split(".")[0],this._TRTCCommandMap.set(e,1)}},{key:"onRoomCustomDataReceived",value:function(e){this._m.getOuterEmitterInstance().emit(K.ROOM_CUSTOM_DATA_RECEIVED,e)}},{key:"sendTRTCCustomData",value:function(n){var t=n.serviceCommand,n=n.data,o="".concat(O.NAME.TUIROOM_SVR,".*");return D(t)||(o=t),this._isValidServiceCommand(o)?this._trans({servcmd:o,data:n}):v({code:M.INVALID_TRTC_CMD})}},{key:"_trans",value:function(n){u.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(n)));var t=n.servcmd,n=n.data;return this._m.get(20).trans({servcmd:t,data:ne(n)?JSON.parse(n):n})}},{key:"_isValidServiceCommand",value:function(e){return e.endsWith(".*")?this._TRTCCommandList.includes(e):(e=e.split(".")[0],this._TRTCCommandMap.has(e))}},{key:"isTRTCCommand",value:function(e){return e=e.split(".")[0],this._TRTCCommandMap.has(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),Ss),gl=(E(Ds,[{key:"_init",value:function(){var e,t=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(t){try{e=JSON.parse(t)}catch(n){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),u.w("".concat(this._n,"._init error:"),n)}e&&(this._needToUpdate(e)?this._fetch():this._fillMap(e.message))}else this._fetch()}},{key:"_needToUpdate",value:function(n){var t=n.localSavedTime,n=n.localSavedVersion,t=t&&new Date().getTime()-t>=this.STORAGE_EXPIRES_TIME,n=!n||n!=="3.2.9";return u.l("".concat(this._n,"._needToUpdate isTimeout:").concat(t," isDifferentVersion:").concat(n)),t||n}},{key:"_fetch",value:function(){var e,t,n,o,i,a;this._m.get(12).isPrivateNetWork()||(e="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.5/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),o=this,me?fe.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(s){o._fillAndSave(s.data),u.l("".concat(n," mini program"))},fail:function(){}}):(i=new XMLHttpRequest,a=setTimeout(function(){i.abort()},3e3),i.onreadystatechange=function(){i.readyState===4&&(clearTimeout(a),i.status!==200&&i.status!==304||(u.l("".concat(n," browser")),o._fillAndSave(i.responseText)))},i.open("GET",e,!0),i.setRequestHeader("Content-type",t),i.send()))}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:new Date().getTime(),localSavedVersion:"3.2.9"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,o=e.split(`;
`),i=o.length,a=new RegExp(/'/g),s=0;s<i;s++)if(n=o[s].indexOf(":"),t=o[s].slice(0,n),n=o[s].slice(n+1,o[s].length),!t.startsWith("//")){if(D(n))continue;this._map.set(t,n.replace(a,""))}}},{key:"get",value:function(n){var o=n.isIntl,i=n.key,t=n.replacement1,n=n.replacement2,o="".concat(i,o?"_en":"_cn"),i=(!this._map.has(o)&&this._map.has(i)&&(o=i),"");return this._map.has(o)&&(i=this._map.get(o),D(t)||(i=i.replace("$replacement1",t)),D(n)||(i=i.replace("$replacement2",n))),i}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),Ds),hl=(E(Ts,[{key:"onNewMessageList",value:function(n){var t=this,n=this._sigM.filterMessageList(n);0<n.length&&n.forEach(function(o){var i=t.getPayloadData(o);i&&t._handleActionType(i,o)})}},{key:"onMessageModified",value:function(n){var t=this,n=this._sigM.filterMessageList(n);0<n.length&&n.forEach(function(o){var i=t.getPayloadData(o);i&&t._onInvitationModified(i,o)})}},{key:"getPayloadData",value:function(n){var t="".concat(this._n,".getPayloadData"),n=n.payload.data;try{return JSON.parse(n)}catch{return u.e("".concat(t," JSON parse error. signalingData:").concat(n)),null}}},{key:"_handleActionType",value:function(e,t){switch(e.actionType){case Me.ACTION_TYPE_INVITE:this._onNewInvitationReceived(e,t);break;case Me.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(e);break;case Me.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(e);break;case Me.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(e);break;case Me.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(e)}}},{key:"_createDefaultEmitData",value:function(e){return{inviteID:e.inviteID,inviter:e.inviter,groupID:e.groupID,data:e.data||""}}},{key:"_onNewInvitationReceived",value:function(e,t){var p="".concat(this._n,"._onNewInvitationReceived"),n=e.inviteID,o=e.inviteeList,i=e.groupID,a=e.inviter,s=this._sigM.getMyUserID(),r=o.includes(s),c=e.timeout,d=(wn().getTime()-1e3*t.time)/1e3,p=(0<c&&0<d&&d<c&&(c-=d),"".concat(p," myselfIncluded:").concat(r," groupID:").concat(i," signalObj:").concat(JSON.stringify(e)));u.l("".concat(p," timeout:").concat(c,"s delta:").concat(d,"s")),(i&&r||!i)&&((p=this._sigM.getInviteInfo(n))&&p===e||(p||this._sigM.setInviteInfo(n,l(l({},e),{},{message:t})),this._sigM.emitEvent(Me.NEW_INVITATION_RECEIVED,l(l({},this._createDefaultEmitData(e)),{},{inviteeList:o})),a!==s&&this._sigM.startTimer(l(l({},e),{},{timeout:c}))))}},{key:"_onInviteeRejected",value:function(e){var t="".concat(this._n,"._onInviteeRejected"),n=e.inviteID,o=e.inviter,i=e.groupID,a=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(a," inviter:").concat(o," groupID:").concat(i)),(i&&a||!i)&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITEE_REJECTED,l(l({},this._createDefaultEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(e){var t="".concat(this._n,"._onInviteeAccepted"),n=e.inviteID,o=e.inviter,i=e.groupID,a=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(a," inviter:").concat(o," groupID:").concat(i)),(i&&a||!i)&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITEE_ACCEPTED,l(l({},this._createDefaultEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(e){var t="".concat(this._n,"._onInvitationCancelled"),n=e.inviteID,o=e.inviter,i=e.groupID,a=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(a," inviter:").concat(o," groupID:").concat(i)),(i&&a||!i)&&(this._sigM.deleteInviteInfo(n),this._sigM.emitEvent(Me.INVITATION_CANCELLED,this._createDefaultEmitData(e)))}},{key:"_onInvitationTimeout",value:function(e){var t="".concat(this._n,"._onInvitationTimeout"),n=e.inviteID,o=e.inviter,i=e.groupID,a=e.inviteeList,s=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(s," inviter:").concat(o," groupID:").concat(i,"  data:").concat(e.data)),(i&&s||!i)&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITATION_TIMEOUT,l(l({},this._createDefaultEmitData(e)),{},{inviteeList:a,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(e,t){var n="".concat(this._n,"._onInvitationModified"),o=e.inviteID,i=e.data;u.l("".concat(n," inviteID:").concat(o," data:").concat(i)),this._sigM.setInviteInfo(o,l(l({},e),{},{message:t})),this._sigM.emitEvent(Me.INVITATION_MODIFIED,{inviteID:o,data:i})}}]),Ts),_l=(E(Cs,[{key:"generateInviteID",value:function(){var e,t=(t=zu)((e=Yu)(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12);return u.l("".concat(this._n,".generateInviteID inviteID:").concat(t)),t}},{key:"createInviteInfo",value:function(n){var t=this.generateInviteID(),n=this.createInviteCustomData(l(l({},n),{},{inviteID:t})),i=n.groupID,o=n.inviteeList,i=i||o[0];return{customData:n,message:this.createSignalingMessage(n,i),inviteID:t}}},{key:"_createDefaultCustomData",value:function(o){var t=o.data,n=o.inviteID,o=o.groupID;return{businessID:1,timeout:0,data:t===void 0?"":t,inviteID:n===void 0?"":n,groupID:o===void 0?"":o}}},{key:"createInviteCustomData",value:function(e){var t=e.userID,n=e.timeout,n=n===void 0?0:n,o=e.groupID,o=o===void 0?"":o,i=this._sigM.getMyUserID(),i=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_INVITE,inviter:i,inviteeList:o?e.inviteeList:[t],timeout:n});return u.l("".concat(this._n,".createInviteCustomData customData:").concat(JSON.stringify(i))),i}},{key:"createCancelCustomData",value:function(e){var t,n="".concat(this._n,".createCancelCustomData"),s=e.inviteID,o=this._sigM.getMyUserID(),s=this._sigM.getInviteInfo(s),i=s.inviteeList,a=s.groupID,s=s.inviter;return s===o?t=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_CANCEL_INVITE,groupID:a,inviter:o,inviteeList:i}):u.e("".concat(n," unmatched inviter:").concat(s," and my userID:").concat(o)),u.l("".concat(n," customData:").concat(JSON.stringify(t))),t}},{key:"createAcceptCustomData",value:function(e){var t,n="".concat(this._n,".createAcceptCustomData"),o=e.inviteID,i=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(o),s=a.inviter,r=a.groupID;return a.inviteeList.includes(i)?t=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_ACCEPT_INVITE,groupID:r,inviter:s,inviteeList:[i]}):u.e("".concat(n," userID:").concat(i," not in inviteeList. inviteID:").concat(o," groupID:").concat(r)),u.l("".concat(n," customData:").concat(JSON.stringify(t))),t}},{key:"createRejectCustomData",value:function(e){var t,n="".concat(this._n,".createRejectCustomData"),o=e.inviteID,i=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(o),s=a.inviter,r=a.groupID;return a.inviteeList.includes(i)?t=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_REJECT_INVITE,groupID:r,inviter:s,inviteeList:[i]}):u.e("".concat(n," userID:").concat(i," not in inviteeList. inviteID:").concat(o," groupID:").concat(r)),u.l("".concat(n," customData:").concat(JSON.stringify(t))),t}},{key:"createTimeoutCustomData",value:function(s){var t="".concat(this._n,".createTimeoutCustomData"),n=s.inviteeList,o=s.inviter,i=s.isInviter,i=i!==void 0&&i,a=this._sigM.getMyUserID(),s=l(l({},this._createDefaultCustomData(s)),{},{actionType:Me.ACTION_TYPE_INVITE_TIMEOUT,inviter:o,inviteeList:i?n:[a]});return u.l("".concat(t," customData:").concat(JSON.stringify(s))),s}},{key:"createSignalingMessage",value:function(e,i){var n=e.groupID,a=e.inviter,o=this._sigM.get(2),i={to:i||n||a,conversationType:n?g.CONV_GROUP:g.CONV_C2C,priority:g.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(e)}},a=o.createCustomMessage(i);return u.d("".concat(this._n,".createSignalingMessage. message:").concat(JSON.stringify(a))),a}}]),Cs),fl=(E(Ms,[{key:"getHistorySignaling",value:function(){var e=this,t=this._sigM.get(11).getLocalConversationList();L(t)||this._getSignalingList(t).then(function(n){e._handleSignalingList(n)})}},{key:"_getSignalingList",value:function(n){var t=this,n=this._getValidConversationList(n),n=this._createPromiseList(n);return L(n)?Promise.resolve([]):this._concurrentGetMessageList(n).then(function(o){var i=new Map;return o.forEach(function(a){a=a.signalingList,a=t._getSignalingRelatedToMeMap(a),i=new Map([].concat(b(i),b(a)))}),t._sortSignaling(i)})}},{key:"_handleSignalingList",value:function(e){L(e)||(u.d("".concat(this._n,"._handleSignalingList signalingList:").concat(JSON.stringify(e))),this._sigM.onNewMessageList(e))}},{key:"_isSignalingNotExpired",value:function(e,t){return e[t]&&1e3*e[t]>new Date().getTime()-this.EXPIRED_TIME}},{key:"_getValidConversationList",value:function(e){for(var t=[],n=0;n<e.length;n++){var a=e[n],o=a.type,i=a.unreadCount,a=a.lastMessage,a=this._isSignalingNotExpired(a,"lastTime");o!==g.CONV_SYSTEM&&0<i&&a&&t.push(e[n])}return t}},{key:"_createPromiseList",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],o=i.conversationID,a=i.unreadCount,i=i.type===g.CONV_C2C?a:this.COUNT,a=(this._signalingMap.set(o,{needMessageCount:i,signalingList:[]}),this._sigM.get(11).getMessageList({conversationID:o}));t.push(a)}return t}},{key:"_concurrentGetMessageList",value:function(e){var t=this,n=[];return Promise.all(e).then(function(o){for(var i=0;i<o.length;i++){var s=o[i],a=s.code,s=s.data;a===0&&s.messageList.length!==0&&(t._handleMessageList(s.messageList),(a=t._relayGetMessageList(s))&&n.push(a))}return 0<n.length?t._concurrentGetMessageList(n):t._signalingMap})}},{key:"_relayGetMessageList",value:function(s){var r=s.messageList,t=s.nextReqMessageID,s=s.isCompleted,n=r.length;if(n===0)return null;var a=r[0],o=a.conversationID,a=a.conversationType,i=this._signalingMap.get(o).needMessageCount,a=a===g.CONV_GROUP,s=i===0||s,r=this._isSignalingNotExpired(r[n-1],"time");return a||s||!r?null:this._sigM.get(11).getMessageList({conversationID:o,nextReqMessageID:t,count:i})}},{key:"_handleMessageList",value:function(e){for(var t=e.length,n=e[0].conversationID,o=this._signalingMap.get(n),i=o.needMessageCount,o=o.signalingList,i=0<i-t?i-t:0,a=[],s=0;s<e.length;s++){var r=e[s];this._isSignalingNotExpired(r,"time")&&a.push(r)}t=this._sigM.filterMessageList(a),this._signalingMap.set(n,{needMessageCount:i,signalingList:o.concat(t)})}},{key:"_getSignalingRelatedToMeMap",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._saveSignalingRelatedToMe(n)}return this._signalingRelatedToMeMap}},{key:"_saveSignalingRelatedToMe",value:function(e){var t=this._sigM.getRemoteSignalingHandler().getPayloadData(e)||{},n=t.actionType,n=n===void 0?"":n,i=t.inviteID,o=i===void 0?"":i,i=t.inviteeList,a=i===void 0?[]:i,s=this._sigM.getMyUserID();switch(n){case Me.ACTION_TYPE_INVITE:a.includes(s)&&this._signalingRelatedToMeMap.set(o,l(l({},t),{},{messageList:[e]}));break;case Me.ACTION_TYPE_REJECT_INVITE:case Me.ACTION_TYPE_ACCEPT_INVITE:this.updateHistoryInviteInfo(e);break;case Me.ACTION_TYPE_CANCEL_INVITE:this.deleteHistoryInviteInfo(o);break;case Me.ACTION_TYPE_INVITE_TIMEOUT:this.updateHistoryInviteInfo(e)}}},{key:"deleteHistoryInviteInfo",value:function(e){this._signalingRelatedToMeMap.has(e)&&this._signalingRelatedToMeMap.delete(e)}},{key:"updateHistoryInviteInfo",value:function(e){var n=this._sigM.getRemoteSignalingHandler().getPayloadData(e)||{},t=n.inviteID,t=t===void 0?"":t,n=n.inviteeList,o=n===void 0?[]:n;if(this._signalingRelatedToMeMap.has(t)){for(var n=this._signalingRelatedToMeMap.get(t),i=n.inviteeList,n=n.messageList,a=0;a<o.length;a++){var s=o[a];i.includes(s)&&i.splice(i.indexOf(s),1)}i.length===0?this.deleteHistoryInviteInfo(t):n.push(e)}else this.deleteHistoryInviteInfo(t)}},{key:"_sortSignaling",value:function(e){var t=[];return e.forEach(function(n){t=[].concat(b(t),b(n.messageList))}),t.sort(function(n,o){return(n.time||0)-(o.time||0)})}},{key:"reset",value:function(){this._signalingMap.clear(),this._signalingRelatedToMeMap.clear()}}]),Ms),ml=E(function e(t,n){S(this,e),this.businessID=t.businessID||1,this.inviteID=t.inviteID,this.groupID=t.groupID||"",this.inviter=t.inviter||"",this.inviteeList=t.inviteeList||[],this.data=t.data||"",this.actionType=t.actionType||Me.ACTION_TYPE_INVITE,this.timeout=t.timeout||0}),vl=["message"],Al=["message"],Il=(F(qo,xe),Yr=te(qo),E(qo,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onReady",value:function(){u.l("".concat(this._n,".onReady")),this._isSyncCompleted=!0,this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(e){return this._remoteSignalingHandler.onNewMessageList(e)}},{key:"onMessageModified",value:function(e){return this._remoteSignalingHandler.onMessageModified(e)}},{key:"hasInviteInfo",value:function(e){return this._inviteInfoMap.has(e)}},{key:"getInviteInfo",value:function(e){return this._inviteInfoMap.get(e)}},{key:"setInviteInfo",value:function(e,o){var n=o.message,o=ae(o,vl);u.l("".concat(this._n,".setInviteInfo inviteID:").concat(e," data:").concat(JSON.stringify(o))),this._inviteInfoMap.set(e,l(l({},o),{},{message:n}))}},{key:"deleteInviteInfo",value:function(e){this.hasInviteInfo(e)&&(u.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(e,".")),this._inviteInfoMap.delete(e))}},{key:"updateInviteInfo",value:function(a){var t="".concat(this._n,".updateInviteInfo"),n=a.inviteID,o=a.inviter,i=a.inviteeList,a=a.groupID;u.l("".concat(t," inviteID:").concat(n," inviter:").concat(o," groupID:").concat(a)),a&&this.hasInviteInfo(n)?(o=i[0],(a=this.getInviteInfo(n).inviteeList).includes(o)&&(a.splice(a.indexOf(o),1),u.l("".concat(t," remove ").concat(o,". localInviteeList.length:").concat(a.length))),a.length===0&&this.deleteInviteInfo(n)):this.deleteInviteInfo(n)}},{key:"getLocalSignalingHandler",value:function(){return this._localSignalingHandler}},{key:"getRemoteSignalingHandler",value:function(){return this._remoteSignalingHandler}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(e,t){this._outerEmitter.emit(e,t)}},{key:"addSignalingListener",value:function(e,t,n){this._canIUseSignaling||(this._canIUseSignaling=!0),this._outerEmitter.on(e,t,n)}},{key:"removeSignalingListener",value:function(e,t,n){this._outerEmitter.off(e,t,n),this._outerEmitter.eventNames().length===0&&(this._canIUseSignaling=!1)}},{key:"invite",value:function(e){var t=this,n="".concat(this._n,".").concat("invite"),o=this._localSignalingHandler.createInviteInfo(e),i=o.message,a=o.customData,s=o.inviteID;return u.l("".concat(n," options:").concat(JSON.stringify(e)," inviteID:").concat(s)),this.sendSignaling(i,e).then(function(r){return r&&r.code===0?(t.setInviteInfo(s,l(l({},a),{},{message:i})),t.startTimer(l(l({},a),{},{inviteID:s})),l(l({},r),{},{inviteID:s})):r}).catch(function(r){return v(r)})}},{key:"inviteSync",value:function(e,t,n){var o=this,i="".concat(this._n,".").concat("inviteSync"),a=this._localSignalingHandler.createInviteInfo(e),s=a.message,r=a.customData,c=a.inviteID;return u.l("".concat(i," options:").concat(JSON.stringify(e)," inviteID:").concat(c)),this.sendSignaling(s,e).then(function(d){if(d&&d.code===0)return o.setInviteInfo(c,l(l({},r),{},{message:s})),o.startTimer(l(l({},r),{},{inviteID:c})),t&&t({inviteID:c}),{inviteID:c};n&&n(d.code===0,d.message||"")}).catch(function(d){return n&&n(d.code,d.message),v(d)}),c}},{key:"_handleImResponse",value:function(e,t,n){t&&t.code===0&&(this._isHandling=!1,n?this.deleteInviteInfo(e.inviteID):this.updateInviteInfo(e))}},{key:"cancel",value:function(e){var t=this,o="".concat(this._n,".").concat("cancel");if(u.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return v({code:M.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var n=this._localSignalingHandler.createCancelCustomData(e);if(!n)return this._isHandling=!1,v({code:M.SIGNALING_NO_PERMISSION});var o=n.groupID,i=n.inviteeList,o=o||i[0],i=this._localSignalingHandler.createSignalingMessage(n,o);return this.sendSignaling(i,e).then(function(a){return t._handleImResponse(n,a,!0),a.code===0?l(l({},a),{},{inviteID:e.inviteID}):a}).catch(function(a){return v(a)})}},{key:"accept",value:function(e){var t=this,n="".concat(this._n,".").concat("accept");if(u.l("".concat(n," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return v({code:M.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var o=this._localSignalingHandler.createAcceptCustomData(e);return o?(n=this._localSignalingHandler.createSignalingMessage(o),this.sendSignaling(n,e).then(function(i){return t._handleImResponse(o,i),i.code===0?l(l({},i),{},{inviteID:e.inviteID}):i}).catch(function(i){return v(i)})):(this._isHandling=!1,v({code:M.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(e){var t=this,n="".concat(this._n,".").concat("reject");if(u.l("".concat(n," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return v({code:M.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var o=this._localSignalingHandler.createRejectCustomData(e);return o?(n=this._localSignalingHandler.createSignalingMessage(o),this.sendSignaling(n,e).then(function(i){return t._handleImResponse(o,i,!0),i.code===0?l(l({},i),{},{inviteID:e.inviteID}):i}).catch(function(i){return v(i)})):(this._isHandling=!1,v({code:M.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(r){var t="".concat(this._n,".getSignalingInfo"),n=r.ID,o=r.from,i=r.to,a=this._filterSignalingMessage(r),s=null,r=(a&&(r=this._remoteSignalingHandler.getPayloadData(r),s=new ml(r)),a?"actionType:".concat(s.actionType):"");return u.l("".concat(t," messageID:").concat(n," from:").concat(o," to:").concat(i," ")+"".concat(r," isSignaling:").concat(a)),s}},{key:"modifyInvitation",value:function(i){var t=this,n=i.inviteID,o=i.data;if(!this.hasInviteInfo(i.inviteID)||this._isHandling)return v({code:M.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var i=this.getInviteInfo(n),a=i.message,s=ae(i,Al),r=a.payload.data;return s.data=o,a.payload.data=JSON.stringify(s),this.get(2).modifyRemoteMessage(a).then(function(c){return t.setInviteInfo(n,l(l({},s),{},{message:a})),t._isHandling=!1,c}).catch(function(c){return t._isHandling=!1,a.payload.data=r,v(c)})}},{key:"_genMessageControlInfo",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=o.data,e=e===void 0?"":e,t=o.onlineUserOnly,a=o.inviteID,a=a===void 0?"":a,n=o.offlinePushInfo,o=o.actionType,i={_onlineOnlyFlag:!1},a={onlineUserOnly:(i=a&&this.getInviteInfo(a)?this.getInviteInfo(a).message:i)._onlineOnlyFlag||t||!1,offlinePushInfo:n,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}};return o===Me.ACTION_TYPE_INVITE_TIMEOUT?(i=!!e.match(/excludeTimeoutSignalingFromHistoryMessage/),a.messageControlInfo.excludedFromUnreadCount=i,a.messageControlInfo.excludedFromLastMessage=i,a):(t=!!e.match(/excludeFromHistoryMessage/),n=!!e.match(/excludeOriginalSignalingFromHistoryMessage/),a.messageControlInfo.excludedFromUnreadCount=t||n,a.messageControlInfo.excludedFromLastMessage=t||n,a)}},{key:"sendSignaling",value:function(e,t){var n=this;return this.get(2).sendMessageInstance(e,this._genMessageControlInfo(t)).catch(function(o){return n._isHandling=!1,v(o)})}},{key:"filterMessageList",value:function(e){var t=this;return e.filter(function(n){return t._filterSignalingMessage(n)})}},{key:"_filterSignalingMessage",value:function(e){var t,n,o=!1;return e.type&&e.type===g.MSG_CUSTOM&&(t=e.cloudCustomData,e=(e=e.payload.data)===void 0?"":e,t=(t===void 0?"":t).match(/"type":"tsignaling"/),n=e.match(/inviteID/),e=e.match(/actionType/),o=t||n&&e),!!o}},{key:"startTimer",value:function(e){var t,n,o,i=this,a="".concat(this._n,".startTimer"),s=e.timeout,r=e.inviteID,c=e.inviter,d=e.groupID,p=c===this.getMyUserID();u.l("".concat(a," timeout:").concat(s," isInviter:").concat(p," groupID:").concat(d)),s<=0||(t=p?s+5:s,n=1,o=setInterval(function(){var _=i._hasLocalInviteInfo(e,p);n<t&&_?++n:(_&&i._sendTimeoutNotice(r,p),u.l("".concat(a," end.")),clearInterval(o))},1e3))}},{key:"_hasLocalInviteInfo",value:function(o,t){var n=o.inviteID,o=o.groupID;if(!this.hasInviteInfo(n))return!1;var i="".concat(this._n,"._hasLocalInviteInfo"),a=this.getInviteInfo(n).inviteeList;return u.l("".concat(i," inviteID:").concat(n," inviteeList:").concat(a," groupID:").concat(o)),!o||(t?0<a.length:0<a.length&&a.includes(this.getMyUserID()))}},{key:"_getReceiver",value:function(e,i){var n=i.groupID,o=i.inviteeList,i=i.inviter;return e?n||o[0]:n||i}},{key:"_sendTimeoutNotice",value:function(e,t){var n=this,o=this.getInviteInfo(e),i=this._getReceiver(t,o),a=(u.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(e," to:").concat(i," isInviter:").concat(t)),this._localSignalingHandler.createTimeoutCustomData(l(l({},o),{},{isInviter:t}))),s=this._localSignalingHandler.createSignalingMessage(a,i);return this.sendSignaling(s,a).then(function(r){var c,d,p;r&&r.code===0&&(r=a.data,c=a.groupID,d=a.inviteeList,p=a.inviter,n.emitEvent(Me.INVITATION_TIMEOUT,{data:r,groupID:c,inviteID:e,inviteeList:d,inviter:p,isSelfTimeout:!0,message:s}),t?n.deleteInviteInfo(e):n.updateInviteInfo(a))})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1}}]),qo),yl=["followTypeList"],Rt={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},Ml=(F(xo,xe),Wr=te(xo),E(xo,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("follow_req_count");D(e)||(e=Number(e),this.DEFAULT_COUNT=e>this.MAX_COUNT?this.MAX_COUNT:e,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList(),this._followType.clear()}},{key:"onFollowInfoNotify",value:function(o){var o=o.dataList||{},t=o.followAddList,t=t===void 0?[]:t,n=o.followDeleteList,n=n===void 0?[]:n,o=o.pushType,i=this._initFollowInfo();o===1?this._handleFollowAddList({followAddList:t,followInfo:i}):this._handleFollowDeleteList({followDeleteList:n,followInfo:i}),this._emitEvent(i),u.l("".concat(this._n,".onFollowInfoNotify pushType:").concat(o," followAddList:").concat(t.length," followDeleteList:").concat(n.length))}},{key:"_initFollowInfo",value:function(){var e={};return Object.values(Rt).forEach(function(t){t!==Rt.NONE&&(e[t]={userInfoList:[],isAdd:!1})}),e}},{key:"_handleFollowAddList",value:function(e){var t=this,n=e.followAddList,o=e.followInfo;n.forEach(function(i){var a=i.followTypeList,a=a===void 0?[]:a,s=ae(i,yl);a.forEach(function(r){o[r].userInfoList.push(s),o[r].isAdd=!0}),t._setFollowType(i.userID,i.followType)})}},{key:"_handleFollowDeleteList",value:function(e){var t=this,n=e.followDeleteList,o=e.followInfo;n.forEach(function(i){var a=i.followTypeList,a=a===void 0?[]:a,s=i.userID;a.forEach(function(r){o[r].userInfoList.push(s),o[r].isAdd=!1}),t._setFollowType(i.userID,i.followType)})}},{key:"_emitEvent",value:function(e){var t=this;Object.keys(e).forEach(function(o){var o=Number(o),i=e[o];0<i.userInfoList.length&&(o===Rt.FOLLOWERS&&(t._clearFollowList(Rt.FOLLOWERS),t.emitOuterEvent(K.MY_FOLLOWERS_LIST_UPDATED,i)),o===Rt.FOLLOWING&&(t._clearFollowList(Rt.FOLLOWING),t.emitOuterEvent(K.MY_FOLLOWING_LIST_UPDATED,i)),o===Rt.MUTUAL&&(t._clearFollowList(Rt.MUTUAL),t.emitOuterEvent(K.MUTUAL_FOLLOWERS_LIST_UPDATED,i)))})}},{key:"followUser",value:function(e){if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility("followUser");var t="".concat(this._n,".").concat("followUser"),n="userIDList:".concat(e.length),o=new R("followUser");return o.setMessage(n),u.l("".concat(t," ").concat(n)),this.req({proto:h.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e.map(function(i){return{userID:i}})}}).then(function(i){return o.end(),u.l("".concat(t," ok.")),V(i.data.resultList)}).catch(function(i){return o.setError(i).end(),u.e("".concat(t," failed. error:"),i),v(i)})}},{key:"unfollowUser",value:function(e){if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility("unfollowUser");var t="".concat(this._n,".").concat("unfollowUser"),n="userIDList:".concat(e.length),o=new R("unfollowUser");return o.setMessage(n),u.l("".concat(t," ").concat(n)),this.req({proto:h.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then(function(i){return o.end(),u.l("".concat(t," ok.")),V(i.data.resultList)}).catch(function(i){return o.setError(i).end(),u.e("".concat(t," failed. error:"),i),v(i)})}},{key:"getMyFollowersList",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",n="getMyFollowersList";if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility(n);var o=t||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(o)){var s=this._myFollowersList.get(o),i=s.resultList,a=s.nextCursor,a=a===void 0?"":a,s=s.lastUpdateTime;if(Date.now()-s<this.MAX_CATCH_TIME&&0<i.length)return u.l("".concat(this._n,".").concat(n," startCursor:").concat(o," from local.")),$({resultList:i,nextCursor:a})}return this._getFollowList(t,Rt.FOLLOWERS).then(function(r){return e._myFollowersList.set(o,l(l({},r),{},{lastUpdateTime:Date.now()})),u.l("".concat(e._n,".").concat(n," startCursor:").concat(o," from remote.")),V(r)})}},{key:"getMyFollowingList",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",n="getMyFollowingList";if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility(n);var o=t||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(o)){var s=this._myFollowingList.get(o),i=s.resultList,a=s.nextCursor,s=s.lastUpdateTime;if(Date.now()-s<this.MAX_CATCH_TIME&&0<i.length)return u.l("".concat(this._n,".").concat(n," startCursor:").concat(o," from local.")),$({resultList:i,nextCursor:a})}return this._getFollowList(t,Rt.FOLLOWING).then(function(r){return e._myFollowingList.set(o,l(l({},r),{},{lastUpdateTime:Date.now()})),u.l("".concat(e._n,".").concat(n," startCursor:").concat(o," from remote.")),V(r)})}},{key:"getMutualFollowersList",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",n="getMutualFollowersList";if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility(n);var o=t||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(o)){var s=this._myMutualFollowersList.get(o),i=s.resultList,a=s.nextCursor,s=s.lastUpdateTime;if(Date.now()-s<this.MAX_CATCH_TIME&&0<i.length)return u.l("".concat(this._n,".").concat(n," startCursor:").concat(o," from local.")),$({resultList:i,nextCursor:a})}return this._getFollowList(t,Rt.MUTUAL).then(function(r){return e._myMutualFollowersList.set(o,l(l({},r),{},{lastUpdateTime:Date.now()})),u.l("".concat(e._n,".").concat(n," startCursor:").concat(o," from remote.")),V(r)})}},{key:"_getFollowList",value:function(e,t){var n=this,o=new R("_getFollowList");return o.setMessage("startCursor:".concat(e," type:").concat(t)),this.req({proto:h.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,startCursor:e,type:t}}).then(function(s){o.end();var s=s.data,a=s.resultList,a=a===void 0?[]:a,s=s.nextCursor,s=s===void 0?"":s,r=[];return a.forEach(function(_){var d=_.userID,p=_.followTime,_=_.profileList;r.push(l({userID:d,followTime:p},n._handleProfileItem(_===void 0?[]:_)))}),{resultList:r,nextCursor:s}}).catch(function(i){return o.setError(i).end(),u.e("".concat(n._n,"._getFollowList failed. error:"),i),v(i)})}},{key:"_handleProfileItem",value:function(e){var t={};return e.forEach(function(n){switch(n.tag){case k.NICK:t.nick=n.value;break;case k.GENDER:t.gender=n.value;break;case k.BIRTHDAY:t.birthday=n.value;break;case k.LOCATION:t.location=n.value;break;case k.SELFSIGNATURE:t.selfSignature=n.value;break;case k.ALLOWTYPE:t.allowType=n.value;break;case k.LANGUAGE:t.language=n.value;break;case k.AVATAR:t.avatar=n.value;break;case k.MESSAGESETTINGS:t.messageSettings=n.value;break;case k.ADMINFORBIDTYPE:t.adminForbidType=n.value;break;case k.LEVEL:t.level=n.value;break;case k.ROLE:t.role=n.value;break;default:t[n.tag]=n.value}}),t}},{key:"getUserFollowInfo",value:function(i){if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility("getUserFollowInfo");var t=i,n=!1,o=(D(i)&&(t=[this.getMyUserID()],n=!0),"".concat(this._n,".").concat("getUserFollowInfo")),i="userIDList:".concat(t.length," isGetMyFollowInfo:").concat(n),a=new R("getUserFollowInfo");return a.setMessage(i),u.l("".concat(o," ").concat(i)),this.req({proto:h.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then(function(r){a.end(),u.l("".concat(o," ok."));var r=r.data.followInfoList,c=[];return(r===void 0?[]:r).forEach(function(m){var p=m.followersCount,_=m.followingCount,m=m.mutualFollowersCount;c.push({followersCount:p,followingCount:_,mutualFollowersCount:m})}),V(c)}).catch(function(s){return a.setError(s).end(),u.e("".concat(o," failed. error:"),s),v(s)})}},{key:"checkFollowType",value:function(e){var t=this;if(!this.canIUse(Ce.FOLLOW))return this.cannotUseCommercialAbility("checkFollowType");100<e.length&&(e=e.slice(0,100),u.w("".concat(n," ").concat(En(100))));var n="".concat(this._n,".").concat("checkFollowType"),o="userIDList length:".concat(e.length," "),i=new R("checkFollowType"),a=(i.setMessage(o),u.l("".concat(n," ").concat(o)),[]),s=[];return e.forEach(function(r){var c;t._followType.has(r)?(c=t._followType.get(r),a.push({userID:r,followType:c})):s.push(r)}),u.l("".concat(n," from local count:").concat(a.length,", from remote count:").concat(s.length,".")),s.length===0?$(a):this.req({proto:h.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:s}}).then(function(r){return i.end(),u.l("".concat(n," ok.")),r=r.data.resultList,(r===void 0?[]:r).forEach(function(p){var d=p.userID,p=p.followType;t._setFollowType(d,p),a.push({userID:d,followType:p})}),V(a)}).catch(function(r){return i.setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"_setFollowType",value:function(e,t){this._followType.set(e,t)}},{key:"_clearFollowList",value:function(e){if(D(e))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();e!==Rt.FOLLOWERS?e!==Rt.FOLLOWING?e!==Rt.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._clearFollowList(),this._followType.clear()}}]),xo),Cl=(E(ys,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(24),t=e.isWorkerEnabled();u.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),u.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(24),t=e.isWorkerEnabled();u.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){u.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){u.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){u.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){u.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){u.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=Re(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=z(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(o){t.e(o)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(1)],this._readyList.forEach(function(t){t.ready(function(){return e._onModuleReady()})})}},{key:"_onModuleReady",value:function(){var e,t,n=!0;this._readyList.forEach(function(o){o.isReady()||(n=!1)}),n&&!this._isReady&&(this._isReady=!0,this._outerEmitter.emit(K.SDK_READY),e=Date.now()-this._startLoginTs,u.w("SDK is ready. cost ".concat(e," ms")),this._startLoginTs=Date.now(),t=this._ssoLogForReady.getStartTs()+nn,this._ssoLogForReady.setMessage(e).start(t).end())}},{key:"login",value:function(){this._startLoginTs===0&&(gn(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(15).start(),this._ssoLogForReady=new R("sdkReady"),this._reason=M.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return this._outerEmitter===null&&(this._outerEmitter=new ss,e=this._outerEmitter,kn=e,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(t,n){var o,i,a=this;this._canIUseSignaling()&&(t===K.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(n),t===K.MESSAGE_MODIFIED&&this.get(33).onMessageModified(n)),t===K.CONVERSATION_LIST_UPDATED||t===K.FRIEND_LIST_UPDATED||t===K.GROUP_LIST_UPDATED||t===K.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._eventThrottling!==!1?this._eventThrottleMap.has(t)?(o=Date.now())-(i=this._eventThrottleMap.get(t)).last<=1e3?(i.timeoutID&&clearTimeout(i.timeoutID),i.timeoutID=setTimeout(function(){i.last=Date.now(),a._outerEmitter._emit.apply(a._outerEmitter,[t,{name:t,data:a._getEventData(t)}])},1e3)):(i.last=o,this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}])):(this._eventThrottleMap.set(t,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}])):this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}]):this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:n}])}.bind(this)),this._outerEmitter;var e}},{key:"_canIUseSignaling",value:function(){var e=this.get(33);return!!e&&e.canIUseSignaling()}},{key:"_getEventData",value:function(e){return e===K.CONVERSATION_LIST_UPDATED?this._moduleMap.get(11).getLocalConversationList():e===K.FRIEND_LIST_UPDATED?this._moduleMap.get(8).getLocalFriendList(!1):e===K.GROUP_LIST_UPDATED?this._moduleMap.get(7).getLocalGroupList():e===K.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(11).getTotalUnreadMessageCount():void 0}},{key:"getInnerEmitterInstance",value:function(){return this._innerEmitter===null&&(this._innerEmitter=new ss,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){e=Ie(t)&&t.data?[e,{name:e,data:t.data}]:[e,{name:e,data:t}],this._innerEmitter._emit.apply(this._innerEmitter,e)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"get",value:function(e){return this._moduleMap.get(e)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(32).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){e=this.getErrorMessage(e,t,n),e&&u.w(e)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);u.w("Oops! ".concat(t)),new R("error").setMessage(t).setLevel("error").end(),this.getOuterEmitterInstance().emit(K.ERROR,e)}},{key:"restartTimer",value:function(){u.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var e=this.get(7);e&&e.restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._moduleMap.get(7).getPollingTimerID(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),gn();var e,t=Re(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=z(e.value,2)[1];n.reset&&n.reset()}}catch(s){t.e(s)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(K.SDK_NOT_READY);var o,i=Re(this._eventThrottleMap);try{for(i.s();!(o=i.n()).done;){var a=z(o.value,2)[1];a.timeoutID&&clearTimeout(a.timeoutID)}}catch(s){i.e(s)}finally{i.f()}this._eventThrottleMap.clear()}}]),ys),Tl=(E(Is,[{key:"defense",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0;if(typeof e!="string"||e.length===0||typeof t!="function")return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(e,t,n),this._funcMap.get(e).set(t,o)),o}},{key:"defenseOnce",value:function(e,t){return typeof t!="function"?null:this._pack(e,t,2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0)}},{key:"find",value:function(e,t){return typeof e!="string"||e.length===0||typeof t!="function"?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return typeof t=="function"&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),this._funcMap.get(e).size===0&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var o=this;return function(){try{t.apply(n,Array.from(arguments))}catch(s){var i=Object.values(K).indexOf(e),a="CallbackError";i!==-1&&(i=Object.keys(K)[i],o._m.outputWarning(a,i,s)),o._reportCount<5&&(new R(a).setMessage("eventName:".concat(e)).setMoreMessage(s.message).end(),o._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._reportCount=0}}]),Is),Dl=(E(As,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._get(1).login(e)}},{key:"logout",value:function(){var e=this;return this._get(1).logout().then(function(t){return e._safetyCallbackFactory.reset(),e._m.reset(),t})}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_get",value:function(e){return this._m.get(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally(function(){e._safetyCallbackFactory.destroy(),e._m.stopTimer(),e._get(24).terminate(),e._get(21).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._get(12);t.emit(K.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})})}},{key:"on",value:function(e,t,n){u.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){u.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,o){u.d("off","eventName:".concat(e));var i=this._safetyCallbackFactory.find(e,t);i!==null&&(this._m.getOuterEmitterInstance().off(e,i,n,o),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){(D(e["tim-push"])?D(e["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(e)}},{key:"setLogLevel",value:function(e){var t;e<=0&&(t=this.getErrorMessage("TIM_ASCII_ART"),(t=this.getErrorMessage("API_REFER"))&&($i()&&"%c ".concat("IM SDK API ->"," %c")),t=this.getErrorMessage("DOCS_GUIDE"),t=this.getErrorMessage("IOS_WEBVIEW_WARNING"),en&&t&&console.warn(t)),u.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._get(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._get(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._get(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._get(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._get(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._get(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._get(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._get(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==g.MSG_MERGER?v({code:M.MSG_MERGER_TYPE_INVALID}):L(e.payload.downloadKey)?v({code:M.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(e).catch(function(t){return v({code:M.MSG_MERGER_DOWNLOAD_FAIL})})}},{key:"createForwardMessage",value:function(e){return this._get(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof Xe?this._get(2).sendMessageInstance(e,t):v({code:M.MSG_INSTANCE_REQUIRED})}},{key:"searchCloudMessages",value:function(e){return this._get(2).searchCloudMessages(e)}},{key:"callExperimentalAPI",value:function(e,t){return e==="sendComboMessage"?this._get(31).sendMessage(t):e==="handleGroupInvitation"?this._get(7).handleGroupInvitation(t):e==="isCommercialAbilityEnabled"?this._get(27).isFeatureEnabled(t):e==="isFeatureEnabledForStat"?this._get(27).isFeatureEnabledForStat(t):e==="isIntl"?this.isIntl():e==="sendTRTCCustomData"||e==="sendRoomCustomData"?this._get(30).sendTRTCCustomData(t):e==="getTimerID"?this._m.getTimerID():e==="getPollingTimerID"?this._m.getPollingTimerID(t):e==="setApplicationID"?(this._get(12).setApplicationID(t),void this._get(20).updateProtocolConfig()):e==="getServerConfig"?this._get(23).getServerConfig(t):v({code:M.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._get(2).revokeMessage(e)}},{key:"resendMessage",value:function(e,t){return e instanceof Xe?this._get(2).resendMessage(e,t):v({code:M.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(e){return this._get(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._get(2).translateText(e)}},{key:"convertVoiceToText",value:function(e){return this._get(2).convertVoiceToText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._get(3).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._get(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._get(3).deleteMessageExtensions(e,t)}},{key:"addMessageReaction",value:function(e,t){return this._get(34).addMessageReaction(e,t)}},{key:"removeMessageReaction",value:function(e,t){return this._get(34).removeMessageReaction(e,t)}},{key:"getMessageReactions",value:function(e){return this._get(34).getMessageReactions(e)}},{key:"getAllUserListOfMessageReaction",value:function(e){return this._get(34).getAllUserListOfMessageReaction(e)}},{key:"modifyMessage",value:function(e){return this._get(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._get(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._get(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._get(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._get(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){var t=this._get(7);return t?t.getReadReceiptDetail(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"findMessage",value:function(e){return this._get(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._get(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._get(11).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._get(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._get(11).deleteConversation(e)}},{key:"setConversationDraft",value:function(e){return this._get(11).setConversationDraft(e)}},{key:"clearHistoryMessage",value:function(e){return this._get(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._get(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._get(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._get(11).setMessageRemindType(e)}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._get(11).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._get(11).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._get(11).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._get(11).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._get(11).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._get(11).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._get(11).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._get(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._get(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._get(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._get(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._get(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._get(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._get(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._get(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._get(8);return e?e.getLocalFriendList():v({code:M.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._get(8);return t?t.addFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._get(8);return t?t.deleteFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._get(8);return t?t.checkFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._get(8);return t?t.getFriendProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._get(8);return t?t.updateFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._get(8);return e?e.getLocalFriendApplicationList():v({code:M.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._get(8);return t?t.acceptFriendApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._get(8);return t?t.refuseFriendApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._get(8);return t?t.deleteFriendApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._get(8);return e?e.setFriendApplicationRead():v({code:M.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._get(8);return e?e.getLocalFriendGroupList():v({code:M.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._get(8);return t?t.createFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._get(8);return t?t.deleteFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._get(8);return t?t.addToFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._get(8);return t?t.removeFromFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._get(8);return t?t.renameFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"followUser",value:function(e){var t=this._get(35);return t?t.followUser(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"unfollowUser",value:function(e){var t=this._get(35);return t?t.unfollowUser(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getMyFollowersList",value:function(e){var t=this._get(35);return t?t.getMyFollowersList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getMyFollowingList",value:function(e){var t=this._get(35);return t?t.getMyFollowingList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getMutualFollowersList",value:function(e){var t=this._get(35);return t?t.getMutualFollowersList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getUserFollowInfo",value:function(e){var t=this._get(35);return t?t.getUserFollowInfo(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"checkFollowType",value:function(e){var t=this._get(35);return t?t.checkFollowType(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(){var e=this._get(7);return e?e.getGroupList():v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupProfile",value:function(e){var t=this._get(7);return t?t.getGroupProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"createGroup",value:function(e){var t=this._get(7);return t?t.createGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"dismissGroup",value:function(e){var t=this._get(7);return t?t.dismissGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"updateGroupProfile",value:function(e){var t=this._get(7);return t?t.updateGroupProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"joinGroup",value:function(e){var t=this._get(7);return t?t.joinGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"quitGroup",value:function(e){var t=this._get(7);return t?t.quitGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"searchGroupByID",value:function(e){var t=this._get(7);return t?t.searchGroupByID(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._get(7);return t?t.getGroupOnlineMemberCount(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"changeGroupOwner",value:function(e){var t=this._get(7);return t?t.changeGroupOwner(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupApplicationList",value:function(){var e=this._get(7);return e?e.getGroupApplicationList():v({code:M.CANNOT_FIND_MODULE})}},{key:"handleGroupApplication",value:function(e){var t=this._get(7);return t?t.handleGroupApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"initGroupAttributes",value:function(e){var t=this._get(7);return t?t.initGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupAttributes",value:function(e){var t=this._get(7);return t?t.setGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteGroupAttributes",value:function(e){var t=this._get(7);return t?t.deleteGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupAttributes",value:function(e){var t=this._get(7);return t?t.getGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupCounters",value:function(e){var t=this._get(7);return t?t.setGroupCounters(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"increaseGroupCounter",value:function(e){var t=this._get(7);return t?t.increaseGroupCounter(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"decreaseGroupCounter",value:function(e){var t=this._get(7);return t?t.decreaseGroupCounter(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupCounters",value:function(e){var t=this._get(7);return t?t.getGroupCounters(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupMemberList",value:function(e){var t=this._get(7);return t?t.getGroupMemberList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupMemberProfile",value:function(e){var t=this._get(7);return t?t.getGroupMemberProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"addGroupMember",value:function(e){var t=this._get(7);return t?t.addGroupMember(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteGroupMember",value:function(e){var t=this._get(7);return t?t.deleteGroupMember(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberMuteTime",value:function(e){var t=this._get(7);return t?t.setGroupMemberMuteTime(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberRole",value:function(e){var t=this._get(7);return t?t.setGroupMemberRole(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberNameCard",value:function(e){var t=this._get(7);return t?t.setGroupMemberNameCard(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberCustomField",value:function(e){var t=this._get(7);return t?t.setGroupMemberCustomField(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"markGroupMemberList",value:function(e){var t=this._get(7);return t?t.markGroupMemberList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._get(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._get(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._get(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._get(10).getTopicList(e)}},{key:"addSignalingListener",value:function(e,t,n){var o=this._get(33);o&&o.addSignalingListener(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"removeSignalingListener",value:function(e,t,n){var o,i=this._safetyCallbackFactory.find(e,t);i===null||(o=this._get(33))&&(o.removeSignalingListener(e,i,n),this._safetyCallbackFactory.delete(e,t))}},{key:"invite",value:function(e){var t=this._get(33);return t?t.invite(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"inviteSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"inviteInGroup",value:function(e){var t=this._get(33);return t?t.invite(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"inviteInGroupSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"cancel",value:function(e){var t=this._get(33);return t?t.cancel(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"accept",value:function(e){var t=this._get(33);return t?t.accept(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"reject",value:function(e){var t=this._get(33);return t?t.reject(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getSignalingInfo",value:function(e){var t=this._get(33);return t?t.getSignalingInfo(e):null}},{key:"modifyInvitation",value:function(e){var t=this._get(33);return t?t.modifyInvitation(e):v({code:M.CANNOT_FIND_MODULE})}}]),As),Sl={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function As(e){S(this,As),e={SDKAppID:e.SDKAppID,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,instanceID:pi(),devMode:e.devMode||!1,testEnv:e.testEnv||!1,proxyServer:e.proxyServer||void 0,fileUploadProxy:e.fileUploadProxy||void 0,fileDownloadProxy:e.fileDownloadProxy||e.fileUploadProxy||void 0,eventThrottling:e.eventThrottling||!1,modules:e.modules||void 0},this._m=new Cl(e),this._vendorMap=new Map,this._safetyCallbackFactory=new Tl(this._m)}function Is(e){S(this,Is),this._funcMap=new Map,this._m=e,this._n="SafetyCallback",this._reportCount=0}function ys(e){var t=this;S(this,ys);var n,o=new R("sdkConstruct"),r=(this._n="ModuleManager",this._isReady=!1,this._reason=M.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(12,new du(this,e)),this._moduleMap.set(15,new mu(this)),this._moduleMap.set(27,new cl(this)),this._moduleMap.set(23,new Ju(this)),this._moduleMap.set(24,new sl(this)),this._moduleMap.set(26,new tl(this)),this._moduleMap.set(21,new xu(this)),this._moduleMap.set(20,new ju(this)),this._moduleMap.set(1,new gu(this)),this._moduleMap.set(2,new Su(this)),this._moduleMap.set(3,new Eu(this)),this._moduleMap.set(34,new Lu(this)),this._moduleMap.set(31,new ku(this)),this._moduleMap.set(4,new lu(this)),this._moduleMap.set(6,new Fc(this)),this._moduleMap.set(11,new Yc(this)),this._moduleMap.set(7,new ou(this)),this._moduleMap.set(10,new su(this)),this._moduleMap.set(13,new hu(this)),this._moduleMap.set(32,new gl(this)),this._moduleMap.set(14,new fu(this)),this._moduleMap.set(17,new Au(this)),this._moduleMap.set(18,new Ru(this)),this._moduleMap.set(19,new Nu(this)),this._moduleMap.set(25,new Xu(this)),this._moduleMap.set(8,new al(this)),this._moduleMap.set(28,new ul(this)),this._moduleMap.set(36,new ll(this)),this._moduleMap.set(29,new dl(this)),this._moduleMap.set(30,new pl(this)),this._moduleMap.set(33,new Il(this)),this._moduleMap.set(35,new Ml(this)),this._eventThrottleMap=new Map,this._eventThrottling=e.eventThrottling,Ie(e.modules)?(Object.keys(e.modules).forEach(function(c){n=e.modules[c],c==="group-module"?t._moduleMap.set(7,new n(t)):c==="relationship-module"?t._moduleMap.set(8,new n(t)):c==="signaling-module"?t._moduleMap.set(33,new n(t)):c==="follow-module"&&t._moduleMap.set(35,new n(t))}),this._moduleMap.get(12).setUsingChatCore(!0)):this._moduleMap.has(7)||this._moduleMap.get(12).setUsingChatCore(!0),e.instanceID),i=e.SDKAppID,a=this._moduleMap.get(12).isIntl(),s=this._moduleMap.get(12).isUsingChatCore(),r="instanceID:".concat(r," SDKAppID:").concat(i," isIntl:").concat(a," isUsingChatCore:").concat(s," host:").concat(gi()," isIOSWebView:").concat(en)+" inBrowser:".concat(Ke," inMiniApp:").concat(me)+" workerAvailable:".concat(St," UserAgent:").concat(Be);R.bindEventStatModule(this._moduleMap.get(14)),R.bindNetMonitorModule(this._moduleMap.get(15)),o.setMessage("".concat(r," ").concat(function(){var c="";if(me)try{var d=fe.getSystemInfoSync(),p=d.model,_=d.version,m=d.system,f=d.platform,I=d.SDKVersion,c="model:".concat(p," version:").concat(_," system:").concat(m," platform:").concat(f," SDKVersion:").concat(I)}catch{c=""}return c}())).end(),u.i("SDK ".concat(r)),Oe.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function xo(e){return S(this,xo),(e=Wr.call(this,e))._n="FollowModule",e._myFollowersList=new Map,e._myFollowingList=new Map,e._myMutualFollowersList=new Map,e._followType=new Map,e.MAX_CATCH_TIME=6e5,e.FIRST_PAGE_INDEX=ci(),e.DEFAULT_COUNT=500,e.MAX_COUNT=1e3,e.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function qo(e){return S(this,qo),(e=Yr.call(this,e))._n="SignalingModule",e._inviteInfoMap=new Map,e._outerEmitter=new ss,e._outerEmitter._emit=e._outerEmitter.emit,e._outerEmitter.emit=function(){this._outerEmitter._emit.apply(this._outerEmitter,[].concat([arguments.length<=0?void 0:arguments[0],{name:arguments.length<=0?void 0:arguments[0],data:arguments.length<=1?void 0:arguments[1]}]))}.bind(X(e)),e._canIUseSignaling=!1,e._isHandling=!1,e._remoteSignalingHandler=new hl(X(e)),e._localSignalingHandler=new _l(X(e)),e._historySignalingHandler=new fl(X(e)),e._isC2CUnreadHandleCompleted=!1,e._isConvSyncCompleted=!1,e._isSyncCompleted=!1,e.getInnerEmitterInstance().on(we.C2C_UNREAD_HANDLE_COMPLETED,e.onC2CUnreadHandleCompleted,X(e)),e.getInnerEmitterInstance().on(we.CONV_SYNC_COMPLETED,e.onConvSyncCompleted,X(e)),e}function Ms(e){S(this,Ms),this._n="HistorySignalingHandler",this._sigM=e,this.EXPIRED_TIME=3e4,this.COUNT=20,this._signalingMap=new Map,this._signalingRelatedToMeMap=new Map}function Cs(e){S(this,Cs),this._n="LocalSignalingHandler",this._sigM=e}function Ts(e){S(this,Ts),this._n="RemoteSignalingHandler",this._sigM=e}function Ds(e){S(this,Ds),this._m=e,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function Ss(e){S(this,Ss),this._m=e,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function Vo(e){return S(this,Vo),(e=zr.call(this,e))._n="ProfanityFilterModule",e._plugin=null,e._filterConfigMap=new Map,e._startIndex=0,e._version=0,e._canIUseLexicon=!1,e._isFetching=!1,e._expiredTime=0,e}function Bo(e){var t;return S(this,Bo),(t=jr.call(this,e))._m=e,t._n="TIMPushModule",t._pluginName="TIMPush",t._pushPlugin=void 0,t._androidPushConfig={},t._deviceToken="",t._businessID=0,t._iOSBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},t}function Ho(e){var t;return S(this,Ho),(t=Jr.call(this,e))._m=e,t._n="OfflinePushModule",t._offlinePushPlugin=void 0,t._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},t._deviceToken="",t._businessID=0,t._iosBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t}function Es(e){S(this,Es),this._m=e,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new rl(this)}function Ls(e){S(this,Ls),this._commercialConfigM=e,this._n="PurchasedFeatureHandler",this._featureMap=new Map}function Ko(e){return S(this,Ko),(e=Xr.call(this,e))._n="WorkerTimerModule",e._isWorkerEnabled=!0,e._workerTimer=null,e._timerID=-1,e._init(),e.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function Wo(e){return S(this,Wo),(e=Zr.call(this,e))._n="SnsModule",e._friendHandler=new ol(X(e)),e._friendApplicationHandler=new nl(X(e)),e._friendGroupHandler=new il(X(e)),e.getInnerEmitterInstance().on(we.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,X(e)),e}function ks(e){S(this,ks),this._snsM=e,this._n="FriendGroupHandler",this._friendGroupMap=new Map}function Rs(e){S(this,Rs),L(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}function Ns(e){S(this,Ns),this._snsM=e,this._n="FriendHandler",this._friendMap=new Map,this._startIndex=0,this._standardSequence=0,this._customSequence=0,this._expirationTime=18e4}function Os(e,t){S(this,Os),this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var n={},o=[];if(n.userID=e,!L(t))for(var i,a="",s=0,r=t.length;s<r;s++)if(a=t[s].tag,i=t[s].value,-1<a.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:a,value:i});else if(-1<a.indexOf("Tag_Profile_Custom"))o.push({key:a,value:i});else switch(a){case k.NICK:n.nick=i;break;case k.GENDER:n.gender=i;break;case k.BIRTHDAY:n.birthday=i;break;case k.LOCATION:n.location=i;break;case k.SELFSIGNATURE:n.selfSignature=i;break;case k.ALLOWTYPE:n.allowType=i;break;case k.LANGUAGE:n.language=i;break;case k.AVATAR:n.avatar=i;break;case k.MESSAGESETTINGS:n.messageSettings=i;break;case k.ADMINFORBIDTYPE:n.adminForbidType=i;break;case k.LEVEL:n.level=i;break;case k.ROLE:n.role=i;break;case Y.REMARK:this.remark=i;break;case Y.ADDTIME:this.addTime=i;break;case Y.GROUP:this.groupList=JSON.parse(JSON.stringify(i));break;case Y.ADDSOURCE:this.source=i;break;case Y.ADDWORDING:break;default:u.l("snsProfileItem unknown tag->",t[s].tag)}this.profile=new Mo(l(l({},n),{},{profileCustomField:o}))}function Gs(e){S(this,Gs),this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSequence=0,this._friendApplicationMap=new Map,this._unreadCount=0}function Yo(e){S(this,Yo),(e=Qr.call(this,e))._n="QualityStatModule",e.TAG="im-ssolog-quality-stat",e.reportIndex=0,e.wholePeriod=!1,e._qualityItems=[sa,ra,jn,Jn,Xn,Rn,Tt,Zn,vo,Ao],e._messageSentItems=[jn,Jn,Xn,Rn,Tt],e._messageReceivedItems=[Zn,vo,Ao],e.REPORT_INTERVAL=120,e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._statInfoArr=[],e._avgRTT=new Qu,e._avgE2EDelay=new Zu,e._rateMessageSent=new $u,e._rateMessageReceived=new el;var t=e.getInnerEmitterInstance();return t.on(we.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,X(e)),t.on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}function Ps(){S(this,Ps),this._lastMap=new Map,this._currentMap=new Map}function bs(){S(this,bs),this._map=new Map}function Us(){S(this,Us),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function ws(){S(this,ws),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function zo(e){return S(this,zo),(e=$r.call(this,e))._n="RecoverMessageModule",e.PULL_LIMIT_COUNT=15,e}function jo(e){return S(this,jo),(e=ec.call(this,e))._n="CloudControlModule",e._cloudConfig=new Map,e._expiredTime=0,e._version=0,e._isFetching=!1,e}function Jo(e){return S(this,Jo),(e=tc.call(this,e))._n="SessionModule",e._platform=e.getPlatform(),e._protocolHandler=new Bu(X(e)),e._messageDispatcher=new Ku(X(e)),e._commandFrequencyLimitMap=new Map,e._commandRequestInfoMap=new Map,e._serverOverloadInfoMap=new Map,e._incrementalPullContactFlag=!0,e._init(),e.getInnerEmitterInstance().on(we.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,X(e)),e}var Xo={},w={};return w.create=function(s){var t="TencentCloudChat.create",n=0,a=s.SDKAppID;if(ge(a))n=a;else if(n=parseInt(a),isNaN(a))return u.e("".concat(t," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(n&&Xo[n])return Xo[n];u.l("".concat(t));var o,i,a=new Dl(l(l({},s),{},{SDKAppID:n})),s=(a.on(K.SDK_DESTROY,function(r){Xo[r.data.SDKAppID]=null,delete Xo[r.data.SDKAppID]}),o=a,i=Object.create(null),Object.keys(Oc).forEach(function(r){var c;o[r]&&(c=new Vt,i[r]=function(){var d=Array.from(arguments);return c.use(function(p,_){var m=function(f,I){if(f.isReady()||Sl[I]===1)return!0;var N={code:N=f.getNotReadyReason(),message:"".concat(f.getErrorMessage(N)," | ").concat(I," | ").concat(f.getErrorMessage(M.SDK_IS_NOT_READY))};return f.onError(N),N}(o,r);return m===!0?_():v(m)}).use(function(p,_){if(function(m,f,I){if(f===void 0)return!0;var N=!0;if(Ie(f))Object.keys(f).forEach(function(H){var Z=m.length===1?m[0][H]:void 0;N=!!cr(Z,f[H],I,H)&&N});else if(q(f))for(var P=0;P<f.length;P++)N=!!cr(m[P],f[P],I,f[P].name)&&N;if(N)return N;throw new Error("Params validate failed.")}(p,_r[r],r)===!0)return _()}).use(function(p,_){return o[r].apply(o,p)}),c.run(d)})}),i);return Xo[n]=s,_r.hookGetAPITips(a.getErrorMessage.bind(a)),u.l("".concat(t," ok")),s},w.TYPES=g,w.EVENT=K,w.TSignaling=Me,w.VERSION="3.2.9",u.l("TencentCloudChat.VERSION:".concat(w.VERSION)),w})})(Nc);const Fi=Nc.exports;Zs();const Ze=io();class Zg{constructor(y){$o(this,"chat");$o(this,"sdkAppId");$o(this,"userId");$o(this,"userSig");const{sdkAppId:C,userId:l,userSig:G}=y;this.sdkAppId=C,this.chat=null,this.userId=l,this.userSig=G,this.initChat()}async initChat(){this.chat=await Fi.create({SDKAppID:this.sdkAppId}),this.join()}async join(){this.chat.login({userID:this.userId,userSig:this.userSig}).then(C=>{setTimeout(()=>{this.listenIn(),this.getMessageRead(),setTimeout(()=>{this.getConversationList()},200)},400),C.data,C.data.repeatLogin===!0&&C.data.errorInfo}).catch(function(C){console.warn("login error:",C)})}getConversationList(){this.chat.getConversationList().then(function(C){const l=C.data.conversationList;l.length>=1,l.length>=1?(Ze.aiList=[],l.forEach(G=>{G.userProfile&&G.userProfile.nick!="PushBot"&&(typeof G.lastMessage.payload.data=="string"&&(G.lastMessage.payload.data=JSON.parse(G.lastMessage.payload.data)),isNaN(G.lastMessage.lastTime)||(G.lastMessage.lastTime=rc(G.lastMessage.lastTime)),G.lastMessage.content=G.lastMessage.payload.text?G.lastMessage.payload.text:G.lastMessage.payload.data.content,Ze.aiList.push(G))}),Ze.aiInfo.ai_uid&&(Ze.isAI=Ze.aiList.some(G=>G.userProfile.userID===Ze.aiInfo.ai_uid))):Ze.aiInfo.ai_uid&&(Ze.isAI=!1)}).catch(function(C){console.warn("getConversationList error:",C)})}deleteConversation(y,C){this.chat.deleteConversation(y).then(function(G){G.data,Ze.aiList.splice(C,1)}).catch(function(G){console.warn("deleteConversation error:",G)})}getMessageRead(){if(!Ze.aiInfo.ai_uid)return!1;setTimeout(()=>{this.getConversationList()},200),this.chat.setMessageRead({conversationID:"C2C"+Ze.aiInfo.ai_uid}),this.chat.getMessageList({conversationID:"C2C"+Ze.aiInfo.ai_uid}).then(C=>{C.data.messageList.forEach(G=>{Ze.originalData.push(G),this.setList(Gi(G))})})}onMessageReceived(y){y.data.forEach(l=>{l.type===Fi.TYPES.MSG_CUSTOM&&(Ze.originalData.push(l),this.setList(l))})}sendToAiText(y){const C=this.chat.createCustomMessage({to:Ze.aiInfo.ai_uid,conversationType:Fi.TYPES.CONV_C2C,payload:{data:JSON.stringify(y),description:String(this.random(1,6)),extension:""}});this.chat.sendMessage(C).then(function(G){}).catch(function(G){console.warn("sendMessage error:",G)})}random(y,C){return Math.floor(Math.random()*(C-y+1)+y)}listenIn(){this.chat.on(Fi.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this))}setList(y){try{Ze.isSend=0,y._elements.forEach((C,l)=>{if(!C.content.data||(C.content.data,C.content.data=JSON.parse(C.content.data),C.content.data.extra==null))return!1;(C.content.data.extra.dataType=="text"||C.content.data.extra.dataType=="audio"||C.content.data.extra.dataType=="image")&&(C.content.data.is_ai_reply=!0,C.to=y.to,Wl(y.time)!=""&&(C.time=rc(y.time)),Ze.chatList.push(C),Ze.chatList)})}catch{}}modifyMessage(y){Ze.chatList[y];const C=Gi(Ze.chatList[y]),l=JSON.stringify(C.content.data),G=Gi(Ze.originalData[y]);G.payload.data=l,G._elements[0].content.data=l,this.chat.modifyMessage(G).then(B=>{B.data}).catch(function(B){})}deleteMessage(y){const C=Gi(Ze.originalData[y]);this.chat.deleteMessage([C]).then(G=>{this.modifyMessage(y)}).catch(function(G){console.warn("\u5220\u9664\u6D88\u606F\u5931\u8D25deleteMessage error:",G)})}}const Qg={class:"light-green",style:{background:"#13102b",height:"100%",position:"relative",overflow:"scroll"}},$g={class:"light-green",style:{background:"#18143c",height:"100%",position:"relative"}},ah=st({__name:"chatView",setup(A){const y=Zs(),C=io();return C.chatList=[],C.isSend=0,ao(async()=>{y.Token!=""&&(await C.getInitIm(),C.chatIm=await new Zg({sdkAppId:C.sdkAppId,userId:y.userInfo.uid,userSig:C.init.userSig}))}),(l,G)=>(re(),he(xt,null,[ft(ce(ep),{"h-100p":"","overflow-hidden":"","x-gap":"0",cols:24},{default:Kt(()=>[ft(ce(wi),{span:5,style:{background:"#18143c",height:"100%",position:"relative"}},{default:Kt(()=>[ft(Op)]),_:1}),ce(y).Token!=""&&(ce(C).aiList!=""||!ce(C).isAI)&&ce(C).aiInfo.ai_uid?(re(),he(xt,{key:0},[ft(ce(wi),{span:13},{default:Kt(()=>[ue("div",Qg,[ft(Tg)])]),_:1}),ft(ce(wi),{span:6},{default:Kt(()=>[ue("div",$g,[ft(Hg)])]),_:1})],64)):(re(),to(ce(wi),{key:1,span:19},{default:Kt(()=>[ft(Xg)]),_:1}))]),_:1}),ce(C).isLoadAi&&ce(C).aiList!=""?(re(),to(ce(Ys),{key:0,"position-absolute":"","left-0":"","top-0":"","w-100p":"","h-100p":"","z-6":""})):gt("",!0)],64))}});export{ah as default};
